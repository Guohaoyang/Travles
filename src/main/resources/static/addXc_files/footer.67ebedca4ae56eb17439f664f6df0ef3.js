function creatresize(){var t=$("#js_height_resize"),e=t[0].scrollHeight,i=$(document.body).height(),n=i-240;e>n?(t.addClass("lists_height"),t.css("height",n)):(t.removeClass("lists_height"),t.css("height",""));t.css("height")}window.QYER||(window.QYER={uid:0}),function(){var t=jQuery;!function(){window.qyerUtil={init:function(){window.QYER&&window.QYER.frameVersion>1&&(this._initHead(),this.spam_text_filter(),this.includeGA(),this.frameCompatibleh())},frameCompatibleh:function(){window._qyer_userid=window.QYER.uid,window.setCookie=this.setCookie,window.getCookie=this.getCookie,window._gaq=window._gaq||[]},includeGA:function(){window._gaq=window._gaq||[],window._gaq.push(["_setAccount","UA-185023-1"],["_setDomainName","qyer.com"],["_setSiteSpeedSampleRate",10],["_addIgnoredRef","qyer.com"],["_addOrganic","soso","w"],["_addOrganic","sogou","query"],["_addOrganic","baidu","word"],["_addOrganic","baidu","q1"],["_addOrganic","baidu","q2"],["_addOrganic","m.baidu","word"],["_addOrganic","so.360","q"],["_addOrganic","so","q"],["_addOrganic","baidu","w"],["_addOrganic","cn.bing","q"],["_addOrganic","sm","q"],["_trackPageview"]),"https:"==document.location.protocol?requirejs(["https://ssl.google-analytics.com/ga.js"]):requirejs(["https://qt.qyer.com/beacon.js","http://www.google-analytics.com/ga.js"])},setCookie:function(t,e,i){var n=365,s=new Date;arguments[2]||(i=1),1==i?(s.setTime(s.getTime()+24*n*60*60*1e3),document.cookie=t+"="+escape(e)+"; path=/;domain=.qyer.com;expires="+s.toGMTString()):document.cookie=t+"="+escape(e)+"; path=/;domain=.qyer.com",n=s=null},getCookie:function(t){var e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]*)(;|$)"));return null!=e?unescape(e[2]):null},_initHead:function(){"ask.qyer.com"==window.location.hostname&&t(".qyer_header_bg").css("position","fixed")},_head:null,_getHead:function(){return this._head||(this._head=document.getElementsByTagName("head")[0]),this._head},loadCss:function(e,i){!1===i?this.insertStyle(t.ajax({url:e,async:!1}).responseText):t('<link rel="stylesheet" type="text/css" />').attr("href",e).appendTo(this._getHead())},insertStyle:function(t){var e=document.createElement("style");e.type="text/css",e.styleSheet?e.styleSheet.cssText=t:e.innerHTML=t,this._getHead().appendChild(e),e=null},sliceArguments:function(t,e){for(var i=[],n=e;n<t.length;n++)i.push(t[n]);return i},isMobile:function(){var t=navigator.userAgent;return t.match(/Android/i)||-1!=t.indexOf("iPhone")||-1!=t.indexOf("iPad")},getWordLen:function(e,i){return i&&(e=function(t){return t.replace(/[^\x00-\xff]/g,"*")}(e)),function(t){if(void 0===t)return 0;var e=t.match(/[^\x00-\x80]/g);return t.length+(e?e.length:0)}(t.trim(e))},subStr:function(t,e){for(var i,n,s=0,a=0;a<t.length;a++)if(i=t.charAt(a),(s+=encodeURI(i).length>2?1:.5)>=e)return n=s==e?a+1:a,t.substr(0,n);return t},doTrackCode:function(e){var i="__dotarckcodebutton__";document.getElementById(i)||t('<button id="'+i+'" style="display:none;">dotarckcodebutton</button>').appendTo(document.body),t("#"+i).attr("data-bn-ipg",e).trigger("click"),i=null},ajaxFillter:function(t,e,i){if(0!=window.location.href.indexOf("https://plan.qyer.com")&&"object"==typeof t&&t.extra&&t.extra.code)switch(0|t.extra.code){case 1:window.qyerUtil.showAntiSpam(t.extra.msg)}},showAntiSpam:function(t){requirejs(["web_ct_antispam"],function(e){e.show(t)})},doAjax:function(e){var i,n,s;if(i=e.minResponseTime?new Date:null,s=function(t){if(void 0===t.error_code)try{t.error_code=t.error,t.result=t.result,0!=t.error_code&&(t.data=t.data||{},t.data.msg=t.msg)}catch(t){}0==t.error_code?(void 0===t.data&&(t.data=e.__defaultData__),e.onCallSuccessBefore&&e.onCallSuccessBefore(t),e.onSuccess&&e.onSuccess(t),e.onCallSuccessAfter&&e.onCallSuccessAfter(t)):e.onError&&e.onError(t)},e.testData)return void 0===e.testData.data&&(e.testData.data=e.__defaultData__),void setTimeout(function(){s(e.testData)},e.minResponseTime||200);var a=window.location.host,o=e.url||e.posturl,r=e.data,c="json";if(!0===/static.qyer.com/.test(a)||!0===/qyerstatic.com/.test(a)){var l;r=t.extend({},r,{__qFED__:e.__qFED__}),e.__qFED__&&e.__qFED__.id&&(l=e.__qFED__.id,e.type="GET"),o="http://fe.2b6.me:3000/service/api/"+l,c="jsonp",api=null}var h=t.ajax({type:e.type||"POST",url:o,dataType:c,data:r,cache:e.cache||!1,success:function(t){i?(n=new Date-i,setTimeout(function(){s.call(null,t)},n>e.minResponseTime?0:e.minResponseTime-n)):s.call(null,t),i=n=null},error:function(t,i){e.onError&&e.onError({error_code:-1,__server_error__:!0,__server_status__:h.statusText,result:"error",data:{msg:i||{}}})}});return h},runOneInPeriodOfTime:function(t,e){var i;return function(n,s,a,o,r){window.clearTimeout(i),i=window.setTimeout(function(){t(n,s,a,o,r)},e||300)}},isLogin:function(){return!(!window.QYER||!window.QYER.uid)},doLogin:function(t){window.qyerUtil.isLogin()||requirejs(["web_ct_logindialog"],function(e){e.show(t)})},doSignin:function(e){requirejs(["web_ct_logindialog"],function(i){i.show(t.extend({},{page:"regist"},e))})},getUrlParam:function(t,e){var i,n=new RegExp("(^|&)"+t+"=([^&]*)(&|$)");if(e){-1!=e.indexOf("?")&&(i=e.substr(e.indexOf("?")+1))}else i=window.location.search.substr(1);if(!i)return null;var s=i.match(n);return null!=s?unescape(s[2]):null},spam_text_filter:function(){var e,i,n,s,a;e=/(http:\/\/)?[\w\.]*\.?(mafengwo\.cn|mafengwo\.com|mafengwo\.net)[a-zA-Z\/0-9&\?\.#\-_]*/gim,a=t(".qyer_spam_text_filter"),a.find("a").each(function(){i=t(this),(-1!=(i.html()+i.attr("href")).indexOf("mafengwo.cn")||-1!=(i.html()+i.attr("href")).indexOf("mafengwo.com")||-1!=(i.html()+i.attr("href")).indexOf("mafengwo.net"))&&i.replaceWith(t(this).html())}),a.each(function(){if(i=t(this),n=i.html().replace(/\<script.*?\>document\.write\(AC_FL_RunContent.*?\<\/script\>/gim,""),null!=(s=n.match(/\<img[\s\S]*?\>/gim)))for(var a=0;a<s.length;a++)n=n.replace(s[a],"[imgimg]"+a+"[/imgimg]");if(n=n.replace(e,""),null!=s)for(var a=0;a<s.length;a++)n=n.replace("[imgimg]"+a+"[/imgimg]",s[a]);i.html(n)}),e=i=n=s=a=null},openUrl:function(e){var i=t('<form action="'+e+'" target="_blank" method="get"></form>');i.appendTo(document.body),i.submit(),setTimeout(function(){i.remove(),i=null},8e3)}}}(),function(){function t(t,e){for(var i in e)t[i]=e[i]}t(Date.prototype,{qGetWeekStr:function(){return"星期"+["日","一","二","三","四","五","六"][this.getDay()]},qAddDate:function(t){return this.setDate(this.getDate()+t),this},qToString:function(t){return[this.getFullYear(),this.getMonth()+1,this.getDate()].join(t||"-")}}),t(String.prototype,{qToDate:function(t){var e=this.split(t||"-");e=[0|e[0],(0|e[1])-1,0|e[2]];var i=new Date(e[0],e[1],e[2]);return e.length=0,e=null,i},qToIntFixed:function(){var t=0|this;return 10>t?"0"+t:t.toString()},qToHTML:function(){return this.replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/\n/gi,"<br />").replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;")}})}()}(),$(function(){qyerUtil.init()}),function(t){void 0===t.cookie&&(t.cookie=function(e,i,n){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(i))||null===i||void 0===i)){if(n=t.extend({},n),(null===i||void 0===i)&&(n.expires=-1),"number"==typeof n.expires){var s=n.expires,a=n.expires=new Date;a.setDate(a.getDate()+s)}return i=String(i),document.cookie=[encodeURIComponent(e),"=",n.raw?i:encodeURIComponent(i),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}n=i||{};for(var o,r=n.raw?function(t){return t}:decodeURIComponent,c=document.cookie.split("; "),l=0;o=c[l]&&c[l].split("=");l++)if(r(o[0])===e)return r(o[1]||"");return null})}(jQuery),function(t,e){function i(e,i){var s,a,o,r=e.nodeName.toLowerCase();return"area"===r?(s=e.parentNode,a=s.name,!(!e.href||!a||"map"!==s.nodeName.toLowerCase())&&(!!(o=t("img[usemap=#"+a+"]")[0])&&n(o))):(/input|select|textarea|button|object/.test(r)?!e.disabled:"a"===r?e.href||i:i)&&n(e)}function n(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}var s=0,a=/^ui-id-\d+$/;t.ui=t.ui||{},t.extend(t.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({focus:function(e){return function(i,n){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),n&&n.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),scrollParent:function(){var e;return e=t.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.css(this,"position"))&&/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(i){if(i!==e)return this.css("zIndex",i);if(this.length)for(var n,s,a=t(this[0]);a.length&&a[0]!==document;){if(("absolute"===(n=a.css("position"))||"relative"===n||"fixed"===n)&&(s=parseInt(a.css("zIndex"),10),!isNaN(s)&&0!==s))return s;a=a.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++s)})},removeUniqueId:function(){return this.each(function(){a.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,n){return!!t.data(e,n[3])},focusable:function(e){return i(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var n=t.attr(e,"tabindex"),s=isNaN(n);return(s||n>=0)&&i(e,!s)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(i,n){function s(e,i,n,s){return t.each(a,function(){i-=parseFloat(t.css(e,"padding"+this))||0,n&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),s&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var a="Width"===n?["Left","Right"]:["Top","Bottom"],o=n.toLowerCase(),r={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+n]=function(i){return i===e?r["inner"+n].call(this):this.each(function(){t(this).css(o,s(this,i)+"px")})},t.fn["outer"+n]=function(e,i){return"number"!=typeof e?r["outer"+n].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,i)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.support.selectstart="onselectstart"in document.createElement("div"),t.fn.extend({disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.extend(t.ui,{plugin:{add:function(e,i,n){var s,a=t.ui[e].prototype;for(s in n)a.plugins[s]=a.plugins[s]||[],a.plugins[s].push([i,n[s]])},call:function(t,e,i){var n,s=t.plugins[e];if(s&&t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType)for(n=0;s.length>n;n++)t.options[s[n][0]]&&s[n][1].apply(t.element,i)}},hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",s=!1;return e[n]>0||(e[n]=1,s=e[n]>0,e[n]=0,s)}})}(jQuery),function(t,e){var i=0,n=Array.prototype.slice,s=t.cleanData;t.cleanData=function(e){for(var i,n=0;null!=(i=e[n]);n++)try{t(i).triggerHandler("remove")}catch(t){}s(e)},t.widget=function(i,n,s){var a,o,r,c,l={},h=i.split(".")[0];i=i.split(".")[1],a=h+"-"+i,s||(s=n,n=t.Widget),t.expr[":"][a.toLowerCase()]=function(e){return!!t.data(e,a)},t[h]=t[h]||{},o=t[h][i],r=t[h][i]=function(t,i){return this._createWidget?(arguments.length&&this._createWidget(t,i),e):new r(t,i)},t.extend(r,o,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),c=new n,c.options=t.widget.extend({},c.options),t.each(s,function(i,s){return t.isFunction(s)?(l[i]=function(){var t=function(){return n.prototype[i].apply(this,arguments)},e=function(t){return n.prototype[i].apply(this,t)};return function(){var i,n=this._super,a=this._superApply;return this._super=t,this._superApply=e,i=s.apply(this,arguments),this._super=n,this._superApply=a,i}}(),e):(l[i]=s,e)}),r.prototype=t.widget.extend(c,{widgetEventPrefix:o?c.widgetEventPrefix:i},l,{constructor:r,namespace:h,widgetName:i,widgetFullName:a}),o?(t.each(o._childConstructors,function(e,i){var n=i.prototype;t.widget(n.namespace+"."+n.widgetName,r,i._proto)}),delete o._childConstructors):n._childConstructors.push(r),t.widget.bridge(i,r)},t.widget.extend=function(i){for(var s,a,o=n.call(arguments,1),r=0,c=o.length;c>r;r++)for(s in o[r])a=o[r][s],o[r].hasOwnProperty(s)&&a!==e&&(i[s]=t.isPlainObject(a)?t.isPlainObject(i[s])?t.widget.extend({},i[s],a):t.widget.extend({},a):a);return i},t.widget.bridge=function(i,s){var a=s.prototype.widgetFullName||i;t.fn[i]=function(o){var r="string"==typeof o,c=n.call(arguments,1),l=this;return o=!r&&c.length?t.widget.extend.apply(null,[o].concat(c)):o,r?this.each(function(){var n,s=t.data(this,a);return s?t.isFunction(s[o])&&"_"!==o.charAt(0)?(n=s[o].apply(s,c),n!==s&&n!==e?(l=n&&n.jquery?l.pushStack(n.get()):n,!1):e):t.error("no such method '"+o+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+o+"'")}):this.each(function(){var e=t.data(this,a);e?e.option(o||{})._init():t.data(this,a,new s(o,this))}),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,n){n=t(n||this.defaultElement||this)[0],this.element=t(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),n!==this&&(t.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===n&&this.destroy()}}),this.document=t(n.style?n.ownerDocument:n.document||n),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,n){var s,a,o,r=i;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof i)if(r={},s=i.split("."),i=s.shift(),s.length){for(a=r[i]=t.widget.extend({},this.options[i]),o=0;s.length-1>o;o++)a[s[o]]=a[s[o]]||{},a=a[s[o]];if(i=s.pop(),n===e)return a[i]===e?null:a[i];a[i]=n}else{if(n===e)return this.options[i]===e?null:this.options[i];r[i]=n}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(i,n,s){var a,o=this;"boolean"!=typeof i&&(s=n,n=i,i=!1),s?(n=a=t(n),this.bindings=this.bindings.add(n)):(s=n,n=this.element,a=this.widget()),t.each(s,function(s,r){function c(){return i||!0!==o.options.disabled&&!t(this).hasClass("ui-state-disabled")?("string"==typeof r?o[r]:r).apply(o,arguments):e}"string"!=typeof r&&(c.guid=r.guid=r.guid||c.guid||t.guid++);var l=s.match(/^(\w+)\s*(.*)$/),h=l[1]+o.eventNamespace,d=l[2];d?a.delegate(d,h,c):n.bind(h,c)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var s,a,o=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(s in a)s in i||(i[s]=a[s]);return this.element.trigger(i,n),!(t.isFunction(o)&&!1===o.apply(this.element[0],[i].concat(n))||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,s,a){"string"==typeof s&&(s={effect:s});var o,r=s?!0===s||"number"==typeof s?i:s.effect||i:e;s=s||{},"number"==typeof s&&(s={duration:s}),o=!t.isEmptyObject(s),s.complete=a,s.delay&&n.delay(s.delay),o&&t.effects&&t.effects.effect[r]?n[e](s):r!==e&&n[r]?n[r](s.duration,s.easing,a):n.queue(function(i){t(this)[e](),a&&a.call(n[0]),i()})}})}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,s=1===i.which,a=!("string"!=typeof this.options.cancel||!i.target.nodeName)&&t(i.target).closest(this.options.cancel).length;return!(s&&!a&&this._mouseCapture(i))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=!1!==this._mouseStart(i),!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return n._mouseMove(t)},this._mouseUpDelegate=function(t){return n._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0))}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t){function e(t,e,i){return t>e&&e+i>t}function i(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))}t.widget("ui.sortable",t.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===t.axis||i(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,i){"disabled"===e?(this.options[e]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,i){var n=null,s=!1,a=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,a.widgetName+"-item")===a?(n=t(this),!1):void 0}),t.data(e.target,a.widgetName+"-item")===a&&(n=t(e.target)),!!n&&(!(this.options.handle&&!i&&(t(this.options.handle,n).find("*").addBack().each(function(){this===e.target&&(s=!0)}),!s))&&(this.currentItem=n,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,i,n){var s,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=t("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!o.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,n,s,a,o=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:e.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:e.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(e.pageY-t(document).scrollTop()<o.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-o.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<o.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+o.scrollSpeed)),e.pageX-t(document).scrollLeft()<o.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-o.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<o.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+o.scrollSpeed))),!1!==r&&t.ui.ddmanager&&!o.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=this.items[i],s=n.item[0],(a=this._intersectsWithPointer(n))&&n.instance===this.currentContainer&&s!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==s&&!t.contains(this.placeholder[0],s)&&("semi-dynamic"!==this.options.type||!t.contains(this.element[0],s))){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(e,n),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var n=this,s=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=s.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=s.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){n._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&n.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!n.length&&e.key&&n.push(e.key+"="),n.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},i.each(function(){n.push(t(e.item||this).attr(e.attribute||"id")||"")}),n},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,n=this.positionAbs.top,s=n+this.helperProportions.height,a=t.left,o=a+t.width,r=t.top,c=r+t.height,l=this.offset.click.top,h=this.offset.click.left,d="x"===this.options.axis||n+l>r&&c>n+l,p="y"===this.options.axis||e+h>a&&o>e+h,u=d&&p;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?u:e+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&n+this.helperProportions.height/2>r&&c>s-this.helperProportions.height/2},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||e(this.positionAbs.left+this.offset.click.left,t.left,t.width),s=i&&n,a=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return!!s&&(this.floating?o&&"right"===o||"down"===a?2:1:a&&("down"===a?2:1))},_intersectsWithSides:function(t){var i=e(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),n=e(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return this.floating&&a?"right"===a&&n||"left"===a&&!n:s&&("down"===s&&i||"up"===s&&!i)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){var i,n,s,a,o=[],r=[],c=this._connectWith();if(c&&e)for(i=c.length-1;i>=0;i--)for(s=t(c[i]),n=s.length-1;n>=0;n--)(a=t.data(s[n],this.widgetFullName))&&a!==this&&!a.options.disabled&&r.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(r.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=r.length-1;i>=0;i--)r[i][0].each(function(){o.push(this)});return t(o)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,n,s,a,o,r,c,l,h=this.items,d=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],p=this._connectWith()
;if(p&&this.ready)for(i=p.length-1;i>=0;i--)for(s=t(p[i]),n=s.length-1;n>=0;n--)(a=t.data(s[n],this.widgetFullName))&&a!==this&&!a.options.disabled&&(d.push([t.isFunction(a.options.items)?a.options.items.call(a.element[0],e,{item:this.currentItem}):t(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],n=0,l=r.length;l>n;n++)c=t(r[n]),c.data(this.widgetName+"-item",o),h.push({item:c,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,n,s,a;for(i=this.items.length-1;i>=0;i--)n=this.items[i],n.instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(s=this.options.toleranceElement?t(this.options.toleranceElement,n.item):n.item,e||(n.width=s.outerWidth(),n.height=s.outerHeight()),a=s.offset(),n.left=a.left,n.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,n=e.options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=e.currentItem[0].nodeName.toLowerCase(),s=t("<"+n+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===n?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(s)}):"img"===n&&s.attr("src",e.currentItem.attr("src")),i||s.css("visibility","hidden"),s},update:function(t,s){(!i||n.forcePlaceholderSize)&&(s.height()||s.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),s.width()||s.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(n.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),n.placeholder.update(e,e.placeholder)},_contactContainers:function(n){var s,a,o,r,c,l,h,d,p,u,f=null,m=null;for(s=this.containers.length-1;s>=0;s--)if(!t.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(f&&t.contains(this.containers[s].element[0],f.element[0]))continue;f=this.containers[s],m=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",n,this._uiHash(this)),this.containers[s].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(o=1e4,r=null,u=f.floating||i(this.currentItem),c=u?"left":"top",l=u?"width":"height",h=this.positionAbs[c]+this.offset.click[c],a=this.items.length-1;a>=0;a--)t.contains(this.containers[m].element[0],this.items[a].item[0])&&this.items[a].item[0]!==this.currentItem[0]&&(!u||e(this.positionAbs.top+this.offset.click.top,this.items[a].top,this.items[a].height))&&(d=this.items[a].item.offset()[c],p=!1,Math.abs(d-h)>Math.abs(d+this.items[a][l]-h)&&(p=!0,d+=this.items[a][l]),o>Math.abs(d-h)&&(o=Math.abs(d-h),r=this.items[a],this.direction=p?"up":"down"));if(!r&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;r?this._rearrange(n,r,null,!0):this._rearrange(n,null,this.containers[m].element,!0),this._trigger("change",n,this._uiHash()),this.containers[m]._trigger("change",n,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(!n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,s=this.options;"parent"===s.containment&&(s.containment=this.helper[0].parentNode),("document"===s.containment||"window"===s.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===s.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===s.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(s.containment)||(e=t(s.containment)[0],i=t(s.containment).offset(),n="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"===e?1:-1,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:s.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:s.scrollLeft())*n}},_generatePosition:function(e){var i,n,s=this.options,a=e.pageX,o=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,c=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),s.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/s.grid[1])*s.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-s.grid[1]:i+s.grid[1]:i,n=this.originalPageX+Math.round((a-this.originalPageX)/s.grid[0])*s.grid[0],a=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-s.grid[0]:n+s.grid[0]:n)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():c?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():c?0:r.scrollLeft())}},_rearrange:function(t,e,i,n){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var s=this.counter;this._delay(function(){s===this.counter&&this.refreshPositions(!n)})},_clear:function(t,e){this.reverting=!1;var i,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)e||n.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(n.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),i=0;n.length>i;i++)n[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(i=0;n.length>i;i++)n[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){!1===t.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})}(jQuery),function(t){function e(t){for(var e,i=["transform","WebkitTransform","msTransform","MozTransform","OTransform"];e=i.shift();)if(void 0!==t.style[e])return e;return"transform"}var i=null,n=t.fn.css;t.fn.css=function(s,a){if(null===i&&(i=void 0!==t.cssProps?t.cssProps:void 0!==t.props?t.props:{}),void 0===i.transform&&("transform"==s||"object"==typeof s&&void 0!==s.transform)&&(i.transform=e(this.get(0))),"transform"!=i.transform)if("transform"==s){if(s=i.transform,void 0===a&&jQuery.style)return jQuery.style(this.get(0),s)}else"object"==typeof s&&void 0!==s.transform&&(s[i.transform]=s.transform,delete s.transform);return n.apply(this,arguments)}}(jQuery),function(t){function e(t){var e=t.data("_ARS_data");return e||(e={rotateUnits:"deg",scale:1,rotate:0},t.data("_ARS_data",e)),e}function i(t,e){t.css("transform","rotate("+e.rotate+e.rotateUnits+") scale("+e.scale+","+e.scale+")")}t.fn.rotate=function(n){var s,a=t(this),o=e(a);return void 0===n?o.rotate+o.rotateUnits:(s=n.toString().match(/^(-?\d+(\.\d+)?)(.+)?$/),s&&(s[3]&&(o.rotateUnits=s[3]),o.rotate=s[1],i(a,o)),this)},t.fn.scale=function(n){var s=t(this),a=e(s);return void 0===n?a.scale:(a.scale=n,i(s,a),this)};var n=t.fx.prototype.cur;t.fx.prototype.cur=function(){return"rotate"==this.prop?parseFloat(t(this.elem).rotate()):"scale"==this.prop?parseFloat(t(this.elem).scale()):n.apply(this,arguments)},t.fx.step.rotate=function(i){var n=e(t(i.elem));t(i.elem).rotate(i.now+n.rotateUnits)},t.fx.step.scale=function(e){t(e.elem).scale(e.now)};var s=t.fn.animate;t.fn.animate=function(i){if(void 0!==i.rotate){var n,a,o=i.rotate.toString().match(/^(([+-]=)?(-?\d+(\.\d+)?))(.+)?$/);o&&o[5]&&(n=t(this),a=e(n),a.rotateUnits=o[5]),i.rotate=o[1]}return s.apply(this,arguments)}}(jQuery),define("common/js/message",function(){function t(){this.__listeners__=[]}var e=jQuery;return t.prototype={msg:{},__listeners__:null,addListener:function(t){"object"==e.type(t)&&-1==e.inArray(t,this.__listeners__)&&this.__listeners__.push(t)},removeListener:function(t){var i=e.inArray(t,this.__listeners__);-1!=i&&this.__listeners__.splice(i,1),i=null},postMessage:function(t,i){for(var n,s,a=qyerUtil.sliceArguments(arguments,1),o=0,r=this.__listeners__.length;o<r;o++)n=this.__listeners__[o]||{},s=n[t],"function"==e.type(s)&&s.apply(n,a);a.length=0,n=s=null}},t}),define("common/js/page",function(){function t(){this.obj=null,this.pobj=null,this.loading=null,this.callback=null}var e=jQuery;return t.prototype={init:function(t){this.obj=e(t),this.loading=e("<div>loading...</div>")},initPage:function(t){this.loading||this.obj.after(this.loading),void 0!==t&&""==t&&this.getData(t),this.pobj=this.obj.find(".page"),this.pobj.find("a").each(function(t){"current"!=e(this).cassName&&(e(this).attr("def",e(this).attr("href")),e(this).attr("href","javascript:;"))});var i=this;this.pobj.find("a").bind("click",function(t){if("current"==e(this).cassName)return!1;var n=e(this).attr("def");if(void 0===n||""==n)return!1;i.loading.show(),i.getData(n)})},getData:function(t){var i=this;"function"==typeof i.ajaxBfCbFun&&i.ajaxBfCbFun(),e.getJSON(t,{},function(t){"function"==typeof i.callback?i.callback(t):i.obj.html(e(t.data.html)),i.initPage()})}},t}),define("project/plan/web/js/createMessage",["common/js/message"],function(t){var e=new t;return e.msg={},e.addListener({onAddCity:function(t,e){t.addToPlan(e)}}),e}),define("project/plan/web/js/dataCreateAPI",["project/plan/web/js/createMessage","common/js/page"],function(t,e){var i={};return i.getCountryJson=function(t,i,n){var s;return s=new e,s.init("#create_box"),s.callback=function(t){this.obj.html($(t.data.html))},s.getData("/createplan.php?action=getCountryListByTypeId"),!1},i.getCityJson=function(t,e,i){var n={cityJson:{cid21:{id:21,cityname:"尼斯",cityname_en:"Nice",lat:"43.696037",lng:"7.265592",fundays:1},cid27:{id:27,cityname:"伦敦",cityname_en:"London",lat:"51.508129",lng:"-0.128005",fundays:3},cid7235:{id:7235,cityname:"马赛",cityname_en:"Marseille",lat:"43.296482",lng:"5.369780",fundays:1},cid8755:{id:8755,cityname:"爱丁堡",cityname_en:"Edinburgh",lat:"55.953251",lng:"-3.188267",fundays:2},cid9609:{id:9609,cityname:"剑桥",cityname_en:"Cambridge",lat:"52.200001",lng:"0.116667",fundays:1},cid9649:{id:9649,cityname:"曼彻斯特",cityname_en:"Manchester",lat:"53.500000",lng:"-2.216667",fundays:1}},page:2,html:"citylist + pagestr"};i.call(e,n)},i}),define("project/plan/web/js/createCountry",["project/plan/web/js/dataCreateAPI","project/plan/web/js/createMessage","common/js/page","project/plan/web/js/createMyPlan","web_old_map"],function(t,e,i,n,s){function a(){this.map="",this.markersData="",this.countryType="",this.myPlan="",this.recommend_cities=[],this.recommend_id=null,this.country_map={},this.infoWindows=[],this.map_loaded=!1}return a.prototype={init:function(t){var i=this;i.map=t,i.myPlan=new n("js_myplanbox",i.map),e.addListener({onShowCitysByCountryId:function(t){i.getCity(1,t,i.map)}}),e.addListener({onShowCountrysByType:function(t){i.getCountryList(t)}})},getCountryList:function(t){var e,n,s=this;window.boundsListener&&(google.maps.event.removeListener(window.boundsListener),window.boundsListener=null),s.countryType=t,s.country_map={},e="/api/place.php?action=getcountrylist&continent_id="+t,n=new i,n.init("#create_box"),n.ajaxBfCbFun=function(){$("#createplan_map_loading").show(),$("#js_creatLoading").show()},n.callback=function(t){var e,i=t.data;e=$(i.html),s.bindEvent(s,e,s.countryType),$("#create_box").html(e),s.drawMapMarker(i.list),$.each(i.list,function(t,e){s.country_map[e.id]=!!e.recommend_plans}),setTimeout(function(){$("#createplan_map_loading").hide()},2e3),$("#js_creatLoading").hide()},n.getData(e)},bindEvent:function(t,i,n){i.find(".js_country").click(function(i){var n=$(this).attr("data-id");$(i.target).parent().hasClass("js_card")||e.postMessage("onShowCitysByCountryId",n),t.country_map[n]&&t.showRecommendPlansPopup(n,$(i.target).find("span.cn").text())}),i.find("#country_typelist a").on("click",function(){var e,i=$(this);i.parent().find("a").removeClass("current"),i.addClass("current"),e=i.attr("data-typeid"),t.getCountryList(e)})},showRecommendPlansPopup:function(t,e){var i=this;requirejs(["web_old_popup"],function(n){n.show({title:e+"经典路线推荐",exClassName:"recommend_plans",contentHTML:'<div class="recommend_details"><div class="loading">数据加载中...</div></div><div id="recommend_map" class="recommend_map"><div class="loading">地图加载中...</div></div><div class="clear"></div>',okText:"选择此路线",cancelText:"手动规划城市",width:958,onOK:function(){$.each(i.recommend_cities,function(t,e){var n={cityid:e.id,cityname:e.name,cityname_en:e.name_en,fundays:parseFloat(e.days),lat:e.lat,lng:e.lng};i.myPlan.addCity(n)}),qyerUtil.doAjax({url:"/api/recommend.php?action=use_recommendroute",data:{id:i.recommend_id}})}}),$(".recommend_plans .qui-popup-closeIcon").attr("data-bn-ipg","plan-create-popup-close"),$(".recommend_plans .qui-popup-okBtn").attr("data-bn-ipg","plan-create-popup-choose"),$(".recommend_plans .ui_button_cancel").attr("data-bn-ipg","plan-create-popup-DIY"),qyerUtil.doAjax({url:"/api/recommend.php?action=get_recommendroute",data:{country_id:t},onSuccess:function(t){i.buildRecommendPlans(t.data)}})})},buildRecommendPlans:function(t){var e,i=this,n=['<div class="prev_plan" data-bn-ipg="plan-create-popup-left"><a href="#"></a></div>','<div class="recommend_wrapper">'],s=["</div>",'<div class="next_plan" data-bn-ipg="plan-create-popup-right"><a href="#"></a></div>'];i.recommend_cities=[],i.recommend_id=null,$.each(t,function(t,e){var i=[],s="";$.each(e.cities,function(t,e){i.push(e.name+"("+e.days+"天)")}),t>0&&(s='style="display:none"'),n.push('<div class="plan_item" '+s+'><div class="title"><h2>'+e.name+'</h2><span class="sep">|</span><em>'+e.rate+'%</em><span>的人选择</span></div><div class="cities">'+i.join(" &gt; ")+'</div><div class="desc"><h3><span></span>路线简介</h3><p>'+e.desc+'</p></div><div class="pois"><h3><span></span>经典游玩</h3><p>'+e.pois.join("、")+'</p></div><div class="tags"><h3><span></span>特色</h3><p><span>'+e.tags.join("</span><span>")+"</span></p></div></div>")}),e=$(".recommend_plans .recommend_details").html(n.join("")+s.join("")).data("index",0).on("click",".prev_plan a",function(){var n=e.data("index")-1;i.changeRecommendPlan(this,e,n,t,function(){e.find(".next_plan a").removeClass("disabled"),0===n&&e.find(".prev_plan a").addClass("disabled")})}).on("click",".next_plan a",function(){var n=e.data("index")+1;i.changeRecommendPlan(this,e,n,t,function(){e.find(".prev_plan a").removeClass("disabled"),n===t.length-1&&e.find(".next_plan a").addClass("disabled")})}).find(".prev_plan a").addClass("disabled").end(),1===t.length&&e.find(".next_plan a").addClass("disabled"),require(["web_old_gmap"],function(e){e.init("recommend_map"),i.updateRecommendMap(0,t)})},updateRecommendMap:function(t,e){var i=this,n={url:"https://static.qyer.com/images/plan2/p_2_2/map_ico.png",size:{w:27,h:32},point:{x:0,y:704}};require(["web_old_gmap"],function(s){$.each(e[t].cities,function(t,e){var a=s.addMarker($.extend(e,{icon:$.extend(n,{point:{x:0,y:32*t}})})),o=s.createDiyInfoWindow({content:'<div class="city_name"><span>'+e.name+'</span><div class="triangle"></div></div>'});o.open(s.map,a),i.infoWindows.push(o)}),s.drawLine(e[t].cities,{strokeColor:"#F00",strokeOpacity:.5,strokeWeight:2}),s.fitBounds(e[t].cities),i.recommend_cities=e[t].cities,i.recommend_id=e[t].id})},changeRecommendPlan:function(t,e,i,n,s){if(!$(t).hasClass("disabled")){var a=$(".recommend_plans .plan_item");for(a.not(":eq("+i+")").hide(),a.eq(i).show(),e.data("index",i),require(["web_old_gmap"],function(t){t.clearMarker(),t.clearLine()});this.infoWindows.length;)this.infoWindows.shift().close();this.updateRecommendMap(i,n),"function"==typeof s&&s()}},drawMapMarker:function(t){var i,n=this;if(!s.mapLoadIsOk)return setTimeout(function(){n.drawMapMarker(t)},1e3),!1;this.map.removeMarker(this.myPlan.ccMarkersData),i=this.formatMapData(t),i=this.map.formatMarkerData(i),markerConfig={"z-index":999},markerConfig.markerClickCb=function(t,i){e.postMessage("onShowCitysByCountryId",i.id)},markerConfig.getMapIconCb=function(t,e,i){var n,s,a;return n=new google.maps.Point(0,0),s=new google.maps.Size(30,46),a="//common3.qyerstatic.com/plan/desktop/create/img/maskLayout_bg.png",new google.maps.MarkerImage(a,s,n)},this.markersData=this.map.drawMarker(i.markers,markerConfig),this.myPlan.contactCcMarker(this.markersData),this.map.fitBounds(i.bounds),$("#create_box").find(".js_country").each(function(t,e){$(e).hover(function(){for(var t=$(this).find(".cn").text(),e=0;e<n.markersData.length;e++){n.markersData[e].title==t&&n.markersData[e].setAnimation(google.maps.Animation.BOUNCE)}},function(){n.markersData[t].setAnimation(null)})})},formatMapData:function(t){var e=[];return!!t&&($.each(t,function(t,i){e.push({id:i.id,name:i.catename,lat:i.lat,lng:i.lng,countryname:i.catename,countryname_en:i.catename_en})}),e)},setLableEvent:function(){var t,i=this;t=i.map.mapDivId,$("#"+t).find("._js_mapOverLayer").on("click",function(){var t=$(this).find("._js_dataSource").attr("data-countryid");e.postMessage("onShowCitysByCountryId",t)}),$("#"+t).find("._js_mapOverLayer").on("mouseover",function(){$(this).addClass("creat_mask_map_layer_hover")}),$("#"+t).find("._js_mapOverLayer").on("mouseout",function(){$(this).removeClass("creat_mask_map_layer_hover")})},getCity:function(t,e,i,n,s){requirejs(["project/plan/web/js/createCity"],function(n){var s=new n;s.init(i),s.showCityByCountryId(t,e)})}},a}),define("project/plan/web/js/createCity",["project/plan/web/js/dataCreateAPI","project/plan/web/js/createMessage","common/js/page","project/plan/web/js/createMyPlan","web_old_map","lodash"],function(t,e,i,n,s,a){function o(){this.map="",this.myPlan="",this.markersData="",this.cityData={},this.addTip=""}var r=!1;return o.prototype={init:function(t){this.map=t,this.myPlan=new n("js_myplanbox",this.map)},initTip:function(){var t=this,e=t.myPlan;if(a.size(e.planCity)<1){if(""==t.addTip){var i=$("#create_plan_tip_box").html();i=$(i),t.addTip=i,t.addTip.bind("selectstart",function(){return!1})}$("#create_box").after(t.addTip),t.addTip.show(),$(document).click(function(){$("#create_plan_tip").hide()})}},showCityByCountryId:function(t,n){var s,a,o=this;s="/api/ra.php?action=country2city&countryid="+n,2==t&&(s="/api/ra.php?action=city2city&cityid="+n),$("#createplan_map_loading").show(),a=new i,a.init("#create_box"),a.ajaxBfCbFun=function(){$("#createplan_map_loading").show(),$("#js_creatLoading").show()},a.callback=function(t){var i,n=t.data;if("ok"!=t.result)return!1;i=$(n.html),i.find("._js_addcity").bind("click",function(){var t=$(this).attr("data-cityid");e.postMessage("onAddCity",o,o.cityData[t])}),i.find("#js_countrytype .js_types").bind("click",function(){var t=$(this).attr("data-type");o.map.removeMarker(o.myPlan.ccMarkersData),e.postMessage("onShowCountrysByType",t)}),i.find(".lists").scroll(function(){$("#create_plan_tip").hide()}),i.find("#js_country2city").click(function(){var t=$(this).attr("data-id");e.postMessage("onShowCitysByCountryId",t)}),$("#create_box").html(i),r=!0,o.drawMapMarker(n.list),o.setCityData(n.list),o.initTip(),setTimeout(function(){$("#createplan_map_loading").hide()},2e3),$("#js_creatLoading").hide()},a.getData(s),window.boundsListener=this.map.map.addListener("idle",function(){if(r)r=!1;else{var t=o.map.map.getBounds(),e=t.getNorthEast(),i=t.getSouthWest(),s=o.map.map.getCenter();$.ajax({url:"/api/v3/map/getCityByLatLng",type:"POST",data:{country_id:n,centerlat:s.lat(),centerlng:s.lng(),maxlat:e.lat(),maxlng:e.lng(),minlat:i.lat(),minlng:i.lng()},dataType:"json",success:function(t){0===t.error_code&&t.data&&t.data.list&&t.data.list.length>0&&(r=!0,o.drawMapMarker(t.data.list,!0),o.setCityData(t.data.list),o.initTip())}})}})},addToPlan:function(t){var e=this;requirejs(["project/plan/web/js/createMyPlan"],function(i){new i("js_myplanbox",e.map).addCity(t),$("#js_height_resize").scrollTop(1e6)})},setCityData:function(t){var e=this.cityData;$.each(t,function(t,i){var n=i.cityid||i.id;void 0===e[n]&&(e[n]=i)})},drawMapMarker:function(t,i){var n,o,c=this;if(!s.mapLoadIsOk)return!1;n=this.formatMapData(t),n=this.map.formatMarkerData(n),markerConfig={"z-index":999},markerConfig.markerClickCb=function(t,i){e.postMessage("onAddCity",c,c.cityData[i.id])},markerConfig.getMapIconCb=function(t,e,i){var n,s,a;return n=new google.maps.Point(0,0),s=new google.maps.Size(30,46),a="//common3.qyerstatic.com/plan/desktop/create/img/maskLayout_bg.png",new google.maps.MarkerImage(a,s,n)},this.map.removeMarker(this.myPlan.ccMarkersData),this.markersData=this.map.drawMarker(n.markers,markerConfig),this.myPlan.contactCcMarker(this.markersData),i?r=!1:(a.size(n.markers)>1&&(r=!0,this.map.fitBounds(n.bounds)),o=$("#js_plan_foundcity_content").width(),setTimeout(function(){c.myPlan.cityCnt>0&&(o=$(".plan_creat_warp").width()),c.setLableEvent("createplan_map",c.map),r=!0,c.map.moveCenterPos(o,n.coordinates)},1500)),$("#create_box").find(".js_items").each(function(t,e){$(e).hover(function(){var e=c.markersData[t];e&&e.setAnimation(google.maps.Animation.BOUNCE)},function(){var e=c.markersData[t];e&&e.setAnimation(null)})})},formatMapData:function(t){var e=[];return!!t&&($.each(t,function(t,i){e.push({id:i.id,name:i.cityname,lat:i.lat,lng:i.lng,cityname:i.cityname,cityname_en:i.cityname_en})}),e)},setLableEvent:function(t,e){$("#"+t).find("._js_mapOverLayer").on("mouseover",function(){$(this).addClass("creat_mask_map_layer_hover")}),$("#"+t).find("._js_mapOverLayer").on("mouseout",function(){$(this).removeClass("creat_mask_map_layer_hover")})}},o}),define("project/plan/web/js/createMyPlan",["project/plan/web/js/dataCreateAPI","project/plan/web/js/createMessage","web_old_map","web_old_popup","lodash"],function(t,e,i,n,s){function a(t,e){if(void 0!==a.unique)return a.unique;this.box="",this.startTime="",this.startCity={},this.endCity={},this.planCity={},this.cityCnt=0,this.cityList={},this.cityIndex=0,this.planDays=0,this.localCity="",this.localCityId=0,this.map="",this.markersData="",this.ccMarkersData=[],this.lineData="",this.traffic={},this.isOpenLayer=!1,this.init(t,e),a.unique=this}return a.prototype={setLocalCity:function(){var t=$("#localCityName");this.localCity=t.attr("data-city"),this.localCityId=t.attr("data-cityid")},getCid:function(){return"c"+this.cityIndex++},init:function(t,i){var n=this;this.getCid();this.map=i,this.box=$("#"+t),this.setLocalCity(),this.startCity={type:20,cityid:n.localCityId,cityname:n.localCity,cityname_en:"",lat:"",lng:"",stay_days:1,xcid:0,isModify:0},this.endCity={type:21,cityid:n.localCityId,cityname:n.localCity,cityname_en:"",lat:"",lng:"",stay_days:1,xcid:1,isModify:0},e.addListener({onDelPlanCity:function(t){n.delPlanCity(t)}}),$("#js_createplan_save").one("click",function(){n.savePlan()}),$("#js_optimize_plan").click(function(){n.optimizePlan()})},savePlan:function(){var t=this;if(s.size(t.planCity)<1)return $("#js_createplan_save").one("click",function(){t.savePlan()}),!1;t.checkPlanCity();var e={},i={},n={},a={};s.each(t.planCity,function(t,e){n[e]={dataid:t.cityid,days:t.stay_days,name:t.cityname,type:t.type}}),e.i=t.startCity.cityid,e.n=t.startCity.cityname,i.i=t.endCity.cityid,i.n=t.endCity.cityname,a={citylist:n,scity:e,ecity:i,starttime:t.startTime},a=JSON.stringify(a);var o=document.createElement("form"),r=document.createElement("input");o.setAttribute("action","/trip/create"+window.location.search),o.setAttribute("method","POST"),r.setAttribute("type","hidden"),r.setAttribute("name","planinfo"),r.value=a,o.appendChild(r),document.body.appendChild(o),o.submit()},showLayer:function(){0==this.isOpenLayer&&(this.box.show().animate({left:0}),this.isOpenLayer=!0)},hideLayer:function(){1==this.isOpenLayer&&(this.box.animate({left:-360}),this.isOpenLayer=!1)},addCity:function(t){var e,i,n=this;if(n.planDays+t.fundays>50)return requirejs(["common/ui/tip/tip"],function(t){t.tip({text:"行程最多支持50天",type:"warning"})}),!0;i=this.getCid(),this.showLayer(),this.cityCnt++,e={type:1,cityid:t.cityid,cityname:t.cityname,cityname_en:t.cityname_en,stay_days:t.fundays,lat:t.lat,lng:t.lng,xcid:i},this.planCity[i]=e,this.cityList[t.cityid]=t,this.planDays+=e.stay_days,this.renderPlan(),setTimeout(function(){n.renderMap()},1e3),$("#create_plan_tip").hide(),this.cityCnt>=4&&($("#js_myplanbox").addClass("plan_myplan_content_layout"),$("#js_optimize_plan").show(),$("#js_optimize_plan").animate({opacity:1},500))},renderPlan:function(){var t="",e=this,i=$("#js_height_resize");if(e.checkPlanCity(),e.cityCnt<=0)return t=e._formatNoCityTpl(),i.html(t),!0;var n,s;$.each(e.planCity,function(i,a){void 0===s&&(s=a),void 0!==n&&(t+=e._initTraffic(n,a)),t+=e._formatCityTpl(a),n=a}),t=e._formatCityTpl(e.startCity)+e._initTraffic(e.startCity,s)+t,t+=e._initTraffic(n,e.endCity)+e._formatCityTpl(e.endCity),t=$(t),e._bindCityItemEvent(t),i.html(t),e.getTraffic(),e.bindDragSort(),creatresize()},_bindCityItemEvent:function(t){var i=this,n="";t.filter(".updown").find(".js_edit_city").click(function(){var t=$(this).parents(".updown"),e=t.find("input");t.find(".text").fadeOut("normal",function(){
t.find(".input").fadeIn("normal",function(){i.bindAutoComplete(e),t.find("input").focus()})})}),n=t.find(".js_cityitem"),n.find(".close").click(function(){var t=$(this).parent().attr("data-xcid");e.postMessage("onDelPlanCity",t)}),n.find(".js_reduceday").click(function(t){var e=$(this),n=e.parent(),s=n.parent(".js_cityitem").attr("data-xcid");i._changeStayDay(s,2,n),t.stopPropagation()}),n.find(".js_addday").click(function(t){var e=$(this),n=e.parent(),s=n.parent(".js_cityitem").attr("data-xcid");i._changeStayDay(s,1,n),t.stopPropagation()})},_changeStayDay:function(t,e,i){var n=1,s=this,a=s.planCity[t],o=a.stay_days;if(1==e){if(s.planDays>=50)return requirejs(["common/ui/tip/tip"],function(t){t.tip({text:"行程最多支持50天",type:"warning"})}),!0;if(o>=20)return!1;o<1&&(n=.5),o+=n,this.planDays+=n,20==o&&i.find(".js_addday").removeClass("ricon").addClass("rnoneicon"),o>=.5&&i.find(".js_reduceday").removeClass("lnoneicon").addClass("licon")}else 2==e&&o>.5&&(o<=1&&(n=.5),o-=n,this.planDays-=n,.5==o&&i.find(".js_reduceday").removeClass("licon").addClass("lnoneicon"),o<20&&i.find(".js_addday").removeClass("rnoneicon").addClass("ricon"));i.find(".js_day").html(o+"天"),s.planCity[t].stay_days=o},_initTraffic:function(t,e){return'<div class="traffics js_traffic" data-cid="'+t.xcid+"_"+e.xcid+'" data-fromxcid="'+t.xcid+'" data-toxcid="'+e.xcid+'">  <p class="cnt js_traffic_info">     <span class="traffic loading">两地交通信息正在加载中...</span> </p></div>'},bindDragSort:function(){var t=this;$("#js_plancitys").sortable({delay:50,items:".js_cityitem",activate:function(t,e){$(t.currentTarget).find("div[data-cid$='"+e.item.attr("data-xcid")+"']").hide()},deactivate:function(t,e){$(t.currentTarget).find("div[data-cid$='"+e.item.attr("data-xcid")+"']").show()},update:function(){var e=[],i={};$("#js_plancitys .js_cityitem").each(function(t){e.push($(this).attr("data-xcid"))}),$.each(e,function(e,n){i[n]=t.planCity[n]}),t.planCity=i,t.renderPlan(),t.renderMap()}}),$("#js_plancitys").disableSelection()},renderMap:function(){var t={};sCity=this.startCity,pCity=this.planCity,eCity=this.endCity,s.size(pCity)>0&&(s.size(sCity)>0&&(sCity={startCity:sCity},$.extend(t,sCity,pCity)),s.size(eCity)>0&&(eCity={endCity:eCity},$.extend(t,pCity,eCity))),this._drawMapMarker(pCity)},_drawMapMarker:function(t){if(!i.mapLoadIsOk)return!1;var e;if(this.map.removeMarker(this.markersData),this.map.removeFlightPath(this.lineData),s.size(t)<=0)return!1;e=this._formatMapData(t),e=this.map.formatMarkerData(e),this._drawPolyLine(e),markerConfig={"z-index":99999},markerConfig.getMapIconCb=function(t,e,i){var n,s,a;return n=new google.maps.Point(0,46),s=new google.maps.Size(30,46),a="//common3.qyerstatic.com/plan/desktop/create/img/maskLayout_bg.png",new google.maps.MarkerImage(a,s,n)},this.markersData=this.map.drawMarker(e.markers,markerConfig)},_formatMapData:function(t){var e=[];return!!t&&($.each(t,function(t,i){e.push({id:t,name:i.cityname,lat:i.lat,lng:i.lng,cityname:i.cityname,cityname_en:i.cityname_en})}),e)},_drawPolyLine:function(t){var e;e=this.map.formatFlightPathData(t.coordinates),this.map.drawPolyLine(e),this.lineData=e},getTraffic:function(){var t=this;$("#js_height_resize").find(".js_traffic").each(function(e){!function(e){var i,n,s,a=e.attr("data-fromxcid"),o=e.attr("data-toxcid");if(n=0==a?t.startCity:t.planCity[a],s=1==o?t.endCity:t.planCity[o],i=a+"_"+o+"_"+n.cityname+"_"+s.cityname,t.traffic[i])return e.find(".js_traffic_info").html(t._formatTraffic(t.traffic[i].status,t.traffic[i].traffic)),!0;$.post("/api/ra.php?action=city2citytraffic",{from:n,to:s},function(a){var o="",r=1,c=JSON.parse(a);0!=n.cityid&&0!=s.cityid||(r=1),void 0!==c.data&&(0==c.data.count&&(r=2),c.data.count>0&&(r=3,o=c.data.data[0])),t.traffic[i]={status:r,traffic:o},e.find(".js_traffic_info").html(t._formatTraffic(r,o))})}($(this))})},_formatCityTpl:function(t){var e,i="listGo";if(1==t.type)e='<div class="items js_cityitem" data-xcid="'+t.xcid+'" style="cursor:move;">\t<a href="#;" class="close" title="delete" data-bn-ipg="plan-plan_create-place_list-delcity"></a>\t<strong>'+t.cityname+'</strong>\t<div class="number">\t\t<span class="licon js_reduceday" title="减" data-bn-ipg="plan-plan_create-place_list-reduceday"></span>\t\t<span class="nmr js_day">'+t.stay_days+'天</span>\t\t<span class="ricon js_addday" title="加" data-bn-ipg="plan-plan_create-place_list-addday"></span>\t</div></div>';else{var n,s,a="plan-plan_create-place_list-alter_depart",o="js_start_city";20==t.type?(s="输入出发城市",n=""==t.cityname?"输入出发城市":t.cityname+"(出发)"):(o="js_end_city",a="plan-plan_create-place_list-alter_back",s="输入返回城市",i="listSpace",n=""==t.cityname?"输入返回城市":t.cityname+"(返回)"),e='<div class="'+i+' updown" data-type="'+t.type+'">\t<div class="text">\t\t<strong>'+n+'</strong>\t\t<a href="javascript:;" title="修改" class="js_edit_city" data-bn-ipg="'+a+'"></a>\t</div>\t<div class="input" style="display:none;">\t\t<input type="text" class="'+o+'" value="'+t.cityname+'" placeholder="'+s+'" maxlength="20">\t\t<span class="enter">enter</span>\t</div></div>',20==t.type?e+=' <div id="js_plancitys">':e="</div>"+e}return e},_formatTraffic:function(t,e){var i="";return 1==t?i+='<span class="traffic noinfo">地理信息缺失</span>':2==t?i+='<span class="traffic noinfo">暂无交通信息</span>':3==t?(e.distance&&(i+='<span class="traffic '+this._formatTripMode(e.tripmode)+'">'+Math.round(e.distance)+" km</span>"),e.avg_time&&(i+='<span class="date">'+this._formatTripTime(e.avg_time)+"</span>"),e.avg_spend&&(i+='<span class="cny">约￥'+Math.round(e.avg_spend)+"\x3c!-- RMB --\x3e</span>")):i+='<span class="traffic loading">两地交通信息正在加载中...</span>',i},_formatTripTime:function(t){var e,i=0;return t=Math.round(t),e=t+"min",t>=60&&(i=Math.floor(t/60),e=i+"h "+Math.round(t%60)+"min"),e},_formatTripMode:function(t){var e="";switch(t){case 1:e="traffic_plane";break;case 2:e="traffic_train";break;case 3:e="bus";break;case 4:e="drive";break;case 5:e="traffic_ship";break;default:e="traffic_other"}return e},_formatNoCityTpl:function(){return'<div class="traffics">  <p class="traffic_none">请从左侧添加</p></div>'},delPlanCity:function(t){var e=this,i={};$.each(e.planCity,function(e,n){t!=n.xcid&&(i[n.xcid]=n)}),this.planDays-=e.planCity[t].stay_days,this.cityCnt=this.cityCnt-1,this.planCity=i,this.renderPlan(),this.renderMap(),this.cityCnt<4&&($("#js_optimize_plan").hide(),$("#js_myplanbox").removeClass("plan_myplan_content_layout")),$("#Mydatepicker").hide(),this.cityCnt<1&&this.hideLayer()},checkPlanCity:function(){var t=this;$("#js_myplanbox").find(".input:visible").each(function(e){var i=$(this),n={cityname:i.find("input").val()};i.parents(".updown").hasClass("listGo")?$.extend(t.startCity,n):$.extend(t.endCity,n)})},editPlanCity:function(t,e){var i=this,n=t.cityname,s=n+"(返回)";20==e.attr("data-type")?(s=n+"(出发)",$.extend(i.startCity,t)):$.extend(i.endCity,t),e.find(".input").hide(),e.find(".text").show().find("strong").html(s),i.getTraffic()},bindAutoComplete:function(t){function e(e){if(e.target.className.toLowerCase()==n.find("input").attr("class"))return!1;var s=t.qyerAutocomplete("getContent"),a=s.find("li:eq(0)");if(a.attr("data-value")){var o={cityid:a.attr("data-cid"),cityname:a.attr("data-value"),cityname_en:a.attr("data-cityname_en"),lat:a.attr("data-lat"),lng:a.attr("data-lng")};i.editPlanCity(o,n),t.val(o.cityname)}}var i=this,n=t.parents(".updown");if(1==n.attr("bindAC"))return!1;$(document).unbind("click",e),$(document).bind("click",e),n.attr("bindAC",1),requirejs(["web_old_inputautocomplete"],function(){t.qyerAutocomplete({onSearch:function(){var e,i=t.val(),n="";e={kw:i},$.get("/api/place.php?action=searchcityonly",e,function(e){var a=JSON.parse(e);if("ok"==a.result){n=$("#myplan_search_city").html();var o={kw:i,list:a.data};n=s.template(n)(o),n=$(n),t.qyerAutocomplete("pushHTML",n)}})},onSelect:function(t){var e={},s={cityid:0,cityname:"",cityname_en:"",lat:0,lng:0};e=t.getAttribute("data-hasEx")?$.extend(s,{cityname:t.getAttribute("data-value")}):{cityid:t.getAttribute("data-cid"),cityname:t.getAttribute("data-value"),cityname_en:t.getAttribute("data-cityname_en"),lat:t.getAttribute("data-lat"),lng:t.getAttribute("data-lng")},i.editPlanCity(e,n),$(this).val(e.cityname)}})})},optimizePlan:function(){var t=this;requirejs(["project/plan/web/js/optimizeCity"],function(e){e(t)})},contactCcMarker:function(t){var e=this;s.each(t,function(t){e.ccMarkersData.push(t)})}},a}),define("project/plan/web/js/optimizeCity",["web_old_popup","web_old_select","common/js/message"],function(t,e,i){function n(e){function i(t){return _.each(t,function(t){1!=t.isfirst&&1!=t.islast||(t.isfirst=0,t.islast=0),t.stay_days=parseFloat(t.stay_days)}),t}var n,s,a,o=e,r=o.planCity,c={},l={},h=[],d="",p="",u=!1;r=i(o.planCity),_.each(r,function(t,e){""!=t.lat?(""==d&&(d=t,t.isfirst=1),c[e]=t):(l[e]=t,h.push(t.cityname))}),p=_.clone(d),s={firstCity:d,cityList:c,noLatLngCitys:h},n=$("#optimizePlanOne").html(),n=_.template(n)(s),n=$(n),n.find(".qui-select").qyerSelect({onChange:function(t){var e=t.getAttribute("data-value");a=$(this).attr("data-type"),"first"==a?(c[d.xcid].isfirst=0,c[e].isfirst=1,d=c[e]):(c[p.xcid].islast=0,c[e].islast=1,p=c[e])}}),t.show({title:"确定首尾城市",contentHTML:n,width:433,cancelText:"    取消    ",okText:"    确定    ",exClassName:"optimize_city",onShow:function(){setTimeout(function(){$(".qui-popup-closeIcon").attr("data-bn-ipg","plan-plan_create-optimize-ABcity-close"),$(".qui-popup-okBtn").attr("data-bn-ipg","plan-plan_create-optimize-ABcity-confirm"),$(".qui-popup-cancelBtn").attr("data-bn-ipg","plan-plan_create-optimize-ABcity-close")},1e3)},onOK:function(){u=!0,t.setOption({showOKBtn:!1,showLoadBtn:!0});var e=!1,n=o.cityIndex+1;if(n="c"+n,c[p.xcid].isfirst=0,c[p.xcid].islast=1,d.xcid==p.xcid){e=!0,c[d.xcid].isfirst=1,c[d.xcid].islast=0;var s=0;_.each(c,function(t){1!=t.isfirst&&t.cityname==d.cityname&&(s=t.xcid)}),0==s?(c[n]=_.clone(d),c[n].xcid=n,c[n].isfirst=0,c[n].islast=1,c[n].stay_days=1):c[s].islast=1}postdata={cityList:c},$.post("/api/ra.php?action=optimizecity",postdata,function(n){if(u=!1,!n)return!1;var s,a,r,c,h=JSON.parse(n);h.data.list;if("ok"!=h.result)return t.setOption({showOKBtn:!0,showLoadBtn:!1}),requirejs(["web_old_tip"],function(t){t.tip({text:"优化行程超时，请再试一次",type:"warning"})}),!0;s=h.data.afList,a=h.data.bfList,r=$("#optimizePlanTwo").html(),c={noList:l,bfList:{staticMapUrl:a.staticMapUrl,xcid:a.cityList,distance:a.distance},afList:{staticMapUrl:s.staticMapUrl,xcid:s.cityList,distance:s.distance},lessDistance:Math.round(a.distance-s.distance)},r=_.template(r)(c),r=$(r);var d=t.getButtons();d.okBtn.setAttribute("data-bn-ipg","plan-plan_create-optimize-order-use"),d.cancelBtn.setAttribute("data-bn-ipg","plan-plan_create-optimize-order-cancol"),d.closeIcon.setAttribute("data-bn-ipg","plan-plan_create-optimize-order-close"),t.setOption({title:"城市顺序优化",width:750,cancelText:"    取消    ",okText:"    采用    ",showOKBtn:!0,showLoadBtn:!1,exClassName:"optimize_city_af",onOK:function(){1==e&&o.cityIndex++,s.cityList=$.extend(s.cityList,l),o.planCity=i(s.cityList),o.renderPlan(),setTimeout(function(){o.renderMap()},1e3)}}),t.setContent(r)})},onBeforeHide:function(){if(u)return!1}})}return n}),define("project/plan/web/js/card",["project/plan/web/js/dataCreateAPI","project/plan/web/js/createMessage","lodash"],function(t,e,i){function n(){this.card=""}return n.prototype={init:function(){var t=this,e=$("#create_box"),i=$("#card_layer").html();t.card=$(i),t.card.click(function(t){$(t.target).hasClass("mask_close")||t.stopPropagation()}),e.after(t.card),e.on("click",".js_card",function(e){t.show();var i=$(this).parents(".js_items");t.setPosition(i),t.setContent(i),e.stopPropagation();var n=$(e.target).attr("data-bn-ipg");if(n){var s="https://qt.qyer.com/beacon.gif?type=click&category="+n+"&campaign=inpage&referer="+encodeURIComponent(window.location.href)+"&referer_link="+encodeURIComponent(document.referrer)+"&guid="+$.cookie("_guid")+"&user_id=0&session="+$.cookie("_session");$.get(s,function(t){})}}),$(document).click(function(){t.close()})},setPosition:function(t){var e=t.offset(),i=t.outerHeight(),n=$(window).height(),s=$("#card_layer_box").parent().outerHeight(),a=e.top;$("#card_layer_box").parent().css({left:320}),a+s>n?(a=a-s+i-20,this.card.find(".mask_arrow").animate({top:s-i/2-20})):(a-=20,this.card.find(".mask_arrow").animate({top:50})),this.card.animate({top:a})},setContent:function(t){var e=this,n=t.attr("data-type"),s=t.attr("data-id"),a=$("#card_layer_content").html(),o="/api/place.php?action=countryinfo";"city"==n&&(o="/api/place.php?action=cityinfo"),$.get(o,{id:s},function(t){var s=JSON.parse(t);"ok"==s.result&&(s.data.type=n,a=i.template(a)(s.data),a=$(a),e.card.find("#card_layer_box").html(a))})},show:function(){this.card.fadeIn()},close:function(){this.card.fadeOut()}},n}),$(function(){var t=["web_old_map","project/plan/web/js/createCountry","project/plan/web/js/createCity","project/plan/web/js/createMyPlan","project/plan/web/js/card","web_old_inputautocomplete","lodash"];requirejs(t,function(t,e,i,n,s,a,o){function r(){t.mapLoadIsOk=!0,h.initMap("createplan_map")}var c,l,h,d,p=$.getUrlParam("country");h=new t,t.loadGoogleMap(r),l=new n("js_myplanbox",h),c=new e,c.init(h),p?c.getCity(1,p,h):c.getCountryList(0),$("#js_plan_foundcity_content").width(),setTimeout(function(){c.setLableEvent()},1500),d=new s,d.init(),requirejs(["web_old_datepicker"],function(){$("#Mydatepicker").datepicker({dateFormat:"yy-m-d",onSelect:function(t){l.startTime=t,$("#datepicker").html("出发日期 : "+t),$("#Mydatepicker").datepicker("setDate",t),$("#Mydatepicker").fadeOut(300)}}).click(function(t){t.stopPropagation()})}),$("#datepicker").click(function(t){var e=$(this),i=e.offset(),n=$("#js_myplanbox").offset();requirejs(["web_old_datepicker"],function(){$("#Mydatepicker").css({top:i.top+e.outerHeight()/2,left:i.left-n.left}).fadeIn(300,function(){$(document).one("click",function(){$("#Mydatepicker").fadeOut(300)})})})}),$("#js_search_desti").qyerAutocomplete({onSearch:function(){var t=$("#js_search_desti").val(),e=$("#search_country_city").html();$.get("/api/place.php?action=searchcity",{kw:t},function(i){var n=JSON.parse(i);"ok"==n.result&&(n.data.kw=t,n.data.citylist||(n.data.citylist=[]),n.data.countrylist||(n.data.countrylist=[]),e=o.template(e)(n.data),e=$(e),$("#js_search_desti").qyerAutocomplete("pushHTML",e))})},onSelect:function(t){var e,i=t.getAttribute("data-value");if(t.getAttribute("data-hasEx"))e={cityid:0,cityname:i,cityname_en:"",fundays:1,lat:0,lng:0},l.addCity(e);else{$("#createplan_map_loading").show();var n;n=t.getAttribute("data-type"),id=t.getAttribute("data-id"),recommend="true"===(t.getAttribute("data-recommend")||"").toString(),c.getCity(n,id,h,i,recommend)}$("#js_search_desti").val("")}}),$("#js_search_desti").val("")}),creatresize(),$(window).resize(function(){creatresize()});var e=!0,i=$("#js_plan_foundcity_content"),n=i.width(),s=n-40;$("#js_mask_showhide").click(function(){e?($(this).attr("data-bn-ipg","Plan-plan_create-place_list-flod"),$(this).removeClass("lshow").addClass("lhide"),i.animate({"margin-left":-s}),e=!1):($(this).attr("data-bn-ipg","Plan-plan_create-place_list-open"),$(this).removeClass("lhide").addClass("lshow"),i.animate({"margin-left":""}),e=!0)})}),function(t){t.getUrlParam=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null}}(jQuery);