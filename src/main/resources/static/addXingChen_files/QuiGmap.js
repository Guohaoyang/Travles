define(["web_qui_controlbase","web_qui_quigmap_infobox"],function(t,n){var o={map:null,init:function(t,n){var o=this;window.google&&google.maps?o.initMap(t,n):(window.googleMapCbFun=function(){o.initMap(t,n)},$.getScript("http://maps.google.cn/maps/api/js?libraries=geometry&sensor=false&key=AIzaSyCFyj9mrzuoTWACoSqRy77qYr9i8O6gi9s&callback=googleMapCbFun"))},initMap:function(t,n){var o=39.92,e=116.46,a=new google.maps.LatLng(o,e),i={maxZoom:19,zoom:3,mapTypeControl:!0,center:a,scaleControl:!0,panControl:!1,streetViewControl:!1};$.extend(i,n||{}),this.map=new google.maps.Map(document.getElementById(t),i),this.map.markers=this.map.markers||[],this.map.lines=this.map.lines||[],this.map.polygon=this.map.polygon||[],this.getInfoBox()},getInfoBox:function(){var t=this;this.infoBox||(t.infoBox=n,$(t).trigger("mapalready"),t.mapstatus="yes")},getStatus:function(){var t=this;return!!t.mapstatus},setMap:function(t){this.map=t,this.map.markers=this.map.markers||[],this.map.lines=this.map.lines||[],this.map.polygon=this.map.polygon||[],this.getInfoBox()},getMap:function(){return this.map},createLatLng:function(t){return new google.maps.LatLng(t.lat-0,t.lng-0)},addMarker:function(t){var n,o=this.createLatLng(t),e={position:o,map:this.map};return t.icon&&$.extend(e,{icon:this.getIcon(t.icon)}),n=new google.maps.Marker(e),this.map.markers.push(n),n},createInfoWindow:function(t){return new google.maps.InfoWindow(t)},createDiyInfoWindow:function(t){var n={alignBottom:!0,pixelOffset:new google.maps.Size((-110),(-30)),closeBoxURL:"",isHidden:!1};return $.extend(n,t),new this.infoBox(n)},addEvent:function(t,n,o){google.maps.event.addListener(t,n,o)},removeEvent:function(t,n){google.maps.event.clearListeners(t,n)},getIcon:function(t){var n=new google.maps.Size(t.size.w,t.size.h),o=new google.maps.Point(t.point.x,t.point.y);return new google.maps.MarkerImage(t.url,n,o)},searchMarkerByPosition:function(t,n){if(this.map.markers.length>0)for(var o,e,a=this.createLatLng(t),i=0;i<this.map.markers.length;i++)if(o=this.map.markers[i],e=o.position,a.toString()==e.toString())return n&&"del"==n&&this.map.markers.splice(i,1),o},changeMarkerIcon:function(t,n){var o=this.searchMarkerByPosition(t);o.setIcon(this.getIcon(n.icon))},changeMarkerOption:function(t,n){var o=this.searchMarkerByPosition(t);o.setOptions(n)},showInfoWindow:function(t){var n=this.searchMarkerByPosition(t);n.infoWindow.open(this.map,n)},closeInfoWindow:function(t){var n=this.searchMarkerByPosition(t);n.infoWindow.close()},delMarker:function(t){var n=this.searchMarkerByPosition(t,"del");n.setMap(null)},drawLine:function(t,n){for(var o,e,a=[],i=0;e=t[i++];)a.push(new google.maps.LatLng(e.lat,e.lng));return $.extend(n,{path:a}),o=new google.maps.Polyline(n),o.setMap(this.map),this.map.lines.push(o),o},drawPolygon:function(t,n){for(var o,e,a=[],i=0;i<t.length;i++)o=t[i].split(","),a.push(this.createLatLng({lat:o[0],lng:o[1]}));return e=new google.maps.Polygon($.extend(n,{paths:a})),e.setMap(this.map),this.map.polygon.push(e),e},fitBounds:function(t){for(var n=new google.maps.LatLngBounds,o=0;o<t.length;o++)n.extend(this.createLatLng(t[o]));this.map.fitBounds(n)},setCenter:function(t){for(var n=lng=0,o=0,e=t.length;o<e;o++){var a=t[o];n+=a.lat-0,lng+=a.lng-0}n/=e,lng/=e,this.map.setCenter(new google.maps.LatLng(n,lng))},setZoom:function(t){"number"==typeof t&&this.map.setZoom(t)},getPolyCenter:function(t){function n(t){return t.sort(function(t,n){return t-n})}for(var o,e,a,i,s,r,g=[],p=[],l=lats1=0,h=t.getPath(),m=h.length,u={},c=0;c<h.length;c++)r=h.getAt(c).lat(),s=h.getAt(c).lng(),p.push(s),g.push(r),l+=s,lats1+=r;return g=n(g),p=n(p),o=g.shift(),e=g.pop(),a=p.shift(),i=p.pop(),u.lat=o+(e-o)/2,u.lng=a+(i-a)/2,o=e=a=i=g=p=l=lats1=h=m=s=r=null,this.createLatLng(u)},clearLine:function(){for(var t,n=this.map.lines,o=0;t=n[o++];)t.setMap(null);n=[]},clearMarker:function(){for(var t,n=0;t=this.map.markers[n++];)t.setMap(null);this.map.markers=[]},destroy:function(){},setOption:function(){},empty:function(){this.clearLine(),this.clearMarker()},fromLatLngToPixel:function(t){var n=Math.pow(2,this.map.getZoom()),o=this.map.getProjection(),e=this.map.getBounds(),a=o.fromLatLngToPoint(new google.maps.LatLng(e.getNorthEast().lat(),e.getSouthWest().lng())),i=o.fromLatLngToPoint(t);return new google.maps.Point(Math.floor((i.x-a.x)*n),Math.floor((i.y-a.y)*n))},fromPixelToLatLng:function(t){var n=Math.pow(2,this.map.getZoom()),o=this.map.getProjection(),e=this.map.getBounds(),a=o.fromLatLngToPoint(new google.maps.LatLng(e.getNorthEast().lat(),e.getSouthWest().lng())),i=new google.maps.Point;return i.x=t.x/n+a.x,i.y=t.y/n+a.y,o.fromPointToLatLng(i)}};return o});
