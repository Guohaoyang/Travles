$(function(){function e(){$(".qyer_head_crumb .arrow").removeClass("hover"),$(".qyer_head_crumb_pulldown").hide()}var t,n,i,o,r,a;$(".qyer_head_crumb .arrow").hover(function(){a=$(this),t=a.parent(".drop"),o=t.height(),n=t.offset().left,i=t.offset().top;var e=$(this).attr("data");window.clearTimeout(r),$(".qyer_head_crumb .arrow").removeClass("hover"),$(this).addClass("hover"),$(".qyer_head_crumb_pulldown").hide(),$("."+e).css({left:n,top:i+o}).show()},function(){}),$(".qyer_head_crumb .drop").hover(function(){},function(){r=window.setTimeout(e,300)}),$(".qyer_head_crumb_pulldown").hover(function(){window.clearTimeout(r),a.addClass("hover"),$(this).show()},function(){r=window.setTimeout(e,300)})}),function(){var e=function(){var t=[].slice.call(arguments);return t.push(e.options),t[0].match(/^\s*#([\w:\-\.]+)\s*$/gim)&&t[0].replace(/^\s*#([\w:\-\.]+)\s*$/gim,function(e,n){var i=document,o=i&&i.getElementById(n);t[0]=o?o.value||o.innerHTML:e}),1==arguments.length?e.compile.apply(e,t):arguments.length>=2?e.to_html.apply(e,t):void 0},t={escapehash:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},escapereplace:function(e){return t.escapehash[e]},escaping:function(e){return"string"!=typeof e?e:e.replace(/[&<>"]/gim,this.escapereplace)},detection:function(e){return"undefined"==typeof e?"":e}},n=function(e){if("undefined"!=typeof console){if(console.warn)return void console.warn(e);if(console.log)return void console.log(e)}throw e},i=function(e,t){if(e=e!==Object(e)?{}:e,e.__proto__)return e.__proto__=t,e;var n=function(){},i=Object.create?Object.create(t):new(n.prototype=t,n);for(var o in e)e.hasOwnProperty(o)&&(i[o]=e[o]);return i};e.__cache={},e.version="0.6.5-stable",e.settings={},e.tags={operationOpen:"{@",operationClose:"}",interpolateOpen:"\\${",interpolateClose:"}",noneencodeOpen:"\\$\\${",noneencodeClose:"}",commentOpen:"\\{#",commentClose:"\\}"},e.options={cache:!0,strip:!0,errorhandling:!0,detection:!0,_method:i({__escapehtml:t,__throw:n,__juicer:e},{})},e.tagInit=function(){var t=e.tags.operationOpen+"each\\s*([^}]*?)\\s*as\\s*(\\w*?)\\s*(,\\s*\\w*?)?"+e.tags.operationClose,n=e.tags.operationOpen+"\\/each"+e.tags.operationClose,i=e.tags.operationOpen+"if\\s*([^}]*?)"+e.tags.operationClose,o=e.tags.operationOpen+"\\/if"+e.tags.operationClose,r=e.tags.operationOpen+"else"+e.tags.operationClose,a=e.tags.operationOpen+"else if\\s*([^}]*?)"+e.tags.operationClose,s=e.tags.interpolateOpen+"([\\s\\S]+?)"+e.tags.interpolateClose,u=e.tags.noneencodeOpen+"([\\s\\S]+?)"+e.tags.noneencodeClose,l=e.tags.commentOpen+"[^}]*?"+e.tags.commentClose,c=e.tags.operationOpen+"each\\s*(\\w*?)\\s*in\\s*range\\(([^}]+?)\\s*,\\s*([^}]+?)\\)"+e.tags.operationClose,p=e.tags.operationOpen+"include\\s*([^}]*?)\\s*,\\s*([^}]*?)"+e.tags.operationClose;e.settings.forstart=new RegExp(t,"igm"),e.settings.forend=new RegExp(n,"igm"),e.settings.ifstart=new RegExp(i,"igm"),e.settings.ifend=new RegExp(o,"igm"),e.settings.elsestart=new RegExp(r,"igm"),e.settings.elseifstart=new RegExp(a,"igm"),e.settings.interpolate=new RegExp(s,"igm"),e.settings.noneencode=new RegExp(u,"igm"),e.settings.inlinecomment=new RegExp(l,"igm"),e.settings.rangestart=new RegExp(c,"igm"),e.settings.include=new RegExp(p,"igm")},e.tagInit(),e.set=function(e,t){var n=this,i=function(e){return e.replace(/[\$\(\)\[\]\+\^\{\}\?\*\|\.]/gim,function(e){return"\\"+e})},o=function(e,t){var o=e.match(/^tag::(.*)$/i);return o?(n.tags[o[1]]=i(t),void n.tagInit()):void(n.options[e]=t)};if(2===arguments.length)return void o(e,t);if(e===Object(e))for(var r in e)e.hasOwnProperty(r)&&o(r,e[r])},e.register=function(e,t){var n=this.options._method;return!n.hasOwnProperty(e)&&(n[e]=t)},e.unregister=function(e){var t=this.options._method;if(t.hasOwnProperty(e))return delete t[e]},e.template=function(t){var n=this;this.options=t,this.__interpolate=function(e,t,n){var i,o=e.split("|"),r=o[0]||"";return o.length>1&&(e=o.shift(),i=o.shift().split(","),r="_method."+i.shift()+".call({}, "+[e].concat(i)+")"),"<%= "+(t?"_method.__escapehtml.escaping":"")+"("+(n&&n.detection===!1?"":"_method.__escapehtml.detection")+"("+r+")) %>"},this.__removeShell=function(t,i){var o=0;return t=t.replace(e.settings.forstart,function(e,t,n,i){var n=n||"value",i=i&&i.substr(1),r="i"+o++;return"<% ~function() {for(var "+r+" in "+t+") {if("+t+".hasOwnProperty("+r+")) {var "+n+"="+t+"["+r+"];"+(i?"var "+i+"="+r+";":"")+" %>"}).replace(e.settings.forend,"<% }}}(); %>").replace(e.settings.ifstart,function(e,t){return"<% if("+t+") { %>"}).replace(e.settings.ifend,"<% } %>").replace(e.settings.elsestart,function(e){return"<% } else { %>"}).replace(e.settings.elseifstart,function(e,t){return"<% } else if("+t+") { %>"}).replace(e.settings.noneencode,function(e,t){return n.__interpolate(t,!1,i)}).replace(e.settings.interpolate,function(e,t){return n.__interpolate(t,!0,i)}).replace(e.settings.inlinecomment,"").replace(e.settings.rangestart,function(e,t,n,i){var r="j"+o++;return"<% ~function() {for(var "+r+"="+n+";"+r+"<"+i+";"+r+"++) {{var "+t+"="+r+"; %>"}).replace(e.settings.include,function(e,t,n){return"<%= _method.__juicer("+t+", "+n+"); %>"}),i&&i.errorhandling===!1||(t="<% try { %>"+t,t+='<% } catch(e) {_method.__throw("Juicer Render Exception: "+e.message);} %>'),t},this.__toNative=function(e,t){return this.__convert(e,!t||t.strip)},this.__lexicalAnalyze=function(t){var n=[],i=[],o="",r=["if","each","_","_method","console","break","case","catch","continue","debugger","default","delete","do","finally","for","function","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with","null","typeof","class","enum","export","extends","import","super","implements","interface","let","package","private","protected","public","static","yield","const","arguments","true","false","undefined","NaN"],a=function(e,t){if(Array.prototype.indexOf&&e.indexOf===Array.prototype.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},s=function(t,o){if(o=o.match(/\w+/gim)[0],a(n,o)===-1&&a(r,o)===-1&&a(i,o)===-1){if("undefined"!=typeof window&&"function"==typeof window[o]&&window[o].toString().match(/^\s*?function \w+\(\) \{\s*?\[native code\]\s*?\}\s*?$/i))return t;if("undefined"!=typeof global&&"function"==typeof global[o]&&global[o].toString().match(/^\s*?function \w+\(\) \{\s*?\[native code\]\s*?\}\s*?$/i))return t;if("function"==typeof e.options._method[o]||e.options._method.hasOwnProperty(o))return i.push(o),t;n.push(o)}return t};t.replace(e.settings.forstart,s).replace(e.settings.interpolate,s).replace(e.settings.ifstart,s).replace(e.settings.elseifstart,s).replace(e.settings.include,s).replace(/[\+\-\*\/%!\?\|\^&~<>=,\(\)\[\]]\s*([A-Za-z_]+)/gim,s);for(var u=0;u<n.length;u++)o+="var "+n[u]+"=_."+n[u]+";";for(var u=0;u<i.length;u++)o+="var "+i[u]+"=_method."+i[u]+";";return"<% "+o+" %>"},this.__convert=function(e,t){var n=[].join("");return n+="'use strict';",n+="var _=_||{};",n+="var _out='';_out+='",n+=t!==!1?e.replace(/\\/g,"\\\\").replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"';_out+=$1;_out+='").split("<%").join("';").split("%>").join("_out+='")+"';return _out;":e.replace(/\\/g,"\\\\").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t").replace(/[\n]/g,"\\n").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"';_out+=$1;_out+='").split("<%").join("';").split("%>").join("_out+='")+"';return _out.replace(/[\\r\\n]\\s+[\\r\\n]/g, '\\r\\n');"},this.parse=function(e,t){var o=this;return t&&t.loose===!1||(e=this.__lexicalAnalyze(e)+e),e=this.__removeShell(e,t),e=this.__toNative(e,t),this._render=new Function("_, _method",e),this.render=function(e,t){return t&&t===n.options._method||(t=i(t,n.options._method)),o._render.call(this,e,t)},this}},e.compile=function(e,t){t&&t===this.options||(t=i(t,this.options));try{var o=this.__cache[e]?this.__cache[e]:new this.template(this.options).parse(e,t);return t&&t.cache===!1||(this.__cache[e]=o),o}catch(r){return n("Juicer Compile Exception: "+r.message),{render:function(){}}}},e.to_html=function(e,t,n){return n&&n===this.options||(n=i(n,this.options)),this.compile(e,n).render(t,n._method)},"undefined"!=typeof module&&module.exports?module.exports=e:this.juicer=e}(),$(function(){function e(e,t){var n=$(".plcMenuBar"),i=0;e.hover(function(){i=$(this).position().left-1,t.css("left",i).show(),n.css("z-index","99")},function(){t.hide(),n.css("z-index","")}),t.hover(function(){t.show(),n.css("z-index","99")},function(){t.hide(),n.css("z-index","")})}var t=$("#topbarPrompt");if(1==t.length){var n=t.find(".trigger"),i=t.find(".layer"),o=i.find(".title,.close");n.on("click",function(){i.show()}),o.on("click",function(){i.hide()})}var r=$(".plcMenuBarHolder"),a=$(".plcMenuBars"),s=r.offset().top;$(document).on("scroll",function(){var e=$(this).scrollTop();e>s?a.css({position:"fixed","z-index":"99",top:"0"}):a.css({position:"","z-index":"",top:""})});var u=$("#menuBarGuide"),l=$("#menuBarPoi"),c=$("#menuBarCity"),p=$("#menuBarGuideDrop"),d=$("#menuBarPoiDrop"),f=$("#menuBarCityDrop");e(u,p),e(l,d),e(c,f)}),$(function(){$(document).on("click",function(e){0===e.button&&"true"==e.target.getAttribute("data-addtoplan")&&require(["common/component/addListToPlan/addListToPlan"],function(t){var n=$(e.target);t.qyerAddToPlan({obj:e.target,type:n.attr("data-type"),pid:n.attr("data-pid"),css:{"z-index":20}})})})}),!function(e,t,n,i){var o=e(t);e.fn.lazyload=function(r){function a(){var t=0;u.each(function(){var n=e(this);if(!l.skip_invisible||n.is(":visible"))if(e.abovethetop(this,l)||e.leftofbegin(this,l));else if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else n.trigger("appear"),t=0})}var s,u=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return r&&(i!==r.failurelimit&&(r.failure_limit=r.failurelimit,delete r.failurelimit),i!==r.effectspeed&&(r.effect_speed=r.effectspeed,delete r.effectspeed),e.extend(l,r)),s=l.container===i||l.container===t?o:e(l.container),0===l.event.indexOf("scroll")&&s.bind(l.event,function(){return a()}),this.each(function(){var t=this,n=e(t);t.loaded=!1,(n.attr("src")===i||n.attr("src")===!1)&&n.is("img")&&n.attr("src",l.placeholder),n.one("appear",function(){if(!this.loaded){if(l.appear){var i=u.length;l.appear.call(t,i,l)}e("<img />").bind("load",function(){var i=n.attr("data-"+l.data_attribute);n.hide(),n.is("img")?n.attr("src",i):n.css("background-image","url('"+i+"')"),n[l.effect](l.effect_speed),t.loaded=!0;var o=e.grep(u,function(e){return!e.loaded});if(u=e(o),l.load){var r=u.length;l.load.call(t,r,l)}}).attr("src",n.attr("data-"+l.data_attribute))}}),0!==l.event.indexOf("scroll")&&n.bind(l.event,function(){t.loaded||n.trigger("appear")})}),o.bind("resize",function(){a()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&o.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&u.each(function(){e(this).trigger("appear")})}),e(n).ready(function(){a()}),this},e.belowthefold=function(n,r){var a;return a=r.container===i||r.container===t?(t.innerHeight?t.innerHeight:o.height())+o.scrollTop():e(r.container).offset().top+e(r.container).height(),a<=e(n).offset().top-r.threshold},e.rightoffold=function(n,r){var a;return a=r.container===i||r.container===t?o.width()+o.scrollLeft():e(r.container).offset().left+e(r.container).width(),a<=e(n).offset().left-r.threshold},e.abovethetop=function(n,r){var a;return a=r.container===i||r.container===t?o.scrollTop():e(r.container).offset().top,a>=e(n).offset().top+r.threshold+e(n).height()},e.leftofbegin=function(n,r){var a;return a=r.container===i||r.container===t?o.scrollLeft():e(r.container).offset().left,a>=e(n).offset().left+r.threshold+e(n).width()},e.inviewport=function(t,n){return!(e.rightoffold(t,n)||e.leftofbegin(t,n)||e.belowthefold(t,n)||e.abovethetop(t,n))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window,document),define("common/util/util",[],function(){"use strict";return{getInstance:function(e,t){switch(t=t||[],t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);default:for(var n=[],i=0,o=t.length;i<o;i++)n.push("arguments["+i+"]");return new Function("return new this("+n.join(",")+");").apply(e,t)}},extend:function(e,t){$.extend(!0,e,t,e)},getStarHtml:function(e,t,n,i){e=Math.floor(e)/2;for(var o=[],r=1;r<=5;r++)e>=r?o.push(t):e+1>r?o.push(n):o.push(i);return o.join("")}}}),define("common/lang/aop",[],function(){"use strict";var e=function(e,n,i,o){var r,a,s=$.isFunction(e);if(s?(r=e,o=i,i=n):r=e[n],a=r,$.isFunction(i)){a=t(i,a,1);for(var u in r)a[u]=r[u]}if($.isFunction(o)){a=t(a,o,0);for(var u in r)a[u]=r[u]}return s||(e[n]=a),a},t=function(e,t,n){return function(){var i=e.apply(this,arguments),o=t.apply(this,arguments);return 0==n?i:o}},n=function(t,n,i){return e(t,n,i,null)},i=function(t,n,i){return e(t,n,null,i)},o=function(t,n,i,o){return e(t,n,i,o)};return{before:n,after:i,wrapper:o}}),define("common/lang/oo-static",["../util/util"],function(e){"use strict";return function(){e.extend(this,{getStatic:function(e){return e?this[e]:this},setStatic:function(t,n){return 1===arguments.length?e.extend(this,t):this[t]=n,this}}),this.implement({getStatic:function(e){return this.constructor.getStatic.apply(this.constructor,arguments)},setStatic:function(e,t){return this.constructor.setStatic.apply(this.constructor,arguments),this},callStatic:function(e,t){return this.getStatic(e).apply(this.constructor,t)}})}}),define("common/lang/oo",["../util/util","./aop","./oo-static"],function(e,t,n){"use strict";var i=function(e){var t=function(){};return t.prototype=e,new t},o=function(t,n,i){t?"function"!=typeof t&&(i=n,n=t,t=u):t=u;var o=r(t,function(){return this instanceof o?o.superclass.prototype.constructor.apply(this,arguments):e.getInstance(o,arguments)});return a(o,n),e.extend(o,t),e.extend(o,i),o.superclass=t,o},r=function(e,t){return t.prototype=i(e.prototype),t.prototype.constructor=t,t},a=function(e,t){for(var n in t)if(t[n]instanceof Function&&"callSuper"!==n&&"callParent"!==n){var i=s(n,e,t[n]);e.prototype[n]=i}else e.prototype[n]=t[n]},s=function(e,n,i){var o,r=t.wrapper(i,function(){o=this.__caller,this.__caller=r},function(){void 0===o?delete this.__caller:this.__caller=o});return r.__name=e,r.__owner=n,r},u=o(function(){this.init.apply(this,arguments)},{init:function(e){this.lang=e&&e.lang||this.lang},callParent:function(e){var t=Array.prototype.slice.call(arguments);return this.__caller.__owner.superclass.prototype[t.shift(0)].apply(this,t)},callSuper:function(){return this.__caller.__owner.superclass.prototype[this.__caller.__name].apply(this,arguments)},before:function(e,n){return t.before(this,e,s(e,this.constructor,function(){return n.apply(this,arguments)})),this},after:function(e,n){return t.after(this,e,s(e,this.constructor,function(){return n.apply(this,arguments)})),this}},{createClass:function(e,t){return o.apply(this,Array.prototype.concat.apply([this],arguments))},implement:function(e){return a(this,e),this},plugin:function(e,t){return e instanceof Function&&e.apply(this,t),this}}).plugin(n),l={Parent:u,createClass:o};return l}),define("common/lang/oo-event",["./aop"],function(e){"use strict";var t={getEventproxy:function(){return $(this)},bind:function(e,t){var n=this.getEventproxy();return n.bind.apply(n,arguments),this},unbind:function(e,t){var n=this.getEventproxy();return n.unbind.apply(n,arguments),this},on:function(){return this.bind.apply(this,arguments)},off:function(){return this.unbind.apply(this,arguments)},one:function(t,n){var i=arguments[1]=e.before(arguments[1],function(){this.unbind(t,i)});return this.bind.apply(this,arguments),this},trigger:function(e,t){var n=this.getEventproxy();return n.trigger.apply(n,arguments),this}};return t}),define("common/lang/i18n",[],function(){"use strict";var e={lang:"zh",i18n:function(e){return this.callStatic("getI18n",[this.lang,e])}},t={i18n_key:"i18n",lang:"zh",i18n:function(e,t){1===arguments.length&&(t=e,e=this.lang);var n=this.getStatic(this._i18n_key)||{};return n[e]=t,this.setStatic(this._i18n_key,n),this},getI18n:function(e,t){var n=(this.getStatic(this._i18n_key)||{})[e];return t?n[t]:n}};return function(){this.implement(e),this.setStatic(t)}}),define("common/widget/widget",["../lang/oo","../lang/oo-event","../lang/i18n"],function(e,t,n){return e.createClass({$el:null,_event_alias:"__widget",init:function(e){this.callSuper.apply(this,arguments),this.setAttrs(e||{}),this.delegateEvents(this.events),this.delegateEvents(e.events)},setAttrs:function(e,t){1===arguments.length&&(t=e,e=this.getStatic("ATTRS")),this._setAttrs(e,t)},_setAttrs:function(e,t){$.each(e,this.proxy(function(e,n){this.setAttr(e,t[e])}))},setAttr:function(e,t){t="undefined"==typeof t?this.getStatic("ATTRS")[e]:t,t="$"===e.charAt(0)?$(t):t,this[e]=t},$:function(e){return e?$(e,this.$el):this.$el},delegateEvents:function(e){return e&&$.each(e,$.proxy(function(e,t){this.delegateEvent.apply(this,t)},this)),this},delegateEvent:function(e,t,n){return e&&t&&(t="string"==typeof t&&$.isFunction(this[t])?$.proxy(this[t],this):$.proxy(t,this),this.$el.on(e+"."+this._event_alias,$.isFunction(n)?n.call(this):n,t)),this},undelegateEvents:function(){this.$el.off("."+this._event_alias)},proxy:function(e){return Array.prototype.splice.call(arguments,1,0,this),$.proxy.apply($,arguments)},destroy:function(){this.undelegateEvents();for(var e in this)if(this.hasOwnProperty(e)){if(this[e]&&$.isFunction(this[e].destroy))try{this[e].destroy()}catch(t){}delete this[e]}}},{ATTRS:{$el:document.body}}).implement(t).plugin(n)}),define("common/widget/userbehavior/config",[],function(){var e=['<span class="poiRedPoint" id="poiRedPoint"></span>','<div class="poiLikeTip" id="poiLikeTip">','<span class="close"></span>','<a href="javscript:void(0)" class="neverShow">不再提示</a>','<p class="text fontYaHei t1"><em>点击想去</em>，心爱的目的地不再错过！</p>','<p class="text fontYaHei t2">旅途中穷游app还可同步查看！</p>',"</div>",'<div class="poiLikeSmallTip" id="poiLikeSmallTip">',"收藏至“我的想去”，随时查看最新信息","</div>"].join(""),t={addPoiComment:{text:"点评旅行地",link:"javascript:void(0)",classname:"js-poiComment","data-bn-ipg":function(e){return"place-"+e.type+"-footprint-addcomment"}},addMguide:{text:"添加微锦囊",link:"//place.qyer.com/mguide/add","data-bn-ipg":function(e){return"place-"+e.type+"-footprint-addmguide"}},addTripNote:{text:"写游记",link:function(e){return"//bbs.qyer.com/thread-new?type=1&fid="+__GLOBAL_DATA__.fid},"data-bn-ipg":function(e){return"place-"+e.type+"-footprint-post"}},canelFootprint:{text:"取消足迹",link:"javascript:void(0)",classname:"js-cancelFootprint","data-bn-ipg":function(e){return"place-"+e.type+"-footprint-cancel"}}},n=function(e,t,n,i){return'<li><a data-bn-ipg="'+i+'" class="'+n+'" href="'+t+'">'+e+"</a></li>"},i=function(e,t){switch(typeof e){case"string":return e;case"function":return e(t);case"undefined":return""}},o={country:["planto","beento","lived"],city:["planto","beento","lived"],poi:["planto","beento","addToPlan"],outerClass:"place-userbehavior",beDoneClass:"selected",planto:{classname:["planto","fontYaHei","plcZIndex"].join(" "),text:"想去",sText:"已想去",exStr:e,"data-bn-ipg":function(e){switch(e.status){case 1:return"place-"+e.type+"-footprint-wishto-add";case 0:return"place-"+e.type+"-footprint-wishto-delete"}}},beento:{classname:["beento","fontYaHei"].join(" "),text:"去过",sText:"已去过",exStr:function(e){"undefined"!=typeof __GLOBAL_DATA__&&"undefined"!=typeof __GLOBAL_DATA__.fid||delete t.addTripNote;var o="<ul>";return $.each(t,function(t,r){o+=n(r.text,i(r.link,e),r.classname,i(r["data-bn-ipg"],e))}),o+="</ul>"},"data-bn-ipg":function(e){return"place-"+e.type+"-top-beenTo"}},lived:{classname:["lived","fontYaHei"].join(" "),text:"生活过",sText:"已生活过","data-bn-ipg":function(e){return"place-"+e.type+"-footprint-lived"}},addToPlan:{classname:["addToPlan","fontYaHei"].join(" "),text:"加入行程",sText:"加入行程",special:!0,getDom:function(e){return'<li class="'+o[e].classname+'" data-type="'+o.type+'" data-addtoplan="true" data-pid="'+o.id+'"><span class="fonts">'+o[e].text+"</span></li>"},"data-bn-ipg":function(){return"place-poi-top-addtoplan"}},getDom:function(e,t,n){o.type=e,o.id=t;var i="undefined"!=typeof n,r={};return r.inner=o[e],r.isLogin=i,n&&(r.userinfo=n),o.createDom(r)},createDom:function(e){var t="",n=e.isLogin,r={type:o.type,id:o.id};return $.each(e.inner,function(a,s){if(o[s].special)t+=o[s].getDom(s);else{var u=n?e.userinfo[s]-0:0;r.status=u,t+='<li class="'+o[s].classname+(n&&u?" selected":"")+'" data-type="'+s+'" data-status="'+(n?u:0)+'" data-bn-ipg="'+i(o[s]["data-bn-ipg"],r)+'"><span class="fonts">'+o[s][n&&u?"sText":"text"]+"</span>"+i(o[s].exStr,r)+"</li>"}}),'<ul class="'+o.outerClass+'">'+t+"</ul>"}};return o}),define("common/service/service",[],function(){return{post:function(e,t,n,i){return qyerUtil.doAjax({url:e,type:"POST",data:t,onSuccess:n,onError:i})},get:function(e,t,n,i){return qyerUtil.doAjax({url:e,type:"GET",data:t,onSuccess:n,onError:i})}}}),define("common/service/userbehavior/urls",[],function(){return{getBehaviorInfo:"/public.php?action=getfeeling",feeling:"/public.php?action=feeling"}}),define("common/service/userbehavior/userbehavior-service",["../service","./urls"],function(e,t){"use strict";var n={getBehaviorInfo:function(n,i,o){e.get(t.getBehaviorInfo,n,i,o)},feeling:function(n,i,o){e.post(t.feeling,n,i,o)}};return n}),define("common/widget/userbehavior/liketip",[],function(){function e(e){$.extend(this,e||{$poiRedPoint:$("#poiRedPoint"),$poiLikeTip:$("#poiLikeTip"),$poiLikeSmallTip:$("#poiLikeSmallTip"),$like:$("#poiRedPoint").parent(),$been:$("#poiRedPoint").parents("ul").find(".beento")}),this.init(),window.likeTipHanlder=this}return e.prototype={init:function(){var e=this;if(window.qyerUtil.isLogin()){if(e.checkIsLike()||e.checkIsBeenTo()||e.checkIsLived())return e.hideDom(e.$poiRedPoint),e.hideDom(e.$poiLikeTip),e.hideDom(e.$poiLikeSmallTip),!1;e.showDom(e.$poiRedPoint)}else e.showDom(e.$poiRedPoint);e.hideDom(e.$poiLikeTip),e.hideDom(e.$poiLikeSmallTip),e.checkCookie("_isNeverShowBigTip")?e.hoverShowDom(e.$poiLikeSmallTip):e.checkCookie("_isShowBigTip")>=3&&e.hoverShowDom(e.$poiLikeSmallTip),e.bindEvent()},bindEvent:function(){var e=this;e.$poiLikeTip.find(".close").on("click",function(t){if(e.checkCookie("_isShowBigTip")){var n=new Date;n.setTime(n.getTime()+31104e6),e.setCookie("_isNeverShowBigTip=true;expires="+n.toGMTString()+";path=/")}else e.setCookie("_isShowBigTip=1");return e.hideDom(e.$poiLikeTip),t.stopPropagation(),!1}).addBack().find(".neverShow").on("click",function(t){var n=e.checkCookie("_isShowBigTip")-0+1,i=new Date;return i.setTime(i.getTime()+31104e6),e.setCookie("_isNeverShowBigTip="+n+";expires="+i.toGMTString()+";path=/"),e.hideDom(e.$poiLikeTip),t.stopPropagation(),!1}),e.$like.on("mouseenter",function(){e.checkCookie("_isNeverShowBigTip")||e.checkCookie("_isShowBigTip")>=3||e.checkIsBeenTo()||e.checkIsLike()||e.checkIsLived()||e.showDom(e.$poiLikeTip)})},hideDom:function(e){e.removeClass("poiLikeHoverShow poiLikeShow")},showDom:function(e){e.addClass("poiLikeShow")},hoverShowDom:function(e){e.addClass("poiLikeHoverShow")},checkIsLike:function(){return this.$like.hasClass("selected")},checkIsBeenTo:function(){return this.$been.hasClass("selected")},checkIsLived:function(){return $(".place-userbehavior").length>0&&($(".place-userbehavior").find(".lived").length>0&&$(".place-userbehavior").find(".lived").hasClass("selected"))},setCookie:function(e){document.cookie=e},checkCookie:function(e){for(var t=this.getCookie(),n=t.split(";"),i=0,o=n.length,r=!1;i<o;i++)if($.trim(e)==$.trim(n[i]).split("=")[0]){r=$.trim(n[i]).split("=")[1];break}return r},getCookie:function(){return document.cookie},closeAll:function(){var e=this;e.hideDom(e.$poiRedPoint),e.hideDom(e.$poiLikeTip),e.hideDom(e.$poiLikeSmallTip)}},e}),define("project/js/batch_add_footprint",[],function(){function e(e,t,n,i){var o="";"city"==t||"area"==t?requirejs(["common/component/footprint/js/footprint"],function(t){t.poiShow({city_id:e,show_type:"poi"})}):"poi"==t?qyerUI.popup.ajax({url:"/api.php?action=addpoicomment&from=poi&source_type=11&poiid="+e+"&typeid="+PLACE.CITYID+"&type=city",width:"690",isclose:"show"}):"country"==t&&requirejs(["common/component/footprint/js/footprint"],function(t){t.countryFpShow({country_id:e,show_type:"country"})}),""==o}return e}),define("common/basic/js/normalize",[],function(){function e(e,i,o){if(e.match(s)||e.match(a))return e;e=r(e);var u=o.match(a),l=i.match(a);return!l||u&&u[1]==l[1]&&u[2]==l[2]?n(t(e,i),o):t(e,i)}function t(e,t){if("./"==e.substr(0,2)&&(e=e.substr(2)),e.match(s)||e.match(a))return e;var n=t.split("/"),i=e.split("/");for(n.pop();curPart=i.shift();)".."==curPart?n.pop():n.push(curPart);return n.join("/")}function n(e,t){var n=t.split("/");for(n.pop(),t=n.join("/")+"/",i=0;t.substr(i,1)==e.substr(i,1);)i++;for(;"/"!=t.substr(i,1);)i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var o=e.split("/");for(out="";n.shift();)out+="../";for(;curPart=o.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var o=/([^:])\/+/g,r=function(e){return e.replace(o,"$1/")},a=/[^\:\/]*:\/\/([^\/])*/,s=/^(\/|data:)/,u=function(t,n,i){n=r(n),i=r(i);for(var o,a,t,s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\((?!#)\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;o=s.exec(t);){a=o[3]||o[2]||o[5]||o[6]||o[4];var u;u=e(a,n,i);var l=o[5]||o[6]?1:0;t=t.substr(0,s.lastIndex-a.length-l-1)+u+t.substr(s.lastIndex-l-1),s.lastIndex=s.lastIndex+(u.length-a.length)}return t};return u.convertURIBase=e,u.absoluteURI=t,u.relativeURI=n,u}),define("common/basic/js/require-css",[],function(){if("undefined"==typeof window)return{load:function(e,t,n){n()}};var e=document.getElementsByTagName("head")[0],t=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,n=!1,i=!0;t[1]||t[7]?n=parseInt(t[1])<6||parseInt(t[7])<=9:t[2]||t[8]?i=!1:t[4]&&(n=parseInt(t[4])<18);var o={};o.pluginBuilder="./css-builder";var r,a,s,u=function(){r=document.createElement("style"),e.appendChild(r),a=r.styleSheet||r.sheet},l=0,c=[],p=function(e){a.addImport(e),r.onload=function(){d()},l++,31==l&&(u(),l=0)},d=function(){s();var e=c.shift();return e?(s=e[1],void p(e[0])):void(s=null)},f=function(e,t){if(a&&a.addImport||u(),a&&a.addImport)s?c.push([e,t]):(p(e),s=t);else{r.textContent='@import "'+e+'";';var n=setInterval(function(){try{r.sheet.cssRules,clearInterval(n),t()}catch(e){}},10)}},h=function(t,n){var o=document.createElement("link");if(o.type="text/css",o.rel="stylesheet",i)o.onload=function(){o.onload=function(){},setTimeout(n,7)};else var r=setInterval(function(){for(var e=0;e<document.styleSheets.length;e++){var t=document.styleSheets[e];if(t.href==o.href)return clearInterval(r),n()}},10);o.href=t,e.appendChild(o)};return o.normalize=function(e,t){return".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4)),t(e)},o.load=function(e,t,i,o){(n?f:h)(t.toUrl(e+".css"),i)},o}),define("common/basic/js/require-css!common/ui/popup/popup",[],function(){}),define("common/ui/popup/popup",["css!common/ui/popup/popup.css"],function(){var e=jQuery,t={$ui:null,$content:null,$box:null,$title:null,$okBtn:null,$cancelBtn:null,$loadBtn:null,$closeIcon:null,_uiState:"normal",defaultWidth:400,init:function(){var t=['<div class="qui-popup" style="display:none">',"<div>",'<div class="qui-popup-dt">','<div class="qui-popup-box">','<div class="qui-popup-closeIcon">&nbsp;</div>','<div class="qui-popup-box-title fontYaHei">title</div>','<div class="qui-popup-box-content">',"</div>",'<div class="qui-popup-box-bottom">',"&nbsp;",'<input class="qui-popup-cancelBtn ui_button_cancel" type="button" value="取消" />  ','<input class="qui-popup-okBtn ui_button" type="button" value="确定" />  ','<input class="qui-popup-loadingBtn  ui_button_load" type="button" value="" />  ',"</div>","</div>","</div>","</div>","</div>"].join("");this.$ui=e(t),this.$content=this.$ui.find(".qui-popup-box-content"),this.$box=this.$ui.find(".qui-popup-box"),this.$title=this.$ui.find(".qui-popup-box-title"),this.$okBtn=this.$ui.find(".qui-popup-okBtn"),this.$cancelBtn=this.$ui.find(".qui-popup-cancelBtn"),this.$loadBtn=this.$ui.find(".qui-popup-loadingBtn"),this.$closeIcon=this.$ui.find(".qui-popup-closeIcon"),this.$ui.appendTo(document.body)},setWidth:function(e){this.$box.animate({width:e},300)},setUIDefault:function(e){this.$ui[0].className="qui-popup",e.exClassName&&this.$ui.addClass(e.exClassName),e.iframeSrc?this.$content.html('<iframe src="'+e.iframeSrc+'"  scrolling="auto" style="height:'+(e.iframeHeight||300)+'px;"  />'):this.$content.html(e.contentHTML||"&nbsp;"),this.$title.html(e.title||"Title"),this.$box.css("width",e.width||this.defaultWidth),this.$title[e.showTitle===!1?"hide":"show"](),this.$okBtn.val(e.okText||"确定"),this.$cancelBtn.val(e.cancelText||"取消"),this.$okBtn[e.showOKBtn===!1?"hide":"show"](),this.$okBtn.removeAttr("data-bn-ipg"),this.$cancelBtn[e.showCancelBtn===!1?"hide":"show"](),this.$cancelBtn.removeAttr("data-bn-ipg"),this.$loadBtn[e.showLoadBtn===!0?"show":"hide"](),this.$loadBtn.removeAttr("data-bn-ipg"),this.$ui.find(".qui-popup-closeIcon").removeAttr("data-bn-ipg"),this.$closeIcon[e.showCloseIcon===!1?"hide":"show"]()},show:function(n){if("hideing"==t._uiState)t.$box.stop(),t.$ui.stop(),this.$ui.css({display:"block",opacity:1}),this.$box.css({top:0,opacity:1}),t._uiState="normal",n.onShow&&n.onShow();else{t._uiState="showing";var i={},o={top:0};e.support.leadingWhitespace&&(i.opacity=1,o.opacity=1),this.$ui.css("display","block").animate(i,200,function(){t.$box.css("top",-30).animate(o,200,function(){t._uiState="normal",n.onShow&&n.onShow()})})}},hide:function(n){if(!n||!n.onBeforeHide||n.onBeforeHide()!==!1){t._uiState="hideing";var i={top:-30},o={};e.support.leadingWhitespace&&(i.opacity=0,o.opacity=0),this.$box.animate(i,200,function(){t.$ui.animate(o,200,function(){t._uiState="normal",t.$ui.css("display","none"),t.$content.html(""),n&&n.onAfterHide&&n.onAfterHide()})})}}};t.init();var n=null,i={show:function(e){return n=e,t.setUIDefault(e),t.$ui.undelegate("click").delegate(".qui-popup-okBtn,.qui-popup-cancelBtn,.qui-popup-closeIcon","click",function(n){if(this.className.indexOf("qui-popup-closeIcon")!=-1||this.className.indexOf("qui-popup-cancelBtn")!=-1){if(e.onBeforeCancel&&!e.onBeforeCancel(n))return;e.onCancel&&e.onCancel()}else if(this.className.indexOf("qui-popup-okBtn")!=-1&&e.onOK&&e.onOK()===!1)return;t.hide(e)}),t.show(e),this},hide:function(e){return t.hide(e),this},setContent:function(e){return t.$content.html(e),this},getContent:function(){return t.$content[0]},getButtons:function(){return{okBtn:t.$okBtn[0],cancelBtn:t.$cancelBtn[0],loadBtn:t.$loadBtn[0],closeIcon:t.$ui.find(".qui-popup-closeIcon")[0]}},setOption:function(i){var o={width:function(){t.setWidth(i.width)},showTitle:function(){i.showTitle===!1?t.$title.hide():t.$title.show()},okText:function(){t.$okBtn.val(i.okText)},cancelText:function(){t.$cancelBtn.val(i.cancelText)},showOKBtn:function(){i.showOKBtn===!1?t.$okBtn.hide():t.$okBtn.show();
},showCancelBtn:function(){i.showCancelBtn===!1?t.$cancelBtn.hide():t.$cancelBtn.show()},showLoadBtn:function(){i.showLoadBtn===!1?t.$loadBtn.hide():t.$loadBtn.show()},showCloseIcon:function(){i.showCloseIcon===!1?t.$closeIcon.hide():t.$closeIcon.show()},title:function(){t.$title.html(i.title)},exClassName:function(){t.$ui[0].className="qui-popup "+i.exClassName},contentHTML:function(){i.iframeSrc||t.$content.html(i.contentHTML)},iframeSrc:function(){t.$content.html('<iframe src="'+i.iframeSrc+'"  scrolling="auto" style="height:'+(i.iframeHeight||300)+'px;" />')},iframeHeight:function(){t.$content.children("iframe").css("height",i.iframeHeight)}};for(var r in i)n[r]=i[r],"function"==e.type(o[r])&&o[r]()}};return i}),!function(e,t){"use strict";function n(e,t){for(var n,i=[],r=0;r<e.length;++r){if(n=a[e[r]]||o(e[r]),!n)throw"module definition dependecy not found: "+e[r];i.push(n)}t.apply(null,i)}function i(e,i,o){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(o===t)throw"invalid module definition, definition function must be specified";n(i,function(){a[e]=o.apply(null,arguments)})}function o(t){for(var n=e,i=t.split(/[.\/]/),o=0;o<i.length;++o){if(!n[i[o]])return;n=n[i[o]]}return n}function r(n){for(var i=0;i<n.length;i++){for(var o=e,r=n[i],s=r.split(/[.\/]/),u=0;u<s.length-1;++u)o[s[u]]===t&&(o[s[u]]={}),o=o[s[u]];o[s[s.length-1]]=a[r]}}var a={},s="moxie/core/utils/Basic",u="moxie/core/I18n",l="moxie/core/utils/Mime",c="moxie/core/utils/Env",p="moxie/core/utils/Dom",d="moxie/core/Exceptions",f="moxie/core/EventTarget",h="moxie/core/utils/Encode",m="moxie/runtime/Runtime",g="moxie/runtime/RuntimeClient",v="moxie/file/Blob",b="moxie/file/File",x="moxie/file/FileInput",y="moxie/file/FileDrop",_="moxie/runtime/RuntimeTarget",w="moxie/file/FileReader",E="moxie/core/utils/Url",A="moxie/file/FileReaderSync",T="moxie/xhr/FormData",k="moxie/xhr/XMLHttpRequest",C="moxie/runtime/Transporter",S="moxie/image/Image",R="moxie/runtime/html5/Runtime",I="moxie/runtime/html5/file/Blob",$="moxie/core/utils/Events",O="moxie/runtime/html5/file/FileInput",q="moxie/runtime/html5/file/FileDrop",D="moxie/runtime/html5/file/FileReader",L="moxie/runtime/html5/xhr/XMLHttpRequest",j="moxie/runtime/html5/utils/BinaryReader",P="moxie/runtime/html5/image/JPEGHeaders",N="moxie/runtime/html5/image/ExifParser",M="moxie/runtime/html5/image/JPEG",U="moxie/runtime/html5/image/PNG",F="moxie/runtime/html5/image/ImageInfo",z="moxie/runtime/html5/image/MegaPixel",B="moxie/runtime/html5/image/Image",H="moxie/runtime/flash/Runtime",G="moxie/runtime/flash/file/Blob",V="moxie/runtime/flash/file/FileInput",X="moxie/runtime/flash/file/FileReader",W="moxie/runtime/flash/file/FileReaderSync",Y="moxie/runtime/flash/xhr/XMLHttpRequest",J="moxie/runtime/flash/runtime/Transporter",Q="moxie/runtime/flash/image/Image",K="moxie/runtime/silverlight/Runtime",Z="moxie/runtime/silverlight/file/Blob",ee="moxie/runtime/silverlight/file/FileInput",te="moxie/runtime/silverlight/file/FileDrop",ne="moxie/runtime/silverlight/file/FileReader",ie="moxie/runtime/silverlight/file/FileReaderSync",oe="moxie/runtime/silverlight/xhr/XMLHttpRequest",re="moxie/runtime/silverlight/runtime/Transporter",ae="moxie/runtime/silverlight/image/Image",se="moxie/runtime/html4/Runtime",ue="moxie/runtime/html4/file/FileInput",le="moxie/runtime/html4/file/FileReader",ce="moxie/runtime/html4/xhr/XMLHttpRequest",pe="moxie/runtime/html4/image/Image";i(s,[],function(){var e=function(e){var t;return e===t?"undefined":null===e?"null":e.nodeType?"node":{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},t=function(i){var o;return n(arguments,function(r,s){s>0&&n(r,function(n,r){n!==o&&(e(i[r])===e(n)&&~a(e(n),["array","object"])?t(i[r],n):i[r]=n)})}),i},n=function(e,t){var n,i,o,r;if(e){try{n=e.length}catch(a){n=r}if(n===r){for(i in e)if(e.hasOwnProperty(i)&&t(e[i],i)===!1)return}else for(o=0;n>o;o++)if(t(e[o],o)===!1)return}},i=function(t){var n;if(!t||"object"!==e(t))return!0;for(n in t)return!1;return!0},o=function(t,n){function i(o){"function"===e(t[o])&&t[o](function(e){++o<r&&!e?i(o):n(e)})}var o=0,r=t.length;"function"!==e(n)&&(n=function(){}),t&&t.length||n(),i(o)},r=function(e,t){var i=0,o=e.length,r=new Array(o);n(e,function(e,n){e(function(e){if(e)return t(e);var a=[].slice.call(arguments);a.shift(),r[n]=a,i++,i===o&&(r.unshift(null),t.apply(this,r))})})},a=function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n}return-1},s=function(t,n){var i=[];"array"!==e(t)&&(t=[t]),"array"!==e(n)&&(n=[n]);for(var o in t)-1===a(t[o],n)&&i.push(t[o]);return!!i.length&&i},u=function(e,t){var i=[];return n(e,function(e){-1!==a(e,t)&&i.push(e)}),i.length?i:null},l=function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]=e[t];return n},c=function(){var e=0;return function(t){var n,i=(new Date).getTime().toString(32);for(n=0;5>n;n++)i+=Math.floor(65535*Math.random()).toString(32);return(t||"o_")+i+(e++).toString(32)}}(),p=function(e){return e?String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,""):e},d=function(e){if("string"!=typeof e)return e;var t,n={t:1099511627776,g:1073741824,m:1048576,k:1024};return e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),t=e[2],e=+e[1],n.hasOwnProperty(t)&&(e*=n[t]),e};return{guid:c,typeOf:e,extend:t,each:n,isEmptyObj:i,inSeries:o,inParallel:r,inArray:a,arrayDiff:s,arrayIntersect:u,toArray:l,trim:p,parseSizeStr:d}}),i(u,[s],function(e){var t={};return{addI18n:function(n){return e.extend(t,n)},translate:function(e){return t[e]||e},_:function(e){return this.translate(e)},sprintf:function(t){var n=[].slice.call(arguments,1);return t.replace(/%[a-z]/g,function(){var t=n.shift();return"undefined"!==e.typeOf(t)?t:""})}}}),i(l,[s,u],function(e,t){var n="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",i={mimes:{},extensions:{},addMimeType:function(e){var t,n,i,o=e.split(/,/);for(t=0;t<o.length;t+=2){for(i=o[t+1].split(/ /),n=0;n<i.length;n++)this.mimes[i[n]]=o[t];this.extensions[o[t]]=i}},extList2mimes:function(t,n){var i,o,r,a,s=this,u=[];for(o=0;o<t.length;o++)for(i=t[o].extensions.split(/\s*,\s*/),r=0;r<i.length;r++){if("*"===i[r])return[];if(a=s.mimes[i[r]])-1===e.inArray(a,u)&&u.push(a);else{if(!n||!/^\w+$/.test(i[r]))return[];u.push("."+i[r])}}return u},mimes2exts:function(t){var n=this,i=[];return e.each(t,function(t){if("*"===t)return i=[],!1;var o=t.match(/^(\w+)\/(\*|\w+)$/);o&&("*"===o[2]?e.each(n.extensions,function(e,t){new RegExp("^"+o[1]+"/").test(t)&&[].push.apply(i,n.extensions[t])}):n.extensions[t]&&[].push.apply(i,n.extensions[t]))}),i},mimes2extList:function(n){var i=[],o=[];return"string"===e.typeOf(n)&&(n=e.trim(n).split(/\s*,\s*/)),o=this.mimes2exts(n),i.push({title:t.translate("Files"),extensions:o.length?o.join(","):"*"}),i.mimes=n,i},getFileExtension:function(e){var t=e&&e.match(/\.([^.]+)$/);return t?t[1].toLowerCase():""},getFileMime:function(e){return this.mimes[this.getFileExtension(e)]||""}};return i.addMimeType(n),i}),i(c,[s],function(e){function t(e,t,n){var i=0,o=0,r=0,a={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},s=function(e){return e=(""+e).replace(/[_\-+]/g,"."),e=e.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),e.length?e.split("."):[-8]},u=function(e){return e?isNaN(e)?a[e]||-7:parseInt(e,10):0};for(e=s(e),t=s(t),o=Math.max(e.length,t.length),i=0;o>i;i++)if(e[i]!=t[i]){if(e[i]=u(e[i]),t[i]=u(t[i]),e[i]<t[i]){r=-1;break}if(e[i]>t[i]){r=1;break}}if(!n)return r;switch(n){case">":case"gt":return r>0;case">=":case"ge":return r>=0;case"<=":case"le":return 0>=r;case"==":case"=":case"eq":return 0===r;case"<>":case"!=":case"ne":return 0!==r;case"":case"<":case"lt":return 0>r;default:return null}}var n=function(e){var t="",n="?",i="function",o="undefined",r="object",a="major",s="name",u="version",l={has:function(e,t){return-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()}},c={rgx:function(){for(var t,n,a,s,u,l,c,p=0,d=arguments;p<d.length;p+=2){var f=d[p],h=d[p+1];if(typeof t===o){t={};for(s in h)u=h[s],typeof u===r?t[u[0]]=e:t[u]=e}for(n=a=0;n<f.length;n++)if(l=f[n].exec(this.getUA())){for(s=0;s<h.length;s++)c=l[++a],u=h[s],typeof u===r&&u.length>0?2==u.length?t[u[0]]=typeof u[1]==i?u[1].call(this,c):u[1]:3==u.length?t[u[0]]=typeof u[1]!==i||u[1].exec&&u[1].test?c?c.replace(u[1],u[2]):e:c?u[1].call(this,c,u[2]):e:4==u.length&&(t[u[0]]=c?u[3].call(this,c.replace(u[1],u[2])):e):t[u]=c?c:e;break}if(l)break}return t},str:function(t,i){for(var o in i)if(typeof i[o]===r&&i[o].length>0){for(var a=0;a<i[o].length;a++)if(l.has(i[o][a],t))return o===n?e:o}else if(l.has(i[o],t))return o===n?e:o;return t}},p={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},d={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[s,u,a],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[s,"Opera"],u,a],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[s,u,a],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[s,"IE"],u,a],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[s,"Yandex"],u,a],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[s,/_/g," "],u,a],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[s,u,a],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[s,"Dolphin"],u,a],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[s,"Chrome"],u,a],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[s,"Android Browser"],u,a],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[u,a,[s,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[u,a,s],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[s,[a,c.str,p.browser.oldsafari.major],[u,c.str,p.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[s,u,a],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[s,"Netscape"],u,a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[s,u,a]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[s,u],[/rv\:([\w\.]+).*(gecko)/i],[u,s]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[s,[u,c.str,p.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[s,"Windows"],[u,c.str,p.os.windows.version]],[/\((bb)(10);/i],[[s,"BlackBerry"],u],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[s,u],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[s,"Symbian"],u],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[s,"Firefox OS"],u],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[s,u],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[s,"Chromium OS"],u],[/(sunos)\s?([\w\.]+\d)*/i],[[s,"Solaris"],u],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[s,u],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[s,"iOS"],[u,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[s,[u,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[s,u]]},f=function(e){var n=e||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:t);this.getBrowser=function(){return c.rgx.apply(this,d.browser)},this.getEngine=function(){return c.rgx.apply(this,d.engine)},this.getOS=function(){return c.rgx.apply(this,d.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this.setUA(n)};return(new f).getResult()}(),i=function(){var t={define_property:function(){return!1}(),create_canvas:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),return_response_type:function(t){try{if(-1!==e.inArray(t,["","text","document"]))return!0;if(window.XMLHttpRequest){var n=new XMLHttpRequest;if(n.open("get","/"),"responseType"in n)return n.responseType=t,n.responseType===t}}catch(i){}return!1},use_data_uri:function(){var e=new Image;return e.onload=function(){t.use_data_uri=1===e.width&&1===e.height},setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return t.use_data_uri&&("IE"!==o.browser||o.version>=9)},use_data_uri_of:function(e){return t.use_data_uri&&33e3>e||t.use_data_uri_over32kb()},use_fileinput:function(){var e=document.createElement("input");return e.setAttribute("type","file"),!e.disabled}};return function(n){var i=[].slice.call(arguments);return i.shift(),"function"===e.typeOf(t[n])?t[n].apply(this,i):!!t[n]}}(),o={can:i,browser:n.browser.name,version:parseFloat(n.browser.major),os:n.os.name,osVersion:n.os.version,verComp:t,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return o.OS=o.os,o}),i(p,[c],function(e){var t=function(e){return"string"!=typeof e?e:document.getElementById(e)},n=function(e,t){if(!e.className)return!1;var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");return n.test(e.className)},i=function(e,t){n(e,t)||(e.className=e.className?e.className.replace(/\s+$/,"")+" "+t:t)},o=function(e,t){if(e.className){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})}},r=function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},a=function(t,n){function i(e){var t,n,i=0,o=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===l.compatMode?l.documentElement:l.body,i=n.left+t.scrollLeft,o=n.top+t.scrollTop),{x:i,y:o}}var o,r,a,s=0,u=0,l=document;if(t=t,n=n||l.body,t&&t.getBoundingClientRect&&"IE"===e.browser&&(!l.documentMode||l.documentMode<8))return r=i(t),a=i(n),{x:r.x-a.x,y:r.y-a.y};for(o=t;o&&o!=n&&o.nodeType;)s+=o.offsetLeft||0,u+=o.offsetTop||0,o=o.offsetParent;for(o=t.parentNode;o&&o!=n&&o.nodeType;)s-=o.scrollLeft||0,u-=o.scrollTop||0,o=o.parentNode;return{x:s,y:u}},s=function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}};return{get:t,hasClass:n,addClass:i,removeClass:o,getStyle:r,getPos:a,getSize:s}}),i(d,[s],function(e){function t(e,t){var n;for(n in e)if(e[n]===t)return n;return null}return{RuntimeError:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": RuntimeError "+this.code}var i={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return e.extend(n,i),n.prototype=Error.prototype,n}(),OperationNotAllowedException:function(){function t(e){this.code=e,this.name="OperationNotAllowedException"}return e.extend(t,{NOT_ALLOWED_ERR:1}),t.prototype=Error.prototype,t}(),ImageError:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": ImageError "+this.code}var i={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return e.extend(n,i),n.prototype=Error.prototype,n}(),FileException:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": FileException "+this.code}var i={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return e.extend(n,i),n.prototype=Error.prototype,n}(),DOMException:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": DOMException "+this.code}var i={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return e.extend(n,i),n.prototype=Error.prototype,n}(),EventException:function(){function t(e){this.code=e,this.name="EventException"}return e.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0}),t.prototype=Error.prototype,t}()}}),i(f,[d,s],function(e,t){function n(){var n={};t.extend(this,{uid:null,init:function(){this.uid||(this.uid=t.guid("uid_"))},addEventListener:function(e,i,o,r){var a,s=this;return e=t.trim(e),/\s/.test(e)?void t.each(e.split(/\s+/),function(e){s.addEventListener(e,i,o,r)}):(e=e.toLowerCase(),o=parseInt(o,10)||0,a=n[this.uid]&&n[this.uid][e]||[],a.push({fn:i,priority:o,scope:r||this}),n[this.uid]||(n[this.uid]={}),void(n[this.uid][e]=a))},hasEventListener:function(e){return e?!(!n[this.uid]||!n[this.uid][e]):!!n[this.uid]},removeEventListener:function(e,i){e=e.toLowerCase();var o,r=n[this.uid]&&n[this.uid][e];if(r){if(i){for(o=r.length-1;o>=0;o--)if(r[o].fn===i){r.splice(o,1);break}}else r=[];r.length||(delete n[this.uid][e],t.isEmptyObj(n[this.uid])&&delete n[this.uid])}},removeAllEventListeners:function(){n[this.uid]&&delete n[this.uid]},dispatchEvent:function(i){var o,r,a,s,u,l={},c=!0;if("string"!==t.typeOf(i)){if(s=i,"string"!==t.typeOf(s.type))throw new e.EventException(e.EventException.UNSPECIFIED_EVENT_TYPE_ERR);i=s.type,s.total!==u&&s.loaded!==u&&(l.total=s.total,l.loaded=s.loaded),l.async=s.async||!1}if(-1!==i.indexOf("::")?function(e){o=e[0],i=e[1]}(i.split("::")):o=this.uid,i=i.toLowerCase(),r=n[o]&&n[o][i]){r.sort(function(e,t){return t.priority-e.priority}),a=[].slice.call(arguments),a.shift(),l.type=i,a.unshift(l);var p=[];t.each(r,function(e){a[0].target=e.scope,l.async?p.push(function(t){setTimeout(function(){t(e.fn.apply(e.scope,a)===!1)},1)}):p.push(function(t){t(e.fn.apply(e.scope,a)===!1)})}),p.length&&t.inSeries(p,function(e){c=!e})}return c},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(e){var n;"array"!==t.typeOf(e)&&(e=[e]);for(var i=0;i<e.length;i++)n="on"+e[i],"function"===t.typeOf(this[n])?this.addEventListener(e[i],this[n]):"undefined"===t.typeOf(this[n])&&(this[n]=null)}})}return n.instance=new n,n}),i(h,[],function(){var e=function(e){return unescape(encodeURIComponent(e))},t=function(e){return decodeURIComponent(escape(e))},n=function(e,n){if("function"==typeof window.atob)return n?t(window.atob(e)):window.atob(e);var i,o,r,a,s,u,l,c,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,f=0,h="",m=[];if(!e)return e;e+="";do a=p.indexOf(e.charAt(d++)),s=p.indexOf(e.charAt(d++)),u=p.indexOf(e.charAt(d++)),l=p.indexOf(e.charAt(d++)),c=a<<18|s<<12|u<<6|l,i=255&c>>16,o=255&c>>8,r=255&c,m[f++]=64==u?String.fromCharCode(i):64==l?String.fromCharCode(i,o):String.fromCharCode(i,o,r);while(d<e.length);return h=m.join(""),n?t(h):h},i=function(t,n){if(n&&e(t),"function"==typeof window.btoa)return window.btoa(t);var i,o,r,a,s,u,l,c,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,f=0,h="",m=[];if(!t)return t;do i=t.charCodeAt(d++),o=t.charCodeAt(d++),r=t.charCodeAt(d++),c=i<<16|o<<8|r,a=63&c>>18,s=63&c>>12,u=63&c>>6,l=63&c,m[f++]=p.charAt(a)+p.charAt(s)+p.charAt(u)+p.charAt(l);while(d<t.length);h=m.join("");var g=t.length%3;return(g?h.slice(0,g-3):h)+"===".slice(g||3)};return{utf8_encode:e,utf8_decode:t,atob:n,btoa:i}}),i(m,[s,p,f],function(e,t,n){function i(n,o,a,s,u){var l,c=this,p=e.guid(o+"_"),d=u||"browser";n=n||{},r[p]=this,a=e.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},a),n.preferred_caps&&(d=i.getMode(s,n.preferred_caps,d)),l=function(){var t={};return{exec:function(e,n,i,o){return l[n]&&(t[e]||(t[e]={context:this,instance:new l[n]}),t[e].instance[i])?t[e].instance[i].apply(this,o):void 0},removeInstance:function(e){delete t[e]},removeAllInstances:function(){var n=this;e.each(t,function(t,i){"function"===e.typeOf(t.instance.destroy)&&t.instance.destroy.call(t.context),n.removeInstance(i)})}}}(),e.extend(this,{initialized:!1,uid:p,type:o,mode:i.getMode(s,n.required_caps,d),shimid:p+"_container",clients:0,options:n,can:function(t,n){var o=arguments[2]||a;if("string"===e.typeOf(t)&&"undefined"===e.typeOf(n)&&(t=i.parseCaps(t)),"object"===e.typeOf(t)){for(var r in t)if(!this.can(r,t[r],o))return!1;return!0}return"function"===e.typeOf(o[t])?o[t].call(this,n):n===o[t]},getShimContainer:function(){var n,i=t.get(this.shimid);return i||(n=this.options.container?t.get(this.options.container):document.body,i=document.createElement("div"),i.id=this.shimid,i.className="moxie-shim moxie-shim-"+this.type,e.extend(i.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),n.appendChild(i),n=null),i},getShim:function(){return l},shimExec:function(e,t){var n=[].slice.call(arguments,2);return c.getShim().exec.call(this,this.uid,e,t,n)},exec:function(e,t){var n=[].slice.call(arguments,2);return c[e]&&c[e][t]?c[e][t].apply(this,n):c.shimExec.apply(this,arguments)},destroy:function(){if(c){var e=t.get(this.shimid);e&&e.parentNode.removeChild(e),l&&l.removeAllInstances(),this.unbindAll(),delete r[this.uid],this.uid=null,p=c=l=e=null}}}),this.mode&&n.required_caps&&!this.can(n.required_caps)&&(this.mode=!1)}var o={},r={};return i.order="html5,flash,silverlight,html4",i.getRuntime=function(e){return!!r[e]&&r[e]},i.addConstructor=function(e,t){t.prototype=n.instance,o[e]=t},i.getConstructor=function(e){return o[e]||null},i.getInfo=function(e){var t=i.getRuntime(e);return t?{uid:t.uid,type:t.type,mode:t.mode,can:function(){return t.can.apply(t,arguments)}}:null},i.parseCaps=function(t){var n={};return"string"!==e.typeOf(t)?t||{}:(e.each(t.split(","),function(e){n[e]=!0}),n)},i.can=function(e,t){var n,o,r=i.getConstructor(e);return!!r&&(n=new r({required_caps:t}),o=n.mode,n.destroy(),!!o)},i.thatCan=function(e,t){var n=(t||i.order).split(/\s*,\s*/);for(var o in n)if(i.can(n[o],e))return n[o];return null},i.getMode=function(t,n,i){var o=null;if("undefined"===e.typeOf(i)&&(i="browser"),n&&!e.isEmptyObj(t)){if(e.each(n,function(n,i){if(t.hasOwnProperty(i)){var r=t[i](n);if("string"==typeof r&&(r=[r]),o){if(!(o=e.arrayIntersect(o,r)))return o=!1}else o=r}}),o)return-1!==e.inArray(i,o)?i:o[0];if(o===!1)return!1}return i},i.capTrue=function(){return!0},i.capFalse=function(){return!1},i.capTest=function(e){return function(){return!!e}},i}),i(g,[d,s,m],function(e,t,n){return function i(){var i;t.extend(this,{connectRuntime:function(o){function r(t){var a,u;return t.length?(a=t.shift(),(u=n.getConstructor(a))?(i=new u(o),i.bind("Init",function(){i.initialized=!0,setTimeout(function(){i.clients++,s.trigger("RuntimeInit",i)},1)}),i.bind("Error",function(){i.destroy(),r(t)}),i.mode?void i.init():void i.trigger("Error")):void r(t)):(s.trigger("RuntimeError",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),void(i=null))}var a,s=this;if("string"===t.typeOf(o)?a=o:"string"===t.typeOf(o.ruid)&&(a=o.ruid),a){if(i=n.getRuntime(a))return i.clients++,i;throw new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)}r((o.runtime_order||n.order).split(/\s*,\s*/))},getRuntime:function(){return i&&i.uid?i:(i=null,null)},disconnectRuntime:function(){i&&--i.clients<=0&&(i.destroy(),i=null)}})}}),i(v,[s,h,g],function(e,t,n){function i(r,a){function s(t,n,r){var a,s=o[this.uid];return"string"===e.typeOf(s)&&s.length?(a=new i(null,{type:r,size:n-t}),a.detach(s.substr(t,a.size)),a):null}n.call(this),r&&this.connectRuntime(r),a?"string"===e.typeOf(a)&&(a={data:a}):a={},e.extend(this,{uid:a.uid||e.guid("uid_"),ruid:r,size:a.size||0,type:a.type||"",slice:function(e,t,n){return this.isDetached()?s.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,n)},getSource:function(){return o[this.uid]?o[this.uid]:null},detach:function(e){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy",o[this.uid]),this.disconnectRuntime(),this.ruid=null),e=e||"";var n=e.match(/^data:([^;]*);base64,/);n&&(this.type=n[1],e=t.atob(e.substring(e.indexOf("base64,")+7))),this.size=e.length,o[this.uid]=e},isDetached:function(){return!this.ruid&&"string"===e.typeOf(o[this.uid])},destroy:function(){this.detach(),delete o[this.uid]}}),a.data?this.detach(a.data):o[this.uid]=a}var o={};return i}),i(b,[s,l,v],function(e,t,n){function i(i,o){var r,a;if(o||(o={}),a=o.type&&""!==o.type?o.type:t.getFileMime(o.name),o.name)r=o.name.replace(/\\/g,"/"),r=r.substr(r.lastIndexOf("/")+1);else{var s=a.split("/")[0];r=e.guid((""!==s?s:"file")+"_"),t.extensions[a]&&(r+="."+t.extensions[a][0])}n.apply(this,arguments),e.extend(this,{type:a||"",name:r||e.guid("file_"),lastModifiedDate:o.lastModifiedDate||(new Date).toLocaleString()})}return i.prototype=n.prototype,i}),i(x,[s,l,p,d,f,u,b,m,g],function(e,t,n,i,o,r,a,s,u){function l(o){var l,p,d,f=this;if(-1!==e.inArray(e.typeOf(o),["string","node"])&&(o={browse_button:o}),p=n.get(o.browse_button),!p)throw new i.DOMException(i.DOMException.NOT_FOUND_ERR);d={accept:[{title:r.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:p.parentNode||document.body},o=e.extend({},d,o),"string"==typeof o.required_caps&&(o.required_caps=s.parseCaps(o.required_caps)),"string"==typeof o.accept&&(o.accept=t.mimes2extList(o.accept)),l=n.get(o.container),l||(l=document.body),"static"===n.getStyle(l,"position")&&(l.style.position="relative"),l=p=null,u.call(f),e.extend(f,{uid:e.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){f.convertEventPropsToHandlers(c),f.bind("RuntimeInit",function(t,i){f.ruid=i.uid,f.shimid=i.shimid,f.bind("Ready",function(){f.trigger("Refresh")},999),f.bind("Change",function(){var t=i.exec.call(f,"FileInput","getFiles");f.files=[],e.each(t,function(e){return 0===e.size||void f.files.push(new a(f.ruid,e))})},999),f.bind("Refresh",function(){var t,r,a,s;a=n.get(o.browse_button),s=n.get(i.shimid),a&&(t=n.getPos(a,n.get(o.container)),r=n.getSize(a),s&&e.extend(s.style,{top:t.y+"px",left:t.x+"px",width:r.w+"px",height:r.h+"px"})),s=a=null}),i.exec.call(f,"FileInput","init",o)}),f.connectRuntime(e.extend({},o,{required_caps:{select_file:!0}}))},disable:function(t){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable","undefined"===e.typeOf(t)||t)},refresh:function(){f.trigger("Refresh")},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===e.typeOf(this.files)&&e.each(this.files,function(e){e.destroy()}),this.files=null}})}var c=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return l.prototype=o.instance,l}),i(y,[u,p,d,s,b,g,f,l],function(e,t,n,i,o,r,a,s){function u(n){var a,u=this;"string"==typeof n&&(n={drop_zone:n}),a={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n="object"==typeof n?i.extend({},a,n):a,n.container=t.get(n.drop_zone)||document.body,"static"===t.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=s.mimes2extList(n.accept)),r.call(u),i.extend(u,{uid:i.guid("uid_"),ruid:null,files:null,init:function(){u.convertEventPropsToHandlers(l),u.bind("RuntimeInit",function(e,t){u.ruid=t.uid,u.bind("Drop",function(){var e=t.exec.call(u,"FileDrop","getFiles");u.files=[],i.each(e,function(e){u.files.push(new o(u.ruid,e))})},999),t.exec.call(u,"FileDrop","init",n),u.dispatchEvent("ready")}),u.connectRuntime(n)},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null}})}var l=["ready","dragenter","dragleave","drop","error"];return u.prototype=a.instance,u}),i(_,[s,g,f],function(e,t,n){function i(){this.uid=e.guid("uid_"),t.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return i.prototype=n.instance,i}),i(w,[s,h,d,f,v,b,_],function(e,t,n,i,o,r,a){function s(){function i(e,i){function c(e){l.readyState=s.DONE,l.error=e,l.trigger("error"),p()}function p(){r.destroy(),r=null,l.trigger("loadend")}function d(t){r.bind("Error",function(e,t){c(t)}),r.bind("Progress",function(e){l.result=t.exec.call(r,"FileReader","getResult"),l.trigger(e)}),r.bind("Load",function(e){l.readyState=s.DONE,l.result=t.exec.call(r,"FileReader","getResult"),l.trigger(e),p()}),t.exec.call(r,"FileReader","read",e,i)}if(r=new a,this.convertEventPropsToHandlers(u),this.readyState===s.LOADING)return c(new n.DOMException(n.DOMException.INVALID_STATE_ERR));if(this.readyState=s.LOADING,this.trigger("loadstart"),i instanceof o)if(i.isDetached()){
var f=i.getSource();switch(e){case"readAsText":case"readAsBinaryString":this.result=f;break;case"readAsDataURL":this.result="data:"+i.type+";base64,"+t.btoa(f)}this.readyState=s.DONE,this.trigger("load"),p()}else d(r.connectRuntime(i.ruid));else c(new n.DOMException(n.DOMException.NOT_FOUND_ERR))}var r,l=this;e.extend(this,{uid:e.guid("uid_"),readyState:s.EMPTY,result:null,error:null,readAsBinaryString:function(e){i.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){i.call(this,"readAsDataURL",e)},readAsText:function(e){i.call(this,"readAsText",e)},abort:function(){this.result=null,-1===e.inArray(this.readyState,[s.EMPTY,s.DONE])&&(this.readyState===s.LOADING&&(this.readyState=s.DONE),r&&r.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),r&&(r.getRuntime().exec.call(this,"FileReader","destroy"),r.disconnectRuntime()),l=r=null}})}var u=["loadstart","progress","load","abort","error","loadend"];return s.EMPTY=0,s.LOADING=1,s.DONE=2,s.prototype=i.instance,s}),i(E,[],function(){var e=function(t,n){for(var i=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],o=i.length,r={http:80,https:443},a={},s=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,u=s.exec(t||"");o--;)u[o]&&(a[i[o]]=u[o]);if(!a.scheme){n&&"string"!=typeof n||(n=e(n||document.location.href)),a.scheme=n.scheme,a.host=n.host,a.port=n.port;var l="";/^[^\/]/.test(a.path)&&(l=n.path,/(\/|\/[^\.]+)$/.test(l)?l+="/":l=l.replace(/\/[^\/]+$/,"/")),a.path=l+(a.path||"")}return a.port||(a.port=r[a.scheme]||80),a.port=parseInt(a.port,10),a.path||(a.path="/"),delete a.source,a},t=function(t){var n={http:80,https:443},i=e(t);return i.scheme+"://"+i.host+(i.port!==n[i.scheme]?":"+i.port:"")+i.path+(i.query?i.query:"")},n=function(t){function n(e){return[e.scheme,e.host,e.port].join("/")}return"string"==typeof t&&(t=e(t)),n(e())===n(t)};return{parseUrl:e,resolveUrl:t,hasSameOrigin:n}}),i(A,[s,g,h],function(e,t,n){return function(){function i(e,t){if(!t.isDetached()){var i=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);return this.disconnectRuntime(),i}var o=t.getSource();switch(e){case"readAsBinaryString":return o;case"readAsDataURL":return"data:"+t.type+";base64,"+n.btoa(o);case"readAsText":for(var r="",a=0,s=o.length;s>a;a++)r+=String.fromCharCode(o[a]);return r}}t.call(this),e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(e){return i.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){return i.call(this,"readAsDataURL",e)},readAsText:function(e){return i.call(this,"readAsText",e)}})}}),i(T,[d,s,v],function(e,t,n){function i(){var e,i=[];t.extend(this,{append:function(o,r){var a=this,s=t.typeOf(r);r instanceof n?e={name:o,value:r}:"array"===s?(o+="[]",t.each(r,function(e){a.append(o,e)})):"object"===s?t.each(r,function(e,t){a.append(o+"["+t+"]",e)}):"null"===s||"undefined"===s||"number"===s&&isNaN(r)?a.append(o,"false"):i.push({name:o,value:r.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return e&&e.value||null},getBlobName:function(){return e&&e.name||null},each:function(n){t.each(i,function(e){n(e.value,e.name)}),e&&n(e.value,e.name)},destroy:function(){e=null,i=[]}})}return i}),i(k,[s,d,f,h,E,m,_,v,A,T,c,l],function(e,t,n,i,o,r,a,s,u,l,c,p){function d(){this.uid=e.guid("uid_")}function f(){function n(e,t){return k.hasOwnProperty(e)?1===arguments.length?c.can("define_property")?k[e]:T[e]:void(c.can("define_property")?k[e]=t:T[e]=t):void 0}function u(t){function i(){E.destroy(),E=null,s.dispatchEvent("loadend"),s=null}function o(o){E.bind("LoadStart",function(e){n("readyState",f.LOADING),s.dispatchEvent("readystatechange"),s.dispatchEvent(e),q&&s.upload.dispatchEvent(e)}),E.bind("Progress",function(e){n("readyState")!==f.LOADING&&(n("readyState",f.LOADING),s.dispatchEvent("readystatechange")),s.dispatchEvent(e)}),E.bind("UploadProgress",function(e){q&&s.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})}),E.bind("Load",function(t){n("readyState",f.DONE),n("status",Number(o.exec.call(E,"XMLHttpRequest","getStatus")||0)),n("statusText",h[n("status")]||""),n("response",o.exec.call(E,"XMLHttpRequest","getResponse",n("responseType"))),~e.inArray(n("responseType"),["text",""])?n("responseText",n("response")):"document"===n("responseType")&&n("responseXML",n("response")),U=o.exec.call(E,"XMLHttpRequest","getAllResponseHeaders"),s.dispatchEvent("readystatechange"),n("status")>0?(q&&s.upload.dispatchEvent(t),s.dispatchEvent(t)):(L=!0,s.dispatchEvent("error")),i()}),E.bind("Abort",function(e){s.dispatchEvent(e),i()}),E.bind("Error",function(e){L=!0,n("readyState",f.DONE),s.dispatchEvent("readystatechange"),D=!0,s.dispatchEvent(e),i()}),o.exec.call(E,"XMLHttpRequest","send",{url:v,method:b,async:C,user:x,password:y,headers:S,mimeType:I,encoding:R,responseType:s.responseType,withCredentials:s.withCredentials,options:M},t)}var s=this;_=(new Date).getTime(),E=new a,"string"==typeof M.required_caps&&(M.required_caps=r.parseCaps(M.required_caps)),M.required_caps=e.extend({},M.required_caps,{return_response_type:s.responseType}),t instanceof l&&(M.required_caps.send_multipart=!0),j||(M.required_caps.do_cors=!0),M.ruid?o(E.connectRuntime(M)):(E.bind("RuntimeInit",function(e,t){o(t)}),E.bind("RuntimeError",function(e,t){s.dispatchEvent("RuntimeError",t)}),E.connectRuntime(M))}function g(){n("responseText",""),n("responseXML",null),n("response",null),n("status",0),n("statusText",""),_=w=null}var v,b,x,y,_,w,E,A,T=this,k={timeout:0,readyState:f.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},C=!0,S={},R=null,I=null,$=!1,O=!1,q=!1,D=!1,L=!1,j=!1,P=null,N=null,M={},U="";e.extend(this,k,{uid:e.guid("uid_"),upload:new d,open:function(r,a,s,u,l){var c;if(!r||!a)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(r)||i.utf8_encode(r)!==r)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(~e.inArray(r.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(b=r.toUpperCase()),~e.inArray(b,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);if(a=i.utf8_encode(a),c=o.parseUrl(a),j=o.hasSameOrigin(c),v=o.resolveUrl(a),(u||l)&&!j)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);if(x=u||c.user,y=l||c.pass,C=s||!0,C===!1&&(n("timeout")||n("withCredentials")||""!==n("responseType")))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);$=!C,O=!1,S={},g.call(this),n("readyState",f.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange")},setRequestHeader:function(o,r){var a=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(n("readyState")!==f.OPENED||O)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(o)||i.utf8_encode(o)!==o)throw new t.DOMException(t.DOMException.SYNTAX_ERR);return o=e.trim(o).toLowerCase(),!~e.inArray(o,a)&&!/^(proxy\-|sec\-)/.test(o)&&(S[o]?S[o]+=", "+r:S[o]=r,!0)},getAllResponseHeaders:function(){return U||""},getResponseHeader:function(t){return t=t.toLowerCase(),L||~e.inArray(t,["set-cookie","set-cookie2"])?null:U&&""!==U&&(A||(A={},e.each(U.split(/\r\n/),function(t){var n=t.split(/:\s+/);2===n.length&&(n[0]=e.trim(n[0]),A[n[0].toLowerCase()]={header:n[0],value:e.trim(n[1])})})),A.hasOwnProperty(t))?A[t].header+": "+A[t].value:null},overrideMimeType:function(i){var o,r;if(~e.inArray(n("readyState"),[f.LOADING,f.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(i=e.trim(i.toLowerCase()),/;/.test(i)&&(o=i.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(i=o[1],o[2]&&(r=o[2])),!p.mimes[i])throw new t.DOMException(t.DOMException.SYNTAX_ERR);P=i,N=r},send:function(n,o){if(M="string"===e.typeOf(o)?{ruid:o}:o?o:{},this.convertEventPropsToHandlers(m),this.upload.convertEventPropsToHandlers(m),this.readyState!==f.OPENED||O)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(n instanceof s)M.ruid=n.ruid,I=n.type||"application/octet-stream";else if(n instanceof l){if(n.hasBlob()){var r=n.getBlob();M.ruid=r.ruid,I=r.type||"application/octet-stream"}}else"string"==typeof n&&(R="UTF-8",I="text/plain;charset=UTF-8",n=i.utf8_encode(n));this.withCredentials||(this.withCredentials=M.required_caps&&M.required_caps.send_browser_cookies&&!j),q=!$&&this.upload.hasEventListener(),L=!1,D=!n,$||(O=!0),u.call(this,n)},abort:function(){if(L=!0,$=!1,~e.inArray(n("readyState"),[f.UNSENT,f.OPENED,f.DONE]))n("readyState",f.UNSENT);else{if(n("readyState",f.DONE),O=!1,!E)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);E.getRuntime().exec.call(E,"XMLHttpRequest","abort",D),D=!0}},destroy:function(){E&&("function"===e.typeOf(E.destroy)&&E.destroy(),E=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var h={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};d.prototype=n.instance;var m=["loadstart","progress","abort","error","load","timeout","loadend"];return f.UNSENT=0,f.OPENED=1,f.HEADERS_RECEIVED=2,f.LOADING=3,f.DONE=4,f.prototype=n.instance,f}),i(C,[s,h,g,f],function(e,t,n,i){function o(){function i(){c=p=0,l=this.result=null}function r(t,n){var i=this;u=n,i.bind("TransportingProgress",function(t){p=t.loaded,c>p&&-1===e.inArray(i.state,[o.IDLE,o.DONE])&&a.call(i)},999),i.bind("TransportingComplete",function(){p=c,i.state=o.DONE,l=null,i.result=u.exec.call(i,"Transporter","getAsBlob",t||"")},999),i.state=o.BUSY,i.trigger("TransportingStarted"),a.call(i)}function a(){var e,n=this,i=c-p;d>i&&(d=i),e=t.btoa(l.substr(p,d)),u.exec.call(n,"Transporter","receive",e,c)}var s,u,l,c,p,d;n.call(this),e.extend(this,{uid:e.guid("uid_"),state:o.IDLE,result:null,transport:function(t,n,o){var a=this;if(o=e.extend({chunk_size:204798},o),(s=o.chunk_size%3)&&(o.chunk_size+=3-s),d=o.chunk_size,i.call(this),l=t,c=t.length,"string"===e.typeOf(o)||o.ruid)r.call(a,n,this.connectRuntime(o));else{var u=function(e,t){a.unbind("RuntimeInit",u),r.call(a,n,t)};this.bind("RuntimeInit",u),this.connectRuntime(o)}},abort:function(){var e=this;e.state=o.IDLE,u&&(u.exec.call(e,"Transporter","clear"),e.trigger("TransportingAborted")),i.call(e)},destroy:function(){this.unbindAll(),u=null,this.disconnectRuntime(),i.call(this)}})}return o.IDLE=0,o.BUSY=1,o.DONE=2,o.prototype=i.instance,o}),i(S,[s,p,d,A,k,m,g,C,c,f,v,b,h],function(e,t,n,i,o,r,a,s,u,l,c,p,d){function f(){function i(e){e||(e=this.getRuntime().exec.call(this,"Image","getInfo")),this.size=e.size,this.width=e.width,this.height=e.height,this.type=e.type,this.meta=e.meta,""===this.name&&(this.name=e.name)}function l(t){var i=e.typeOf(t);try{if(t instanceof f){if(!t.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);m.apply(this,arguments)}else if(t instanceof c){if(!~e.inArray(t.type,["image/jpeg","image/png"]))throw new n.ImageError(n.ImageError.WRONG_FORMAT);g.apply(this,arguments)}else if(-1!==e.inArray(i,["blob","file"]))l.call(this,new p(null,t),arguments[1]);else if("string"===i)/^data:[^;]*;base64,/.test(t)?l.call(this,new c(null,{data:t}),arguments[1]):v.apply(this,arguments);else{if("node"!==i||"img"!==t.nodeName.toLowerCase())throw new n.DOMException(n.DOMException.TYPE_MISMATCH_ERR);l.call(this,t.src,arguments[1])}}catch(o){this.trigger("error",o)}}function m(t,n){var i=this.connectRuntime(t.ruid);this.ruid=i.uid,i.exec.call(this,"Image","loadFromImage",t,"undefined"===e.typeOf(n)||n)}function g(t,n){function i(e){o.ruid=e.uid,e.exec.call(o,"Image","loadFromBlob",t)}var o=this;o.name=t.name||"",t.isDetached()?(this.bind("RuntimeInit",function(e,t){i(t)}),n&&"string"==typeof n.required_caps&&(n.required_caps=r.parseCaps(n.required_caps)),this.connectRuntime(e.extend({required_caps:{access_image_binary:!0,resize_image:!0}},n))):i(this.connectRuntime(t.ruid))}function v(e,t){var n,i=this;n=new o,n.open("get",e),n.responseType="blob",n.onprogress=function(e){i.trigger(e)},n.onload=function(){g.call(i,n.response,!0)},n.onerror=function(e){i.trigger(e)},n.onloadend=function(){n.destroy()},n.bind("RuntimeError",function(e,t){i.trigger("RuntimeError",t)}),n.send(null,t)}a.call(this),e.extend(this,{uid:e.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){i.call(this)},999),this.convertEventPropsToHandlers(h),l.apply(this,arguments)},downsize:function(t,i,o,r){try{if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>f.MAX_RESIZE_WIDTH||this.height>f.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);(!t&&!i||"undefined"===e.typeOf(o))&&(o=!1),t=t||this.width,i=i||this.height,r="undefined"===e.typeOf(r)||!!r,this.getRuntime().exec.call(this,"Image","downsize",t,i,o,r)}catch(a){this.trigger("error",a)}},crop:function(e,t,n){this.downsize(e,t,!0,n)},getAsCanvas:function(){if(!u.can("create_canvas"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);var e=this.connectRuntime(this.ruid);return e.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return e||(e="image/jpeg"),"image/jpeg"!==e||t||(t=90),this.getRuntime().exec.call(this,"Image","getAsBlob",e,t)},getAsDataURL:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",e,t)},getAsBinaryString:function(e,t){var n=this.getAsDataURL(e,t);return d.atob(n.substring(n.indexOf("base64,")+7))},embed:function(i){function o(){if(u.can("create_canvas")){var t=r.getAsCanvas();if(t)return i.appendChild(t),t=null,r.destroy(),void h.trigger("embedded")}var o=r.getAsDataURL(a,l);if(!o)throw new n.ImageError(n.ImageError.WRONG_FORMAT);if(u.can("use_data_uri_of",o.length))i.innerHTML='<img src="'+o+'" width="'+r.width+'" height="'+r.height+'" />',r.destroy(),h.trigger("embedded");else{var c=new s;c.bind("TransportingComplete",function(){p=h.connectRuntime(this.result.ruid),h.bind("Embedded",function(){e.extend(p.getShimContainer().style,{top:"0px",left:"0px",width:r.width+"px",height:r.height+"px"}),p=null},999),p.exec.call(h,"ImageView","display",this.result.uid,g,v),r.destroy()}),c.transport(d.atob(o.substring(o.indexOf("base64,")+7)),a,e.extend({},m,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:i}))}}var r,a,l,c,p,h=this,m=arguments[1]||{},g=this.width,v=this.height;try{if(!(i=t.get(i)))throw new n.DOMException(n.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>f.MAX_RESIZE_WIDTH||this.height>f.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);if(a=m.type||this.type||"image/jpeg",l=m.quality||90,c="undefined"!==e.typeOf(m.crop)&&m.crop,m.width)g=m.width,v=m.height||g;else{var b=t.getSize(i);b.w&&b.h&&(g=b.w,v=b.h)}return r=new f,r.bind("Resize",function(){o.call(h)}),r.bind("Load",function(){r.downsize(g,v,c,!1)}),r.clone(this,!1),r}catch(x){this.trigger("error",x)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}})}var h=["progress","load","error","resize","embedded"];return f.MAX_RESIZE_WIDTH=6500,f.MAX_RESIZE_HEIGHT=6500,f.prototype=l.instance,f}),i(R,[s,d,m,c],function(e,t,n,i){function o(t){var o=this,s=n.capTest,u=n.capTrue,l=e.extend({access_binary:s(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return o.can("access_binary")&&!!a.Image},display_media:s(i.can("create_canvas")||i.can("use_data_uri_over32kb")),do_cors:s(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:s(function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&("IE"!==i.browser||i.version>9)}()),filter_by_extension:s(function(){return"Chrome"===i.browser&&i.version>=28||"IE"===i.browser&&i.version>=10}()),return_response_headers:u,return_response_type:function(e){return!("json"!==e||!window.JSON)||i.can("return_response_type",e)},return_status_code:u,report_upload_progress:s(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return o.can("access_binary")&&i.can("create_canvas")},select_file:function(){return i.can("use_fileinput")&&window.File},select_folder:function(){return o.can("select_file")&&"Chrome"===i.browser&&i.version>=21},select_multiple:function(){return!(!o.can("select_file")||"Safari"===i.browser&&"Windows"===i.os||"iOS"===i.os&&i.verComp(i.osVersion,"7.0.4","<"))},send_binary_string:s(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:s(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||o.can("send_binary_string")},slice_blob:s(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return o.can("slice_blob")&&o.can("send_multipart")},summon_file_dialog:s(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||"IE"===i.browser&&i.version>=10||!!~e.inArray(i.browser,["Chrome","Safari"])}()),upload_filesize:u},arguments[2]);n.call(this,t,arguments[1]||r,l),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(o),e=o=null}}(this.destroy)}),e.extend(this.getShim(),a)}var r="html5",a={};return n.addConstructor(r,o),a}),i(I,[R,v],function(e,t){function n(){function e(e,t,n){var i;if(!window.File.prototype.slice)return(i=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?i.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(o){return e.slice(t,n-t)}}this.slice=function(){return new t(this.getRuntime().uid,e.apply(this,arguments))}}return e.Blob=n}),i($,[s],function(e){function t(){this.returnValue=!1}function n(){this.cancelBubble=!0}var i={},o="moxie_"+e.guid(),r=function(r,a,s,u){var l,c;a=a.toLowerCase(),r.addEventListener?(l=s,r.addEventListener(a,l,!1)):r.attachEvent&&(l=function(){var e=window.event;e.target||(e.target=e.srcElement),e.preventDefault=t,e.stopPropagation=n,s(e)},r.attachEvent("on"+a,l)),r[o]||(r[o]=e.guid()),i.hasOwnProperty(r[o])||(i[r[o]]={}),c=i[r[o]],c.hasOwnProperty(a)||(c[a]=[]),c[a].push({func:l,orig:s,key:u})},a=function(t,n,r){var a,s;if(n=n.toLowerCase(),t[o]&&i[t[o]]&&i[t[o]][n]){a=i[t[o]][n];for(var u=a.length-1;u>=0&&(a[u].orig!==r&&a[u].key!==r||(t.removeEventListener?t.removeEventListener(n,a[u].func,!1):t.detachEvent&&t.detachEvent("on"+n,a[u].func),a[u].orig=null,a[u].func=null,a.splice(u,1),r===s));u--);if(a.length||delete i[t[o]][n],e.isEmptyObj(i[t[o]])){delete i[t[o]];try{delete t[o]}catch(l){t[o]=s}}}},s=function(t,n){t&&t[o]&&e.each(i[t[o]],function(e,i){a(t,i,n)})};return{addEvent:r,removeEvent:a,removeAllEvents:s}}),i(O,[R,s,p,$,l,c],function(e,t,n,i,o,r){function a(){var e,a=[];t.extend(this,{init:function(s){var u,l,c,p,d,f,h=this,m=h.getRuntime();e=s,a=[],c=e.accept.mimes||o.extList2mimes(e.accept,m.can("filter_by_extension")),l=m.getShimContainer(),l.innerHTML='<input id="'+m.uid+'" type="file" style="font-size:999px;opacity:0;"'+(e.multiple&&m.can("select_multiple")?"multiple":"")+(e.directory&&m.can("select_folder")?"webkitdirectory directory":"")+(c?' accept="'+c.join(",")+'"':"")+" />",u=n.get(m.uid),t.extend(u.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),p=n.get(e.browse_button),m.can("summon_file_dialog")&&("static"===n.getStyle(p,"position")&&(p.style.position="relative"),d=parseInt(n.getStyle(p,"z-index"),10)||1,p.style.zIndex=d,l.style.zIndex=d-1,i.addEvent(p,"click",function(e){var t=n.get(m.uid);t&&!t.disabled&&t.click(),e.preventDefault()},h.uid)),f=m.can("summon_file_dialog")?p:l,i.addEvent(f,"mouseover",function(){h.trigger("mouseenter")},h.uid),i.addEvent(f,"mouseout",function(){h.trigger("mouseleave")},h.uid),i.addEvent(f,"mousedown",function(){h.trigger("mousedown")},h.uid),i.addEvent(n.get(e.container),"mouseup",function(){h.trigger("mouseup")},h.uid),u.onchange=function g(){if(a=[],e.directory?t.each(this.files,function(e){"."!==e.name&&a.push(e)}):a=[].slice.call(this.files),"IE"!==r.browser)this.value="";else{var n=this.cloneNode(!0);this.parentNode.replaceChild(n,this),n.onchange=g}h.trigger("change")},h.trigger({type:"ready",async:!0}),l=null},getFiles:function(){return a},disable:function(e){var t,i=this.getRuntime();(t=n.get(i.uid))&&(t.disabled=!!e)},destroy:function(){var t=this.getRuntime(),o=t.getShim(),r=t.getShimContainer();i.removeAllEvents(r,this.uid),i.removeAllEvents(e&&n.get(e.container),this.uid),i.removeAllEvents(e&&n.get(e.browse_button),this.uid),r&&(r.innerHTML=""),o.removeInstance(this.uid),a=e=r=o=null}})}return e.FileInput=a}),i(q,[R,s,p,$,l],function(e,t,n,i,o){function r(){function e(e){for(var n=[],i=0;i<e.length;i++)[].push.apply(n,e[i].extensions.split(/\s*,\s*/));return-1===t.inArray("*",n)?n:[]}function r(e){var n=o.getFileExtension(e.name);return!n||!d.length||-1!==t.inArray(n,d)}function a(e,n){var i=[];t.each(e,function(e){var t=e.webkitGetAsEntry();if(t)if(t.isFile){var n=e.getAsFile();r(n)&&p.push(n)}else i.push(t)}),i.length?s(i,n):n()}function s(e,n){var i=[];t.each(e,function(e){i.push(function(t){u(e,t)})}),t.inSeries(i,function(){n()})}function u(e,t){e.isFile?e.file(function(e){r(e)&&p.push(e),t()},function(){t()}):e.isDirectory?l(e,t):t()}function l(e,t){function n(e){o.readEntries(function(t){t.length?([].push.apply(i,t),n(e)):e()},e)}var i=[],o=e.createReader();n(function(){s(i,t)})}var c,p=[],d=[];t.extend(this,{init:function(n){var o,s=this;c=n,d=e(c.accept),o=c.container,i.addEvent(o,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},s.uid),i.addEvent(o,"drop",function(e){e.preventDefault(),e.stopPropagation(),p=[],e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry?a(e.dataTransfer.items,function(){s.trigger("drop")}):(t.each(e.dataTransfer.files,function(e){r(e)&&p.push(e)}),s.trigger("drop"))},s.uid),i.addEvent(o,"dragenter",function(e){e.preventDefault(),e.stopPropagation(),s.trigger("dragenter")},s.uid),i.addEvent(o,"dragleave",function(e){e.preventDefault(),e.stopPropagation(),s.trigger("dragleave")},s.uid)},getFiles:function(){return p},destroy:function(){i.removeAllEvents(c&&n.get(c.container),this.uid),p=d=c=null}})}return e.FileDrop=r}),i(D,[R,h,s],function(e,t,n){function i(){function e(e){return t.atob(e.substring(e.indexOf("base64,")+7))}var i,o=!1;n.extend(this,{read:function(e,t){var r=this;i=new window.FileReader,i.addEventListener("progress",function(e){r.trigger(e)}),i.addEventListener("load",function(e){r.trigger(e)}),i.addEventListener("error",function(e){r.trigger(e,i.error)}),i.addEventListener("loadend",function(){i=null}),"function"===n.typeOf(i[e])?(o=!1,i[e](t.getSource())):"readAsBinaryString"===e&&(o=!0,i.readAsDataURL(t.getSource()))},getResult:function(){return i&&i.result?o?e(i.result):i.result:null},abort:function(){i&&i.abort()},destroy:function(){i=null}})}return e.FileReader=i}),i(L,[R,s,l,E,b,v,T,d,c],function(e,t,n,i,o,r,a,s,u){function l(){function e(e,t){var n,i,o=this;n=t.getBlob().getSource(),i=new window.FileReader,i.onload=function(){t.append(t.getBlobName(),new r(null,{type:n.type,data:i.result})),h.send.call(o,e,t)},i.readAsBinaryString(n)}function l(){return!window.XMLHttpRequest||"IE"===u.browser&&u.version<8?function(){for(var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}}():new window.XMLHttpRequest}function c(e){var t=e.responseXML,n=e.responseText;return"IE"===u.browser&&n&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(e.getResponseHeader("Content-Type"))&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(n)),t&&("IE"===u.browser&&0!==t.parseError||!t.documentElement||"parsererror"===t.documentElement.tagName)?null:t}function p(e){var t="----moxieboundary"+(new Date).getTime(),n="--",i="\r\n",o="",a=this.getRuntime();if(!a.can("send_binary_string"))throw new s.RuntimeError(s.RuntimeError.NOT_SUPPORTED_ERR);return d.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),e.each(function(e,a){o+=e instanceof r?n+t+i+'Content-Disposition: form-data; name="'+a+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+i+"Content-Type: "+(e.type||"application/octet-stream")+i+i+e.getSource()+i:n+t+i+'Content-Disposition: form-data; name="'+a+'"'+i+i+unescape(encodeURIComponent(e))+i}),o+=n+t+n+i}var d,f,h=this;t.extend(this,{send:function(n,o){var s=this,c="Mozilla"===u.browser&&u.version>=4&&u.version<7,h="Android Browser"===u.browser,m=!1;if(f=n.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),d=l(),d.open(n.method,n.url,n.async,n.user,n.password),o instanceof r)o.isDetached()&&(m=!0),o=o.getSource();else if(o instanceof a){if(o.hasBlob())if(o.getBlob().isDetached())o=p.call(s,o),m=!0;else if((c||h)&&"blob"===t.typeOf(o.getBlob().getSource())&&window.FileReader)return void e.call(s,n,o);if(o instanceof a){var g=new window.FormData;o.each(function(e,t){e instanceof r?g.append(t,e.getSource()):g.append(t,e)}),o=g}}d.upload?(n.withCredentials&&(d.withCredentials=!0),d.addEventListener("load",function(e){s.trigger(e)}),d.addEventListener("error",function(e){s.trigger(e)}),d.addEventListener("progress",function(e){s.trigger(e)}),d.upload.addEventListener("progress",function(e){s.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})})):d.onreadystatechange=function(){switch(d.readyState){case 1:break;case 2:break;case 3:var e,t;try{i.hasSameOrigin(n.url)&&(e=d.getResponseHeader("Content-Length")||0),d.responseText&&(t=d.responseText.length)}catch(o){e=t=0}s.trigger({type:"progress",lengthComputable:!!e,total:parseInt(e,10),loaded:t});break;case 4:d.onreadystatechange=function(){},0===d.status?s.trigger("error"):s.trigger("load")}},t.isEmptyObj(n.headers)||t.each(n.headers,function(e,t){d.setRequestHeader(t,e)}),""!==n.responseType&&"responseType"in d&&(d.responseType="json"!==n.responseType||u.can("return_response_type","json")?n.responseType:"text"),m?d.sendAsBinary?d.sendAsBinary(o):function(){for(var e=new Uint8Array(o.length),t=0;t<o.length;t++)e[t]=255&o.charCodeAt(t);d.send(e.buffer)}():d.send(o),s.trigger("loadstart")},getStatus:function(){try{if(d)return d.status}catch(e){}return 0},getResponse:function(e){var t=this.getRuntime();try{switch(e){case"blob":var i=new o(t.uid,d.response),r=d.getResponseHeader("Content-Disposition");if(r){var a=r.match(/filename=([\'\"'])([^\1]+)\1/);a&&(f=a[2])}return i.name=f,i.type||(i.type=n.getFileMime(f)),i;case"json":return u.can("return_response_type","json")?d.response:200===d.status&&window.JSON?JSON.parse(d.responseText):null;case"document":return c(d);default:return""!==d.responseText?d.responseText:null}}catch(s){return null}},getAllResponseHeaders:function(){try{return d.getAllResponseHeaders()}catch(e){}return""},abort:function(){d&&d.abort()},destroy:function(){h=f=null}})}return e.XMLHttpRequest=l}),i(j,[],function(){return function(){function e(e,t){var n,i=r?0:-8*(t-1),a=0;for(n=0;t>n;n++)a|=o.charCodeAt(e+n)<<Math.abs(i+8*n);return a}function n(e,t,n){n=3===arguments.length?n:o.length-t-1,o=o.substr(0,t)+e+o.substr(n+t)}function i(e,t,i){var o,a="",s=r?0:-8*(i-1);for(o=0;i>o;o++)a+=String.fromCharCode(255&t>>Math.abs(s+8*o));n(a,e,i)}var o,r=!1;return{II:function(e){return e===t?r:void(r=e)},init:function(e){r=!1,o=e},SEGMENT:function(e,t,i){switch(arguments.length){case 1:return o.substr(e,o.length-e-1);case 2:return o.substr(e,t);case 3:n(i,e,t);break;default:return o}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(n,o){return o===t?e(n,4):void i(n,o,4)},SLONG:function(t){var n=e(t,4);return n>2147483647?n-4294967296:n},STRING:function(t,n){var i="";for(n+=t;n>t;t++)i+=String.fromCharCode(e(t,1));return i}}}}),i(P,[j],function(e){return function t(n){var i,o,r,a=[],s=0;if(i=new e,i.init(n),65496===i.SHORT(0)){for(o=2;o<=n.length;)if(r=i.SHORT(o),r>=65488&&65495>=r)o+=2;else{if(65498===r||65497===r)break;s=i.SHORT(o+2)+2,r>=65505&&65519>=r&&a.push({hex:r,name:"APP"+(15&r),start:o,length:s,segment:i.SEGMENT(o,s)}),o+=s}return i.init(null),{headers:a,restore:function(e){var t,n;for(i.init(e),o=65504==i.SHORT(2)?4+i.SHORT(4):2,n=0,t=a.length;t>n;n++)i.SEGMENT(o,0,a[n].segment),o+=a[n].length;return e=i.SEGMENT(),i.init(null),e},strip:function(e){var n,o,r;for(o=new t(e),n=o.headers,o.purge(),i.init(e),r=n.length;r--;)i.SEGMENT(n[r].start,n[r].length,"");return e=i.SEGMENT(),i.init(null),e},get:function(e){for(var t=[],n=0,i=a.length;i>n;n++)a[n].name===e.toUpperCase()&&t.push(a[n].segment);return t},set:function(e,t){var n,i,o,r=[];for("string"==typeof t?r.push(t):r=t,n=i=0,o=a.length;o>n&&(a[n].name===e.toUpperCase()&&(a[n].segment=r[i],a[n].length=r[i].length,i++),!(i>=r.length));n++);},purge:function(){a=[],i.init(null),i=null}}}}}),i(N,[s,j],function(e,n){return function i(){function i(e,n){var i,o,r,s,u,p,d,f,h=a.SHORT(e),m=[],g={};for(i=0;h>i;i++)if(d=p=e+12*i+2,r=n[a.SHORT(d)],r!==t){switch(s=a.SHORT(d+=2),u=a.LONG(d+=2),d+=4,m=[],s){case 1:case 7:for(u>4&&(d=a.LONG(d)+c.tiffHeader),o=0;u>o;o++)m[o]=a.BYTE(d+o);break;case 2:u>4&&(d=a.LONG(d)+c.tiffHeader),g[r]=a.STRING(d,u-1);continue;case 3:for(u>2&&(d=a.LONG(d)+c.tiffHeader),o=0;u>o;o++)m[o]=a.SHORT(d+2*o);break;case 4:for(u>1&&(d=a.LONG(d)+c.tiffHeader),o=0;u>o;o++)m[o]=a.LONG(d+4*o);break;case 5:for(d=a.LONG(d)+c.tiffHeader,o=0;u>o;o++)m[o]=a.LONG(d+4*o)/a.LONG(d+4*o+4);break;case 9:for(d=a.LONG(d)+c.tiffHeader,o=0;u>o;o++)m[o]=a.SLONG(d+4*o);break;case 10:for(d=a.LONG(d)+c.tiffHeader,o=0;u>o;o++)m[o]=a.SLONG(d+4*o)/a.SLONG(d+4*o+4);break;default:continue}f=1==u?m[0]:m,g[r]=l.hasOwnProperty(r)&&"object"!=typeof f?l[r][f]:f}return g}function o(){var e=c.tiffHeader;return a.II(18761==a.SHORT(e)),42===a.SHORT(e+=2)&&(c.IFD0=c.tiffHeader+a.LONG(e+=2),u=i(c.IFD0,s.tiff),"ExifIFDPointer"in u&&(c.exifIFD=c.tiffHeader+u.ExifIFDPointer,delete u.ExifIFDPointer),"GPSInfoIFDPointer"in u&&(c.gpsIFD=c.tiffHeader+u.GPSInfoIFDPointer,delete u.GPSInfoIFDPointer),!0)}function r(e,t,n){var i,o,r,u=0;if("string"==typeof t){var l=s[e.toLowerCase()];for(var p in l)if(l[p]===t){t=p;break}}i=c[e.toLowerCase()+"IFD"],o=a.SHORT(i);for(var d=0;o>d;d++)if(r=i+12*d+2,
a.SHORT(r)==t){u=r+8;break}return!!u&&(a.LONG(u,n),!0)}var a,s,u,l,c={};return a=new n,s={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return c={tiffHeader:10},!(e===t||!e.length)&&(a.init(e),65505===a.SHORT(0)&&"EXIF\0"===a.STRING(4,5).toUpperCase()&&o())},TIFF:function(){return u},EXIF:function(){var t;if(t=i(c.exifIFD,s.exif),t.ExifVersion&&"array"===e.typeOf(t.ExifVersion)){for(var n=0,o="";n<t.ExifVersion.length;n++)o+=String.fromCharCode(t.ExifVersion[n]);t.ExifVersion=o}return t},GPS:function(){var t;return t=i(c.gpsIFD,s.gps),t.GPSVersionID&&"array"===e.typeOf(t.GPSVersionID)&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return("PixelXDimension"===e||"PixelYDimension"===e)&&r("exif",e,t)},getBinary:function(){return a.SEGMENT()},purge:function(){a.init(null),a=u=null,c={}}}}}),i(M,[s,d,P,j,N],function(e,t,n,i,o){function r(r){function a(){for(var e,t,n=0;n<=u.length;){if(e=l.SHORT(n+=2),e>=65472&&65475>=e)return n+=5,{height:l.SHORT(n),width:l.SHORT(n+=2)};t=l.SHORT(n+=2),n+=t-2}return null}function s(){p&&c&&l&&(p.purge(),c.purge(),l.init(null),u=d=c=p=l=null)}var u,l,c,p,d,f;if(u=r,l=new i,l.init(u),65496!==l.SHORT(0))throw new t.ImageError(t.ImageError.WRONG_FORMAT);c=new n(r),p=new o,f=!!p.init(c.get("app1")[0]),d=a.call(this),e.extend(this,{type:"image/jpeg",size:u.length,width:d&&d.width||0,height:d&&d.height||0,setExif:function(t,n){return!!f&&("object"===e.typeOf(t)?e.each(t,function(e,t){p.setExif(t,e)}):p.setExif(t,n),void c.set("app1",p.getBinary()))},writeHeaders:function(){return arguments.length?c.restore(arguments[0]):u=c.restore(u)},stripHeaders:function(e){return c.strip(e)},purge:function(){s.call(this)}}),f&&(this.meta={tiff:p.TIFF(),exif:p.EXIF(),gps:p.GPS()})}return r}),i(U,[d,s,j],function(e,t,n){function i(i){function o(){var e,t;return e=a.call(this,8),"IHDR"==e.type?(t=e.start,{width:u.LONG(t),height:u.LONG(t+=4)}):null}function r(){u&&(u.init(null),s=p=l=c=u=null)}function a(e){var t,n,i,o;return t=u.LONG(e),n=u.STRING(e+=4,4),i=e+=4,o=u.LONG(e+t),{length:t,type:n,start:i,CRC:o}}var s,u,l,c,p;s=i,u=new n,u.init(s),function(){var t=0,n=0,i=[35152,20039,3338,6666];for(n=0;n<i.length;n++,t+=2)if(i[n]!=u.SHORT(t))throw new e.ImageError(e.ImageError.WRONG_FORMAT)}(),p=o.call(this),t.extend(this,{type:"image/png",size:s.length,width:p.width,height:p.height,purge:function(){r.call(this)}}),r.call(this)}return i}),i(F,[s,d,M,U],function(e,t,n,i){return function(o){var r,a=[n,i];r=function(){for(var e=0;e<a.length;e++)try{return new a[e](o)}catch(n){}throw new t.ImageError(t.ImageError.WRONG_FORMAT)}(),e.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(e){return e},stripHeaders:function(e){return e},purge:function(){}}),e.extend(this,r),this.purge=function(){r.purge(),r=null}}}),i(z,[],function(){function e(e,i,o){var r=e.naturalWidth,a=e.naturalHeight,s=o.width,u=o.height,l=o.x||0,c=o.y||0,p=i.getContext("2d");t(e)&&(r/=2,a/=2);var d=1024,f=document.createElement("canvas");f.width=f.height=d;for(var h=f.getContext("2d"),m=n(e,r,a),g=0;a>g;){for(var v=g+d>a?a-g:d,b=0;r>b;){var x=b+d>r?r-b:d;h.clearRect(0,0,d,d),h.drawImage(e,-b,-g);var y=b*s/r+l<<0,_=Math.ceil(x*s/r),w=g*u/a/m+c<<0,E=Math.ceil(v*u/a/m);p.drawImage(f,0,0,x,v,y,w,_,E),b+=d}g+=d}f=h=null}function t(e){var t=e.naturalWidth,n=e.naturalHeight;if(t*n>1048576){var i=document.createElement("canvas");i.width=i.height=1;var o=i.getContext("2d");return o.drawImage(e,-t+1,0),0===o.getImageData(0,0,1,1).data[3]}return!1}function n(e,t,n){var i=document.createElement("canvas");i.width=1,i.height=n;var o=i.getContext("2d");o.drawImage(e,0,0);for(var r=o.getImageData(0,0,1,n).data,a=0,s=n,u=n;u>a;){var l=r[4*(u-1)+3];0===l?s=u:a=u,u=s+a>>1}i=null;var c=u/n;return 0===c?1:c}return{isSubsampled:t,renderTo:e}}),i(B,[R,s,d,h,b,F,z,l,c],function(e,t,n,i,o,r,a,s,u){function l(){function e(){if(!x&&!v)throw new n.ImageError(n.DOMException.INVALID_STATE_ERR);return x||v}function l(e){return i.atob(e.substring(e.indexOf("base64,")+7))}function c(e,t){return"data:"+(t||"")+";base64,"+i.btoa(e)}function p(e){var t=this;v=new Image,v.onerror=function(){g.call(this),t.trigger("error",new n.ImageError(n.ImageError.WRONG_FORMAT))},v.onload=function(){t.trigger("load")},v.src=/^data:[^;]*;base64,/.test(e)?e:c(e,_.type)}function d(e,t){var i,o=this;return window.FileReader?(i=new FileReader,i.onload=function(){t(this.result)},i.onerror=function(){o.trigger("error",new n.FileException(n.FileException.NOT_READABLE_ERR))},void i.readAsDataURL(e)):t(e.getAsDataURL())}function f(n,i,o,r){var a,s,u,l,c,p,d=this,f=0,g=0;if(A=r,p=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==t.inArray(p,[5,6,7,8])){var v=n;n=i,i=v}return u=e(),s=o?Math.max:Math.min,a=s(n/u.width,i/u.height),a>1&&(!o||r)?void this.trigger("Resize"):(x||(x=document.createElement("canvas")),l=Math.round(u.width*a),c=Math.round(u.height*a),o?(x.width=n,x.height=i,l>n&&(f=Math.round((l-n)/2)),c>i&&(g=Math.round((c-i)/2))):(x.width=l,x.height=c),A||m(x.width,x.height,p),h.call(this,u,x,-f,-g,l,c),this.width=x.width,this.height=x.height,E=!0,void d.trigger("Resize"))}function h(e,t,n,i,o,r){if("iOS"===u.OS)a.renderTo(e,t,{width:o,height:r,x:n,y:i});else{var s=t.getContext("2d");s.drawImage(e,n,i,o,r)}}function m(e,t,n){switch(n){case 5:case 6:case 7:case 8:x.width=t,x.height=e;break;default:x.width=e,x.height=t}var i=x.getContext("2d");switch(n){case 2:i.translate(e,0),i.scale(-1,1);break;case 3:i.translate(e,t),i.rotate(Math.PI);break;case 4:i.translate(0,t),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-t);break;case 7:i.rotate(.5*Math.PI),i.translate(e,-t),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-e,0)}}function g(){b&&(b.purge(),b=null),y=v=x=_=null,E=!1}var v,b,x,y,_,w=this,E=!1,A=!0;t.extend(this,{loadFromBlob:function(e){var t=this,i=t.getRuntime(),o=!(arguments.length>1)||arguments[1];if(!i.can("access_binary"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);return _=e,e.isDetached()?(y=e.getSource(),void p.call(this,y)):void d.call(this,e.getSource(),function(e){o&&(y=l(e)),p.call(t,e)})},loadFromImage:function(e,t){this.meta=e.meta,_=new o(null,{name:e.name,size:e.size,type:e.type}),p.call(this,t?y=e.getAsBinaryString():e.getAsDataURL())},getInfo:function(){var t,n=this.getRuntime();return!b&&y&&n.can("access_image_binary")&&(b=new r(y)),t={width:e().width||0,height:e().height||0,type:_.type||s.getFileMime(_.name),size:y&&y.length||_.size||0,name:_.name||"",meta:b&&b.meta||this.meta||{}}},downsize:function(){f.apply(this,arguments)},getAsCanvas:function(){return x&&(x.id=this.uid+"_canvas"),x},getAsBlob:function(e,t){return e!==this.type&&f.call(this,this.width,this.height,!1),new o(null,{name:_.name||"",type:e,data:w.getAsBinaryString.call(this,e,t)})},getAsDataURL:function(e){var t=arguments[1]||90;if(!E)return v.src;if("image/jpeg"!==e)return x.toDataURL("image/png");try{return x.toDataURL("image/jpeg",t/100)}catch(n){return x.toDataURL("image/jpeg")}},getAsBinaryString:function(e,t){if(!E)return y||(y=l(w.getAsDataURL(e,t))),y;if("image/jpeg"!==e)y=l(w.getAsDataURL(e,t));else{var n;t||(t=90);try{n=x.toDataURL("image/jpeg",t/100)}catch(i){n=x.toDataURL("image/jpeg")}y=l(n),b&&(y=b.stripHeaders(y),A&&(b.meta&&b.meta.exif&&b.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),y=b.writeHeaders(y)),b.purge(),b=null)}return E=!1,y},destroy:function(){w=null,g.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return e.Image=l}),i(H,[s,c,p,d,m],function(e,t,n,i,o){function r(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}function a(a){var l,c=this;a=e.extend({swf_url:t.swf_url},a),o.call(this,a,s,{access_binary:function(e){return e&&"browser"===c.mode},access_image_binary:function(e){return e&&"browser"===c.mode},display_media:o.capTrue,do_cors:o.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===c.mode},resize_image:o.capTrue,return_response_headers:!1,return_response_type:function(t){return!("json"!==t||!window.JSON)||(!e.arrayDiff(t,["","text","document"])||"browser"===c.mode)},return_status_code:function(t){return"browser"===c.mode||!e.arrayDiff(t,[200,404])},select_file:o.capTrue,select_multiple:o.capTrue,send_binary_string:function(e){return e&&"browser"===c.mode},send_browser_cookies:function(e){return e&&"browser"===c.mode},send_custom_headers:function(e){return e&&"browser"===c.mode},send_multipart:o.capTrue,slice_blob:o.capTrue,stream_upload:function(e){return e&&"browser"===c.mode},summon_file_dialog:!1,upload_filesize:function(t){return e.parseSizeStr(t)<=2097152||"client"===c.mode},use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}},{access_binary:function(e){return e?"browser":"client"},access_image_binary:function(e){return e?"browser":"client"},report_upload_progress:function(e){return e?"browser":"client"},return_response_type:function(t){return e.arrayDiff(t,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"browser":["client","browser"]},send_binary_string:function(e){return e?"browser":"client"},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"browser":"client"},stream_upload:function(e){return e?"client":"browser"},upload_filesize:function(t){return e.parseSizeStr(t)>=2097152?"client":"browser"}},"client"),r()<10&&(this.mode=!1),e.extend(this,{getShim:function(){return n.get(this.uid)},shimExec:function(e,t){var n=[].slice.call(arguments,2);return c.getShim().exec(this.uid,e,t,n)},init:function(){var n,o,r;r=this.getShimContainer(),e.extend(r.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+a.swf_url+'" ',"IE"===t.browser&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===t.browser?(o=document.createElement("div"),r.appendChild(o),o.outerHTML=n,o=r=null):r.innerHTML=n,l=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(e){return function(){e.call(c),clearTimeout(l),a=l=e=c=null}}(this.destroy)},u)}var s="flash",u={};return o.addConstructor(s,a),u}),i(G,[H,v],function(e,t){var n={slice:function(e,n,i,o){var r=this.getRuntime();return 0>n?n=Math.max(e.size+n,0):n>0&&(n=Math.min(n,e.size)),0>i?i=Math.max(e.size+i,0):i>0&&(i=Math.min(i,e.size)),e=r.shimExec.call(this,"Blob","slice",n,i,o||""),e&&(e=new t(r.uid,e)),e}};return e.Blob=n}),i(V,[H],function(e){var t={init:function(e){this.getRuntime().shimExec.call(this,"FileInput","init",{name:e.name,accept:e.accept,multiple:e.multiple}),this.trigger("ready")}};return e.FileInput=t}),i(X,[H,h],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var i="",o={read:function(e,t){var o=this,r=o.getRuntime();return"readAsDataURL"===e&&(i="data:"+(t.type||"")+";base64,"),o.bind("Progress",function(t,o){o&&(i+=n(o,e))}),r.shimExec.call(this,"FileReader","readAsBase64",t.uid)},getResult:function(){return i},destroy:function(){i=null}};return e.FileReader=o}),i(W,[H,h],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var i={read:function(e,t){var i,o=this.getRuntime();return(i=o.shimExec.call(this,"FileReaderSync","readAsBase64",t.uid))?("readAsDataURL"===e&&(i="data:"+(t.type||"")+";base64,"+i),n(i,e,t.type)):null}};return e.FileReaderSync=i}),i(Y,[H,s,v,b,A,T,C],function(e,t,n,i,o,r,a){var s={send:function(e,i){function o(){e.transport=c.mode,c.shimExec.call(l,"XMLHttpRequest","send",e,i)}function s(e,t){c.shimExec.call(l,"XMLHttpRequest","appendBlob",e,t.uid),i=null,o()}function u(e,t){var n=new a;n.bind("TransportingComplete",function(){t(this.result)}),n.transport(e.getSource(),e.type,{ruid:c.uid})}var l=this,c=l.getRuntime();if(t.isEmptyObj(e.headers)||t.each(e.headers,function(e,t){c.shimExec.call(l,"XMLHttpRequest","setRequestHeader",t,e.toString())}),i instanceof r){var p;if(i.each(function(e,t){e instanceof n?p=t:c.shimExec.call(l,"XMLHttpRequest","append",t,e)}),i.hasBlob()){var d=i.getBlob();d.isDetached()?u(d,function(e){d.destroy(),s(p,e)}):s(p,d)}else i=null,o()}else i instanceof n?i.isDetached()?u(i,function(e){i.destroy(),i=e.uid,o()}):(i=i.uid,o()):o()},getResponse:function(e){var n,r,a=this.getRuntime();if(r=a.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(r=new i(a.uid,r),"blob"===e)return r;try{if(n=new o,~t.inArray(e,["","text"]))return n.readAsText(r);if("json"===e&&window.JSON)return JSON.parse(n.readAsText(r))}finally{r.destroy()}}return null},abort:function(e){var t=this.getRuntime();t.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return e.XMLHttpRequest=s}),i(J,[H,v],function(e,t){var n={getAsBlob:function(e){var n=this.getRuntime(),i=n.shimExec.call(this,"Transporter","getAsBlob",e);return i?new t(n.uid,i):null}};return e.Transporter=n}),i(Q,[H,s,C,v,A],function(e,t,n,i,o){var r={loadFromBlob:function(e){function t(e){o.shimExec.call(i,"Image","loadFromBlob",e.uid),i=o=null}var i=this,o=i.getRuntime();if(e.isDetached()){var r=new n;r.bind("TransportingComplete",function(){t(r.result.getSource())}),r.transport(e.getSource(),e.type,{ruid:o.uid})}else t(e.getSource())},loadFromImage:function(e){var t=this.getRuntime();return t.shimExec.call(this,"Image","loadFromImage",e.uid)},getAsBlob:function(e,t){var n=this.getRuntime(),o=n.shimExec.call(this,"Image","getAsBlob",e,t);return o?new i(n.uid,o):null},getAsDataURL:function(){var e,t=this.getRuntime(),n=t.Image.getAsBlob.apply(this,arguments);return n?(e=new o,e.readAsDataURL(n)):null}};return e.Image=r}),i(K,[s,c,p,d,m],function(e,t,n,i,o){function r(e){var t,n,i,o,r,a=!1,s=null,u=0;try{try{s=new ActiveXObject("AgControl.AgControl"),s.IsVersionSupported(e)&&(a=!0),s=null}catch(l){var c=navigator.plugins["Silverlight Plug-In"];if(c){for(t=c.description,"1.0.30226.2"===t&&(t="2.0.30226.2"),n=t.split(".");n.length>3;)n.pop();for(;n.length<4;)n.push(0);for(i=e.split(".");i.length>4;)i.pop();do o=parseInt(i[u],10),r=parseInt(n[u],10),u++;while(u<i.length&&o===r);r>=o&&!isNaN(o)&&(a=!0)}}}catch(p){a=!1}return a}function a(a){var l,c=this;a=e.extend({xap_url:t.xap_url},a),o.call(this,a,s,{access_binary:o.capTrue,access_image_binary:o.capTrue,display_media:o.capTrue,do_cors:o.capTrue,drag_and_drop:!1,report_upload_progress:o.capTrue,resize_image:o.capTrue,return_response_headers:function(e){return e&&"client"===c.mode},return_response_type:function(e){return"json"!==e||!!window.JSON},return_status_code:function(t){return"client"===c.mode||!e.arrayDiff(t,[200,404])},select_file:o.capTrue,select_multiple:o.capTrue,send_binary_string:o.capTrue,send_browser_cookies:function(e){return e&&"browser"===c.mode},send_custom_headers:function(e){return e&&"client"===c.mode},send_multipart:o.capTrue,slice_blob:o.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:o.capTrue,use_http_method:function(t){return"client"===c.mode||!e.arrayDiff(t,["GET","POST"])}},{return_response_headers:function(e){return e?"client":"browser"},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"client":["client","browser"]},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"client":"browser"},use_http_method:function(t){return e.arrayDiff(t,["GET","POST"])?"client":["client","browser"]}}),r("2.0.31005.0")&&"Opera"!==t.browser||(this.mode=!1),e.extend(this,{getShim:function(){return n.get(this.uid).content.Moxie},shimExec:function(e,t){var n=[].slice.call(arguments,2);return c.getShim().exec(this.uid,e,t,n)},init:function(){var e;e=this.getShimContainer(),e.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+a.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+t.global_event_dispatcher+'"/></object>',l=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},"Windows"!==t.OS?1e4:5e3)},destroy:function(e){return function(){e.call(c),clearTimeout(l),a=l=e=c=null}}(this.destroy)},u)}var s="silverlight",u={};return o.addConstructor(s,a),u}),i(Z,[K,s,G],function(e,t,n){return e.Blob=t.extend({},n)}),i(ee,[K],function(e){var t={init:function(e){function t(e){for(var t="",n=0;n<e.length;n++)t+=(""!==t?"|":"")+e[n].title+" | *."+e[n].extensions.replace(/,/g,";*.");return t}this.getRuntime().shimExec.call(this,"FileInput","init",t(e.accept),e.name,e.multiple),this.trigger("ready")}};return e.FileInput=t}),i(te,[K,p,$],function(e,t,n){var i={init:function(){var e,i=this,o=i.getRuntime();return e=o.getShimContainer(),n.addEvent(e,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},i.uid),n.addEvent(e,"dragenter",function(e){e.preventDefault();var n=t.get(o.uid).dragEnter(e);n&&e.stopPropagation()},i.uid),n.addEvent(e,"drop",function(e){e.preventDefault();var n=t.get(o.uid).dragDrop(e);n&&e.stopPropagation()},i.uid),o.shimExec.call(this,"FileDrop","init")}};return e.FileDrop=i}),i(ne,[K,s,X],function(e,t,n){return e.FileReader=t.extend({},n)}),i(ie,[K,s,W],function(e,t,n){return e.FileReaderSync=t.extend({},n)}),i(oe,[K,s,Y],function(e,t,n){return e.XMLHttpRequest=t.extend({},n)}),i(re,[K,s,J],function(e,t,n){return e.Transporter=t.extend({},n)}),i(ae,[K,s,Q],function(e,t,n){return e.Image=t.extend({},n,{getInfo:function(){var e=this.getRuntime(),n=["tiff","exif","gps"],i={meta:{}},o=e.shimExec.call(this,"Image","getInfo");return o.meta&&t.each(n,function(e){var t,n,r,a,s=o.meta[e];if(s&&s.keys)for(i.meta[e]={},n=0,r=s.keys.length;r>n;n++)t=s.keys[n],a=s[t],a&&(/^(\d|[1-9]\d+)$/.test(a)?a=parseInt(a,10):/^\d*\.\d+$/.test(a)&&(a=parseFloat(a)),i.meta[e][t]=a)}),i.width=parseInt(o.width,10),i.height=parseInt(o.height,10),i.size=parseInt(o.size,10),i.type=o.type,i.name=o.name,i}})}),i(se,[s,d,m,c],function(e,t,n,i){function o(t){var o=this,s=n.capTest,u=n.capTrue;n.call(this,t,r,{access_binary:s(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:s(a.Image&&(i.can("create_canvas")||i.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:s(function(){return"Chrome"===i.browser&&i.version>=28||"IE"===i.browser&&i.version>=10}()),resize_image:function(){return a.Image&&o.can("access_binary")&&i.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(t){return!("json"!==t||!window.JSON)||!!~e.inArray(t,["text","document",""])},return_status_code:function(t){return!e.arrayDiff(t,[200,404])},select_file:function(){return i.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return o.can("select_file")},summon_file_dialog:s(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||!!~e.inArray(i.browser,["Chrome","Safari"])}()),upload_filesize:u,use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}}),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(o),e=o=null}}(this.destroy)}),e.extend(this.getShim(),a)}var r="html4",a={};return n.addConstructor(r,o),a}),i(ue,[se,s,p,$,l,c],function(e,t,n,i,o,r){function a(){function e(){var o,c,p,d,f,h,m=this,g=m.getRuntime();h=t.guid("uid_"),o=g.getShimContainer(),a&&(p=n.get(a+"_form"),p&&t.extend(p.style,{top:"100%"})),d=document.createElement("form"),d.setAttribute("id",h+"_form"),d.setAttribute("method","post"),d.setAttribute("enctype","multipart/form-data"),d.setAttribute("encoding","multipart/form-data"),t.extend(d.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),f=document.createElement("input"),f.setAttribute("id",h),f.setAttribute("type","file"),f.setAttribute("name",s.name||"Filedata"),f.setAttribute("accept",l.join(",")),t.extend(f.style,{fontSize:"999px",opacity:0}),d.appendChild(f),o.appendChild(d),t.extend(f.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===r.browser&&r.version<10&&t.extend(f.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),f.onchange=function(){var t;this.value&&(t=this.files?this.files[0]:{name:this.value},u=[t],this.onchange=function(){},e.call(m),m.bind("change",function i(){var e,t=n.get(h),o=n.get(h+"_form");m.unbind("change",i),m.files.length&&t&&o&&(e=m.files[0],t.setAttribute("id",e.uid),o.setAttribute("id",e.uid+"_form"),o.setAttribute("target",e.uid+"_iframe")),t=o=null},998),f=d=null,m.trigger("change"))},g.can("summon_file_dialog")&&(c=n.get(s.browse_button),i.removeEvent(c,"click",m.uid),i.addEvent(c,"click",function(e){f&&!f.disabled&&f.click(),e.preventDefault()},m.uid)),a=h,o=p=c=null}var a,s,u=[],l=[];t.extend(this,{init:function(t){var r,a=this,u=a.getRuntime();s=t,l=t.accept.mimes||o.extList2mimes(t.accept,u.can("filter_by_extension")),r=u.getShimContainer(),function(){var e,o,s;e=n.get(t.browse_button),u.can("summon_file_dialog")&&("static"===n.getStyle(e,"position")&&(e.style.position="relative"),o=parseInt(n.getStyle(e,"z-index"),10)||1,e.style.zIndex=o,r.style.zIndex=o-1),s=u.can("summon_file_dialog")?e:r,i.addEvent(s,"mouseover",function(){a.trigger("mouseenter")},a.uid),i.addEvent(s,"mouseout",function(){a.trigger("mouseleave")},a.uid),i.addEvent(s,"mousedown",function(){a.trigger("mousedown")},a.uid),i.addEvent(n.get(t.container),"mouseup",function(){a.trigger("mouseup")},a.uid),e=null}(),e.call(this),r=null,a.trigger({type:"ready",async:!0})},getFiles:function(){return u},disable:function(e){var t;(t=n.get(a))&&(t.disabled=!!e)},destroy:function(){var e=this.getRuntime(),t=e.getShim(),o=e.getShimContainer();i.removeAllEvents(o,this.uid),i.removeAllEvents(s&&n.get(s.container),this.uid),i.removeAllEvents(s&&n.get(s.browse_button),this.uid),o&&(o.innerHTML=""),t.removeInstance(this.uid),a=u=l=s=o=t=null}})}return e.FileInput=a}),i(le,[se,D],function(e,t){return e.FileReader=t}),i(ce,[se,s,p,E,d,$,v,T],function(e,t,n,i,o,r,a,s){function u(){function e(e){var t,i,o,a,s=this,u=!1;if(c){if(t=c.id.replace(/_iframe$/,""),i=n.get(t+"_form")){for(o=i.getElementsByTagName("input"),a=o.length;a--;)switch(o[a].getAttribute("type")){case"hidden":o[a].parentNode.removeChild(o[a]);break;case"file":u=!0}o=[],u||i.parentNode.removeChild(i),i=null}setTimeout(function(){r.removeEvent(c,"load",s.uid),c.parentNode&&c.parentNode.removeChild(c);var t=s.getRuntime().getShimContainer();t.children.length||t.parentNode.removeChild(t),t=c=null,e()},1)}}var u,l,c;t.extend(this,{send:function(p,d){function f(){var n=x.getShimContainer()||document.body,o=document.createElement("div");o.innerHTML='<iframe id="'+h+'_iframe" name="'+h+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',c=o.firstChild,n.appendChild(c),r.addEvent(c,"load",function(){var n;try{n=c.contentWindow.document||c.contentDocument||window.frames[c.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(n.title)?u=n.title.replace(/^(\d+).*$/,"$1"):(u=200,l=t.trim(n.body.innerHTML),b.trigger({type:"progress",loaded:l.length,total:l.length}),v&&b.trigger({type:"uploadprogress",loaded:v.size||1025,total:v.size||1025}))}catch(o){if(!i.hasSameOrigin(p.url))return void e.call(b,function(){b.trigger("error")});u=404}e.call(b,function(){b.trigger("load")})},b.uid)}var h,m,g,v,b=this,x=b.getRuntime();if(u=l=null,d instanceof s&&d.hasBlob()){if(v=d.getBlob(),h=v.uid,g=n.get(h),m=n.get(h+"_form"),!m)throw new o.DOMException(o.DOMException.NOT_FOUND_ERR)}else h=t.guid("uid_"),m=document.createElement("form"),m.setAttribute("id",h+"_form"),m.setAttribute("method",p.method),m.setAttribute("enctype","multipart/form-data"),m.setAttribute("encoding","multipart/form-data"),m.setAttribute("target",h+"_iframe"),x.getShimContainer().appendChild(m);d instanceof s&&d.each(function(e,n){if(e instanceof a)g&&g.setAttribute("name",n);else{var i=document.createElement("input");t.extend(i,{type:"hidden",name:n,value:e}),g?m.insertBefore(i,g):m.appendChild(i)}}),m.setAttribute("action",p.url),f(),m.submit(),b.trigger("loadstart")},getStatus:function(){return u},getResponse:function(e){if("json"===e&&"string"===t.typeOf(l)&&window.JSON)try{return JSON.parse(l.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(n){return null}return l},abort:function(){var t=this;c&&c.contentWindow&&(c.contentWindow.stop?c.contentWindow.stop():c.contentWindow.document.execCommand?c.contentWindow.document.execCommand("Stop"):c.src="about:blank"),e.call(this,function(){t.dispatchEvent("abort")})}})}return e.XMLHttpRequest=u}),i(pe,[se,B],function(e,t){return e.Image=t}),r([s,u,l,c,p,d,f,h,m,g,v,b,x,y,_,w,E,A,T,k,C,S,$])}(this),function(){"use strict";var e={},t=moxie.core.utils.Basic.inArray;return function n(i){var o,r;for(o in i)r=typeof i[o],"object"!==r||~t(o,["Exceptions","Env","Mime"])?"function"===r&&(e[o]=i[o]):n(i[o])}(window.moxie),e.Env=window.moxie.core.utils.Env,e.Mime=window.moxie.core.utils.Mime,e.Exceptions=window.moxie.core.Exceptions,window.mOxie=e,window.o||(window.o=e),e}(),function(e,t,n){function i(e){function t(e,t,n){var o={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};o[e]?i[o[e]]=t:n||(i[e]=t)}var n=e.required_features,i={};return"string"==typeof n?a.each(n.split(/\s*,\s*/),function(e){t(e,!0)}):"object"==typeof n?a.each(n,function(e,n){t(n,e)}):n===!0&&(e.multipart||(i.send_binary_string=!0),e.chunk_size>0&&(i.slice_blob=!0),e.resize.enabled&&(i.send_binary_string=!0),a.each(e,function(e,n){t(n,!!e,!0)})),i}var o=e.setTimeout,r={},a={VERSION:"2.1.1",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,get:function(e){var n,i=[];"array"!==t.typeOf(e)&&(e=[e]);for(var o=e.length;o--;)n=t.get(e[o]),n&&i.push(n);return i.length?i:null},each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g;return e?(""+e).replace(n,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){var t,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<n.length;t+=2)e=e.replace(n[t],n[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(e,t){var n="";return a.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e},formatSize:function(e){function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}if(e===n||/\D/.test(e))return a.translate("N/A");var i=Math.pow(1024,4);return e>i?t(e/i,1)+" "+a.translate("tb"):e>(i/=1024)?t(e/i,1)+" "+a.translate("gb"):e>(i/=1024)?t(e/i,1)+" "+a.translate("mb"):e>1024?Math.round(e/1024)+" "+a.translate("kb"):e+" "+a.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(e,n){var i,o;return i=new a.Uploader(e),o=t.Runtime.thatCan(i.getOption().required_features,n||e.runtimes),i.destroy(),o},addFileFilter:function(e,t){r[e]=t}};a.addFileFilter("mime_types",function(e,t,n){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:a.FILE_EXTENSION_ERROR,message:a.translate("File extension error."),
file:t}),n(!1)):n(!0)}),a.addFileFilter("max_file_size",function(e,t,n){var i;e=a.parseSize(e),t.size!==i&&e&&t.size>e?(this.trigger("Error",{code:a.FILE_SIZE_ERROR,message:a.translate("File size error."),file:t}),n(!1)):n(!0)}),a.addFileFilter("prevent_duplicates",function(e,t,n){if(e)for(var i=this.files.length;i--;)if(t.name===this.files[i].name&&t.size===this.files[i].size)return this.trigger("Error",{code:a.FILE_DUPLICATE_ERROR,message:a.translate("Duplicate file error."),file:t}),void n(!1);n(!0)}),a.Uploader=function(e){function s(){var e,t,n=0;if(this.state==a.STARTED){for(t=0;t<I.length;t++)e||I[t].status!=a.QUEUED?n++:(e=I[t],this.trigger("BeforeUpload",e)&&(e.status=a.UPLOADING,this.trigger("UploadFile",e)));n==I.length&&(this.state!==a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",I))}}function u(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,l()}function l(){var e,t;for(C.reset(),e=0;e<I.length;e++)t=I[e],t.size!==n?(C.size+=t.origSize,C.loaded+=t.loaded*t.origSize/t.size):C.size=n,t.status==a.DONE?C.uploaded++:t.status==a.FAILED?C.failed++:C.queued++;C.size===n?C.percent=I.length>0?Math.ceil(C.uploaded/I.length*100):0:(C.bytesPerSec=Math.ceil(C.loaded/((+new Date-k||1)/1e3)),C.percent=C.size>0?Math.ceil(C.loaded/C.size*100):0)}function c(){var e=O[0]||q[0];return!!e&&e.getRuntime().uid}function p(e,n){if(e.ruid){var i=t.Runtime.getInfo(e.ruid);if(i)return i.can(n)}return!1}function d(){this.bind("FilesAdded",g),this.bind("CancelUpload",_),this.bind("BeforeUpload",v),this.bind("UploadFile",b),this.bind("UploadProgress",x),this.bind("StateChanged",y),this.bind("QueueChanged",l),this.bind("Error",E),this.bind("FileUploaded",w),this.bind("Destroy",A)}function f(e,n){var i=this,o=0,r=[],s={accept:e.filters.mime_types,runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:$,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};a.each(e.runtimes.split(/\s*,\s*/),function(t){e[t]&&(s[t]=e[t])}),e.browse_button&&a.each(e.browse_button,function(n){r.push(function(r){var u=new t.FileInput(a.extend({},s,{name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:n}));u.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(i.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),o++,O.push(this),r()},u.onchange=function(){i.addFile(this.files)},u.bind("mouseenter mouseleave mousedown mouseup",function(i){D||(e.browse_button_hover&&("mouseenter"===i.type?t.addClass(n,e.browse_button_hover):"mouseleave"===i.type&&t.removeClass(n,e.browse_button_hover)),e.browse_button_active&&("mousedown"===i.type?t.addClass(n,e.browse_button_active):"mouseup"===i.type&&t.removeClass(n,e.browse_button_active)))}),u.bind("error runtimeerror",function(){u=null,r()}),u.init()})}),e.drop_element&&a.each(e.drop_element,function(e){r.push(function(n){var r=new t.FileDrop(a.extend({},s,{drop_zone:e}));r.onready=function(){var e=t.Runtime.getInfo(this.ruid);i.features.dragdrop=e.can("drag_and_drop"),o++,q.push(this),n()},r.ondrop=function(){i.addFile(this.files)},r.bind("error runtimeerror",function(){r=null,n()}),r.init()})}),t.inSeries(r,function(){"function"==typeof n&&n(o)})}function h(e,n,i){var o=new t.Image;try{o.onload=function(){o.downsize(n.width,n.height,n.crop,n.preserve_headers)},o.onresize=function(){i(this.getAsBlob(e.type,n.quality)),this.destroy()},o.onerror=function(){i(e)},o.load(e)}catch(r){i(e)}}function m(e,n,o){function r(e,t,n){var i=T[e];switch(e){case"max_file_size":"max_file_size"===e&&(T.max_file_size=T.filters.max_file_size=t);break;case"chunk_size":(t=a.parseSize(t))&&(T[e]=t);break;case"filters":"array"===a.typeOf(t)&&(t={mime_types:t}),n?a.extend(T.filters,t):T.filters=t,t.mime_types&&(T.filters.mime_types.regexp=function(e){var t=[];return a.each(e,function(e){a.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?t.push("\\.*"):t.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+t.join("|")+")$","i")}(T.filters.mime_types));break;case"resize":n?a.extend(T.resize,t,{enabled:!0}):T.resize=t;break;case"prevent_duplicates":T.prevent_duplicates=T.filters.prevent_duplicates=!!t;break;case"browse_button":case"drop_element":t=a.get(t);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":T[e]=t,n||(u=!0);break;default:T[e]=t}n||s.trigger("OptionChanged",e,t,i)}var s=this,u=!1;"object"==typeof e?a.each(e,function(e,t){r(t,e,o)}):r(e,n,o),o?(T.required_features=i(a.extend({},T)),$=i(a.extend({},T,{required_features:!0}))):u&&(s.trigger("Destroy"),f.call(s,T,function(e){e?(s.runtime=t.Runtime.getInfo(c()).type,s.trigger("Init",{runtime:s.runtime}),s.trigger("PostInit")):s.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})}))}function g(e,t){[].push.apply(I,t),e.trigger("QueueChanged"),e.refresh()}function v(e,t){if(T.unique_names){var n=t.name.match(/\.([^.]+)$/),i="part";n&&(i=n[1]),t.target_name=t.id+"."+i}}function b(e,n){function i(){c-- >0?o(r,1e3):(n.loaded=f,e.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:n,response:S.responseText,status:S.status,responseHeaders:S.getAllResponseHeaders()}))}function r(){var p,h,m,g;n.status!=a.DONE&&n.status!=a.FAILED&&e.state!=a.STOPPED&&(m={name:n.target_name||n.name},l&&d.chunks&&s.size>l?(g=Math.min(l,s.size-f),p=s.slice(f,f+g)):(g=s.size,p=s),l&&d.chunks&&(e.settings.send_chunk_number?(m.chunk=Math.ceil(f/l),m.chunks=Math.ceil(s.size/l)):(m.offset=f,m.total=s.size)),S=new t.XMLHttpRequest,S.upload&&(S.upload.onprogress=function(t){n.loaded=Math.min(n.size,f+t.loaded),e.trigger("UploadProgress",n)}),S.onload=function(){return S.status>=400?void i():(c=e.settings.max_retries,g<s.size?(p.destroy(),f+=g,n.loaded=Math.min(f,s.size),e.trigger("ChunkUploaded",n,{offset:n.loaded,total:s.size,response:S.responseText,status:S.status,responseHeaders:S.getAllResponseHeaders()}),"Android Browser"===t.Env.browser&&e.trigger("UploadProgress",n)):n.loaded=n.size,p=h=null,!f||f>=s.size?(n.size!=n.origSize&&(s.destroy(),s=null),e.trigger("UploadProgress",n),n.status=a.DONE,e.trigger("FileUploaded",n,{response:S.responseText,status:S.status,responseHeaders:S.getAllResponseHeaders()})):o(r,1),void 0)},S.onerror=function(){i()},S.onloadend=function(){this.destroy(),S=null},e.settings.multipart&&d.multipart?(m.name=n.target_name||n.name,S.open("post",u,!0),a.each(e.settings.headers,function(e,t){S.setRequestHeader(t,e)}),h=new t.FormData,a.each(a.extend(m,e.settings.multipart_params),function(e,t){h.append(t,e)}),h.append(e.settings.file_data_name,p),S.send(h,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:$,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})):(u=a.buildUrl(e.settings.url,a.extend(m,e.settings.multipart_params)),S.open("post",u,!0),S.setRequestHeader("Content-Type","application/octet-stream"),a.each(e.settings.headers,function(e,t){S.setRequestHeader(t,e)}),S.send(p,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:$,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})))}var s,u=e.settings.url,l=e.settings.chunk_size,c=e.settings.max_retries,d=e.features,f=0;n.loaded&&(f=n.loaded=l*Math.floor(n.loaded/l)),s=n.getSource(),e.settings.resize.enabled&&p(s,"send_binary_string")&&~t.inArray(s.type,["image/jpeg","image/png"])?h.call(this,s,e.settings.resize,function(e){s=e,n.size=e.size,r()}):r()}function x(e,t){u(t)}function y(e){if(e.state==a.STARTED)k=+new Date;else if(e.state==a.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==a.UPLOADING&&(e.files[t].status=a.QUEUED,l())}function _(){S&&S.abort()}function w(e){l(),o(function(){s.call(e)},1)}function E(e,t){t.file&&(t.file.status=a.FAILED,u(t.file),e.state==a.STARTED&&(e.trigger("CancelUpload"),o(function(){s.call(e)},1)))}function A(e){e.stop(),a.each(I,function(e){e.destroy()}),I=[],O.length&&(a.each(O,function(e){e.destroy()}),O=[]),q.length&&(a.each(q,function(e){e.destroy()}),q=[]),$={},D=!1,k=S=null,C.reset()}var T,k,C,S,R=a.guid(),I=[],$={},O=[],q=[],D=!1;T={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_chunk_number:!0},m.call(this,e,null,!0),C=new a.QueueProgress,a.extend(this,{id:R,uid:R,state:a.STOPPED,features:{},runtime:null,files:I,settings:T,total:C,init:function(){var e=this;return"function"==typeof T.preinit?T.preinit(e):a.each(T.preinit,function(t,n){e.bind(n,t)}),T.browse_button&&T.url?(d.call(this),void f.call(this,T,function(n){"function"==typeof T.init?T.init(e):a.each(T.init,function(t,n){e.bind(n,t)}),n?(e.runtime=t.Runtime.getInfo(c()).type,e.trigger("Init",{runtime:e.runtime}),e.trigger("PostInit")):e.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})})):void this.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})},setOption:function(e,t){m.call(this,e,t,!this.runtime)},getOption:function(e){return e?T[e]:T},refresh:function(){O.length&&a.each(O,function(e){e.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=a.STARTED&&(this.state=a.STARTED,this.trigger("StateChanged"),s.call(this))},stop:function(){this.state!=a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){D=arguments[0]===n||arguments[0],O.length&&a.each(O,function(e){e.disable(D)}),this.trigger("DisableBrowse",D)},getFile:function(e){var t;for(t=I.length-1;t>=0;t--)if(I[t].id===e)return I[t]},addFile:function(e,n){function i(e,n){var i=[];t.each(l.settings.filters,function(t,n){r[n]&&i.push(function(i){r[n].call(l,t,e,function(e){i(!e)})})}),t.inSeries(i,n)}function s(e){var r=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!u)return!1;e.ruid=u,e.connectRuntime(u)}s(new a.File(e))}else e instanceof t.Blob?(s(e.getSource()),e.destroy()):e instanceof a.File?(n&&(e.name=n),p.push(function(t){i(e,function(n){n||(d.push(e),l.trigger("FileFiltered",e)),o(t,1)})})):t.inArray(r,["file","blob"])!==-1?s(new t.File(null,e)):"node"===r&&"filelist"===t.typeOf(e.files)?t.each(e.files,s):"array"===r&&(n=null,t.each(e,s))}var u,l=this,p=[],d=[];u=c(),s(e),p.length&&t.inSeries(p,function(){d.length&&l.trigger("FilesAdded",d)})},removeFile:function(e){for(var t="string"==typeof e?e:e.id,n=I.length-1;n>=0;n--)if(I[n].id===t)return this.splice(n,1)[0]},splice:function(e,t){var i=I.splice(e===n?0:e,t===n?I.length:t),o=!1;return this.state==a.STARTED&&(o=!0,this.stop()),this.trigger("FilesRemoved",i),a.each(i,function(e){e.destroy()}),this.trigger("QueueChanged"),this.refresh(),o&&this.start(),i},bind:function(e,t,n){var i=this;a.Uploader.prototype.bind.call(this,e,function(){var e=[].slice.call(arguments);return e.splice(0,1,i),t.apply(this,e)},0,n)},destroy:function(){this.trigger("Destroy"),T=C=null,this.unbindAll()}})},a.Uploader.prototype=t.EventTarget.instance,a.File=function(){function e(e){a.extend(this,{id:a.guid(),name:e.name||e.fileName,type:e.type||"",size:e.size||e.fileSize,origSize:e.size||e.fileSize,loaded:0,percent:0,status:a.QUEUED,lastModifiedDate:e.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var e=this.getSource().getSource();return t.inArray(t.typeOf(e),["blob","file"])!==-1?e:null},getSource:function(){return n[this.id]?n[this.id]:null},destroy:function(){var e=this.getSource();e&&(e.destroy(),delete n[this.id])}}),n[this.id]=e}var n={};return e}(),a.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=a}(window,mOxie),define("plupload",function(){}),!function(global){function createCookie(e,t,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var o="; expires="+i.toGMTString();document.cookie=e+"="+t+o+"; path=/"}function readCookie(e){for(var t=e+"=",n=document.cookie.split(";"),i=0,o=n.length;i<o;i++){for(var r=n[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null}function QiniuJsSDK(){function log(e,t){for(var n="[qiniu-js-sdk]["+e+"]",i=n,o=0;o<t.length;o++)i+="string"==typeof t[o]?" "+t[o]:" "+that.stringifyJSON(t[o]);that.detectIEVersion()?console.log(i):(t.unshift(n),console.log.apply(console,t)),document.getElementById("qiniu-js-sdk-log")&&(document.getElementById("qiniu-js-sdk-log").innerHTML+="<p>"+i+"</p>")}function makeLogFunc(e){var t=e.toLowerCase();logger[t]=function(){if(window.console&&window.console.log&&logger.level>=logger[e]){var n=Array.prototype.slice.call(arguments);log(t,n)}}}var that=this;this.detectIEVersion=function(){for(var e=4,t=document.createElement("div"),n=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+e+"]><i></i><![endif]-->",n[0];)e++;return e>4&&e};var logger={MUTE:0,FATA:1,ERROR:2,WARN:3,INFO:4,DEBUG:5,TRACE:6,level:0};for(var property in logger)logger.hasOwnProperty(property)&&"number"==typeof logger[property]&&!logger.hasOwnProperty(property.toLowerCase())&&makeLogFunc(property);var qiniuUploadUrl;qiniuUploadUrl="https:"===window.location.protocol?"https://up.qbox.me":"http://upload.qiniu.com";var qiniuUploadUrls=["http://upload.qiniu.com","http://up.qiniu.com"],qiniuUpHosts={http:["http://upload.qiniu.com","http://up.qiniu.com"],https:["https://up.qbox.me"]},changeUrlTimes=0;this.resetUploadUrl=function(){var e="https:"===window.location.protocol?qiniuUpHosts.https:qiniuUpHosts.http,t=changeUrlTimes%e.length;qiniuUploadUrl=e[t],changeUrlTimes++,logger.debug("resetUploadUrl: "+qiniuUploadUrl)},this.isImage=function(e){return e=e.split(/[?#]/)[0],/\.(png|jpg|jpeg|gif|bmp)$/i.test(e)},this.getFileExtension=function(e){var t,n=e.split(".");return t=1===n.length||""===n[0]&&2===n.length?"":n.pop().toLowerCase()},this.utf8_encode=function(e){if(null===e||"undefined"==typeof e)return"";var t,n,i=e+"",o="",r=0;t=n=0,r=i.length;for(var a=0;a<r;a++){var s=i.charCodeAt(a),u=null;if(s<128)n++;else if(s>127&&s<2048)u=String.fromCharCode(s>>6|192,63&s|128);else if(63488&s^!0)u=String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128);else{if(64512&s^!0)throw new RangeError("Unmatched trail surrogate at "+a);var l=i.charCodeAt(++a);if(64512&l^!0)throw new RangeError("Unmatched lead surrogate at "+(a-1));s=((1023&s)<<10)+(1023&l)+65536,u=String.fromCharCode(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}null!==u&&(n>t&&(o+=i.slice(t,n)),o+=u,t=n=a+1)}return n>t&&(o+=i.slice(t,r)),o},this.base64_decode=function(e){var t,n,i,o,r,a,s,u,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,p=0,d="",f=[];if(!e)return e;e+="";do o=l.indexOf(e.charAt(c++)),r=l.indexOf(e.charAt(c++)),a=l.indexOf(e.charAt(c++)),s=l.indexOf(e.charAt(c++)),u=o<<18|r<<12|a<<6|s,t=u>>16&255,n=u>>8&255,i=255&u,64===a?f[p++]=String.fromCharCode(t):64===s?f[p++]=String.fromCharCode(t,n):f[p++]=String.fromCharCode(t,n,i);while(c<e.length);return d=f.join("")},this.base64_encode=function(e){var t,n,i,o,r,a,s,u,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,p=0,d="",f=[];if(!e)return e;e=this.utf8_encode(e+"");do t=e.charCodeAt(c++),n=e.charCodeAt(c++),i=e.charCodeAt(c++),u=t<<16|n<<8|i,o=u>>18&63,r=u>>12&63,a=u>>6&63,s=63&u,f[p++]=l.charAt(o)+l.charAt(r)+l.charAt(a)+l.charAt(s);while(c<e.length);switch(d=f.join(""),e.length%3){case 1:d=d.slice(0,-2)+"==";break;case 2:d=d.slice(0,-1)+"="}return d},this.URLSafeBase64Encode=function(e){return e=this.base64_encode(e),e.replace(/\//g,"_").replace(/\+/g,"-")},this.URLSafeBase64Decode=function(e){return e=e.replace(/_/g,"/").replace(/-/g,"+"),this.base64_decode(e)},this.createAjax=function(e){var t={};return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},this.parseJSON=function(data){if(window.JSON&&window.JSON.parse)return window.JSON.parse(data);var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,text=String(data);return rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),eval("("+text+")")},this.stringifyJSON=function(e){if(window.JSON&&window.JSON.stringify)return window.JSON.stringify(e);switch(typeof e){case"string":return'"'+e.replace(/(["\\])/g,"\\$1")+'"';case"array":return"["+e.map(that.stringifyJSON).join(",")+"]";case"object":if(e instanceof Array){for(var t=[],n=e.length,i=0;i<n;i++)t.push(that.stringifyJSON(e[i]));return"["+t.join(",")+"]"}if(null===e)return"null";var o=[];for(var r in e)e.hasOwnProperty(r)&&o.push(that.stringifyJSON(r)+":"+that.stringifyJSON(e[r]));return"{"+o.join(",")+"}";case"number":return e;case!1:return e;case"boolean":return e}},this.trim=function(e){return null===e?"":e.replace(/^\s+|\s+$/g,"")},this.uploader=function(e){var t=function(){var t,n,i,o=that.detectIEVersion(),r="Safari"===mOxie.Env.browser&&mOxie.Env.version<=5&&"Windows"===mOxie.Env.os&&"7"===mOxie.Env.osVersion||"Safari"===mOxie.Env.browser&&"iOS"===mOxie.Env.os&&"7"===mOxie.Env.osVersion;o&&o<9&&e.chunk_size&&e.runtimes.indexOf("flash")>=0?e.chunk_size=0:r?e.chunk_size=0:(t=20,n=4<<t,i=plupload.parseSize(e.chunk_size),i>n&&(e.chunk_size=n))},n=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];0===i.indexOf("-H")?t.push(i.split(" ")[2]):t.push(i)}return t},i=function(e){var t=e.split(":"),n=t[0],i=that.parseJSON(that.URLSafeBase64Decode(t[2]));return i.ak=n,i.scope.indexOf(":")>=0?(i.bucket=i.scope.split(":")[0],i.key=i.scope.split(":")[1]):i.bucket=i.scope,i},o=function(t){var o=i(t),r=window.location.protocol+"//uc.qbox.me/v1/query?ak="+o.ak+"&bucket="+o.bucket;logger.debug("putPolicy: ",o),logger.debug("get uphosts from: ",r);var a,s=that.detectIEVersion();s&&s<=9?(a=new mOxie.XMLHttpRequest,mOxie.Env.swf_url=e.flash_swf_url):a=that.createAjax(),a.open("GET",r,!0);var u=function(){if(logger.debug("ajax.readyState: ",a.readyState),4===a.readyState)if(logger.debug("ajax.status: ",a.status),a.status<400){var e=that.parseJSON(a.responseText);qiniuUpHosts.http=n(e.http.up),qiniuUpHosts.https=n(e.https.up),logger.debug("get new uphosts: ",qiniuUpHosts),that.resetUploadUrl()}else logger.error("get uphosts error: ",a.responseText)};s&&s<=9?a.bind("readystatechange",u):a.onreadystatechange=u,a.send()},r=function(t){return!that.token||e.uptoken_url&&that.tokenInfo.isExpired()?a(t):that.token},a=function(t){if(e.uptoken)that.token=e.uptoken;else if(e.uptoken_url){logger.debug("get uptoken from: ",that.uptoken_url);var n=that.createAjax();if(n.open("GET",that.uptoken_url,!1),n.setRequestHeader("If-Modified-Since","0"),n.send(),200===n.status){var i=that.parseJSON(n.responseText);that.token=i.uptoken;var r=that.token.split(":"),a=that.parseJSON(that.URLSafeBase64Decode(r[2]));that.tokenMap||(that.tokenMap={});var s=function(e){return Math.ceil(e.getTime()/1e3)},u=s(new Date(n.getResponseHeader("date"))),l=s(new Date);that.tokenInfo={serverDelay:l-u,deadline:a.deadline,isExpired:function(){var e=this.deadline-s(new Date)+this.serverDelay;return e<600}},logger.debug("get new uptoken: ",that.token),logger.debug("get token info: ",that.tokenInfo)}else logger.error("get uptoken error: ",n.responseText)}else e.uptoken_func?(logger.debug("get uptoken from uptoken_func"),that.token=e.uptoken_func(t),logger.debug("get new uptoken: ",that.token)):logger.error("one of [uptoken, uptoken_url, uptoken_func] settings in options is required!");return that.token&&o(that.token),that.token},s=function(t,n,i){var o="",r=!1;if(!e.save_key)if(r=t.getOption&&t.getOption("unique_names"),r=r||t.settings&&t.settings.unique_names){var a=that.getFileExtension(n.name);o=a?n.id+"."+a:n.id}else o="function"==typeof i?i(t,n):n.name;return o};if(e.log_level&&(logger.level=e.log_level),!e.domain)throw"domain setting in options is required!";if(!e.browse_button)throw"browse_button setting in options is required!";if(!e.uptoken&&!e.uptoken_url&&!e.uptoken_func)throw"one of [uptoken, uptoken_url, uptoken_func] settings in options is required!";logger.debug("init uploader start"),logger.debug("environment: ",mOxie.Env),logger.debug("userAgent: ",navigator.userAgent);var u={},l=e.init&&e.init.Error,c=e.init&&e.init.FileUploaded;e.init.Error=function(){},e.init.FileUploaded=function(){},that.uptoken_url=e.uptoken_url,that.token="",that.key_handler="function"==typeof e.init.Key?e.init.Key:"",this.domain=e.domain;var p="",d={isResumeUpload:!1,resumeFilesize:0,startTime:"",currentTime:""};t(),logger.debug("invoke reset_chunk_size()"),logger.debug("op.chunk_size: ",e.chunk_size);var f={url:qiniuUploadUrl,multipart_params:{token:""}},h=that.detectIEVersion();h&&h<=9&&(f.multipart_params.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),plupload.extend(u,e,f),logger.debug("option: ",u);var m=new plupload.Uploader(u);logger.debug("new plupload.Uploader(option)"),m.bind("Init",function(t,n){logger.debug("Init event activated"),e.get_new_uptoken||a(null)}),logger.debug("bind Init event"),m.bind("FilesAdded",function(e,t){logger.debug("FilesAdded event activated");var n=e.getOption&&e.getOption("auto_start");n=n||e.settings&&e.settings.auto_start,logger.debug("auto_start: ",n),logger.debug("files: ",t);var i=function(){return"ios"===mOxie.Env.OS.toLowerCase()};if(i())for(var o=0;o<t.length;o++){var r=t[o],a=that.getFileExtension(r.name);r.name=r.id+"."+a}n&&setTimeout(function(){e.start(),logger.debug("invoke up.start()")},0),e.refresh()}),logger.debug("bind FilesAdded event"),m.bind("BeforeUpload",function(t,n){logger.debug("BeforeUpload event activated"),n.speed=n.speed||0,p="",e.get_new_uptoken&&a(n);var i=function(t,n,i){d.startTime=(new Date).getTime();var r;r=e.save_key?{token:that.token}:{key:s(t,n,i),token:that.token};var a=that.detectIEVersion();a&&a<=9&&(r.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),logger.debug("directUpload multipart_params_obj: ",r);var u=e.x_vars;if(void 0!==u&&"object"==typeof u)for(var l in u)u.hasOwnProperty(l)&&("function"==typeof u[l]?r["x:"+l]=u[l](t,n):"object"!=typeof u[l]&&(r["x:"+l]=u[l]));t.setOption({url:qiniuUploadUrl,multipart:!0,chunk_size:o()?e.max_file_size:void 0,multipart_params:r})},o=function(){var e=navigator.userAgent.toLowerCase();return!(!e.match(/MicroMessenger/i)&&"QQBrowser"!==mOxie.Env.browser&&!e.match(/V1_AND_SQ/i)||"android"!==mOxie.Env.OS.toLowerCase())},u=t.getOption&&t.getOption("chunk_size");if(u=u||t.settings&&t.settings.chunk_size,logger.debug("uploader.runtime: ",m.runtime),logger.debug("chunk_size: ",u),"html5"!==m.runtime&&"flash"!==m.runtime||!u)logger.debug("directUpload because uploader.runtime !== 'html5' || uploader.runtime !== 'flash' || !chunk_size"),i(t,n,that.key_handler);else if(n.size<u||o())logger.debug("directUpload because file.size < chunk_size || is_android_weixin_or_qq()"),i(t,n,that.key_handler);else{var l=localStorage.getItem(n.name),c=u;if(l){l=that.parseJSON(l);var f=(new Date).getTime(),h=l.time||0,g=864e5;f-h<g&&100!==l.percent&&n.size===l.total?(n.percent=l.percent,n.loaded=l.offset,p=l.ctx,d.isResumeUpload=!0,d.resumeFilesize=l.offset,l.offset+c>n.size&&(c=n.size-l.offset)):localStorage.removeItem(n.name)}d.startTime=(new Date).getTime();var v={},b=that.detectIEVersion();b&&b<=9&&(v.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),t.setOption({url:qiniuUploadUrl+"/mkblk/"+c,multipart:!1,chunk_size:u,required_features:"chunks",headers:{Authorization:"UpToken "+r(n)},multipart_params:v})}}),logger.debug("bind BeforeUpload event"),m.bind("UploadProgress",function(e,t){logger.trace("UploadProgress event activated"),d.currentTime=(new Date).getTime();var n=d.currentTime-d.startTime,i=t.loaded||0;d.isResumeUpload&&(i=t.loaded-d.resumeFilesize),t.speed=(i/n*1e3).toFixed(0)||0}),logger.debug("bind UploadProgress event"),m.bind("ChunkUploaded",function(e,t,n){logger.debug("ChunkUploaded event activated"),logger.debug("file: ",t),logger.debug("info: ",n);var i=that.parseJSON(n.response);logger.debug("res: ",i),p=p?p+","+i.ctx:i.ctx;var o=n.total-n.offset,a=e.getOption&&e.getOption("chunk_size");a=a||e.settings&&e.settings.chunk_size,o<a&&(e.setOption({url:qiniuUploadUrl+"/mkblk/"+o}),logger.debug("up.setOption url: ",qiniuUploadUrl+"/mkblk/"+o)),e.setOption({headers:{Authorization:"UpToken "+r(t)}}),localStorage.setItem(t.name,that.stringifyJSON({ctx:p,percent:t.percent,total:n.total,offset:n.offset,time:(new Date).getTime()}))}),logger.debug("bind ChunkUploaded event");var g=qiniuUploadUrls.length,v=function(e){return g-- >0?(setTimeout(function(){that.resetUploadUrl(),e.status=plupload.QUEUED,m.stop(),m.start()},0),!0):(g=qiniuUploadUrls.length,!1)};return m.bind("Error",function(e){return function(t,n){logger.error("Error event activated"),logger.error("err: ",n);var i="",o=n.file;if(o){switch(n.code){case plupload.FAILED:i="上传失败。请稍后再试。";break;case plupload.FILE_SIZE_ERROR:var r=t.getOption&&t.getOption("max_file_size");r=r||t.settings&&t.settings.max_file_size,i="浏览器最大可上传"+r+"。更大文件请使用命令行工具。";break;case plupload.FILE_EXTENSION_ERROR:i="文件验证失败。请稍后重试。";break;case plupload.HTTP_ERROR:if(""===n.response){if(i=n.message||"未知网络错误。",!v(o))return;break}var a=that.parseJSON(n.response),s=a.error;switch(n.status){case 400:i="请求报文格式错误。";break;case 401:i="客户端认证授权失败。请重试或提交反馈。";break;case 405:i="客户端请求错误。请重试或提交反馈。";break;case 579:i="资源上传成功，但回调失败。";break;case 599:if(i="网络连接异常。请重试或提交反馈。",!v(o))return;break;case 614:i="文件已存在。";try{a=that.parseJSON(a.error),s=a.error||"file exists"}catch(u){s=a.error||"file exists"}break;case 631:i="指定空间不存在。";break;case 701:i="上传数据块校验出错。请重试或提交反馈。";break;default:if(i="未知错误。",!v(o))return}i=i+"("+n.status+"："+s+")";break;case plupload.SECURITY_ERROR:i="安全配置错误。请联系网站管理员。";break;case plupload.GENERIC_ERROR:i="上传失败。请稍后再试。";break;case plupload.IO_ERROR:i="上传失败。请稍后再试。";break;case plupload.INIT_ERROR:i="网站配置错误。请联系网站管理员。",m.destroy();break;default:if(i=n.message+n.details,!v(o))return}e&&e(t,n,i)}t.refresh()}}(l)),logger.debug("bind Error event"),m.bind("FileUploaded",function(t){return function(n,i,o){logger.debug("FileUploaded event activated"),logger.debug("file: ",i),logger.debug("info: ",o);var r=function(n,i,o){if(e.downtoken_url){var r=that.createAjax();r.open("POST",e.downtoken_url,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){var e;try{e=that.parseJSON(r.responseText)}catch(a){throw"invalid json format"}var s={};plupload.extend(s,that.parseJSON(o),e),t&&t(n,i,that.stringifyJSON(s))}else m.trigger("Error",{status:r.status,response:r.responseText,file:i,code:plupload.HTTP_ERROR})},r.send("key="+that.parseJSON(o).key+"&domain="+e.domain)}else t&&t(n,i,o)},a=that.parseJSON(o.response);if(p=p?p:a.ctx,logger.debug("ctx: ",p),p){var u="";logger.debug("save_key: ",e.save_key),e.save_key||(u=s(n,i,that.key_handler),u=u?"/key/"+that.URLSafeBase64Encode(u):"");var l="/fname/"+that.URLSafeBase64Encode(i.name);logger.debug("op.x_vars: ",e.x_vars);var c=e.x_vars,d="",f="";if(void 0!==c&&"object"==typeof c)for(var h in c)c.hasOwnProperty(h)&&("function"==typeof c[h]?d=that.URLSafeBase64Encode(c[h](n,i)):"object"!=typeof c[h]&&(d=that.URLSafeBase64Encode(c[h])),f+="/x:"+h+"/"+d);var g,v=qiniuUploadUrl+"/mkfile/"+i.size+u+l+f,b=that.detectIEVersion();b&&b<=9?(g=new mOxie.XMLHttpRequest,mOxie.Env.swf_url=e.flash_swf_url):g=that.createAjax(),g.open("POST",v,!0),g.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),g.setRequestHeader("Authorization","UpToken "+that.token);var x=function(){if(logger.debug("ajax.readyState: ",g.readyState),4===g.readyState){localStorage.removeItem(i.name);var e;200===g.status?(e=g.responseText,logger.debug("mkfile is success: ",e),r(n,i,e)):(e={status:g.status,response:g.responseText,file:i,code:-200},logger.debug("mkfile is error: ",e),m.trigger("Error",e))}};b&&b<=9?g.bind("readystatechange",x):g.onreadystatechange=x,g.send(p),logger.debug("mkfile: ",v)}else r(n,i,o.response)}}(c)),logger.debug("bind FileUploaded event"),m.init(),logger.debug("invoke uploader.init()"),logger.debug("init uploader end"),m},this.getUrl=function(e){if(!e)return!1;e=encodeURI(e);var t=this.domain;return"/"!==t.slice(t.length-1)&&(t+="/"),t+e},this.imageView2=function(e,t){var n=e.mode||"",i=e.w||"",o=e.h||"",r=e.q||"",a=e.format||"";if(!n)return!1;if(!i&&!o)return!1;var s="imageView2/"+n;return s+=i?"/w/"+i:"",s+=o?"/h/"+o:"",s+=r?"/q/"+r:"",s+=a?"/format/"+a:"",t&&(s=this.getUrl(t)+"?"+s),s},this.imageMogr2=function(e,t){var n=e["auto-orient"]||"",i=e.thumbnail||"",o=e.strip||"",r=e.gravity||"",a=e.crop||"",s=e.quality||"",u=e.rotate||"",l=e.format||"",c=e.blur||"",p="imageMogr2";return p+=n?"/auto-orient":"",p+=i?"/thumbnail/"+i:"",p+=o?"/strip":"",p+=r?"/gravity/"+r:"",p+=s?"/quality/"+s:"",p+=a?"/crop/"+a:"",p+=u?"/rotate/"+u:"",p+=l?"/format/"+l:"",p+=c?"/blur/"+c:"",t&&(p=this.getUrl(t)+"?"+p),p},this.watermark=function(e,t){var n=e.mode;if(!n)return!1;var i="watermark/"+n;if(1===n){var o=e.image||"";if(!o)return!1;i+=o?"/image/"+this.URLSafeBase64Encode(o):""}else{if(2!==n)return!1;var r=e.text?e.text:"",a=e.font?e.font:"",s=e.fontsize?e.fontsize:"",u=e.fill?e.fill:"";if(!r)return!1;i+=r?"/text/"+this.URLSafeBase64Encode(r):"",i+=a?"/font/"+this.URLSafeBase64Encode(a):"",i+=s?"/fontsize/"+s:"",i+=u?"/fill/"+this.URLSafeBase64Encode(u):""}var l=e.dissolve||"",c=e.gravity||"",p=e.dx||"",d=e.dy||"";return i+=l?"/dissolve/"+l:"",i+=c?"/gravity/"+c:"",i+=p?"/dx/"+p:"",i+=d?"/dy/"+d:"",t&&(i=this.getUrl(t)+"?"+i),i},this.imageInfo=function(e){if(!e)return!1;var t,n=this.getUrl(e)+"?imageInfo",i=this.createAjax(),o=this;return i.open("GET",n,!1),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&(t=o.parseJSON(i.responseText))},i.send(),t},this.exif=function(e){if(!e)return!1;var t,n=this.getUrl(e)+"?exif",i=this.createAjax(),o=this;return i.open("GET",n,!1),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&(t=o.parseJSON(i.responseText))},i.send(),t},this.get=function(e,t){return!(!t||!e)&&("exif"===e?this.exif(t):"imageInfo"===e&&this.imageInfo(t))},this.pipeline=function(e,t){var n,i,o="[object Array]"===Object.prototype.toString.call(e),r="";if(o){for(var a=0,s=e.length;a<s;a++){if(n=e[a],!n.fop)return!1;switch(n.fop){case"watermark":r+=this.watermark(n)+"|";break;case"imageView2":r+=this.imageView2(n)+"|";break;case"imageMogr2":r+=this.imageMogr2(n)+"|";break;default:i=!0}if(i)return!1}if(t){r=this.getUrl(t)+"?"+r;var u=r.length;"|"===r.slice(u-1)&&(r=r.slice(0,u-1))}return r}return!1}}window.localStorage||(window.localStorage={setItem:function(e,t){createCookie(e,t,30)},getItem:function(e){return readCookie(e)},removeItem:function(e){createCookie(e,"",-1)}});var Qiniu=new QiniuJsSDK;global.Qiniu=Qiniu,global.QiniuJsSDK=QiniuJsSDK}(window),define("web_qui_quiupload_qiniu",function(){}),define("web_qui_quiupload",["plupload","web_qui_quiupload_qiniu"],function(){"use strict";function e(e){this.upopt={browse_button:"",container:"",dragdrop:!1,drop_element:"",max_file_size:"100mb",runtimes:"html5,flash,html4",flash_swf_url:"/qcross/static/models/basic/js/plupload/Moxie.swf",multi_selection:!0,chunk_size:"4mb",max_retries:3,qyer_token_url:"/qcross/www/u/api.php?action=getAlbumToken",domain:"//pic.qyer.com/",auto_start:!0,token_format:function(e){return e.data.tk=e.data.token,e},init:{FilesAdded:function(e,t){},BeforeUpload:function(e,t){},UploadProgress:function(e,t){},UploadComplete:function(){},
FileUploaded:function(e,t,n){},Key:function(e,t){var n,i=[];return i.push(window.QYER.uid),i.push((new Date).getTime()),i.push(parseInt(1e4*Math.random())),n=i.join(""),t.key=n,n},Error:function(e,t,n){var i="";if(t)switch(t.code){case-100:i="Silverlight加载失败";break;case-300:case-400:i="无法打开文件";break;case-600:i="图片必须小于"+e.getOption("max_file_size");break;case-601:i="文件扩展名不正确";break;default:i="未知错误"}e.trigger("UploadError",t,i)}}},this.init(e)}return e.prototype={init:function(e){this.upopt=$.extend(!0,this.upopt,e||{}),this._getUpToken()},_getUpToken:function(){var e=this;$.getJSON(e.upopt.qyer_token_url,function(t){if(0!==t.error_code)throw new Error(t.data);e.upopt.uptoken=t.data.token||t.data.tk,t.data.domain&&e.upopt.domain==t.data.domain,e.uploader=Qiniu.uploader(e.upopt),$(e).trigger("uploadready")})}},e}),define("common/component/footprint/js/sourceType",[],function(){var e={"C-des-leftTopBtn":10,"C-des-beenTo":11,"C-des-bottomInput":12,"C-des-batchComment":{visited:13,unvisited:14,search:16},"C-des-batchCommentSearch":16,"C-profile-cityFootMarkDone":17,"C-profile-allFootmarkRecommend":21,"C-profile-allBeenBatchComment":{visited:22,unvisited:28},"C-profile-allBeenBatchCommentSearch":26,"C-profile-batchComment":{visited:23,unvisited:24,search:26},"C-profile-batchCommentSearch":26,"C-poi-create":20,"C-M-poiDetail":51,"C-M-poiDetailDock":52,"C-M-IWantToComment":53,"C-other-extract":2,"C-other-translate":1};return e}),define("common/ui/textArea/textArea",[],function(){function e(e){this.$obj=e.$obj,this.timer=null,this.option=e.option,this.init()}var t=jQuery,n=[".qui-textArea {zoom: 1; }",".qui-textArea .red { color: red; }",".qui-textArea textarea,",".qui-textArea input { word-break:break-all; transition: height 0.2s; -webkit-transition: height 0.2s; -moz-transition: height 0.2s; -ms-transition: height 0.2s; box-sizing: border-box; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; }",".qui-textArea .autoHeight { overflow: hidden; }"].join("");window.qyerUtil.insertStyle(n),e.prototype={$obj:null,$textarea:null,$cloneTextarea:null,initHeight:null,maxHeight:null,timer:null,option:null,init:function(){this.$textarea=this.$obj.find("textarea").size()?this.$obj.find("textarea"):this.$obj.find("input"),this.$obj.attr("data-width")&&(this.$textarea.css("width",this.$obj.attr("data-width")),this.initHeight=this.$obj.attr("data-height")||this.$textarea.outerHeight()),this.$obj.attr("data-height")&&(this.$textarea.css("height",this.$obj.attr("data-height")),this.initWidth=this.$obj.attr("data-width")||this.$textarea.outerWidth()),this.option&&this.option.autoIncreaseHeight===!0&&(this.$cloneTextarea=this.createClone(this.$textarea)),this.$obj.show(),this.updateUI(),this.bindEvent()},createClone:function(e){if(e){var t=this.$textarea.clone(!0);return t.css({position:"absolute",left:"-9999em",overflow:"auto"}),t.insertAfter(e),t}},bindEvent:function(){var e=this;this.$obj.keyup(function(t){e.registEvent()})},registEvent:function(){var e=this;window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){e.updateUI(!0)},100)},updateUI:function(e){var n=this.$textarea,i=this.$cloneTextarea,o=this.$obj.find(".max"),r=this.$obj.find(".min"),a=this.$obj.find(".current"),s=(this.$obj.find(".exceed"),this.option.max),u=this.option.min,l=n.val().length;if(i){var c,p;i[0].value=n.val(),c=parseInt(i[0].scrollHeight,10),p=t.isNumeric(this.$obj.attr("data-max-height"))?this.$obj.attr("data-max-height"):99999,c>this.initHeight?(n.addClass("autoHeight"),c>=p&&(c=p,n.removeClass("autoHeight"))):c=this.initHeight,n.css("height",c),c=p=null}s==-1?l<u?(a.addClass("red"),0==l&&a.removeClass("red")):a.removeClass("red"):l<u||l>s?(a.addClass("red"),0==l&&a.removeClass("red")):a.removeClass("red"),a.html(l),o.html(s),r.html(u),$aTextArea=i=o=a=$left=s=u=l=left=null},isValidate:function(){var e=this.$obj.find("textarea").val().length;return this.option.max==-1?e>=this.option.min:e>=this.option.min&&e<=this.option.max},getContent:function(){return this.$obj.find("textarea")[0]},setValue:function(e){this.$textarea.val(e),this.$cloneTextarea.val(e),this.updateUI(!0)},getTextArea:function(){return this.$obj.find("textarea")[0]},unload:function(){this.$cloneTextarea.remove()},reset:function(){this.$textarea.val(""),this.$cloneTextarea.val(""),this.$obj.find(".current").html(0)}},t.fn.extend({qyerTextArea:function(n){var i,o;if(i={isValidate:function(e){return e.data("_qyerTextArea").isValidate()},getValue:function(e){return e.data("_qyerTextArea").getTextArea().value},unload:function(e){e.data("_qyerTextArea").unload()},reset:function(e){e.data("_qyerTextArea").setValue("")},setValue:function(e,t){e.data("_qyerTextArea").setValue(t)}},o=t.type(n),"object"==o||"undefined"==o)t.each(this,function(i,o){var r,a;r=t(o),a=t.extend({},n),a.max="undefined"!=typeof a.max?a.max:-1,a.min="undefined"!=typeof a.min?a.min:0,a.width=1==t.isNumeric(r.attr("data-width"))?r.attr("data-width"):null,a.height=1==t.isNumeric(r.attr("data-height"))?r.attr("data-height"):null,r.data("_qyerTextArea")||r.data("_qyerTextArea",new e({$obj:r,option:a})),r=a=null});else if("string"==o){var r,a,s=[];if(a=arguments,t.each(this,function(e,o){if(r=t(o),i[n]){var u=qyerUtil.sliceArguments(a,1);u.unshift(r),s.push(i[n].apply(r,u)),u=null}}),r=a=null,s.length)return 1==s.length?s[0]:s}return i=o=null,this}})}),define("common/basic/js/require-css!common/ui/inputValidation/inputValidation",[],function(){}),define("common/ui/inputValidation/inputValidation",["css!common/ui/inputValidation/inputValidation"],function(){function e(e,n){this.$obj=t(e),this.option=n,this.init()}var t=jQuery;e.prototype={$obj:null,$textDiv:null,option:null,init:function(){var e=this;this.setDefault(),this.option.blurAutoCheck!==!1&&this.$obj.blur(function(){e.check()}),this.$obj.focus(function(){e.clearTip()})},setDefault:function(){switch(this.option.defaultType){case"mail":this.option.exp=/^([a-zA-Z0-9]+[_|\_|\.-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.-]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,6}$/,this.option.text=this.option.text||"邮箱地址格式错误";break;case"phone":this.option.exp=/^1[3|4|5|7|8][0-9]\d{4,8}$/,this.option.text=this.option.text||"手机号码格式错误";break;case"identityID":this.option.exp=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,this.option.text=this.option.text||"身份证号码格式错误";break;case"async":var e=this;this.option.exp=function(){return e.$obj.addClass("ui3_input_icon_loading"),e.$obj.removeClass("ui3_input_icon_error ui3_input_icon_ok"),e.option.asyncCheck(e.$obj.val(),function(t){setTimeout(function(){e.$obj.removeClass("ui3_input_icon_loading"),t?(e.option.text=t,e.addTip(),e.$obj.addClass("ui3_input_icon_error")):e.$obj.addClass("ui3_input_icon_ok")},10)}),!0}}},check:function(){var e=!1;switch(t.type(this.option.exp)){case"regexp":this.option.exp.lastIndex=0,e=this.option.exp.test(this.$obj.val());break;case"function":e=this.option.exp(this.$obj.val())}return this[e?"clearTip":"addTip"](),e},clearTip:function(){this.$obj.removeClass("qui-errorip ui3_input_icon_error"),this.$textDiv&&(this.$textDiv.remove(),this.$textDiv=null)},addTip:function(){this.$obj.addClass("qui-errorip"),this.$obj.hasClass("ui3_input")&&this.$obj.addClass("ui3_input_icon_error"),this.$textDiv&&this.$textDiv.remove();var e="qui-errorip-textDiv"+(this.option.style||"");this.$textDiv=t('<div class="'+e+'"><div class="tip"> <p class="a1"></p> <p class="a2"></p> </div> <div class="text">'+this.option.text+"</div> </div>");var n=this.$obj[this.option.parent?"position":"offset"]();if(1==this.option.style){this.$textDiv.appendTo(this.option.parent||document.body);var i=t(this.option.parent||document.body).outerWidth();i-=n.left,i-=this.$obj.outerWidth(),i=i-this.$textDiv.outerWidth()/2+16,this.$textDiv.css({right:i,top:n.top-25})}else this.$textDiv.css({left:n.left+10,top:n.top+this.$obj.outerHeight()-1}),this.$textDiv.appendTo(this.option.parent||document.body)},clear:function(){this.clearTip()}},t.fn.extend({qyerInputValidation:function(n){var i,o=!1,r=this;return t.each(this,function(){i=t(this),i.data("__errorTip__")?"clear"==n?(o=r,i.data("__errorTip__").clear()):o=i.data("__errorTip__").check():i.data("__errorTip__",new e(this,n))}),r=null,n?this:o}})}),define("common/basic/js/require-css!common/component/poiComment/poiComment",[],function(){}),define("common/component/poiComment/poiComment",["common/ui/popup/popup","web_qui_quiupload","common/component/footprint/js/sourceType","common/ui/textArea/textArea","common/ui/inputValidation/inputValidation","css!common/component/poiComment/poiComment.css"],function(e,t,n){var i={settings:{saveDataSetting:{data:{}},onShow:!1,onHide:!1,onSucceed:null,onCancel:null}};return i.inition=function(e){if(!qyerUtil.isLogin())return void qyerUtil.doLogin();$.extend(this.settings,e);return this.settings.ajaxArgu?(this.getData(this.settings,this.createDOM),!1):void(this.settings.data&&this.createDOM(this.settings.data,this.settings))},i.getData=function(e,t){var e=e,n=this;$.ajax(e.ajaxArgu).done(function(i){n.settings.saveDataSetting.data.starLevel&&parseInt(n.settings.saveDataSetting.data.starLevel,10)>0?i.data.starLevel=parseInt(n.settings.saveDataSetting.data.starLevel,10):i.data.starLevel=i.data.starLevel,t.call(n,i.data,e)}).fail(function(e){})},i.createDOM=function(t,n){var t=t,n=n,o=t.imgUrl||"//common2.qyerstatic.com/place/common/component/poiComment/images/poi_200_133.png",r=t.poiLink||"javascript:void(0)",a=t.cnName||t.enName,s=t.enName&&t.cnName?t.enName:"",u=t.starLevel||0,l=t.comment||"",c=$("<div/>",{"class":"qui-siglComment"}),p=$("<a/>",{href:r,"class":"siglComment-title"}).appendTo(c);$("<img/>",{src:o,width:80,height:80}).appendTo(p);var d=$("<div/>",{"class":"siglComment-info"}).appendTo(c);$('<p class="siglComment-cn"><a href="'+r+'">'+a+"</a></p>").appendTo(d),$('<p class="siglComment-en"><a href="'+r+'">'+s+"</a></p>").appendTo(d);for(var f=$("<div/>",{"class":"siglComment-stars",starlevel:u}).appendTo(d),h=0;h<5;h++)$('<span class="star"></span>').appendTo(f);$('<em class="level">点击星星为它评分</em>').appendTo(f);var m=$("<div/>",{"class":"siglComment-detail","data-width":"638","data-height":"104"}).appendTo(c);$("<textarea/>",{"class":"ui3_textarea",placeholder:"这里有哪些亮点？哪些方面还不够好？大家都期待着你的点评"}).val(l).appendTo(m),$('<div class="siglComment-camera" id="swf_upload_container_c"><label id="uploader">分享照片</label>有图有真相的点评最受欢迎！</div>').appendTo(m),$('<ul class="siglComment-photolist" style="display:none" id="siglComment-photolist"><li class="add" id="swf_upload_container1"><span id="siglCommentPhotoUp"></span></li></ul>').appendTo(m),$('<div class="tips"><span class="current"></span> / <span class="min"></span> ~ <span class="max"></span></div>').appendTo(m);var g=e.show({title:" ",contentHTML:c,width:690,okText:"发布",onAfterHide:function(){n.onHide&&n.onHide.call(g)},onCancel:function(){n.onCancel&&n.onCancel.call(g)},onOK:function(){var t=$(g.getContent()),i=t.find(".siglComment-detail").find(".ui3_textarea").qyerInputValidation(),o=t.find(".siglComment-stars").attr("starlevel");if(!(o>0))return requirejs(["common/ui/tip/tip"],function(e){e.tip({text:"点击星星为它评分",type:"warning"})}),!1;if(i){e.setOption({showLoadBtn:!0,showOKBtn:!1});({starlevel:o,comment:t.find(".siglComment-detail").find(".ui3_textarea").val()});return n.saveDataSetting.data.starlevel=o,n.saveDataSetting.data.comment=t.find(".siglComment-detail").find(".ui3_textarea").val(),n.saveDataSetting.data.imgs=$.map($("#siglComment-photolist li[tid]"),function(e){return $(e).attr("tid")}).join(","),$.ajax(n.saveDataSetting).done(function(e){n.onSucceed&&n.onSucceed.call(g,e),g.hide()}).fail(function(t){n.onFail&&n.onFail.call(g,t),e.setOption({showLoadBtn:!1,showOKBtn:!0})}),!1}return!1},onBeforeHide:function(){var e=$(g.getContent());e.find(".siglComment-detail").find(".ui3_textarea").qyerInputValidation("clear")}});i.popup=g,i.bindEvent.call(g.getContent()),n.onShow&&n.onShow.call(g)},i.bindEvent=function(){var e=$(this);e.find(".siglComment-detail").qyerTextArea({max:2e3,min:30,autoIncreaseHeight:!0}),e.find(".siglComment-detail").find(".ui3_textarea").qyerInputValidation({blurAutoCheck:!1,text:"点评不少于30字，不超过2000字",exp:/^(\s|\S){30,2000}$/im});var t=e.find(".siglComment-stars"),n=["很差","差","一般","好","很好"],i=t.attr("starlevel");t.find(".star").removeClass("star-on"),t.find(".level").html("点击星星为它评分"),i>0&&(t.find(".star:lt("+i+")").addClass("star-on"),t.find(".level").html(n[parseInt(i,10)-1])),t.off("mouseleave").on("mouseleave",function(){$(this).find(".star").removeClass("star-on"),t.find(".level").html("点击星星为它评分");var e=t.attr("starlevel");e>0&&($(this).find(".star:lt("+e+")").addClass("star-on"),t.find(".level").html(n[parseInt(e,10)-1]))}),t.find(".star").each(function(e){var i=e;$(this).hover(function(){t.find(".star").addClass("star-on"),t.find(".star:gt("+i+")").removeClass("star-on"),t.find(".level").html(n[i])}).click(function(){t.attr("starlevel",i+1)})}),$("#swf_upload_container_c label,#siglCommentPhotoUp").off("click").on("click",function(){require(["common/component/uploadPopup/uploadPopup"],function(e){var t=new e({max:20,items:[{model:"local",opt:{headOpt:{models:["list","create"]}}},{model:"myphoto",opt:{headOpt:{models:["list"]}}}]});t.show(),$(t).on("fireuploadimage",function(e,n){if(t.hide(),"string"==typeof n)var n=JSON.parse(n);var i=$("#siglComment-photolist"),o=i.css("display","block");$.each(n,function(e,t){var n=$('<li tid="'+t.id+'">\t\t\t\t\t\t\t<img src="'+t.url+'/80"/>\t\t\t\t\t\t\t<span class="close">\t\t\t\t\t\t\t</span>\t\t\t\t\t\t</li>').insertBefore(o.find(".add"));n.find(".close").click(function(e){e.stopPropagation(),$(this).parent().remove()})})})})})},i.show=function(e){i.inition({ajaxArgu:{data:{poiid:e.poiid},url:"/poi.php?action=popupPoiComment",type:"post",dataType:"json"},flash_swf_url:"/qcross/static/models/basic/js/plupload/Moxie.swf",saveDataSetting:{url:"/qcross/place/index.php?action=savePoiComment",type:"post",dataType:"json",data:{poiid:e.poiid,source_type:n[e.source_type],starLevel:e.starLevel}},onShow:e.onShow||e.onshow||!1,onHide:e.onHide||e.onhide||!1,onSucceed:e.onSuccess||e.onsuccess||e.onSucceed||e.onsucceed||!1,onCancel:e.oncancel||e.oncancel||!1})},i.hide=function(){i.settings.onCancel&&i.settings.onCancel.call(i.popup),e.hide()},i}),define("common/basic/js/require-css!common/widget/userbehavior/userbehavior",[],function(){}),define("common/widget/userbehavior/widget-userbehavior",["common/widget/widget","common/widget/userbehavior/config","common/service/userbehavior/userbehavior-service","common/widget/userbehavior/liketip","project/js/batch_add_footprint","common/component/poiComment/poiComment","css!common/widget/userbehavior/userbehavior.css"],function(e,t,n,i,o,r){return e.createClass({init:function(e,t){this.callSuper.apply(this,arguments),this.params=e,"number"==typeof e.type?this.type=this.place["name"+e.type]:"string"==typeof e.type?this.type=e.type:this.type=this.place.name1,this.id=e.id,this.getDom()},toggleLoading:function(e){this.$el[e?e:"toggleClass"]("place-ubloading")},events:[["click","handle",">ul>li"],["click","submenu",">ul>li a"]],getDom:function(){this.toggleLoading("addClass"),qyerUtil.isLogin()?this.getBaseData():this.setDom(t.getDom(this.type,this.id))},getBaseData:function(){var e=this;n.getBehaviorInfo({tp:e.type,id:e.id},$.proxy(e.getBaseDataSuccess,e),$.proxy(e.getBaseDataError,e))},getBaseDataSuccess:function(e){var n=this,i=e.data.result;n.setDom(t.getDom(n.type,n.id,{planto:i.planto,beento:i.beento,lived:i.lived}))},getBaseDataError:function(e){this.$el.hide()},setDom:function(e){this.$dom=$(e),this.$el.append(this.$dom),this.toggleLoading("removeClass"),this.params.exClass&&this.$dom.addClass(this.params.exClass),new i},preventUnnecessary:function(e,t){return t===!0?void $(e).attr("data-on","no"):"yes"==$(e).attr("data-on")||($(e).attr("data-on","yes"),!1)},handle:function(e){if(!qyerUtil.isLogin())return qyerUtil.doLogin(),!1;var t=this,i=$(e.currentTarget);switch(i.attr("data-type")){case t.planto:case t.beento:case t.lived:if(t.preventUnnecessary(e.currentTarget))return!1;var o=i.attr("data-type"),r={type:t.reversePlace[t.type],id:t.id,oper:o};r[o]=i.attr("data-status")-0?0:1,n.feeling(r,$.proxy(function(t){this.handleSuccess(e.currentTarget,t)},this),$.proxy(function(t){this.handleError(e.currentTarget,t)},this))}},handleSuccess:function(e,n){var i=$(e),o=this,r=i.attr("data-status")-0,a=i.attr("data-type");switch(i.attr("data-status",r?0:1).attr("data-bn-ipg",t[a]["data-bn-ipg"]({type:o.type,id:o.id,status:r})).toggleClass("selected").find("span.fonts").text(t[a][r?"text":"sText"]),o.preventUnnecessary(e,!0),a){case o.beento:"country"!=o.type&&"city"!=o.type||r?"poi"!=o.type||r||o.writePoiComment():o.execAddToPlan(n.data.poi_not_count,n.data.isaddimpress);break;case o.lived:"country"!=o.type&&"city"!=o.type||r||require(["common/component/shareExp/shareExp"],function(e){e.show({id:o.id,type:o.type})})}},handleError:function(e,t){var n=this;this.preventUnnecessary(e,!0),requirejs(["common/ui/tip/tip"],function(e){e.tip({text:t.data.msg||n.errorTip,type:"warning"})})},execAddToPlan:function(e,t){var n=PLACE.TYPE,i=PLACE.PID;o(i,n,e,t)},writePoiComment:function(){var e=this;return!(!PLACE||!PLACE.CITYID)&&void r.show({poiid:e.id,source_type:"C-des-beento",onsucceed:function(e){requirejs(["common/component/switchRoute/switchRoute"],function(e){e.show({onOKFn:function(){requirejs(["common/component/footprint/js/comment"],function(e){e.commShow({city_id:PLACE.CITYID,source_type:"C-des-leftTopBtn"})})},onCancelFn:function(){window.location.reload()}})})}})},batchPoiComment:function(){requirejs(["common/component/footprint/js/comment"],function(e){e.commShow({city_id:PLACE.PID,source_type:"C-des-batchComment"})})},submenu:function(e){if(!qyerUtil.isLogin())return qyerUtil.doLogin(),!1;var t=$(e.currentTarget),n=this;if(!t.hasClass("js-cancelFootprint")){qyerUtil.doTrackCode(t.attr("data-bn-ipg"));var i=t.attr("href");return t.hasClass("js-poiComment")?"poi"==n.type?n.writePoiComment():n.batchPoiComment():"string"==typeof i&&"javascript:void(0)"!=i&&(window.document.location.href=i),e.stopPropagation(),!1}}},{ATTRS:{planto:"planto",beento:"beento",lived:"lived",addToPlan:"addToPlan",place:{name4:"country",name1:"city",name2:"poi"},reversePlace:{poi:2,country:4,city:1},errorTip:"操作失败,请刷新页面重试"}})}),define("project/js/slider",[],function(){function e(e){var t={prev:$(),next:$(),content:$(),item:$(),page:$(),width:0,step:1,amount:0,loop:!0,curIndex:0,autoPlay:!1,showTime:3e3,hoverPause:!0};this.options=$.extend(t,e)}function t(t){var n=new e(t);return n.init(),n}var n=null;return e.prototype.oldAnimate=function(e){this.options.item.eq(this.options.curIndex).stop(!0).animate({left:e},400)},e.prototype.newAnimate=function(e){var t=this,n=this.options.item.eq(this.options.curIndex);t.beforeAnimate(t.options.curIndex,n),n.css({left:e}).stop(!0).animate({left:0},400,function(){t.onAnimate(t.options.curIndex,n)})},e.prototype.beforeAnimate=function(e,t){"function"==typeof this.options.beforeAnimate&&this.options.beforeAnimate(e,t)},e.prototype.onAnimate=function(e,t){"function"==typeof this.options.onAnimate&&this.options.onAnimate(e,t)},e.prototype.autoPlay=function(){var e=this;this.options.autoPlay&&(window.clearTimeout(n),n=window.setTimeout(function(){e.doNext()},e.options.showTime))},e.prototype.doNext=function(){!this.options.loop&&this.options.next.hasClass("disabled")||(this.oldAnimate("-100%"),this.getNext(),this.newAnimate("100%"),1==this.options.page.length&&this.options.page.children().removeClass("current").eq(this.options.curIndex).addClass("current"),this.autoPlay(),this.options.loop||(this.options.curIndex>=this.options.amount-1&&this.options.next.addClass("disabled"),this.options.prev.removeClass("disabled")))},e.prototype.doPrev=function(){!this.options.loop&&this.options.prev.hasClass("disabled")||(this.oldAnimate("100%"),this.getPrev(),this.newAnimate("-100%"),this.options.loop||(this.options.curIndex<=0&&this.options.prev.addClass("disabled"),this.options.next.removeClass("disabled")))},e.prototype.getNext=function(){this.options.curIndex++,this.options.curIndex>this.options.amount-1&&(this.options.curIndex=0)},e.prototype.getPrev=function(){this.options.curIndex--,this.options.curIndex<0&&(this.options.curIndex=this.options.amount-1)},e.prototype.bindEvent=function(){var e=this;this.options.next.on("click",function(){e.doNext()}),this.options.prev.on("click",function(){e.doPrev()}),this.options.autoPlay&&this.options.hoverPause&&(this.options.content.on("mouseenter",function(){window.clearTimeout(n)}),this.options.content.on("mouseleave",function(){e.autoPlay()}))},e.prototype.init=function(){this.options.item=this.options.content.children(),this.options.width=this.options.item.eq(0).outerWidth(),this.options.amount=this.options.item.length,this.options.amount<2||(this.options.item.css({position:"absolute",left:"100%"}).eq(0).css({left:"0"}),this.bindEvent(),this.autoPlay(),this.options.loop||this.options.prev.addClass("disabled"))},t}),define("project/js/qyguide",[],function(){var e=$("#qyGuide"),t=e.find(".plcQYGuidePage em");require(["project/js/slider"],function(n){n({prev:e.find(".prev"),next:e.find(".next"),content:e.find(".plcQYGuideContent"),beforeAnimate:function(e){t.text(++e)}})}),e.on("click",".download a",function(e){var t=$(this).parents("li").attr("data-id");require(["project/js/qyguide_download"],function(e){e(t)})}),$(".js-guideBatchDown").on("click",function(){requirejs(["common/component/guideBatchdownload/guideBatchdownload"],function(e){e.show({id:PLACE.PID,type:PLACE.TYPE})})})}),define("project/js/slide",[],function(){function e(e){this._prev=e.prev,this._next=e.next,this._content=e.content,this._step=e.step||3,this._currentIndex=0,this._length=0,this._list=$(),this._liWidth=e.liWidth||335}function t(t){var n=new e(t);return n.init(),n}return e.prototype.doPrev=function(){this._currentIndex-this._step<0?this._currentIndex=0:this._currentIndex-=this._step,this._next.removeClass("disabled"),this.animate(this._currentIndex),0==this._currentIndex&&this._prev.addClass("disabled")},e.prototype.doNext=function(){this._currentIndex+this._step+this._step>this._length-1?this._currentIndex=this._length-this._step:this._currentIndex+=this._step;var e=this._currentIndex+this._step,t=this._list.find("li:lt("+e+")");t.each(function(e,t){var n=$(this).find("img[data-original]");n.each(function(e,t){var n=$(this).attr("src"),i=$(this).attr("data-original");n!==i&&$(this).attr("src",i)})}),this._prev.removeClass("disabled"),this.animate(this._currentIndex),this._currentIndex+this._step==this._length&&this._next.addClass("disabled")},e.prototype.animate=function(e){this._list.stop(!0).animate({left:-(e*this._liWidth)},500)},e.prototype.init=function(){var e=this;this._list=this._content.find("ul"),this._length=this._list.find("li").length,this._list.css("width",this._liWidth*this._length),this._length<=this._step||(this._prev.addClass("disabled"),this._prev.on("click",function(t){t.preventDefault(),e.doPrev()}),this._next.on("click",function(t){t.preventDefault(),e.doNext()}))},t}),define("project/js/discuss",[],function(){function e(e,t,n,i){var o="/city.php?action=ajaxtravel";"recommend"==$("#plcTravelSort").find(".current").attr("data-type")&&(o="/city.php?action=ajaxrecommendthreads");var n=n||"hot";e.addClass("plcListLoading"),$.getJSON(o,{page:t,type:PLACE.TYPE,pid:PLACE.PID,sort:n},function(t){e.removeClass("plcListLoading");var n=t.data,o=e.siblings(".plcDiscussPage"),r=e.siblings(".plcDiscussContentEmpty");n.list.length>0?r.hide():r.show();var a=$("#travelTmpl").html(),s=juicer(a,n);e.html(s),o.html(n.pagehtml),"function"==typeof i&&i()})}function t(e,t,n){var i="/city.php?action=ajaxask";e.addClass("plcListLoading"),$.getJSON(i,{page:t,type:PLACE.TYPE,pid:PLACE.PID},function(t){e.removeClass("plcListLoading");var i=t.data,o=e.siblings(".plcDiscussPage"),r=e.siblings(".plcDiscussContentEmpty");i.list.length>0?r.hide():r.show();var a=$("#askTmpl").html(),s=juicer(a,i);e.html(s),o.html(i.pagehtml),"function"==typeof n&&n()})}function n(e,t,n){var i="/city.php?action=ajaxpartner";e.addClass("plcListLoading"),$.getJSON(i,{page:t,type:PLACE.TYPE,pid:PLACE.PID},function(t){e.removeClass("plcListLoading");var i=t.data,o=e.siblings(".plcDiscussPage"),r=e.siblings(".plcDiscussContentEmpty");i.list.length>0?r.hide():r.show();var a=$("#partnerTmpl").html(),s=juicer(a,i);e.html(s),o.html(i.pagehtml),"function"==typeof n&&n()})}function i(e,t,n,i){var o="/city.php?action=ajaxcomment";return n=!!n,n&&!qyerUtil.isLogin()?void qyerUtil.doLogin():(e.addClass("plcListLoading"),void $.getJSON(o,{page:t,type:PLACE.TYPE,pid:PLACE.PID,friendFirst:n},function(t){e.removeClass("plcListLoading");var o=t.data,r=e.siblings(".plcDiscussPage"),a=e.siblings(".plcDiscussContentEmpty");a.hide(),0==o.list.length&&(n?a.filter("[data-type=friend]").show():a.filter("[data-type=all]").show());var s=$("#commentTmpl").html(),u=juicer(s,o);e.html(u),r.html(o.pagehtml),"function"==typeof i&&i(),requirejs(["common/ui/textArea/textArea"],function(){e.find(".qui-textArea").qyerTextArea({max:140,min:10})})}))}function o(){var e=$(".plcDiscussMain").offset().top;e-=50,$("body,html").animate({scrollTop:e})}require(["project/js/tab"],function(o){o({tab:$(".plcDiscussTags"),content:$(".plcDiscussContent"),onChanged:function(o,r,a){var s=$(a).children("ul"),u=s.text();if(""==$.trim(u)){var l=$(r).attr("data-type");switch(l){case"ask":t(s,1);break;case"travel":e(s,1);break;case"partner":n(s,1);break;case"comment":$("#commentListFriendPrior")[0].checked=!1,i(s,1)}}}})}),$("#plcTravelLists").on("click",".ui_page a",function(){var t=$(this).attr("data-page"),n=$(".plcTravelList"),i=$("#plcTravelSort .current").attr("data-type");e(n,t,i,function(){o()})}),$("#plcAskLists").on("click",".ui_page a",function(){var e=$(this).attr("data-page"),n=$(".plcAskList");t(n,e,function(){o()})}),$("#plcPartnerLists").on("click",".ui_page a",function(){var e=$(this).attr("data-page"),t=$(".plcPartnerList");n(t,e,function(){o()})}),$("#plcCommentLists").on("click",".ui_page a",function(){var e=$(this).attr("data-page"),t=$(".plcCommentList"),n=$("#commentListFriendPrior").is(":checked");i(t,e,n,function(){o()})}),$("#plcTravelSort").on("click","span",function(){if(!$(this).hasClass("current")){$(this).addClass("current").siblings("span").removeClass("current");var t=$(this).attr("data-type"),n=$(".plcTravelList");e(n,1,t)}}),$("#commentListFriendPrior").on("change",function(){var e=$(this)[0].checked,t=$(".plcCommentList");i(t,1,e)}),$(".plcCommentList").on("click",".praise",function(){var e=this,t="/poi.php?action=useful",n=$(this).parents("li[data-id]").attr("data-id");return qyerUtil.isLogin()?void $.post(t,{type:2,pid:n},function(t){if(0==t.error_code){var n=$(e).text();n=parseInt(n,10),$(e).text(++n),$(e).removeClass("praise").addClass("praised"),requirejs(["common/ui/tip/tip"],function(e){e.tip({text:t.data.msg_impel})})}else $(e).removeClass("praise").addClass("praised"),requirejs(["common/ui/tip/tip"],function(e){e.tip({text:t.data.msg,type:"warning"})})},"json"):void qyerUtil.doLogin()}),$(".plcCommentList").on("click",".plcCommentUserCnts .replyBtn",function(){var e=$(this).parents(".plcCommentUserCnts").next(".plcCommentUserReplys");e.is(":hidden")?e.slideDown(function(){var e=$(this).parents("li[data-id]"),t=e.find(".title a:eq(0)").text(),n="回复 @"+t+"：";$(this).find("textarea").focus().val(n)}):e.slideUp()}),$(".plcCommentList").on("click",".plcCommentUserReplys .replyBtn",function(){var e=$(this).parent().parent("li[data-id]"),t=e.parents(".plcCommentUserReplys").find("textarea"),n=e.find(".title a:eq(0)").text(),i="回复 @"+n+"：";t.focus().val(i)}),$(".plcCommentList").on("click",".qui-textArea :button",function(){var e=$(this).parents(".qui-textArea"),t=e.children("textarea");if($li=$(this).parents("li[data-id]"),cid=$li.attr("data-id"),$replyList=$li.find(".msglist"),!qyerUtil.isLogin())return void qyerUtil.doLogin();var n=e.qyerTextArea("isValidate");if(!n)return void requirejs(["common/ui/tip/tip"],function(e){e.tip({text:"你输入的字数不符合要求",type:"error"})});var i="/public.php?action=replycomment";$.post(i,{cid:cid,type:2,reply:t.val()},function(e){if(0!=e.error_code)return void requirejs(["common/ui/tip/tip"],function(e){e.tip({text:"回复错误",type:"error"})});var t=e.data,n=$("#replyTmpl").html(),i=juicer(n,t);$replyList.prepend(i);var o=$li.find(".replyBtn"),r=o.find("span"),a=parseInt(r.text());a++,r.text(a)},"json")})}),define("project/js/comentRankUser",[],function(){function e(e,t){if(!qyerUtil.isLogin())return!1;var n=e.find("li"),i=0,o=[];for(i;i<n.length;i++)o.push(n[i].getAttribute("data-uid"));$.post("/public.php?action=ckfriend",{fuids:o.join(","),timer:Date.now()},function(e){if(0!==e.error_code)throw new Error("getFollow ajax error");t&&t(e.data)},"json")}var t=$(".plcDiscussRankuser");e(t,function(e){for(o in e)0!==e[o].follow&&t.find('li[data-uid="'+o+'"]').find(".follow").empty().text("已关注")}),t.on("click",".follow a",function(){if(!qyerUtil.isLogin())return void qyerUtil.doLogin();var e=$(this).parent(),t=e.attr("data-id");require(["project/js/followuser"],function(n){n(t,function(){e.empty().text("已关注")})})})}),define("common/basic/js/require-css!common/ui/tip/tip",[],function(){}),define("common/ui/tip/tip",["css!common/ui/tip/tip.css"],function(){function e(e){i.html(e.text||"&nbsp;"),n[0].className="qui-tip-box","error"==e.type?n.addClass("qui-tip-box-error"):"warning"==e.type&&n.addClass("qui-tip-box-warning")}var t,n,i,o=jQuery;!function(){var e=['<div class="qui-tip" style="display:none;" >','<div class="qui-tip-box">','<span class="qui-tip-text fontYaHei">这里是提示文本</span>',"</div>","</div>"].join("");t=o(e),i=t.find(".qui-tip-text"),n=t.find(".qui-tip-box"),t.appendTo(document.body)}();var r={_timer:null,tip:function(n){return e(n),t.slideDown(200),window.clearTimeout(this._timer),this._timer=setTimeout(function(){t.slideUp(200)},n.time||3e3),this}};return r}),define("common/component/shareExp/shareExp",["common/ui/popup/popup","common/ui/tip/tip","common/ui/textArea/textArea"],function(e,t){function n(e){this.option={id:0,type:"city",title:"&nbsp;",pText:"一个瞬间？一个贴士？有什么想和大家分享的就说说吧",getExpUrl:"/country.php?action=showimpress",shareExpUrl:"/country.php?action=impress",textareaVal:"",onSuccess:function(){},onHide:function(){}},i.extend(this.option,e),this.init()}var i=jQuery;n.prototype={init:function(){this.getMyExp()},getExp:function(e){e.posturl=this.option.getExpUrl,qyerUtil.doAjax(e)},shareExp:function(e){e.posturl=this.option.shareExpUrl,qyerUtil.doAjax(e)},getMyExp:function(){var e=this;this.getExp({data:{id:e.option.id,type:e.option.type},onSuccess:function(t){e.option.textareaVal=t.data.text,"&nbsp;"==e.option.title&&(e.option.title="说说我的"+t.data.placeName),e.showExpPop()},onError:function(e){e.__server_error__?t.tip({text:"服务器连接错误，请稍后再试",type:"error"}):t.tip({text:e.data.msg,type:"error"})}})},showExpPop:function(){var n=this;e.show({title:n.option.title,width:440,contentHTML:['<div style="position:relative;">',"<p>"+n.option.pText+"</p>",'<div id="shareExpUnit" class="qui-textArea" data-width="400" data-height="120" style="margin-top:10px;">','<textarea id="shareExpTextarea" placeholder="不超过120个汉字" class="ui2_textarea" style="width:400px;height:120px;border:1px solid #cccccc;padding:5px;">'+n.option.textareaVal+"</textarea>",'<div class="tips" style="position:absolute;bottom:-20px;">','<span class="current"></span>/<span class="max"></span>',"</div>","</div>","</div>"].join(""),okText:"发表",onShow:function(){i("#shareExpUnit").qyerTextArea({max:120})},onOK:function(){var o=i("#shareExpUnit").qyerTextArea("isValidate");return o?n.shareExp({data:{id:n.option.id,type:n.option.type,text:i("#shareExpTextarea").val()},onSuccess:function(o){t.tip({text:o.data.msg}),e.hide(),i.isFunction(n.option.onSuccess)&&window.setTimeout(function(){n.option.onSuccess.call(n)},300)},onError:function(e){e.__server_error__?t.tip({
text:"服务器连接错误，请稍后再试",type:"error"}):t.tip({text:e.data.msg,type:"error"})}}):t.tip({text:"输入文字超出限制",type:"error"}),!1},onCancel:function(){i.isFunction(n.option.onHide)&&n.option.onHide.call(n)}})}};var o={show:function(e){if(!qyerUtil.isLogin())return void qyerUtil.doLogin();new n(e)}};return o}),define("common/basic/js/require-css!common/ui/inputAutocomplete/inputAutocomplete",[],function(){}),define("common/ui/inputAutocomplete/inputAutocomplete",["css!common/ui/inputAutocomplete/inputAutocomplete.css"],function(){function e(e){this.$obj=e.$obj,this.timer=null,this.isSearching=!1,this.autoSelect=!1,this.$contentDiv=null,this.option=e.option,e.option.parent&&(this.$parent=t(e.option.parent)),this.init()}var t=jQuery;e.prototype={$obj:null,timer:null,option:null,isSearching:!1,autoSelect:!1,$contentDiv:null,$parent:null,init:function(){this.createDomNode(),this.bindEvent()},createDomNode:function(){var e=['<div class="qui-inputAutocomplete" style="display:none;">','<ul class="qui-inputAutocomplete-ul" >','<li class="disableDefalut">loading ... </li>',"</ul>","</div>"].join("");this.$contentDiv=t(e);var n={width:this.$obj.outerWidth()};if(!this.$parent){var i=this.$obj.offset();n.top=i.top+this.$obj.outerHeight(),n.left=i.left,i=null}this.$contentDiv.css(n),this.$contentDiv.appendTo(this.$parent||document.body),e=n=null},_blurTimer:null,bindEvent:function(){var e=this;this.$obj.keyup(function(n){if(t.inArray(n.keyCode,[37,39])==-1)return 9==n.keyCode?(e.$contentDiv.hide(),void(e.option.onVoid&&e.option.onVoid(e.$obj[0]))):void(t.inArray(n.keyCode,[38,40,13])!=-1?e.updateUI(n.keyCode):t.trim(e.$obj.val())||e.option.isAllowEmptySeach?e.registSearch():(e.$contentDiv.hide(),e.option.onVoid&&e.option.onVoid(e.$obj[0])))}).blur(function(){e._blurTimer=window.setTimeout(function(){e.$contentDiv.is(":hidden")||e.option.isBlurClose!==!1&&e.$contentDiv.hide()},300)}),this.option.isFocusedSeach&&this.$obj.focus(function(){(t.trim(e.$obj.val())||e.option.isAllowEmptySeach)&&e.registSearch()}),this.$contentDiv.delegate(".qui-inputAutocomplete-ul li","click",function(n){return n.target.className.indexOf("disableDefalut")!=-1?(n.stopPropagation(),void window.clearTimeout(e._blurTimer)):void(this.className.indexOf("disableDefalut")==-1&&(e.$obj.val(t(this).text()),e.$contentDiv.hide(),e.option.onSelect&&(e.option.onSelect.call(e.$obj[0],this),e.$contentDiv.html(""))))})},registSearch:function(){var e=this;this.isSearching=!1,window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){(t.trim(e.$obj.val())||e.option.isAllowEmptySeach)&&(e.isSearching=!0,e.showContentDiv(),e.option.onSearch.call(e.$obj[0]))},300)},showContentDiv:function(){var e=this;this.$contentDiv.is(":hidden")&&(this.$contentDiv.show(),t(document).one("click",function(t){e.option.isBlurClose!==!1&&e.$contentDiv.hide()}))},updateUI:function(e){function n(){var e=o.find("li[data-select=true]"),t=o.find("li").index(e);e.attr("data-select",""),e.length?(e=o.find("li:not(.disableDefalut)").eq(t+1),e.length||(e=o.find("li:eq(0)"))):e=o.find("li:eq(0)"),e.attr("data-select","true"),e=null}function i(){var e=o.find("li[data-select=true]"),t=o.find("li").index(e);e.attr("data-select",""),e.length?(e=o.find("li:not(.disableDefalut)").eq(t-1),e.length||(e=o.find("li:eq("+(r-1)+")"))):e=o.find("li:eq("+(r-1)+")"),e.attr("data-select","true"),e=null}if(!this.$contentDiv.is(":hidden")){var o=this.$contentDiv.find(".qui-inputAutocomplete-ul"),r=o.find("li:not(.disableDefalut)").size();if(r&&(t.inArray(e,[38,40])!=-1&&(40==e?n():i()),this.option.enterSelect!==!1&&13==e)){var a=o.find("li[data-select=true]");a.length?(this.$obj.val(a.text()),this.option.onSelect&&(this.option.onSelect.call(this.$obj[0],a[0],!0),this.$contentDiv.html("")),this.$contentDiv.hide()):this.option.isBlurClose!==!1&&this.$contentDiv.hide()}}},pushHTML:function(e){var t={width:this.$obj.outerWidth()};if(!this.$parent){var n=this.$obj.offset();t.top=n.top+this.$obj.outerHeight(),t.left=n.left,n=null}this.$contentDiv.css(t).html(e).show(),this.isSearching=!1,t=null;var i=this.$contentDiv.find(".qui-inputAutocomplete-ul > li:not(.disableDefalut)");i.length&&this.autoSelect!==!1&&i.eq(0).attr("data-select","true"),i=null},isShow:function(){return!this.$contentDiv.is(":hidden")},hide:function(){return this.$contentDiv.hide()},destroy:function(){this.$contentDiv.remove()}},t.fn.extend({qyerAutocomplete:function(n){var i,o,r=arguments;return t.each(this,function(a,s){i=t(s),"object"==t.type(n)?i.data("_autocomplete",new e({$obj:i,option:n})):"pushHTML"==n?i.data("_autocomplete").pushHTML(r[1]):"getContent"==n?o=i.data("_autocomplete").$contentDiv:"isShow"==n?o=i.data("_autocomplete").isShow():"hide"==n?i.data("_autocomplete").hide():"destroy"==n&&(i.data("_autocomplete").destroy(),i.data("_autocomplete",null))}),i=r=null,"undefined"==typeof o?this:o}})}),define("common/basic/js/require-css!common/component/openAsk/openAsk",[],function(){}),define("common/component/openAsk/openAsk",["common/ui/popup/popup","common/ui/tip/tip","common/ui/textArea/textArea","common/ui/inputAutocomplete/inputAutocomplete","common/ui/inputValidation/inputValidation","css!common/component/openAsk/openAsk.css"],function(e,t){function n(e){i.extend(this.option,this.defaultOption),this.option=e,this.init()}if("undefined"!=typeof jQuery){var i=jQuery,o=function(e){var t=[{from:11,name:"place_profile",reg:/^http(s)?:\/\/place\.qyer\.com\/[^\/]+\/(profile|citytransport|when-to-go|cost|information|advice|ctytransport|ncost|pracinfo|nadvice|whentogo|carrental|ctyprofile|nvisa|transportation)/},{from:12,name:"place_travelnote",reg:/^http(s)?:\/\/place\.qyer\.com\/[^\/]+\/travel-notes/},{from:13,name:"place_city",reg:/^http(s)?:\/\/place\.qyer\.com\/[^\/]+/},{from:14,name:"bbs_forum",reg:/^http(s)?:\/\/bbs\.qyer\.com\/forum-[^\/]+/},{from:15,name:"bbs_index",reg:/^http(s)?:\/\/bbs\.qyer\.com\/?\??/},{from:16,name:"ask_tags",reg:/^http(s)?:\/\/ask\.qyer\.com\/tags/},{from:17,name:"ask_detail",reg:/^http(s)?:\/\/ask\.qyer\.com\/question\/\d+/},{from:18,name:"ask_search",reg:/^http(s)?:\/\/ask\.qyer\.com\/search/},{from:19,name:"ask_index",reg:/^http(s)?:\/\/ask\.qyer\.com\/?\??/},{from:20,name:"search_ask",reg:/^http(s)?:\/\/search\.qyer\.com\/ask/},{from:21,name:"ucenter_ask",reg:/^http(s)?:\/\/www\.qyer\.com\/u\/\d+\/ask/}],n=function(){for(var e,n=window.location.href,i=0,o=t.length;i<o;i+=1){var r=t[i];if(r.reg.test(n)){e=r.from;break}}return e||0};return e||n()};i.ajaxSetup({traditional:!0}),n.prototype={option:null,popup:null,tags:[],forums:{},defaultOption:{fid:0,from:0},getFNameByID:function(e){var t=this.forums,n=[];for(var i in t)n=n.concat(t[i]);for(var o=0;o<n.length;o++)if(n[o].id==e)return n[o].name},API:{baseURL:/^bbs\.qyer\.com/.test(location.host)?"/qyerajax.php":"/public.php",getTagByString:function(e){e.posturl=this.baseURL+"?action=maketag&ispopup=1&returnjson=1",window.qyerUtil.doAjax(e)},getTagByTag:function(e){e.posturl=this.baseURL+"?action=TopicMenu",window.qyerUtil.doAjax(e)},submitForm_openAsk:function(e){e.posturl="/qcross/ask/json/askpopup",window.qyerUtil.doAjax(e)}},init:function(){this.initFrame()},checkOpenAskForm:function(){var n=i(e.getContent()),r=n.find("input[name='js_question_title']"),a=n.find("input[name='js_ask_fid']"),s={error:!1,data:{}};if(0==r.qyerInputValidation())return s.error=!0,s;if(this.tags.length<1)return t.tip({text:"没有标签的问题，石沉大海，无人回答哦",type:"error"}),s.error=!0,s;if(s.error===!1){s.data={title:n.find("input[name='js_question_title']").val(),content:n.find("textarea[name='js_ask_content']").val(),"tag[]":[],fid:n.find("input[name='js_ask_fid']").val(),from:o()};for(var u=0,l=this.tags.length;u<l;u++)s.data["tag[]"].push(this.tags[u])}return n=r=$tag=a=null,s},_bindEvt:function(){var n=i(e.getContent()),o=n.find(".js-dropmenu"),r=n.find(".js-dropmenu-popup"),a=n.find("input[name='js_ask_fid']"),s=this;n.off("click.popup").on("click.popup",".js-btn-submit-openAsk",function(){var n=s.checkOpenAskForm(),o=i(this);o.hasClass("ui_button_load")||n&&n.error===!1&&(s.setBtnStatus(o,1),opt={data:n.data,onSuccess:function(n){("undefined"==typeof s.option.onSuccess||"function"==typeof s.option.onSuccess&&s.option.onSuccess(n.data)!==!1)&&o.next().attr("target",s.option.target||"_self").attr("href",n.data.jumpurl)[0].click(),s.setBtnStatus(o,0),e.hide(),t.tip({text:"提问成功！经验+1"})},onError:function(e){s.option&&s.option.onError&&"function"==i.type(s.option.onError)&&s.option.onError(),s.setBtnStatus(o,0),t.tip({text:e.__server_error__?"服务器响应失败，请重试":e.data.msg,type:"error"})}},s.API.submitForm_openAsk(opt))}).on("click",".js-btn-cancel-openAsk",function(){e.hide()}).on("click",".js-dropmenu",function(){r.toggleClass("hide"),o.toggleClass("open")}).on("click",".js-dropmenu-popup .item a",function(){var e=i(this);o.toggleClass("open").find("em").text(e.text()),r.toggleClass("hide"),a.val(e.attr("data-id"))}).on("blur",'input[name="js_question_title"]',function(){s.searchTag(i(this).val())}).on("click",".js-btn-tag-close",function(){s.removeATag(i(this).parent())})},setBtnStatus:function(e,t){0===t?e.removeClass("ui_button_load ui_button_disabled").addClass("ui_button"):e.removeClass("ui_button").addClass("ui_button_load")},getForumSublistHTML:function(e,t){var n=18,t=t||1,o=n*(t-1),r=n*t-1,a="";return i.each(this.forums[e],function(e,t){var n="";if(e>=o&&e<=r){var n='<dd class="js-bbs"><a data-id="'+t.id+'" href="javascript:void(0);">'+t.name+"</a></dd>";a+=n}}),a},getTpl:function(){var e=['<h2 class="openAsk-askTitle fontYaHei p20 mt20">提问</h2>','<div class="qui-textArea openAsk-title p20" data-width="720" data-height="32">','<input placeholder="输入完整清晰的问题" class="ui2_textarea bs" name="js_question_title"/>','<div class="tips">','<span class="current"></span>/<span class="max"></span>字',"</div>","</div>",'<h2 class="openAsk-contentTitle fontYaHei p20">详细内容<em class="fz12">(可选)</em></h2>','<div class="qui-textArea openAsk-content clearfix p20" data-width="720"  data-height="128">','<textarea placeholder="在这里添加详细内容" class="ui2_textarea bs" name="js_ask_content"></textarea>','<div class="tips">','<span class="current"></span>/<span class="max"></span>字</div>',"</div>",'<dl class="tags bs p20">','<dt class="tag-title vm">标签：</dt>','<p class="tag-input-ribbon vm">','<input type="text" value="" placeholder="添加标签" class="tag-input js-tag-input" />',"</p>","</dl>",'<div class="ask-bottom-box p20 bs">','<div class="publish-box js-dropmenu">','<em class="publish-title">选择同时发布的论坛版面</em><span class="publish-arrow"></span>',"</div>\t\t\t",'<input type="button" class="ui_button fr js-btn-submit-openAsk" value="提问"/>',"<a></a>",'<input type="button" style="margin-right:10px;" class="ui_button_cancel fr mr10 js-btn-cancel-openAsk" value="取消" />','<div class="js-dropmenu-popup bbs-container hide">','<div class="item">',"<dl>","<dt>穷游兴趣小组</dt>",this.getForumSublistHTML("穷游兴趣小组"),"</dl>","</div>",'<div class="item">',"<dl>","<dt>穷游欧洲</dt>",this.getForumSublistHTML("穷游欧洲"),"</dl>","</div>",'<div class="item">',"<dl>","<dt>穷游亚洲</dt>",this.getForumSublistHTML("穷游亚洲",1),"</dl>","</div>",'<div class="item">',"<dl>",this.getForumSublistHTML("穷游亚洲",2),"</dl>","</div>",'<div class="item">',"<dl>","<dt>穷游美洲</dt>",this.getForumSublistHTML("穷游美洲"),"</dl>","<dl>","<dt>穷游大洋洲</dt>",this.getForumSublistHTML("穷游大洋洲"),"</dl>","<dl>","<dt>穷游非洲</dt>",this.getForumSublistHTML("穷游非洲"),"</dl>","</div>",'<div class="item">',"<dl>","<dt>线上线下</dt>",this.getForumSublistHTML("线上线下"),"</dl>","<dl>","<dt>后院</dt>",this.getForumSublistHTML("后院"),"</dl>","</div>","</div>","</div>",'<input type="hidden" name="tag[]" />','<input type="hidden" name="tag[]" />','<input type="hidden" name="tag[]" />','<input type="hidden" name="tag[]" />','<input type="hidden" name="tag[]" />','<input type="hidden" name="js_ask_fid" />','<input type="hidden" name="js_ask_oper" />','<input type="hidden" name="js_ask_from" />'].join("");return e},initFrame:function(){var t=this;e.show({contentHTML:'<div style="padding:100px; text-align:center;">loading</div>',width:760,title:"提问",exClassName:"qui-openAskContainer",showTitle:!1,showOKBtn:!1,showCancelBtn:!1,onShow:function(){var n="/qcross/bbs/thread.php?action=getForums";i.get(n,function(n){var i;0==n.error_code?(t.forums=n.data,i=t.getTpl(),e.setContent(i),t._initComponent(),t._bindEvt()):e.hide()},"json")}})},encode:function(e){var t="";return 0==e.length?"":(t=e.replace(/&/g,"&gt;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\'/g,"&#39;"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/\n/g,"<br>"))},_initComponent:function(){var t=this,n=i(e.getContent()),o=n.find(".js-tag-input"),r=n.find(".openAsk-title");n.find("input[name='js_ask_fid']").val(t.option.fid),n.find(".publish-title").html(t.getFNameByID(t.option.fid)),n.find("input[name='js_ask_from']").val(t.option.from),n.find("input[name='js_ask_oper']").val(1),n.find(".openAsk-title").qyerTextArea({min:1,max:50}).end().find(".openAsk-content").qyerTextArea({max:1e3}).end().find("input[name='js_question_title']").qyerInputValidation({parent:r[0],text:"至少写够1个字，最多不超过50字",exp:function(e){return/^.{1,50}$/.test(e)}}).end().find(".js-tag-input").qyerAutocomplete({parent:o.parent()[0],onSearch:function(){function e(e){var t,n=[],i=e.data.item,o=i.length;if(o<1)n.push('<div class="qui-inputAutocomplete-noResult">没有找到任何结果</div>');else{for(t=0;t<o;t++)n.push("<li data-tag="+i[t]+"><em>"+i[t]+"</em></li>");n.unshift('<ul class="qui-inputAutocomplete-ul js-inputAutoComplete">'),n.push("</ul>")}return n.join("")}var n=o.val(),r={data:{keyword:n},onSuccess:function(t){if(t&&t.data&&"array"==i.type(t.data.item))try{o.qyerAutocomplete("pushHTML",e(t))}catch(n){}},onError:function(t){o.qyerAutocomplete("pushHTML",e(t))}};t.API.getTagByTag(r)},onSelect:function(e){t.addATag(e.getAttribute("data-tag")),o.val("")}})},searchTag:function(e){if(e){var t=this,n={data:{title:e},onSuccess:function(e){var n,i,o=e.data;if(o)for(i=0,n=e.data.length;i<n;i++)t.addATag(o[i])},onError:function(e){}};this.API.getTagByString(n)}},addATag:function(t){var n=i(e.getContent()).find(".tag-input-ribbon");this.tagIndexOfTags(t,this.tags)<0&&this.tags.length<5&&i.trim(t).length>0&&(i('<dd class="tag-item vm" title="'+t+'"><span class="tag">'+this.encode(t)+'</span><span class="btn-tag-close js-btn-tag-close"></span></dd>').insertBefore(n),this.tags.push(t),5==this.tags.length&&n.hide()),n=null},removeATag:function(e){var t=e.find(".tag").text(),n=this.tagIndexOfTags(t,this.tags);e.animate({marginTop:-40,opacity:0},200,function(){e.siblings(".tag-input-ribbon").show().end().remove()}),this.tags.splice(n,1),t=n=null},tagIndexOfTags:function(e,t){var n,i;for(n=0,i=t.length;n<i;n++)if(e===t[n])return n;return-1}};var r={qyerOpenAsk:function(e){window.qyerUtil.isLogin()?new n(e||{}):window.qyerUtil.doLogin()}};return r}}),define("common/basic/js/require-css!common/component/mguideManagePlatform/mguideManagePlatform",[],function(){}),define("common/component/mguideManagePlatform/mguideManagePlatform",["common/ui/tip/tip","common/ui/popup/popup","css!common/component/mguideManagePlatform/mguideManagePlatform.css"],function(e,t){function n(e){var t=this;this.defaults={data:{index:1,title:"可以俯瞰巴黎城市的观景点介绍",author:"蝎之传说",id:"123",from:1},exClass:"",tpl:['<li class="mguideManageList fontYaHei" tid="__&id&__">','<span class="index ___&getClass&_">__&index&__</span>','<span class="title ___&getClass&_">__&title&__</span>','<span class="author">__&author&__</span>','<span class="remove"><a href="javascript:void(0)">移除运营位</a></span>',"</li>"].join(""),fnArray:{getClass:function(){var e=t.defaults.data;return e?1==e.from?"":"blue":""}}},this.defaults=$.extend(this.defaults,e||{})}function i(i){var a=function(){var e=window.location.href,t=e.match(/com\/[\w\-]+(\/(\w+)?\/?)?/),n="";return n=t[2]?t[2]:"default"}(),s={type:i&&i.type?i.type:PLACE.TYPE,pid:i&&i.pid?i.pid:PLACE.PID,classname:i&&i.classname?i.classname:a},u={onSuccess:function(o){if(!o.data.list||0==o.data.list.length)return void e.tip({text:"没有数据",type:"warning"});var a='<ul id="mguideManagePlatform">',u=o.data.list;$.each(u,function(e){var t=new n({data:u[e]});a+=t.getDom()}),a+="</ul>",t.show({contentHTML:a,onOK:function(){i&&i.onOK&&$.isFunction(i.onOK)&&i.onOK()},onCancel:function(){i&&i.onOK&&$.isFunction(i.onOK)&&i.onCancel()},title:"管理微锦囊运营位",width:700,showCancelBtn:!1}),$("#mguideManagePlatform").on("click",".remove",function(){var e=$(this),t=$(this).parents("li").attr("tid");r({id:t,type:s.type,pid:s.pid,classname:s.classname,callback:function(){e.parents("li").remove(),$("#mguideManagePlatform").find("li").each(function(e){var t=parseInt(e,10)+1;$(this).find(".index").html(t)})}})})},onError:function(t){e.tip({text:"请求错误",type:"warning"})}},l={data:s,onSuccess:u.onSuccess,onError:u.onError,url:o.getMguideList};i&&i.testData&&(l.testData=i.testData),qyerUtil.doAjax(l)}var o={removemguide:"/mguide.php?action=removeFromWhite",getMguideList:"/mguide.php?action=getBusinessList"};n.prototype.getDom=function(){var e=this;if(e.defaults.data){var t=e.defaults.tpl.replace(/___&[\w]{1,15}&_/g,function(t){var n=/___&([\w]{1,})&_/.exec(t)[1];return e.defaults.fnArray[n]?e.defaults.fnArray[n].call(e):""});t=t.replace(/__&[\w]{1,15}&__/g,function(t){var n=/__&([\w]{1,})&__/.exec(t)[1];return e.defaults.data[n]})}return e.dom=t,e.dom},n.prototype.setData=function(e){var t=this;t.defaults.data=e,t.getDom()},n.prototype.getData=function(){return me.defaults.data||""};var r=function(t){if(!t.id)return void e.tip({text:"缺少微锦囊ID",type:"warning"});if(""==$.trim(t.classname)){var n=window.location.href,i=n.match(/com\/[\w\-]+(\/(\w+)?\/?)?/),r="";r=i[2]?i[2]:"default",t.classname=r}qyerUtil.doAjax({data:{id:t.id,pid:t.pid||PLACE.PID,type:t.type||PLACE.TYPE,classname:t.classname},url:o.removemguide,testData:t.testData,onSuccess:function(n){e.tip({text:n.data.msg,type:n.data.icon||""}),$.isFunction(t.callback)&&t.callback.call(this,n)},onError:function(t){e.tip({text:"移除失败",type:"error"})}})},a={show:function(e){return qyerUtil.isLogin()?void i(e):void qyerUtil.doLogin()}};return a}),define("project/js/country/url",[],function(){"use strict";return{getCountryRecommendPlan:"/country.php?action=get_country_recommend_plan&country_id=<%=id%>"}}),function(e,t){var n=t(e);if("function"==typeof define&&define.amd)define("common/util/template/template",[],function(){return n});else if("object"==typeof exports)module.exports=n;else{var i=e.template;n.noConflict=function(){return e.template===n&&(e.template=i),n},e.template=n}}(this,function(e){"use strict";function t(e){if(null===e)return"null";var t=typeof e;if("object"!==t)return t;var n=x.call(e).slice(8,-1).toLowerCase();return"object"!==n?n:e.constructor==Object?n:"unkonw"}function n(e){return"object"===t(e)}function i(e){return"function"===t(e)}function o(e){return"string"===t(e)}function r(){for(var e=arguments[0]||{},t=y.call(arguments,1),n=t.length,i=0;i<n;i++){var o=t[i];for(var r in o)e[r]=o[r]}return e}function a(){var e=y.call(arguments);return r.apply(null,[{}].concat(e))}function s(e){return e}function u(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\/g,"&#92;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function l(e){return e.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")}function c(e,t){"undefined"!=typeof console&&console[e]&&console[e](t)}function p(e){function t(){return"template.js error"}var n="template.js error\n\n";for(var i in e)n+="<"+i+">\n"+e[i]+"\n\n";return n+="<message>\n"+e.message+"\n\n",c("error",n),g.error(e),t.toString=function(){return'__code__ = "template.js error"'},t}function d(e,t){function n(e){return e=e.replace(/('|")/g,"\\$1").replace(/\n/g," "),';__code__ += ("'+e+'")\n'}function i(e){var t,n,i,r=/^(?:=|:(.*?)=)(.*)$/;return(n=r.exec(e))?(t=n[2],i=o(n[1])?n[1]:u?"h":"",';__code__ += __modifierMap__["'+i+'"](typeof ('+t+') !== "undefined" ? ('+t+') : "")\n'):";"+e+"\n"}for(var r="",a=t.sTag,s=t.eTag,u=t.escape,l=e.split(a),c=0,p=l.length;c<p;c++){var d=l[c].split(s);1===d.length?r+=n(d[0]):(r+=i(d[0],!0),d[1]&&(r+=n(d[1])))}return r}function f(e,t){var n=d(e,t),i='\n    var html = (function (__data__, __modifierMap__) {\n        var __str__ = "", __code__ = "";\n        for(var key in __data__) {\n            __str__+=("var " + key + "=__data__[\'" + key + "\'];");\n        }\n        eval(__str__);\n\n',o="\n        ;return __code__;\n    }(__data__, __modifierMap__));\n    return html;\n",r=i+n+o;r=r.replace(/[\r]/g," ");try{var a=new Function("__data__","__modifierMap__",r);return a.toString=function(){return n},a}catch(s){throw s.temp="function anonymous(__data__, __modifierMap__) {"+r+"}",s}}function h(e,t){function n(n){n=a(v,n);try{var o=i(n,b);return o=t.compress?l(o):o}catch(r){return r.name="RenderError",r.tpl=e,r.render=i.toString(),p(r)()}}t=a(g,t);try{var i=f(e,t)}catch(o){return o.name="CompileError",o.tpl=e,o.render=o.temp,delete o.temp,p(o)}return n.toString=function(){return i.toString()},n}function m(e,t){if("string"!=typeof e)return"";var i=h(e);return n(t)?i(t):i}var g={sTag:"<%",eTag:"%>",compress:!1,escape:!0,error:function(e){}},v={},b={"":function(e){return s(e)},h:function(e){return u(e)},u:function(e){return encodeURI(e)}},x={}.toString,y=[].slice;return m.config=function(e){return n(e)&&(g=r(g,e)),a(g)},m.registerFunction=function(e,t){return o(e)?i(t)?v[e]=t:v[e]:a(v)},m.unregisterFunction=function(e){return!!o(e)&&(delete v[e],!0)},m.registerModifier=function(e,t){return o(e)?i(t)?b[e]=t:b[e]:a(b)},m.unregisterModifier=function(e){return!!o(e)&&(delete b[e],!0)},m.__encodeHTML=u,m.__compress=l,m.__handelError=p,m.__compile=h,m.version="0.7.0",m}),define("common/util/template",["./util","./template/template"],function(e){return template.registerFunction("comm_poi_getstar",function(){return e.getStarHtml.apply(e,arguments)}),{registerFunction:template.registerFunction,render:function(e,t){return template(e,t||{})}}}),define("project/js/country/service",["common/service/service","./url","common/util/template"],function(e,t,n){"use strict";var i={getCountryRecommendPlan:function(i,o,r){return e.get(n.render(t.getCountryRecommendPlan,{id:i||PLACE.PID}),{},o||function(){},r||function(){})}};return i}),define("project/js/country/tpls",[],function(){return{schedule:$("#js-schedule-tpl").html()}}),define("common/component/copyPlan/copyPlan",["common/ui/popup/popup","common/ui/tip/tip"],function(e,t){var n=jQuery,i={copyPlan:function(e){e.posturl="/qcross/plan/planapi_action_copyplan",qyerUtil.doAjax(e)},getToken:function(e){e.posturl="/public.php?action=getplantoken",qyerUtil.doAjax(e)}},o={show:function(o){function r(){var r=o.planid;e.show({title:"给行程起个名字吧",width:460,contentHTML:'<div><input class="ui3_input js_planname" placeholder="请输入行程名称" style="width:400px;"/></div>',onOK:function(){var s=n(e.getContent()).find(".js_planname").val();return(s=n.trim(s))?s.length>18?(t.tip({text:"标题最多18个汉字",type:"warning"}),!1):(i.copyPlan({data:{planid:r,title:s,token:a},onSuccess:function(n){t.tip({text:"行程复制成功",type:"ok"}),e.hide(),o.isJump===!0&&n.data&&n.data.url&&qyerUtil.openUrl(n.data.url),o.onSuccess&&o.onSuccess(n.data),r=s=null},onError:function(n){t.tip({text:n.data.msg,type:"error"}),e.setOption({showLoadBtn:!1,showOKBtn:!0})}}),e.setOption({showLoadBtn:!0,showOKBtn:!1}),!1):(t.tip({text:"请输入行程名称",type:"warning"}),!1)}})}var a;qyerUtil.isLogin()?r():i.getToken({onSuccess:function(e){a=e.data,r()},onError:function(e){t.tip({text:e.data.msg,type:"error"})}})}};return o}),define("project/js/country/schedule",["./service","./tpls","common/util/template","common/widget/widget","common/component/copyPlan/copyPlan"],function(e,t,n,i,o){var r=i.createClass({init:function(){this.callSuper.apply(this,arguments),this.get()},get:function(){this.service()},service:function(t){return e.getCountryRecommendPlan(t||PLACE.PID,$.proxy(function(e){this._success.apply(this,[].slice.call(arguments))},this),$.proxy(function(e){this._error.apply(this,[].slice.call(arguments))},this))},_success:function(){this.success.apply(this,[].slice.call(arguments))},_error:function(){this.error.apply(this,[].slice.call(arguments))},checkData:function(e){return e&&e.data&&e.data.planlist&&e.data.planlist.length},success:function(e){var t=this.checkData(e);return t?void this.render(e):void this.always(e)},render:function(e){var t=n.render(this.getStatic().tpl,e.data);this.$(".qyWrap").html(t)},error:function(e){this.always(e)},always:function(e){this.$().remove(),this.destroy()},switchTab:function(){this.tab.apply(this,arguments)},tab:function(e){var t=$(e.currentTarget),n=t.parent().index(),i=this.getStatic().CLASSNAME.current;this.$(".plcRouteTags > li").removeClass(i).eq(n).addClass(i),this.$(".plcRouteContent").hide().eq(n).show()},login:function(){return!!qyerUtil.isLogin()||(qyerUtil.doLogin(),!1)},copyPlan:function(e){this.login()&&o.show({planid:$(e.currentTarget).parents(".plcRouteContent").attr("data-id"),isJump:!0})},events:[["mouseover.schedule","switchTab",".plcRouteTags > li > span"],["click.schedule","copyPlan",".copyPlanBtn"]]},{tpl:t.schedule,CLASSNAME:{current:"current"}});return r}),$(function(){function e(){function e(e){var t=$(".plcTopBarStat em").eq(0),n=t.text();n=parseInt(n,10)+e,t.text(n)}require(["common/widget/userbehavior/widget-userbehavior"],function(t){var n=new t({$el:$("#js-plcFootPrint"),type:PLACE.TYPE,id:PLACE.PID,exClass:"place-exClass"}).after("handleSuccess",$.proxy(function(t,n){var i=$(t);"beento"==i.attr("data-type")&&e(1==i.attr("data-status")?1:-1)},n))})}$(".topTrackCode").on("click",function(){var e=$(this),t=e.hasClass("selected");qyerUtil.doTrackCode(e.attr("data-ipg-"+(t?"delete":"add")))}),$(".plcContainer:odd").addClass("odd"),$("img.lazy").lazyload({effect:"fadeIn"}),window.__userStatusCallBack?(window.__userStatusCallBack_old=window.__userStatusCallBack,window.__userStatusCallBack=function(t){window.__userStatusCallBack_old.call(window,t),e.call(window,t)}):window.__userStatusCallBack=function(t){e.call(window,t)},require(["project/js/slider"],function(e){var t=$("#expScrollModule"),n=3e3*t.find(".plcShareExpList li").eq(0).find(".text").length;e({prev:t.find(".prev"),next:t.find(".next"),content:t.find(".plcShareExpList"),autoPlay:!0,showTime:n})}),require(["project/js/qyguide"]),require(["project/js/slider"],function(e){var t=$(".plcHotCityContent");e({prev:t.find(".prev"),next:t.find(".next"),content:t.find(".plcHotCityLists"),loop:!1,onAnimate:function(e,t){if(0!=e){var n=$(t).find("img[data-original]");n.each(function(e,t){var n=$(this).attr("src"),i=$(this).attr("data-original");n!==i&&$(this).attr("src",i)})}}})}),require(["project/js/slide"],function(e){e({content:$("#mguideLists"),prev:$("#mguidePagePrev"),next:$("#mguidePageNext")})}),require(["project/js/discuss"]),requirejs(["project/js/comentRankUser"]),$(".js-shareExpBtn").on("click",function(){var e=PLACE.PID,t=PLACE.TYPE;require(["common/component/shareExp/shareExp"],function(n){n.show({id:e,type:t})})}),$(".js-askBtn").on("click",function(){requirejs(["common/component/openAsk/openAsk"],function(e){e.qyerOpenAsk({onSuccess:function(){return!1}})})}),$("#plcMguideManage").length>0&&$("#plcMguideManage").on("click",function(){require(["common/component/mguideManagePlatform/mguideManagePlatform"],function(e){e.show()})}),require(["project/js/country/schedule"],function(e){var t=new e({$el:$("#js-country-schedule")}).after("success",$.proxy(function(){this.$(".plcRouteContent").hide().eq(0).show()},t)).before("always",$.proxy(function(){this.$().removeClass("place-loading")},t)).after("always",$.proxy(function(){$(".plcContainer").removeClass("odd"),$(".plcContainer:odd").addClass("odd")},t))})}),define("project/js/country",function(){}),function(e){var t=document,n="appendChild",i="styleSheet",o=t.createElement("style");o.type="text/css",t.getElementsByTagName("head")[0][n](o),o[i]?o[i].cssText=e:o[n](t.createTextNode(e))}(".qui-popup{\n    position: fixed;\n    top: 0px;\n    left: 0px;\n    width: 100%;\n    height: 100%;\n    background-image:url(\"//common2.qyerstatic.com/place/common/basic/images/bg_255_255_255_0.7.png\");\n    z-index: 1000;\n    overflow-y: auto;\n    opacity: 0;\n}\n.qui-popup > div{\n    display: table;\n    height: 100%;\n    margin: 0 auto;\n}\n.qui-popup-dt{\n    display: table-cell;\n    vertical-align:middle;\n}\n.qui-popup-box{\n    margin: 0 auto;\n    background-color: #fff;\n    position: relative;\n    -webkit-box-shadow: 0 0 6px #aaa;\n    -moz-box-shadow: 0 0 6px #aaa;\n    box-shadow: 0 0 6px #aaa;\n    border: solid 1px #ccc;\n    \n    opacity: 0;\n}\n.qui-popup-box-title{\n    height: 60px;\n    line-height: 60px;\n    font-size: 18px;\n    font-weight: bold;\n    padding-left: 20px;\n}\n.qui-popup-box-content{\n    -webkit-box-sizing: border-box; \n    -moz-box-sizing: border-box;  \n    box-sizing: border-box; \n    padding: 0 20px;\n}\n.qui-popup-box-content >iframe{\n    width: 100%;\n    border: none;\n}\n.qui-popup-box-bottom{\n    text-align: right;\n    height: 70px;\n    line-height: 70px;\n    padding-right: 20px;\n}\n.qui-popup-closeIcon{\n    position: absolute;\n    right: 10px;\n    top: 10px;  \n    cursor: pointer;\n    background-image: url(\"//common2.qyerstatic.com/place/common/ui/popup/ico.png\");\n    height: 32px;\n    width: 32px;\n    background-repeat: no-repeat;\n    background-position:0 0;\n    border-radius: 5px;\n}\n.qui-popup-closeIcon:hover{\n    background-position: 0px -38px;\n}\n.qui-popup-cancelBtn{\n    vertical-align: middle;\n    margin-left:10px;\n}\n.qui-popup-okBtn{\n    vertical-align: middle;\n    margin-left:10px;\n}\n.qui-popup-loadingBtn{\n    vertical-align: middle;\n    display: none;\n    margin-left:10px;\n}.qui-errorip{\n    border: 1px solid #d0312b !important; \n}\n.qui-errorip-textDiv{border:solid 1px #d0312b; background-color: #ffcccd; color:#88777c; position: absolute; z-index: 2000; }\n.qui-errorip-textDiv > .tip{display: block; position: absolute; left: 5px; top: 0; }\n.qui-errorip-textDiv > .tip > p{position:absolute; width:0; height:0; }\n.qui-errorip-textDiv > .tip > .a1{top:-5px; left:0; border-left:5px solid transparent; border-right:5px solid transparent; border-bottom:5px solid #CB0013; }\n.qui-errorip-textDiv > .tip > .a2{top:-4px; left:0; border-left:5px solid transparent; border-right:5px solid transparent; border-bottom:5px solid #FFCCCD; }\n.qui-errorip-textDiv > .text{padding: 0 5px; }\n.qui-errorip-textDiv1 {border:solid 1px #ebb75a; background-color: #fff894; color:#222222; position: absolute; z-index: 2000;border-radius: 3px; }\n.qui-errorip-textDiv1 > .tip{display: block; position: absolute; left: 50%; bottom: -5px;margin-left: -5px; }\n.qui-errorip-textDiv1 > .tip > p{position:absolute; width:0; height:0; }\n.qui-errorip-textDiv1 > .tip > .a1{top:-4px; left:0; border-left:5px solid transparent; border-right:5px solid transparent; border-top:5px solid #ebb75a; }\n.qui-errorip-textDiv1 > .tip > .a2{top:-5px; left:0; border-left:5px solid transparent; border-right:5px solid transparent; border-top:5px solid #fff894; }\n.qui-errorip-textDiv1 > .text{max-width: 300px; overflow: hidden; padding: 0 8px; text-overflow: ellipsis; white-space: nowrap;}\n.qui-siglComment{clear:both;margin-top:-40px;}\n.siglComment-title{width:80px;height:80px;float:left;}\n.siglComment-title img{width:80px;height:80px;}\n.siglComment-info{margin-left:90px;height:80px;margin-right:50px;}\n.siglComment-cn{font-size:18px;font-family:\"microsoft YAHEI\";display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}\n.siglComment-cn a{color:#636363;}\n.siglComment-en{font-size:14px;display:block;height:20px;padding-bottom:10px;}\n.siglComment-en a{color:#959595;}\n.siglComment-stars{height:22px;}\n.siglComment-stars .star{cursor:pointer;padding-right:5px;width:22px;height:22px;float:left;background-image:url(//common2.qyerstatic.com/place/common/component/poiComment/images/icon_star.png);background-repeat:no-repeat;background-position:-27px center;}\n.siglComment-stars .level{float:left;margin-left:20px;margin-top:5px;color:#959595;}\n.siglComment-stars .star-on{background-position:left center;}\n.siglComment-detail{overflow:hidden;clear:both;margin-top:15px;}\n.siglComment-detail .ui3_textarea{width:638px;height:104px;min-height:104px;padding:2px 5px 0px;display: block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;z-index: 10;position: relative;overflow: hidden;}\t\n.qui-siglComment .red{color:#f00;}  \n.siglComment-camera{height:30px;color:#959595;border:solid 1px #c0c0c0;margin-top:-1px;line-height:32px;overflow:hidden;}  \n.siglComment-camera input[type=file]{display:none;}\n.siglComment-camera label{background-image:url(//common2.qyerstatic.com/place/common/component/poiComment/images/camera.png);background-repeat:no-repeat;background-position:left center;padding-left:20px;color:#0072bc;margin:0px 10px;cursor:pointer;}\n.siglComment-camera label:hover{text-decoration:underline;}\n.siglComment-camera~ .tips{margin-top:5px;}\n.siglComment-photolist{overflow: hidden;}\n.siglComment-photolist li{float:left;position: relative;width:80px;height:80px;padding:10px 0 10px 10px;float:left;overflow: hidden;}\n.siglComment-photolist li img{width:80px;height:80px;}\n.siglComment-photolist li .close{cursor:pointer;position:absolute;right:-1px;top:9px;background-image:url(//common2.qyerstatic.com/place/common/component/poiComment/images/close.png);background-repeat:no-repeat;background-position:left top;width:20px;height:20px;border:solid 1px transparent;}\n.siglComment-photolist li .close:hover{background-position:left bottom;width:20px;height:20px;border:solid 1px transparent;}\n.siglComment-photolist .add{background:url(//common2.qyerstatic.com/place/common/component/poiComment/images/icon-add.png) no-repeat 10px 10px;cursor: pointer;position: relative;}\n#siglCommentPhotoUp{display: inline-block;width: 100%;height: 100%;}  \n#siglCommentPhotoUp .moxie-shim-html5{left:0px!important;top:0px!important;}\n.uploadpopup .p10{padding: 10px;}\n.uploadpopup .mr10{margin-right: 10px;}@charset \"utf-8\";\n@charset \"utf-8\";\n@font-face {\n    font-family: 'Place';\n    src: url('//static.qyer.com/models/basic/font/iconfont_place/place_iconfont.eot'); \n    src: url('//static.qyer.com/models/basic/font/iconfont_place/place_iconfont.eot') format('embedded-opentype'), \n    url('//static.qyer.com/models/basic/font/iconfont_place/place_iconfont.woff') format('woff'), \n    url('//static.qyer.com/models/basic/font/iconfont_place/place_iconfont.ttf') format('truetype'),\n    url('//static.qyer.com/models/basic/font/iconfont_place/place_iconfont.svg') format('svg'); \n}\n@font-face {font-family: \"exPlace\";\n  src: url('//static.qyer.com/models/basic/font/iconfont_place/place_exIconfont.eot');\n  src: url('//static.qyer.com/models/basic/font/iconfont_place/place_exIconfont.eot') format('embedded-opentype'), \n  url('//static.qyer.com/models/basic/font/iconfont_place/place_exIconfont.woff') format('woff'), \n  url('//static.qyer.com/models/basic/font/iconfont_place/place_exIconfont.ttf') format('truetype'),\n  url('//static.qyer.com/models/basic/font/iconfont_place/place_exIconfont.svg') format('svg'); \n}\n.place-iconfont, .poi-discount .iconfont{\n  font-family:\"Place\" !important;\n  font-size:16px;\n  font-style:normal;\n  -webkit-font-smoothing: antialiased;\n  -webkit-text-stroke-width: 0.2px;\n  -moz-osx-font-smoothing: grayscale;\n}\n@charset 'utf-8';\n.poiRedPoint{\n\tborder: solid 2px #fff;\n\tbackground: #ff6763;\n\tborder-radius: 50%;\n\twidth: 12px;\n\theight: 12px;\n\tdisplay: none;\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 0;\n\tmargin-left: 9px;\n\tz-index: 15;\n}\n.poiLikeTip{\n\twidth: 300px;\n\theight: 122px;\n\tposition: absolute;\n\tleft: 50%;\n\tmargin-left: -150px;\n\ttop: 43px;\n\tz-index: 16;\n\tbackground: url(//common2.qyerstatic.com/place/project/images/poi/poiLikeTip.png) no-repeat left top;\n\tbackground-size: 300px 122px;\n\tcolor: #444!important;\n\tdisplay: none;\n}\n.poiLikeTip .close{\n\tposition: absolute;\n\tz-index:1;\n\tfont-size:20px;\n\tright: 5px;\n\ttop:10px;\n\theight: 26px;\n\tline-height: 24px;\n\twidth: 26px;\n\tcolor: #c0c0c0;\n\tbackground-image: url(//common2.qyerstatic.com/place/project/images/poi/poiLikeClose.png);background-repeat: no-repeat;\n\tbackground-position: 3px 0px; \n\tbackground-size: 50px 25px;\n\tcursor: pointer;\n}\n.poiLikeTip .close:hover{\n\tbackground-position: -25px 0px;\n\tcolor: #fff;\n}\n.poiLikeTip .neverShow{\n\tposition: absolute;\n\tleft: 10px;\n\tbottom: 10px;\n\tcolor: #959595;\n}\n.poiLikeTip .neverShow:hover{\n\tcolor: #3f9f5f;\n}\n.poiLikeTip .text{\n\theight: 18px;\n\tline-height: 18px;\n\tcolor: #636363;\n\ttext-align: left;\n\tfont-size: 14px;\n\tpadding-left: 10px;\n\ttext-indent: 0px;\n}\n.poiLikeTip .t1{\n\tmargin-top: 16px;\n}\n.poiLikeTip em{\n\tfont-style: normal;\n\tfont-size: 16px;\n\tfont-weight: bold;\n}\n.poiLikeSmallTip{\n\twidth: 234px;\n\theight: 32px;\n\tdisplay: none;\n\tbackground: url(//common2.qyerstatic.com/place/project/images/poi/poiLikeSmallTip.png) no-repeat left top;\n\tbackground-size: 234px 32px;\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 43px;\n\tmargin-left: -117px;\n\tline-height: 36px;\n\tcolor: #959595!important;\n}\n.place-userbehavior .planto:hover .poiLikeHoverShow{\n\tdisplay: block;\n\tz-index: 5;\n}\n.poiLikeShow{\n\tdisplay: block!important;\n}\n.place-userbehavior .selected .poiLikeShow,\n.place-userbehavior .selected .poiLikeHoverShow{\n\tdisplay: none!important;\n}\n.place-ubloading{\n\tposition: relative;\n\tmin-height: 70px;\n}\n.place-ubloading:before{\n\tcontent: '';\n\tposition: absolute;\n\tleft: 0;\n\twidth: 100%;\n\theight: 70px;\n\ttop: 0;\n\tz-index: 10;\n\tbackground: rgba(255, 255, 255, 0.6) url(//static.qyer.com/models/common/images/wait_16_2.gif) no-repeat center center;\n}\n.place-userbehavior{\n\theight: 84px;\n\tdisplay: table;\n\twidth: 100%;\n\tbox-sizing: border-box;\n}\n.place-userbehavior > li{\n\tcursor: pointer;\n\tdisplay: table-cell;\n\tposition: relative;\n\ttext-align: center;\n\theight: 84px;\n\tz-index: 1;\n}\n.place-userbehavior > li:before,\n.place-userbehavior > li:after{\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 0;\n\twidth: 40px;\n\theight: 40px;\n\tmargin-left: -20px;\n\tcontent: '';\n}\n.place-userbehavior > li:before{\n\tfont-family: 'Place'!important;\n\tfont-size: 24px;\n\tcolor: #fff;\n\tfont-style:normal;\n  \t-webkit-font-smoothing: antialiased;\n  \t-webkit-text-stroke-width: 0.2px;\n  \t-moz-osx-font-smoothing: grayscale;\n  \ttext-align: center;\n  \tline-height: 40px;\n  \tz-index: 12;\n}\n.place-userbehavior .planto:before{\n\tcontent: '\\e639';\n}\n.place-userbehavior .beento:before{\n\tcontent: '\\e63b';\n}\n.place-userbehavior .lived:before{\n\tfont-family: 'exPlace'!important;\n\tcontent: '\\e890';\n}\n.place-userbehavior .addToPlan:before{\n\tfont-family: 'exPlace'!important;\n\tcontent: '\\e893';\n}\n.place-userbehavior > li:after{\n\tbackground-color: rgb(67, 158, 97);\n\tborder-radius: 50%;\n\tz-index: 7;\n}\n.place-userbehavior > li:hover{\n\tcolor: rgb(20, 120, 80);\n}\n.place-userbehavior > li:hover:after{\n\tbackground-color: rgb(95, 172, 121);\n}\n.place-userbehavior > li.selected:after{\n\tbackground-color: rgb(236, 236, 236);\n}\n.place-userbehavior > li.selected:before{\n\tfont-family: 'exPlace'!important;\n\tcontent: '\\e892';\n\tcolor: rgb(95, 172, 121);\n\tfont-weight: bold;\n}\n.place-userbehavior > li.selected:hover:before{\n\tfont-family: 'exPlace'!important;\n\tcontent: '\\e891';\n\tfont-weight: bold;\n}\n.place-userbehavior .fonts{\n\tfont-size:16px;\n\tposition: absolute;\n\twidth: 75px;\n\tmargin-left: -37px;\n\ttop: 50px;\n\tz-index: 4;\n\tleft: 50%;\n}\n.place-userbehavior .beento ul li,\n.place-userbehavior .beento ul{\n\tdisplay: none;\n}\n.place-userbehavior .beento.selected ul{\n\tposition: absolute;\n\tborder: solid 4px #ececec;\n\twidth: 0;\n\theight: 0;\n\tborder-top:solid 4px transparent;\n\tborder-left:solid 4px transparent;\n\ttop:100%;\n\tleft: 100%;\n\tmargin: -15px 0 0 -10px;\n\tdisplay: block;\n}\n.place-userbehavior .beento.selected:hover ul li{\n\tdisplay: block;\n}\n.place-userbehavior .beento.selected:hover ul{\n\twidth: 100px;\n\tleft: 50%;\n\ttop: -7px;\n\tmargin:0 0 0 -50px;\n\tpadding-top: 87px;\n\tdisplay: block;\n\tborder: 1px solid #d7d7d7;\n\tbox-shadow: 0 0 4px rgba(0,0,0,0.15);\n\tbackground-color: #fff;\n\theight: auto;\n}\n.place-userbehavior .beento li{\n\tline-height: 32px;\n\tborder-top: #ececec solid 1px;\n\tmargin: 0 10px;\n\ttext-align: left;\n\ttext-indent: 3px;\n}\n.place-userbehavior .beento li a{\n\tcolor: #959595;\n\tdisplay: block;\n}\n.place-userbehavior .beento li a:hover{\n\tcolor: #0073b6;\n\ttext-decoration: none;\n}\n.place-userbehavior li.addToPlan:hover{\n\tcolor: #0073b6;\n}\n.place-userbehavior li.addToPlan:after{\n\tbackground-color: rgb(37, 150, 218);\n}\n.place-userbehavior li.addToPlan:hover:after{\n\tbackground-color: rgb(65, 166, 244);\n}\n.plcFootprint{\n\tpadding-top: 20px;\n\theight: 84px;\n}\n.plcZIndex{\n\tz-index: 2!important;\n}\n.place-exClass{\n\tposition: relative;\n}\n.place-exClass .beento.selected:hover ul{\n\tpadding-top: 101px!important;\n\ttop: -21px;\n}\n.place-exClass .beento.selected:hover li{\n\tdisplay: block;\n}\n.qui-tip{\n\tposition: fixed;\n\ttop: 100px;\n\tleft: 0;\n\twidth: 100%;\n\ttext-align: center;\n\tdisplay: none;\n\tz-index: 1100;\n}\n.qui-tip-box{\n\tdisplay: inline-block;\n\tmin-width:120px;\n\tmax-width:390px;\n\tpadding:20px 30px;\n\tbackground-color:#fff;\n\tbox-shadow: 0 2px 7px rgba(0,0,0,0.25);\n\tborder: solid 1px #c0c0c0;\n\ttext-align:left;\n\tfont-size: 18px;\n\tline-height: 32px;\n}\n.qui-tip-text { display:block; position:relative; padding-left:34px;}\n.qui-tip-text:before { content:''; position:absolute; left:0; top:4px; width:24px; height:24px; background:#fff url(//common2.qyerstatic.com/place/common/ui/tip/icons2.png) no-repeat;}\n.qui-tip-box-error .qui-tip-text:before { background-position:0 -80px;}\n.qui-tip-box-warning .qui-tip-text:before { background-position:0 -40px;}.qui-inputAutocomplete{\n\tposition: absolute;\n\tz-index: 1100;\n\tbackground-color: #fff;\n\tborder: solid 1px #eee;\n}\n.qui-inputAutocomplete-ul{\n}\n.qui-inputAutocomplete-ul li{\n\theight: 32px;\n\tline-height: 32px;\n\tborder-bottom: solid 1px #eee;\n    background-color: #fff;\n    cursor: pointer;\n    word-break: keep-all;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n.qui-inputAutocomplete-ul li:hover,\n.qui-inputAutocomplete-ul li[data-select=true]{\n\tbackground-color: #e0f1de;\n}\n.qui-inputAutocomplete-ul li.disableDefalut{\n    background-color: #fff !important;\n    cursor: default;\n}\n.qui-inputAutocomplete-noResult{\n\tcolor:red;\n}\n.qyer_inputAutocomplete_name { padding:0 5px 0 10px;}\n.qyer_inputAutocomplete_name .current { color:#077345;}\n.qyer_inputAutocomplete_en { padding-right:10px; font-family:Tahoma, Geneva, sans-serif;}\n.qyer_inputAutocomplete_found { color:#959595; padding-right:10px;}\n.qyer_inputAutocomplete_creat { padding:10px;}.qui-openAskContainer .fz12{font-size:12px;}\n.qui-openAskContainer .vm{vertical-align: middle;}\n.qui-openAskContainer .bs{box-sizing:border-box; -webkit-box-sizing:border-box; -moz-box-sizing:border-box; -ms-box-sizing:border-box;}\n.qui-openAskContainer .p20{padding:0 20px;}\n.qui-openAskContainer .mt20{margin-top:20px;}\n.qui-openAskContainer .qui-popup-box-content{padding:0px;}\n.qui-openAskContainer .qui-popup-box-bottom{display:none;}\n.qui-openAskContainer .hide{display:none;}\n.qui-openAskContainer .disableDefalut{display:none;}\n.qui-openAskContainer .qui-textArea{display:block; margin-top:10px;}\n.qui-openAskContainer  .qui-textArea  textarea,\n.qui-openAskContainer  .qui-textArea  input{width:100%; height:100%; font-size:14px; }\n.qui-openAskContainer  .qui-textArea  textarea{line-height:1.5;}\n.qui-openAskContainer  .qui-textArea  input{line-height:1;}\n.qui-openAskContainer  .qui-textArea  .tips{margin-top:6px; font-size:12px; color:rgb(149,149,149);}\n.qui-openAskContainer  .openAsk-askTitle{font-size:18px; line-height:20px; }\n.qui-openAskContainer  .openAsk-title { height:32px;}\n.qui-openAskContainer  .openAsk-content {height:128px;}\n.qui-openAskContainer  .openAsk-contentTitle{font-size:14px; line-height:16px; margin-top:40px;}\n.qui-openAskContainer  .tags{height:48px; margin-top:60px; border-top:1px solid rgb(195,195,195); border-bottom:1px solid rgb(195,195,195); background:rgb(224,241,223); position:relative; z-index:101; font-size:0; }\n.qui-openAskContainer  .tags  .tag-title,\n.qui-openAskContainer  .tags  .tag-item,\n.qui-openAskContainer  .tags  .tag,\n.qui-openAskContainer  .tags  .btn-tag-close,\n.qui-openAskContainer  .tags  .tag-input-ribbon{display:inline-block;}\n.qui-openAskContainer  .tags  .tag-title{height:48px; line-height:48px; font-size:12px;}\n.qui-openAskContainer  .tags  .tag-item {float: none; margin-right:10px; font-size:12px;}\n.qui-openAskContainer  .tags  .tag-item  .tag{float:left; padding:0 5px 0 12px; line-height:24px; background:url(//static.qyer.com/images/bbs/two/tag_bg.png) no-repeat; color:#FFF; max-width:85px; overflow:hidden; text-overflow:ellipsis; white-space: nowrap;}\n.qui-openAskContainer  .tags  .tag-item  .btn-tag-close{float:left; width:22px; height:24px; background:url(//static.qyer.com/images/bbs/two/tag_bg.png) no-repeat left -30px; cursor:pointer;}\n.qui-openAskContainer  .tags  .tag-item  .btn-tag-close:hover{background-position:left -60px;}\n.qui-openAskContainer  .tags  .tag-input-ribbon em{padding:0 6px; font-size:12px;}\n.qui-openAskContainer  .tags  .tag-input-ribbon input{width:120px; height:22px; padding:0 6px; font-size:12px; box-sizing:border-box; -webkit-box-sizing:border-box; -moz-box-sizing:border-box; -ms-box-sizing:border-box; line-height:1;}\n.qui-openAskContainer  .ask-bottom-box{position:relative; padding:20px; height:70px;}\n.qui-openAskContainer  .ask-bottom-box .publish-box{position:relative; float:left; border:1px solid rgb(192,192,192); padding:0 50px 0 10px; line-height:22px; cursor:pointer;}\n.qui-openAskContainer  .ask-bottom-box .publish-box:hover{border:1px solid #999;}\n.qui-openAskContainer  .ask-bottom-box .publish-box  .publish-arrow{position:absolute; right:10px; top:9px; width:0; height:0; overflow: hidden; border:4px solid rgba(0,0,0,0); border-top-color:rgb(149,149,149); border-bottom-width:0; cursor:pointer;}\n.qui-openAskContainer  .ask-bottom-box .publish-box.open .publish-arrow{border:4px solid rgba(0,0,0,0); border-bottom-color:rgb(149,149,149); border-top-width:0;}\n.qui-openAskContainer .bbs-container{position:absolute; top:-357px; white-space: nowrap; font-size:0; z-index:2001; border:1px solid rgb(192,192,192); background-color:#FFF; padding:10px 30px 10px 10px; overflow:hidden;}\n.qui-openAskContainer .bbs-container .item{display:inline-block; vertical-align:top; padding-left:30px; margin-bottom:-30px; font-size:12px;}\n.qui-openAskContainer .bbs-container .item:first-child{padding-left:0;}\n.qui-openAskContainer .bbs-container dl{margin-bottom:30px;}\n.qui-openAskContainer .bbs-container dt{font-weight:700; margin-bottom:6px; line-height:14px;}\n.qui-openAskContainer .bbs-container a{display:block; line-height:24px; padding:0 6px; color:rgb(99,99,99);}\n.qui-openAskContainer .bbs-container a:hover{background-color:#ececec;color:#0073b6;text-decoration:none;}\n.qui-inputAutocomplete .qui-inputAutocomplete-noResult{padding-left:6px;border:1px solid #d7d7d7;line-height:22px;color:#959595;font-size:12px;}\n@charset \"utf-8\";\n#mguideManagePlatform{overflow: hidden;}\n#mguideManagePlatform .mguideManageList{height: 22px;line-height: 22px;font-size: 14px;overflow: hidden;}\n#mguideManagePlatform .index{font-weight: bold;width: 50px;text-align:center;float: left}\n#mguideManagePlatform .title{float:left;width: 400px;overflow: hidden;text-overflow:ellipsis;white-space: nowrap;}\n#mguideManagePlatform .author{float:left;width:100px;overflow: hidden;overflow: hidden;text-overflow:ellipsis;white-space: nowrap;}\n#mguideManagePlatform .remove{float:left;width: 75px;float: left;}\n#mguideManagePlatform .blue{color:rgb(0,128,0);}"),
$(function(){function e(){$(".plcFocusPhoto .prev").show(),$(".plcFocusPhoto .next").show(),require(["project/js/slider"],function(e){var t=$("#focusPhoto");e({prev:t.find(".prev"),next:t.find(".next"),content:t.find(".plcFocusPhotoList")}),t.find(".photoAdmin").click(function(){requirejs(["common/component/manageCover/manageCover"],function(e){e.show({pid:PLACE.PID,type:PLACE.TYPE})})})})}function t(){$(".plcFocusPhoto .prev").hide(),$(".plcFocusPhoto .next").hide()}function n(){o++,o===r-1&&e()}function i(e,t){t.each(function(t){if(0===t)e&&$(this).attr("src",$(this)[0].src.replace("680x450","1360x900"));else{var i=$(this);setTimeout(function(){i[0].addEventListener("load",n,!1),e?i[0].src=i.attr("pic-url").replace("680x450","1360x900"):i[0].src=i.attr("pic-url")},4e3)}})}var o=0,r=$(".plcFocusPhotoList img").size();t(),window.devicePixelRatio>1?i(!0,$(".plcFocusPhotoList img")):i(!1,$(".plcFocusPhotoList img"))}),$(document).ready(function(){function e(e){var t=document.cookie;return"string"==typeof e?(document.cookie=e,document.cookie):"string"==typeof t&&t}function t(){if($(".qui-popup-logindialog").length>0)return!1;var t=e();if(t){for(var n=t.split(";"),i=n.length,o=0,r=!0;o<i;o++)if("isDoLogin"==$.trim(n[o].split("=")[0])){r=!1;break}if(r){qyerUtil.doLogin({databnipg:"autopopup"});var a=new Date;a.setTime(a.getTime()+864e5),e("isDoLogin=828;expires="+a.toGMTString()+";path=/")}}else qyerUtil.doLogin({databnipg:"autopopup"})}$("<style>.qyer_layer_fix{display:none!important}</style>").appendTo("body"),setTimeout(t,1e4)}),$("body").off("click","._addToLikeList").on("click","._addToLikeList",function(e){function t(e,t,n){var i=$.extend({oper:"planto",type:2,id:null,status:1},e);i[i.oper]=i.status,delete i.status,qyerUtil.doAjax({url:"/public.php?action=feeling",data:i,onSuccess:function(e){$.isFunction(t)&&t.call(this,e)},onError:function(e){n(),requirejs(["common/ui/tip/tip"],function(t){t.tip({text:e.data.msg,type:"error"})})}})}function n(){var e={liking:"plcAddToLikeList",liked:"plcCancelToLikeList"},n=["liked","liking"],o=i.attr("data-status")-0;t({id:i.attr("data-pid"),type:i.attr("data-type"),status:o},function(t){if(i.removeClass("_disabled"),0==t.error_code&&1==t.data.result){i.removeClass(e[n[o]]).addClass(e[n[1-o]]),i.attr("data-status",1-o);var r=$("table");$("table").length>0&&r.find("a[data-id="+i.attr("data-pid")+"]").attr("data-status",1-o).text(o?"取消想去":"加入想去"),$("body").trigger("addToLikeListEvent")}else requirejs(["common/ui/tip/tip"],function(e){e.tip({text:"操作失败"})})},function(){i.removeClass("_disabled")})}if(e.stopPropagation(),e.preventDefault(),!qyerUtil.isLogin())return!($(".qui-popup-logindialog").length>0&&"block"==$(".qui-popup-logindialog").css("display"))&&void qyerUtil.doLogin();var i=$(this);return!i.hasClass("_disabled")&&(i.addClass("_disabled"),qyerUtil.doTrackCode(i.attr("data-ipg-"+(1==i.attr("data-status")?"add":"delete"))),n(),!1)}),$(document).ready(function(){$(".js-batchDpingBtn, .pla_topbtns .yelp").off("click").on("click",function(){requirejs(["common/component/footprint/js/comment"],function(e){e.commShow({city_id:PLACE.PID,source_type:"C-des-batchComment"})})})});