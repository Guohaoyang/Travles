define(["web_old_popup"],function(t,e){function i(t){this.popup=null,this.option=null}function o(t,e,i){t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener(e,i,!1)}function n(t,e,i){t.detachEvent?t.detachEvent("on"+e,i):t.removeEventListener(e,i,!1)}var p,a=jQuery;i.prototype={show:function(t){this.option=this.replaceOption(t),this.createLoginContent(),this.funMsg=this.bindMessage()},hide:function(t){this.popup.hide(t),this.action=""},createLoginContent:function(){var e=this,i="https://passport.qyer.com/login/pop",o={page:e.option.page,ref:decodeURIComponent(window.location.href)};this.option.isSkipLoginReload&&this.option.isSkipLoginReload===!0&&(o.isSkipLoginReload=1),this.option.isSkipRegisterReload&&this.option.isSkipRegisterReload===!0&&(o.isSkipRegisterReload=1),this.option.databnipg&&(o.databnipg=this.option.databnipg);for(k in o){var p=-1===i.indexOf("?")?"?":"&";i+=p+k+"="+o[k]}this.popup=t.show({showTitle:!1,width:370,showBottomBtns:!1,iframeSrc:i,iframeHeight:456,onAfterHide:function(){n(window,"message",e.funMsg)}}),setTimeout(function(){window.frames[0].postMessage(JSON.parse(JSON.stringify(e.option)),"*")},1e3)},bindMessage:function(){var t=this,e=function(e){var i="string"==typeof e.data?JSON.parse(e.data):e.data;"height"===i.type?t.changePopupHeight(i.msg):"callback"===i.type?t.option[i.msg]&&t.option[i.msg].call(t):"reload"===i.type&&window.location.reload()};return o(window,"message",e),e},changePopupHeight:function(t){this.popup.setOption({iframeHeight:t})},replaceOption:function(t){return"login"===t.page?"phone"===t.pageType?t.pageType="msg":t.pageType="account":"regist"!==t.page&&"register"!==t.page||(t.page="register","account"===t.pageType&&(t.pageType="mail"),"msg"===t.pageType&&(t.pageType="phone")),t},showDialogtrack:function(t){var e="web-"+t+"-layer";return this.option.databnipg&&(e+="-"+this.option.databnipg.split("-").join("")),e}};var s={show:function(t){p||(p=new i),p.show(a.extend({page:"login",pageType:"account"},t,{}))},hide:function(t){p.hide(t)}};return s});