$(function(){var s="email";function d(e,t){new jQuery.UtrialAvatarCutter({content:"picture_original",purviews:[{id:"picture_200",width:200,height:200},{id:"picture_50",width:50,height:50},{id:"picture_30",width:30,height:30}],selector:{width:200,height:200},showCoords:function(e){$("#x1").val(e.x),$("#y1").val(e.y),$("#cw").val(e.w),$("#ch").val(e.h)},cropattrs:{boxWidth:500,boxHeight:500}}).reload(e)}d($("#picture_original>img").attr("src")),$("#file1").delegate(null,"change",function e(){var t=$("#file1").val(),o=(n="file1",a=0,$("#"+n)[0].files&&(a=$("#"+n)[0].files[0].size),a=Math.ceil(a/1024));var n,a;if(0<t.length){if(5048<o)return void alert("上传的附件文件不能超过5M");var i=t.lastIndexOf("."),r=t.substring(i+1).toLowerCase();-1!=$.inArray(r,["jpg","jpeg","png","gif"])?$.ajaxFileUpload({url:"/setting/uploadAvatar",secureuri:!1,fileElementId:"file1",dataType:"json",success:function(e,t){$("#picture_original>img").attr({src:e.src,width:e.width,height:e.height}),$("#imgsrc").val(e.image),$("#imgExt").val(e.ext),d(e.src),$("#div_avatar").show()},error:function(e,t,o){alert(o)}}):alert("请选择jpg,jpeg,png,gif类型的图片")}else alert("请选择jpg,jpeg,png,gif类型的图片");$("#file1").replaceWith('<input type="file" id="file1" name="file1" class="face-file"  />'),$("#file1").on("change",e)}),$("#btnCrop").click(function(){return $.post("/setting/updateAvatar",{x:$("#x1").val(),y:$("#y1").val(),w:$("#cw").val(),h:$("#ch").val(),image:$("#imgsrc").val(),ext:$("#imgExt").val(),xsrf_token:$.getCookie("qy_xsrf_cookie")},function(e){"1"==e.status?($("#userInfo .photo-sm").attr("src",e.data.url+"!usermini"),$.message({msg:"保存成功。"})):$.message({msg:e.other.desc||"保存失败。"})}),!1});var e,i,t=$(".m-edit-info"),o=$(".nav-tabs li",t),n=$(".tab-items",t);o.on("click",function(){o.removeClass("active"),$(this).addClass("active"),e=o.index($(this)),n.hide(),n.eq(e).show()});var r=_province_,c=_city_,l=$("#provinceid"),u=$("#cityid");function a(e){var t=$(e).val(),o=t?t.split(""):[],n=0,a=$(e).next(".tooltip");if(!/^[\u4E00-\u9FA5A-Za-z0-9_]+$/.test(t))return a.css({opacity:1}).find(".tooltip-inner").html("昵称只支持中英文、数字、下划线"),!1;for(var i=0,r=o.length;i<r;i++)/^[\u4e00-\u9fa5]{1,1}$/.test(o[i])?n+=2:n++;return n<4?(a.css({opacity:1}).find(".tooltip-inner").html("昵称必须为4个字符以上(一个汉字两个字符)"),!1):16<n?(a.css({opacity:1}).find(".tooltip-inner").html("昵称不能超过16个字符(一个汉字两个字符)"),!1):(a.css({opacity:0}),!0)}function p(e,t){void 0!==t&&t&&($("#verifyTemp").find(".m-mask").hide(),$("#verifyTemp").find(".m-verify").hide()),"email"==e?($(".email-box-default").addClass("hidden"),$(".email-box-next").removeClass("hidden")):"phone"==e?($(".phone-box-default").addClass("hidden"),$(".phone-box-next").removeClass("hidden")):"password"==e&&($(".password-do").hasClass("hasPass")||$(".password-box-next").find(".old-password-box").addClass("hidden"),$(".password-box-default").addClass("hidden"),$(".password-box-next").removeClass("hidden"))}l.on("change",function(){var e=$(":selected",this).attr("value");if(!e)return $("option:not(:first)",u).remove(),void u.attr("disabled",!0);u.attr("disabled",!1);for(var t=0,o=i.length;t<o;t++)if(e==i[t].value){$("option:not(:first)",u).remove();for(var n=0,a=i[t].childs.length;n<a;n++)$('<option value="{0}">{1}</option>'.format(i[t].childs[n],i[t].childs[n])).appendTo(u),c==i[t].childs[n]&&$("option[value={0}]".format(c),u).prop("selected",!0)}}),$.ajax({type:"get",dataType:"json",url:"/setting/cityData",success:function(e){if(1!=e.status)return!1;i=e.data,function(e){for(var t=0,o=e.length;t<o;t++)if($('<option value="{0}">{1}</option>'.format(e[t].value,e[t].name)).appendTo(l),r==e[t].value){$("option[value={0}]".format(r),l).prop("selected",!0);for(var n=0,a=e[t].childs.length;n<a;n++)$('<option value="{0}">{1}</option>'.format(e[t].childs[n],e[t].childs[n])).appendTo(u),c==e[t].childs[n]&&$("option[value={0}]".format(c),u).prop("selected",!0)}}(e.data)}}),$("#baseInfoForm").submit(function(e){return e.preventDefault(),!1}),$("#newpwd2").on("keydown",function(e){if("13"==e.which)return $("#setPsdBtn").trigger("click"),!1}),$("#nickname").on("blur",function(){var e=$(this).val(),t=$(this).next(".tooltip");a($("#nickname"))&&$.ajax({type:"get",url:"/user/checkUserName",data:{nick:e},success:function(e){return 1!=e.status?(t.css({opacity:1}).find(".tooltip-inner").html(e.other.desc),!1):(t.css({opacity:0}).find(".tooltip-inner").html(""),!0)}})}).on("keydown",function(e){"13"==e.which&&$("#baseInfoBtn").trigger("click")}),$("#signature").on("blur keydown",function(){var e=$(this).val(),t=$(this).next(".tooltip");200<e.length?t.css({opacity:1}).show():t.css({opacity:0}).hide()}),$.get("/setting/getPushOption",function(t){if("1"==t.status){var e=JSON.parse(t.data.options);for(key in e){var o=e[key];for(otherKey in o)o[otherKey]&&$("#"+key).find("[name="+otherKey+"]").attr("checked",!0)}$("#optionsBtn").on("click",function(){var o=new Object;$("#settingMsgForm .config-list").each(function(){var t=$(this).attr("id");o[t]=new Object,$(this).find("input").each(function(){var e=$(this).attr("name");o[t][e]="",$(this).is(":checked")?o[t][e]=1:o[t][e]=0})});var e=JSON.stringify(o);$.post("/setting/setPushOption",{option:e,xsrf_token:$.getCookie("qy_xsrf_cookie")},function(e){"1"==e.status?$.message({msg:"保存成功。"}):$.message({msg:t.other.desc||"保存失败。"})})})}}),$.get("/setting/getAccountInfo",function(e){var t=e.data.basic_info,o=e.data.third_party_info,a=$("#bindAccountForm .email-box .box-value"),i=$("#bindAccountForm .phone-box .box-value");if(""!=t.email&&(a.text(t.email),$("#bindAccountForm .email-box .box-do").text("修改").addClass("hasValue")),""!=t.phone&&null!=t.phone&&(i.text(t.phone),$("#bindAccountForm .phone-box .box-do").text("修改").addClass("hasValue")),"1"==t.passwd&&$("#bindAccountForm .password-do").text("修改").addClass("hasPass"),""==t.email&&null==t.phone&&$("#bindAccountForm .password-do").addClass("unBinding"),0<o.length)for(var n=0;n<o.length;n++)"1"==o[n].id_type?($(".weibo-box .box-value").text(o[n].name),$(".weibo-box .box-do").text("解绑").addClass("hasAccount")):"3"==o[n].id_type?($(".wechat-box .box-value").text(o[n].name),$(".wechat-box .box-do").text("解绑").addClass("hasAccount")):"2"==o[n].id_type&&($(".qq-box .box-value").text(o[n].name),$(".qq-box .box-do").text("解绑").addClass("hasAccount"));function r(e){var t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("target","_blank"),t.setAttribute("id","camnpr"),document.body.appendChild(t),t.click()}"0"==t.passwd&&$(".third-account .box-do.hasAccount").removeClass("box-do").addClass("no-password"),$(".third-account .no-password").on("click",function(){$(".third-account #endMsg").html("当前帐号未设置其他登录方式。解除绑定前请先绑定手机或邮箱，并设置密码")}),$(".third-account .box-do").on("click",function(){$(".third-account #endMsg").empty();var n=$(this);$.get("/setting/getSecurityStatus",function(e){if("1"==e.data.flag){n.parent().hasClass("weibo-box")?s="weibo":n.parent().hasClass("qq-box")?s="qq":n.parent().hasClass("wechat-box")&&(s="wechat"),$("#verifyTemp .email-opt").empty().addClass("hidden"),$("#verifyTemp .phone-opt").empty().addClass("hidden");var t="使用邮箱 "+a.text()+" 进行验证",o="使用手机号 "+i.text()+" 进行验证";""!=a.text()&&$("#verifyTemp .email-opt").text(t).removeClass("hidden"),""!=i.text()&&$("#verifyTemp .phone-opt").text(o).removeClass("hidden"),$("#verifyTemp").find(".m-mask").show(),$("#verifyTemp").find(".m-verify").show()}else n.parent().hasClass("weibo-box")?n.hasClass("hasAccount")?$.get("/weibo/unbind",function(){$.message({msg:"解绑成功"}),setTimeout(function(){window.location.reload()},1e3)}):r("/weibo/login"):n.parent().hasClass("qq-box")?n.hasClass("hasAccount")?$.get("/qq/unbind",function(){$.message({msg:"解绑成功"}),setTimeout(function(){window.location.reload()},1e3)}):r("/qq/login"):n.parent().hasClass("wechat-box")&&(n.hasClass("hasAccount")?$.get("/wechat/unbind",function(){$.message({msg:"解绑成功"}),setTimeout(function(){window.location.reload()},1e3)}):r("/wechat/login"))})}),$("#bindAccountForm .email-box .box-do").on("click",function(){var t="使用邮箱 "+a.text()+" 进行验证",o="使用手机号 "+i.text()+" 进行验证";$("#verifyTemp .email-opt").empty().addClass("hidden"),$("#verifyTemp .phone-opt").empty().addClass("hidden"),s="email",$(this).hasClass("hasValue")?""==i.text()?$.get("/setting/getSecurityStatus",function(e){"1"==e.data.flag?($("#verifyTemp .email-opt").text(t).removeClass("hidden"),$("#verifyTemp").find(".m-mask").show(),$("#verifyTemp").find(".m-verify").show()):p("email")}):$.get("/setting/getSecurityStatus",function(e){"1"==e.data.flag?($("#verifyTemp .phone-opt").text(o).removeClass("hidden"),$("#verifyTemp .email-opt").text(t).removeClass("hidden"),$("#verifyTemp").find(".m-mask").show(),$("#verifyTemp").find(".m-verify").show()):p("email")}):""==o?p("email"):$.get("/setting/getSecurityStatus",function(e){"1"==e.data.flag?($("#verifyTemp .phone-opt").text(o).removeClass("hidden"),$("#verifyTemp").find(".m-mask").show(),$("#verifyTemp").find(".m-verify").show()):p("email")})}),$("#bindAccountForm .phone-box .box-do").on("click",function(){s="phone",$("#verifyTemp .email-opt").empty().addClass("hidden"),$("#verifyTemp .phone-opt").empty().addClass("hidden");var t="使用邮箱 "+a.text()+" 进行验证",o="使用手机号 "+i.text()+" 进行验证";$(this).hasClass("hasValue")?""==a.text()?$.get("/setting/getSecurityStatus",function(e){"1"==e.data.flag?($("#verifyTemp .phone-opt").text(o).removeClass("hidden"),$("#verifyTemp").find(".m-mask").show(),$("#verifyTemp").find(".m-verify").show()):p("phone")}):$.get("/setting/getSecurityStatus",function(e){"1"==e.data.flag?($("#verifyTemp .phone-opt").text(o).removeClass("hidden"),$("#verifyTemp .email-opt").text(t).removeClass("hidden"),$("#verifyTemp").find(".m-mask").show(),$("#verifyTemp").find(".m-verify").show()):p("phone")}):""==t?p("phone"):$.get("/setting/getSecurityStatus",function(e){"1"==e.data.flag?($("#verifyTemp .email-opt").text(t).removeClass("hidden"),$("#verifyTemp").find(".m-mask").show(),$("#verifyTemp").find(".m-verify").show()):p("phone")})}),$(".password-box-next .password-commit").on("click",function(){var t=$(this).parent().find("#endMsg");return t.empty(),$("#oldpwd,#newpwd,#newpwd2").removeClass("error"),$(".old-password-box").hasClass("hidden")||""!=$("#oldpwd").val()?""==$("#newpwd").val()?($("#newpwd").addClass("error"),void t.text("密码不能为空")):""==$("#newpwd2").val()?($("#newpwd2").addClass("error"),void t.text("密码不能为空")):$("#newpwd").val()!=$("#newpwd2").val()?($("#newpwd,#newpwd2").addClass("error"),void t.text("两次输入的密码不一样")):void($(".old-password-box").hasClass("hidden")?$.ajax({type:"post",url:"/setting/updatePassword",data:{password:$.md5($("#newpwd").val()),xsrf_token:$.getCookie("qy_xsrf_cookie")},success:function(e){"1"==e.status?($.message({msg:"保存成功。"}),$(".password-box-default .password-do").text("修改"),$(".password-box-next .old-password-box").removeClass("hidden"),$(".password-box-default").removeClass("hidden"),$(".password-box-next").addClass("hidden")):t.text("保存失败")}}):$.ajax({type:"post",url:"/setting/modifyPassword",data:{oldpwd:$.md5($("#oldpwd").val()),newpwd:$.md5($("#newpwd").val()),newpwd2:$.md5($("#newpwd2").val()),xsrf_token:$.getCookie("qy_xsrf_cookie")},success:function(e){"1"==e.status?($.message({msg:"保存成功。"}),$(".password-box-default").removeClass("hidden"),$(".password-box-next").addClass("hidden")):($("#oldpwd").addClass("error"),t.text("原密码不正确"))}})):($("#oldpwd").addClass("error"),void t.text("密码不能为空"))}),$("#bindAccountForm .password-do").on("click",function(){$.get("/setting/getSecurityStatus",function(e){if("1"==e.data.flag){s="password",$("#verifyTemp .email-opt").empty().addClass("hidden"),$("#verifyTemp .phone-opt").empty().addClass("hidden");var t="使用邮箱 "+a.text()+" 进行验证",o="使用手机号 "+i.text()+" 进行验证";""!=a.text()&&$("#verifyTemp .email-opt").text(t).removeClass("hidden"),""!=i.text()&&$("#verifyTemp .phone-opt").text(o).removeClass("hidden"),$("#verifyTemp").find(".m-mask").show(),$("#verifyTemp").find(".m-verify").show()}else{if($(".password-do").hasClass("unBinding"))return void $.message({msg:"请先绑定手机号或邮箱。"});$(".password-do").hasClass("hasPass")||$(".password-box-next").find(".old-password-box").addClass("hidden"),$(".password-box-default").addClass("hidden"),$(".password-box-next").removeClass("hidden")}})})}),$("#verifyTemp .btn-primary").on("click",function(){$("#verifyTemp #endMsg").empty(),$("select.change-box").css("border-color","#ccc"),$("#verifyTemp .code-input").removeClass("error");var e=$("#verifyTemp .code-input").val();return"0"==$("select.change-box").val()?($("#verifyTemp #endMsg").html("请选择验证方式"),void $("select.change-box").css("border-color","red")):""==e?($("#verifyTemp #endMsg").html("验证码不能为空"),void $("#verifyTemp .code-input").addClass("error")):void $.post("/setting/checkSecurityCode",{code:e,xsrf_token:$.getCookie("qy_xsrf_cookie")},function(e){"1"==e.status?(p(s,!0),"weibo"==s?$(".weibo-box .box-do").trigger("click"):"qq"==s?$(".qq-box .box-do").trigger("click"):"wechat"==s&&$(".wechat-box .box-do").trigger("click")):$("#verifyTemp #endMsg").html("验证码有误")})}),$(".send-code").on("click",function(){var o=$(this),t=$(this).parent().parent().find("#endMsg");if(t.empty(),$("#email,#phone").removeClass("error"),o.hasClass("update-email")){var n=$("#email").val();if(!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(n))return $("#email").addClass("error"),t.text("邮箱格式不正确"),void"false";$.post("/user/checkEmailUsed",{email:n,xsrf_token:$.getCookie("qy_xsrf_cookie")},function(e){if(console.log(e),"1"!=e.status)return $("#email").addClass("error"),t.text("该邮箱已被使用"),void"false";$.post("/setting/sendVerifyCodeEmail",{email:n,xsrf_token:$.getCookie("qy_xsrf_cookie")},function(e){if("1"==e.status){var t=60;!function e(){0==t?(o.removeAttr("disabled").val("获取验证码").css("color","#259"),o.parent().find(".code-input").attr("placeholder","点击右侧发送验证码"),t=60):(o.attr("disabled",!0).val(t+"秒后，重新获取").css("color","#aaa"),o.parent().find(".code-input").attr("placeholder","请输入收到的验证码"),t--,setTimeout(function(){e()},1e3))}()}})})}else if(o.hasClass("update-phone")){var a=$("#phone").val();if(!/^1\d{10}$/.test(a))return $("#phone").addClass("error"),t.text("手机格式不正确"),void"false";$.post("/user/checkPhoneUsed",{phone:a,xsrf_token:$.getCookie("qy_xsrf_cookie")},function(e){if("1"!=e.status)return $("#phone").addClass("error"),void t.text("该手机已被使用");$.post("/setting/sendVerifyCodeMessage",{phone:a,xsrf_token:$.getCookie("qy_xsrf_cookie")},function(e){if("1"==e.status){var t=60;!function e(){0==t?(o.removeAttr("disabled").val("获取验证码").css("color","#259"),o.parent().find(".code-input").attr("placeholder","点击右侧发送验证码"),t=60):(o.attr("disabled",!0).val(t+"秒后，重新获取").css("color","#aaa"),o.parent().find(".code-input").attr("placeholder","请输入收到的验证码"),t--,setTimeout(function(){e()},1e3))}()}})})}else{$("select.change-box").css("border-color","#ccc");var e=$("select.change-box").val();if("email"==e)url="/setting/sendSecurityCodeEmail";else if("phone"==e)url="/setting/sendSecurityCodeMessage";else if("0"==e)return $("select.change-box").css("border-color","red"),void"false";$.get(url,function(e){if("1"==e.status){var t=60;!function e(){0==t?(o.removeAttr("disabled").val("获取验证码").css("color","#259"),o.parent().find(".code-input").attr("placeholder","点击右侧发送验证码"),t=60):(o.attr("disabled",!0).val(t+"秒后，重新获取").css("color","#aaa"),o.parent().find(".code-input").attr("placeholder","请输入收到的验证码"),t--,setTimeout(function(){e()},1e3))}()}})}}),$("#bindAccountForm .btn-primary").on("click",function(){var t=$(this).parent().find("#endMsg");if(t.empty(),$(this).hasClass("phone-commit")){var o=$("#phone").val(),e=$(".phone-box-next .code-input").val();""==o||""==e?t.text("手机号或验证码不能为空"):$.post("/setting/updatePhone",{phone:o,code:e,xsrf_token:$.getCookie("qy_xsrf_cookie")},function(e){"1"==e.status?($(".phone-box-default .box-do").text("修改").addClass("hasValue"),$(".phone-box-default").removeClass("hidden").find(".box-value").text(o),$(".phone-box-next").addClass("hidden"),$("#bindAccountForm .password-do").removeClass("unBinding")):"ERR26"==e.msg?t.text("验证码不正确"):"ERR3"==e.msg&&t.text("该手机号已存在")})}else if($(this).hasClass("email-commit")){var n=$("#email").val();e=$(".email-box-next .code-input").val();""==n||""==e?t.text("邮箱或验证码不能为空"):$.post("/setting/updateEmail",{email:n,code:e,xsrf_token:$.getCookie("qy_xsrf_cookie")},function(e){"1"==e.status?($(".email-box-default .box-do").text("修改").addClass("hasValue"),$(".email-box-default").removeClass("hidden").find(".box-value").text(n),$(".email-box-next").addClass("hidden"),$("#bindAccountForm .password-do").removeClass("unBinding")):"ERR26"==e.msg?t.text("验证码不正确"):"ERR3"==e.msg&&t.text("该邮箱已存在")})}}),$("#verifyTemp .btn-close").on("click",function(){$("#verifyTemp").find(".m-mask").hide(),$("#verifyTemp").find(".m-verify").hide()}),$("#baseInfoBtn").on("click",function(){if(!a($("#nickname"))||200<$("#signature").val().length)return!1;$.ajax({type:"post",url:"/setting/modifyUserInfo",data:{nickname:$("#nickname").val(),provinceid:$("#provinceid").val(),cityid:$("#cityid").val(),signature:$("#signature").val(),sex:$("#sex").val(),signature:$("#signature").val(),xsrf_token:$.getCookie("qy_xsrf_cookie")},success:function(e){"1"==e.status?($.message({msg:"保存成功。"}),$("#userInfo .user-name").html($("#nickname").val())):$.message({msg:e.other.desc||"保存失败。"})}})})}),jQuery.extend({handleError:function(e,t,o,n){e.error&&e.error.call(e.context||e,t,o,n),e.global&&(e.context?jQuery(e.context):jQuery.event).trigger("ajaxError",[t,e,n])},createUploadIframe:function(e,t){var o="jUploadFrame"+e,n='<iframe id="'+o+'" name="'+o+'" style="position:absolute; top:-9999px; left:-9999px"';return window.ActiveXObject&&("boolean"==typeof t?n+=' src="javascript:false"':"string"==typeof t&&(n+=' src="'+t+'"')),n+=" />",jQuery(n).appendTo(document.body),jQuery("#"+o).get(0)},createUploadForm:function(e,t){var o="jUploadForm"+e,n="jUploadFile"+e,a=jQuery('<form  action="" method="POST" name="'+o+'" id="'+o+'" enctype="multipart/form-data"></form>'),i=jQuery("#"+t),r=jQuery(i).clone();return jQuery(i).attr("id",n),jQuery(i).before(r),jQuery(i).appendTo(a),jQuery(a).css("position","absolute"),jQuery(a).css("top","-1200px"),jQuery(a).css("left","-1200px"),jQuery(a).appendTo("body"),a},ajaxFileUpload:function(a){a=jQuery.extend({},jQuery.ajaxSettings,a);var e=(new Date).getTime(),i=jQuery.createUploadForm(e,a.fileElementId),r=(jQuery.createUploadIframe(e,a.secureuri),"jUploadFrame"+e),t="jUploadForm"+e;a.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var s=!1,d={};a.global&&jQuery.event.trigger("ajaxSend",[d,a]);var o=function(e){var t=document.getElementById(r);try{t.contentWindow?(d.responseText=t.contentWindow.document.body?t.contentWindow.document.body.innerHTML:null,d.responseXML=t.contentWindow.document.XMLDocument?t.contentWindow.document.XMLDocument:t.contentWindow.document):t.contentDocument&&(d.responseText=t.contentDocument.document.body?t.contentDocument.document.body.innerHTML:null,d.responseXML=t.contentDocument.document.XMLDocument?t.contentDocument.document.XMLDocument:t.contentDocument.document)}catch(e){jQuery.handleError(a,d,null,e)}if(d||"timeout"==e){var o;s=!0;try{if("error"!=(o="timeout"!=e?"success":"error")){var n=jQuery.uploadHttpData(d,a.dataType);a.success&&a.success(n,o),a.global&&jQuery.event.trigger("ajaxSuccess",[d,a])}else jQuery.handleError(a,d,o)}catch(e){o="error",jQuery.handleError(a,d,o,e)}a.global&&jQuery.event.trigger("ajaxComplete",[d,a]),a.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),a.complete&&a.complete(d,o),jQuery(t).unbind(),setTimeout(function(){try{jQuery(t).remove(),jQuery(i).remove()}catch(e){jQuery.handleError(a,d,null,e)}},100),d=null}};0<a.timeout&&setTimeout(function(){s||o("timeout")},a.timeout);try{i=jQuery("#"+t);jQuery(i).attr("action",a.url),jQuery(i).attr("method","POST"),jQuery(i).attr("target",r),i.encoding?jQuery(i).attr("encoding","multipart/form-data"):jQuery(i).attr("enctype","multipart/form-data"),jQuery(i).submit()}catch(e){jQuery.handleError(a,d,null,e)}return jQuery("#"+r).load(o),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;return data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type&&eval("data = "+data),"html"==type&&jQuery("<div>").html(data).evalScripts(),data}})(function(ae){ae.Jcrop=function(e,t){var c,b=ae.extend({},ae.Jcrop.defaults),o=navigator.userAgent.toLowerCase(),n=/msie/.test(o),a=/msie [1-6]\./.test(o);function m(e){return Math.round(e)+"px"}function g(e){return b.baseClass+"-"+e}function l(e){var t=ae(e).offset();return[t.left,t.top]}function u(e){return[e.pageX-c[0],e.pageY-c[1]]}function i(e){"object"!=typeof e&&(e={}),b=ae.extend(b,e),ae.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof b[t]&&(b[t]=function(){})})}function r(e,t,o){if(c=l(j),V.setCursor("move"===e?e:e+"-resize"),"move"===e)return V.activateHandlers((n=t,N.watchKeys(),function(e){W.moveOffset([e[0]-n[0],e[1]-n[1]]),n=e,K.update()}),h,o);var n,a,i,r=W.getFixed(),s=p(e),d=W.getCorner(p(s));W.setPressed(W.getCorner(s)),W.setCurrent(d),V.activateHandlers((a=e,i=r,function(e){if(b.aspectRatio)switch(a){case"e":case"w":e[1]=i.y+1;break;case"n":case"s":e[0]=i.x+1}else switch(a){case"e":case"w":e[1]=i.y2;break;case"n":case"s":e[0]=i.x2}W.setCurrent(e),K.update()}),h,o)}function p(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function v(t){return function(e){return b.disabled||("move"!==t||b.allowMove)&&(c=l(j),P=!0,r(t,u(e)),e.stopPropagation(),e.preventDefault()),!1}}function s(e,t,o){var n=e.width(),a=e.height();t<n&&0<t&&(a=(n=t)/e.width()*e.height()),o<a&&0<o&&(n=(a=o)/e.height()*e.width()),I=e.width()/n,E=e.height()/a,e.width(n).height(a)}function y(e){return{x:e.x*I,y:e.y*E,x2:e.x2*I,y2:e.y2*E,w:e.w*I,h:e.h*E}}function h(e){var t=W.getFixed();t.w>b.minSelect[0]&&t.h>b.minSelect[1]?(K.enableHandles(),K.done()):K.release(),V.setCursor(b.allowSelect?"crosshair":"default")}function d(e){if(b.disabled)return!1;if(!b.allowSelect)return!1;P=!0,c=l(j),K.disableHandles(),V.setCursor("crosshair");var t=u(e);return W.setPressed(t),K.update(),V.activateHandlers(f,h,"touch"===e.type.substring(0,5)),N.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function f(e){W.setCurrent(e),K.update()}function x(){var e=ae("<div></div>").addClass(g("tracker"));return n&&e.css({opacity:0,backgroundColor:"white"}),e}"object"!=typeof e&&(e=ae(e)[0]),"object"!=typeof t&&(t={}),i(t);var $={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},w=ae(e),C=!0;if("IMG"==e.tagName){if(0!=w[0].width&&0!=w[0].height)w.width(w[0].width),w.height(w[0].height);else{var k=new Image;k.src=w[0].src,w.width(k.width),w.height(k.height)}var j=w.clone().removeAttr("id").css($).show();j.width(w.width()),j.height(w.height()),w.after(j).hide()}else j=w.css($).show(),C=!1,null===b.shade&&(b.shade=!0);s(j,b.boxWidth,b.boxHeight);var T=j.width(),S=j.height(),_=ae("<div />").width(T).height(S).addClass(g("holder")).css({position:"relative",backgroundColor:b.bgColor}).insertAfter(w).append(j);b.addClass&&_.addClass(b.addClass);var M=ae("<div />"),A=ae("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),Q=ae("<div />").width("100%").height("100%").css("zIndex",320),F=ae("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=W.getFixed();b.onDblClick.call(ne,e)}).insertBefore(j).append(A,Q);C&&(M=ae("<img />").attr("src",j.attr("src")).css($).width(T).height(S),A.append(M)),a&&F.css({overflowY:"hidden"});var O,z,q,D,I,E,P,H,B=b.boundary,R=x().width(T+2*B).height(S+2*B).css({position:"absolute",top:m(-B),left:m(-B),zIndex:290}).mousedown(d),U=b.bgColor,J=b.bgOpacity;c=l(j);var L=function(){function e(){var e,t={},o=["touchstart","touchmove","touchend"],n=document.createElement("div");try{for(e=0;e<o.length;e++){var a=o[e],i=(a="on"+a)in n;i||(n.setAttribute(a,"return;"),i="function"==typeof n[a]),t[o[e]]=i}return t.touchstart&&t.touchend&&t.touchmove}catch(e){return!1}}return{createDragger:function(t){return function(e){return b.disabled||("move"!==t||b.allowMove)&&(c=l(j),P=!0,r(t,u(L.cfilter(e)),!0),e.stopPropagation(),e.preventDefault()),!1}},newSelection:function(e){return d(L.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:!0===b.touchSupport||!1===b.touchSupport?b.touchSupport:e()}}(),W=function(){var t,o,p=0,h=0,f=0,m=0;function n(){if(!b.aspectRatio)return function(){var e,t=f-p,o=m-h;O&&Math.abs(t)>O&&(f=0<t?p+O:p-O);z&&Math.abs(o)>z&&(m=0<o?h+z:h-z);D/E&&Math.abs(o)<D/E&&(m=0<o?h+D/E:h-D/E);q/I&&Math.abs(t)<q/I&&(f=0<t?p+q/I:p-q/I);p<0&&(f-=p,p-=p);h<0&&(m-=h,h-=h);f<0&&(p-=f,f-=f);m<0&&(h-=m,m-=m);T<f&&(p-=e=f-T,f-=e);S<m&&(h-=e=m-S,m-=e);T<p&&(m-=e=p-S,h-=e);S<h&&(m-=e=h-S,h-=e);return v(g(p,h,f,m))}();var e,t,o,n,a=b.aspectRatio,i=b.minSize[0]/I,r=b.maxSize[0]/I,s=b.maxSize[1]/E,d=f-p,c=m-h,l=Math.abs(d),u=Math.abs(c);return 0===r&&(r=10*T),0===s&&(s=10*S),l/u<a?(t=m,o=u*a,(e=d<0?p-o:o+p)<0?(e=0,n=Math.abs((e-p)/a),t=c<0?h-n:n+h):T<e&&(e=T,n=Math.abs((e-p)/a),t=c<0?h-n:n+h)):(e=f,n=l/a,(t=c<0?h-n:h+n)<0?(t=0,o=Math.abs((t-h)*a),e=d<0?p-o:o+p):S<t&&(t=S,o=Math.abs(t-h)*a,e=d<0?p-o:o+p)),p<e?(e-p<i?e=p+i:r<e-p&&(e=p+r),t=h<t?h+(e-p)/a:h-(e-p)/a):e<p&&(p-e<i?e=p-i:r<p-e&&(e=p-r),t=h<t?h+(p-e)/a:h-(p-e)/a),e<0?(p-=e,e=0):T<e&&(p-=e-T,e=T),t<0?(h-=t,t=0):S<t&&(h-=t-S,t=S),v(g(p,h,e,t))}function a(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>T&&(e[0]=T),e[1]>S&&(e[1]=S),[Math.round(e[0]),Math.round(e[1])]}function g(e,t,o,n){var a=e,i=o,r=t,s=n;return o<e&&(a=o,i=e),n<t&&(r=n,s=t),[a,r,i,s]}function v(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}return{flipCoords:g,setPressed:function(e){e=a(e),f=p=e[0],m=h=e[1]},setCurrent:function(e){e=a(e),t=e[0]-f,o=e[1]-m,f=e[0],m=e[1]},getOffset:function(){return[t,o]},moveOffset:function(e){var t=e[0],o=e[1];p+t<0&&(t-=t+p),h+o<0&&(o-=o+h),S<m+o&&(o+=S-(m+o)),T<f+t&&(t+=T-(f+t)),p+=t,f+=t,h+=o,m+=o},getCorner:function(e){var t=n();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}},getFixed:n}}(),X=function(){var o=!1,n=ae("<div />").css({position:"absolute",zIndex:240,opacity:0}),a={top:i(),left:i().height(S),right:i().height(S),bottom:i()};function e(){return t(W.getFixed())}function t(e){a.top.css({left:m(e.x),width:m(e.w),height:m(e.y)}),a.bottom.css({top:m(e.y2),left:m(e.x),width:m(e.w),height:m(S-e.y2)}),a.right.css({left:m(e.x2),width:m(T-e.x2)}),a.left.css({width:m(e.x)})}function i(){return ae("<div />").css({position:"absolute",backgroundColor:b.shadeColor||b.bgColor}).appendTo(n)}function r(){o||(o=!0,n.insertBefore(j),e(),K.setBgOpacity(1,0,1),M.hide(),s(b.shadeColor||b.bgColor,1),K.isAwake()?c(b.bgOpacity,1):c(1,1))}function s(e,t){te(l(),e,t)}function d(){o&&(n.remove(),M.show(),o=!1,K.isAwake()?K.setBgOpacity(b.bgOpacity,1,1):(K.setBgOpacity(1,1,1),K.disableHandles()),te(_,0,1))}function c(e,t){o&&(b.bgFade&&!t?n.animate({opacity:1-e},{queue:!1,duration:b.fadeTime}):n.css({opacity:1-e}))}function l(){return n.children()}return{update:e,updateRaw:t,getShades:l,setBgColor:s,enable:r,disable:d,resize:function(e,t){a.left.css({height:m(t)}),a.right.css({height:m(t)})},refresh:function(){b.shade?r():d(),K.isAwake()&&c(b.bgOpacity)},opacity:c}}(),K=function(){var r,i=370,s={},d={},o={},e=!1;function c(e,t){var o=ae("<div />").mousedown(v(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return L.support&&o.bind("touchstart.jcrop",L.createDragger(e)),Q.append(o),o}function t(){var e=W.getFixed();W.setPressed([e.x,e.y]),W.setCurrent([e.x2,e.y2]),n()}function n(e){if(r)return a(e)}function a(e){var t,o,n,a,i=W.getFixed();t=i.w,o=i.h,F.width(Math.round(t)).height(Math.round(o)),n=i.x,a=i.y,b.shade||M.css({top:m(-a),left:m(-n)}),F.css({top:m(a),left:m(n)}),b.shade&&X.updateRaw(i),r||function(){F.show(),b.shade?X.opacity(J):l(J,!0);r=!0}(),e?b.onSelect.call(ne,y(i)):b.onChange.call(ne,y(i))}function l(e,t,o){(r||t)&&(b.bgFade&&!o?j.animate({opacity:e},{queue:!1,duration:b.fadeTime}):j.css("opacity",e))}function u(){if(e=!0,b.allowResize)return Q.show(),!0}function p(){e=!1,Q.hide()}function h(e){e?(H=!0,p()):(H=!1,u())}b.dragEdges&&ae.isArray(b.createDragbars)&&function(e){var t;for(t=0;t<e.length;t++)o[e[t]]=c(e[t],i++).addClass("jcrop-dragbar")}(b.createDragbars),ae.isArray(b.createHandles)&&function(e){var t,o,n,a;for(t=0;t<e.length;t++)d[e[t]]=(o=e[t],a=void 0,n=b.handleSize,a=c(o,i++).css({opacity:b.handleOpacity}).addClass(g("handle")),n&&a.width(n).height(n),a)}(b.createHandles),b.drawBorders&&ae.isArray(b.createBorders)&&function(e){var t,o,n,a;for(o=0;o<e.length;o++){switch(e[o]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}s[e[o]]=(n=t,a=ae("<div />").css({position:"absolute",opacity:b.borderOpacity}).addClass(g(n)),A.append(a),a)}}(b.createBorders),ae(document).bind("touchstart.jcrop-ios",function(e){ae(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var f=x().mousedown(v("move")).css({cursor:"move",position:"absolute",zIndex:360});return L.support&&f.bind("touchstart.jcrop",L.createDragger("move")),A.append(f),p(),{updateVisible:n,update:a,release:function(){p(),F.hide(),b.shade?X.opacity(1):l(1),r=!1,b.onRelease.call(ne)},refresh:t,isAwake:function(){return r},setCursor:function(e){f.css("cursor",e)},enableHandles:u,enableOnly:function(){e=!0},showHandles:function(){e&&Q.show()},disableHandles:p,animMode:h,setBgOpacity:l,done:function(){h(!1),t()}}}(),V=function(){var a=function(){},i=function(){},r=b.trackDocument;function s(e){return a(u(e)),!1}function d(e){return e.preventDefault(),e.stopPropagation(),P&&(P=!1,i(u(e)),K.isAwake()&&b.onSelect.call(ne,y(W.getFixed())),R.css({zIndex:290}),ae(document).unbind(".jcrop"),a=function(){},i=function(){}),!1}function c(e){return a(u(L.cfilter(e))),!1}function l(e){return d(L.cfilter(e))}return r||R.mousemove(s).mouseup(d).mouseout(d),j.before(R),{activateHandlers:function(e,t,o){var n;return P=!0,a=e,i=t,n=o,R.css({zIndex:450}),n?ae(document).bind("touchmove.jcrop",c).bind("touchend.jcrop",l):r&&ae(document).bind("mousemove.jcrop",s).bind("mouseup.jcrop",d),!1},setCursor:function(e){R.css("cursor",e)}}}(),N=function(){var t=ae('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),e=ae("<div />").css({position:"absolute",overflow:"hidden"}).append(t);function o(e,t,o){b.allowMove&&(W.moveOffset([t,o]),K.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}return b.keySupport&&(t.keydown(function(e){if(e.ctrlKey||e.metaKey)return!0;var t=!!e.shiftKey?10:1;switch(e.keyCode){case 37:o(e,-t,0);break;case 39:o(e,t,0);break;case 38:o(e,0,-t);break;case 40:o(e,0,t);break;case 27:b.allowSelect&&K.release();break;case 9:return!0}return!1}).blur(function(e){t.hide()}),a||!b.fixedSupport?(t.css({position:"absolute",left:"-20px"}),e.append(t).insertBefore(j)):t.insertBefore(j)),{watchKeys:function(){b.keySupport&&(t.show(),t.focus())}}}();function Y(e){Z([e[0]/I,e[1]/E,e[2]/I,e[3]/E]),b.onSelect.call(ne,y(W.getFixed())),K.enableHandles()}function Z(e){W.setPressed([e[0],e[1]]),W.setCurrent([e[2],e[3]]),K.update()}function G(){b.disabled=!0,K.disableHandles(),K.setCursor("default"),V.setCursor("default")}function ee(){b.disabled=!1,oe()}function te(e,t,o){var n=t||b.bgColor;b.bgFade&&ae.fx.step.hasOwnProperty("backgroundColor")&&b.fadeTime&&!o?e.animate({backgroundColor:n},{queue:!1,duration:b.fadeTime}):e.css("backgroundColor",n)}function oe(e){b.allowResize?e?K.enableOnly():K.enableHandles():K.disableHandles(),V.setCursor(b.allowSelect?"crosshair":"default"),K.setCursor(b.allowMove?"move":"default"),b.hasOwnProperty("trueSize")&&(I=b.trueSize[0]/T,E=b.trueSize[1]/S),b.hasOwnProperty("setSelect")&&(Y(b.setSelect),K.done(),delete b.setSelect),X.refresh(),b.bgColor!=U&&(te(b.shade?X.getShades():_,b.shade&&b.shadeColor||b.bgColor),U=b.bgColor),J!=b.bgOpacity&&(J=b.bgOpacity,b.shade?X.refresh():K.setBgOpacity(J)),O=b.maxSize[0]||0,z=b.maxSize[1]||0,q=b.minSize[0]||0,D=b.minSize[1]||0,b.hasOwnProperty("outerImage")&&(j.attr("src",b.outerImage),delete b.outerImage),K.refresh()}L.support&&R.bind("touchstart.jcrop",L.newSelection),Q.hide(),oe(!0);var ne={setImage:function(a,i){K.release(),G();var r=new Image;r.onload=function(){var e=r.width,t=r.height,o=b.boxWidth,n=b.boxHeight;j.width(e).height(t),j.attr("src",a),M.attr("src",a),s(j,o,n),T=j.width(),S=j.height(),M.width(T).height(S),R.width(T+2*B).height(S+2*B),_.width(T).height(S),X.resize(T,S),ee(),"function"==typeof i&&i.call(ne)},r.src=a},animateTo:function(e,t){var o=e[0]/I,n=e[1]/E,a=e[2]/I,i=e[3]/E;if(!H){var r=W.flipCoords(o,n,a,i),s=W.getFixed(),d=[s.x,s.y,s.x2,s.y2],c=d,l=b.animationDelay,u=r[0]-d[0],p=r[1]-d[1],h=r[2]-d[2],f=r[3]-d[3],m=0,g=b.swingSpeed;o=c[0],n=c[1],a=c[2],i=c[3],K.animMode(!0);var v=function(){m+=(100-m)/g,c[0]=Math.round(o+m/100*u),c[1]=Math.round(n+m/100*p),c[2]=Math.round(a+m/100*h),c[3]=Math.round(i+m/100*f),99.8<=m&&(m=100),m<100?(Z(c),y()):(K.done(),K.animMode(!1),"function"==typeof t&&t.call(ne))};y()}function y(){window.setTimeout(v,l)}},setSelect:Y,setOptions:function(e){i(e),oe()},tellSelect:function(){return y(W.getFixed())},tellScaled:function(){return W.getFixed()},setClass:function(e){_.removeClass().addClass(g("holder")).addClass(e)},disable:G,enable:ee,cancel:function(){K.done(),V.activateHandlers(null,null)},release:K.release,destroy:function(){_.remove(),w.show(),w.css("visibility","visible"),ae(e).removeData("Jcrop")},focus:N.watchKeys,getBounds:function(){return[T*I,S*E]},getWidgetSize:function(){return[T,S]},getScaleFactor:function(){return[I,E]},getOptions:function(){return b},ui:{holder:_,selection:F}};return n&&_.bind("selectstart",function(){return!1}),w.data("Jcrop",ne),ne},ae.fn.Jcrop=function(e,t){var o;return this.each(function(){if(ae(this).data("Jcrop")){if("api"===e)return ae(this).data("Jcrop");ae(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?ae.Jcrop.Loader(this,function(){ae(this).css({display:"block",visibility:"hidden"}),o=ae.Jcrop(this,e),ae.isFunction(t)&&t.call(o)}):(ae(this).css({display:"block",visibility:"hidden"}),o=ae.Jcrop(this,e),ae.isFunction(t)&&t.call(o))}),this},ae.Jcrop.Loader=function(e,t,o){var n=ae(e),a=n[0];n.bind("load.jcloader",function e(){a.complete?(n.unbind(".jcloader"),ae.isFunction(t)&&t.call(a)):window.setTimeout(e,50)}).bind("error.jcloader",function(e){n.unbind(".jcloader"),ae.isFunction(o)&&o.call(a)}),a.complete&&ae.isFunction(t)&&(n.unbind(".jcloader"),t.call(a))},ae.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery)),jQuery.UtrialAvatarCutter=function(a){var r,s,d,l,o,u,p,h=null,t=this,n=a.content,f=a.imgid||"img_"+(Math.random()+"").substr(3,8),m=new Array,g=null,v=null;if(a.purviews)for(i=0,c=a.purviews.length;i<c;++i)m[m.length]=a.purviews[i];check_thums_img=function(){if(a.purviews)for(i=0,c=a.purviews.length;i<c;++i)0==$("#"+a.purviews[i].id+" img").length?$("#"+a.purviews[i].id).html("<img src='"+o+"'/>"):$("#"+a.purviews[i].id+" img").attr("src",o)},this.reload=function(e){null!=e&&""!=e&&(o=e,$("#"+n).html("<img id='"+f+"' style='width:200px;height:200px;' src='"+o+"'/>"),$("#"+f).bind("load",function(){check_thums_img(),t.init()}))},$("#"+n+" img").attr("id",f);var y=function(e){if(0==e.w||0==e.h)return h.setSelect([d,l,d+s,l+r]),void h.animateTo([d,l,d+s,l+r]);for(d=e.x,l=e.y,s=e.w,r=e.h,a.showCoords&&a.showCoords.call(this,e),i=0,e=m.length;i<e;++i){var t=m[i],o=t.width/s,n=t.height/r;$("#"+t.id+" img").css({width:Math.round(o*p)+"px",height:Math.round(n*u)+"px",marginLeft:"-"+Math.round(o*d)+"px",marginTop:"-"+Math.round(n*l)+"px"})}};this.init=function(){if(null!=h&&h.destroy(),""!=(o=$("#"+n+" img").attr("src"))){for(check_thums_img(),i=0,c=m.length;i<c;++i){var e=m[i];$("#"+e.id).css({position:"relative",overflow:"hidden",height:e.height+"px",width:e.width+"px"})}u=$("#"+f).height(),p=$("#"+f).width(),g=a.selector.width,v=a.selector.height,g=Math.min(p,g),v=Math.min(u,v),d=(p-g+60)/2,l=(u-v+60)/2;var t=a.cropattrs||{};t=$.extend(t,{aspectRatio:1,onChange:y,onSelect:y}),(h=$.Jcrop($("#"+f),t)).animateTo([d,l,g-d,v-l])}},this.submit=function(){return{w:s,h:r,x:d,y:l,s:o}}};