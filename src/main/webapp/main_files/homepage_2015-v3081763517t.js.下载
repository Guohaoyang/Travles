var daodao=daodao||{};daodao.home={init:function(){ta.queueForLoad(this.loadHighResBackdrop)},loadHighResBackdrop:function(){var b=ta.id("backdrop");if(!b){return}var c=ta.retrieve("homeBackdropHighRes");if(!c){c=b.get("lazy-src")}var a=Asset.image(c,{id:"backdrop",onLoad:daodao.home.showHighResBackdrop});b.setProperty("src",a.getProperty("src"))},showHighResBackdrop:function(){new Fx.Tween(ta.id("backdrop_blur"),{duration:2000,property:"opacity"}).start(1,0);if(ta.id("backdrop_blur").src.indexOf("Marriot")>0){new Asset.image("http://ad.doubleclick.net/ad/N4764.TripAdvisor/B7873453.103157951;sz=1x1",{});new Asset.image("http://amch.questionmarket.com/adsc/d1077015/3/1085095/adscout.php?ord="+new Date().valueOf(),{})}},inputDefaultText:{hotel:"酒店名称、入住城市",restaurant:"餐馆名称",attraction:"景点名称",destination:"目的地名称"},trackFeaturedQuote:function(a,b){var e=new Event(a);var g="";if(e&&e.target){g=e.target.className}var f={headerQuoteAvatar:"Featured_Quote_Avatar",headerQuoteTitle:"Featured_Quote_Title",quoteLoc:"Featured_Quote_DestinationName"};var d="Featured_Quote_General";for(var c in f){if(g.indexOf(c)>-1){d=f[c];break}}if(b.indexOf("http")==0){ta.trackEventOnPage("Homepage_Hero_Photo","click",d,0,false)}else{ta.setEvtCookie("Homepage_Hero_Photo","click",d,0,b)}}};daodao.home.FormTab=new Class({Implements:[Events,Options],options:{triggerInput:function(a,b){a.query=b;a.focus();a.fireEvent("click")}},initialize:function(d,c,b){var d=this.radio=$(d);var e=this;if(!this.radio){return}var a=this.label=$(c);if(this.label){a.addEvent("click",function(){e.focus()})}else{d.addEvent("click",function(){e.focus()})}this.addEvent("focus",function(){this.showPanel();this.radioChecked();if(!daodao.home.isNotTheFirstClickSearchTab){daodao.home.isNotTheFirstClickSearchTab=true}else{daodao.pageAction(d.getAttribute("pageAction"))}});this.addEvent("blur",function(){this.hideForm();this.radioUnChecked()});this.setOptions(b)},focus:function(){this.fireEvent("focus")},blur:function(){this.fireEvent("blur");return this.form.getElement("input.search-input")},addDisplayForm:function(a){this.form=$(a);return this},showPanel:function(){if(this.form){this.form.setStyle("display","block")}return this},radioChecked:function(){this.label.addClass("checked")},radioUnChecked:function(){this.label.removeClass("checked")},hideForm:function(){if(this.form){this.form.setStyle("display","none")}return this},focusInput:function(){this.addEvent("focus",function(){var b=this.query;var a=this.form.getElement("input.search-input");if(b&&a&&(!a.get("value")||a.get("value").indexOf(daodao.home.inputDefaultText[a.get("name")])>=0||a.query!==b)){this.options.triggerInput.call(this,a,b)}})}});daodao.home.FormTabControler={tabs:[],focusTab:null,createTab:function(c,b,f,a){var e=new daodao.home.FormTab(c,b,a).addDisplayForm(f);this.tabs.push(e);var d=this;e.addEvent("focus",function(){if(d.focusTab!==this){if(d.focusTab){var g=d.focusTab.blur();if(g){var i=g.retrieve("typeahead")||g.retrieve("typeAhead");if(i){var h=i.query}else{var h=d.focusTab.query}if(h){this.query=h}}}d.focusTab=this}});e.focusInput();return e}};daodao.home.autoSubmit=function(c,b,a){if("HOTEL"!==a){daodao.home.isAutoSubmit=true}};window.addEvent("domready",function(a){daodao.home.init();daodao.home.FormTabControler.createTab("hotel","hotelLabel","hotelSearch").focus();daodao.home.FormTabControler.createTab("attraction","attractionlLabel","attractionSearch");daodao.home.FormTabControler.createTab("restaurant","restaurantLabel","restaurantSearch");daodao.home.FormTabControler.createTab("destination","destinationLabel","destinationSearch");ta.store("multiDP.checkOut","退房时间");ta.store("multiDP.checkIn","入住时间");ta.store("autoSelectDepart",true);ta.store("multiDP.two_field",true);ta.store("checkrates.meta_ui_sk_box_v3",true)});
var Syncro=(function(){var a=function(){this.components=[]};a.prototype.add=function(b){if(!b.sync||typeof b.sync!=="function"){throw new Error("API Error: component must implement sync(data) function.")}this.components.push(b);this.data&&b.sync(this.data)};a.prototype.sync=function(b,d){this.data=d;for(var c=this.components.length-1;c>=0;c--){this.components[c]!==b&&this.components[c].sync(d)}};return a}());
window.odometerOptions={auto:false};(function(a,c,b,d){b.commerce.odometer=function(e,t){var f=b.id(e),r,j=2000,i=0,g,s=1,n,p,l,m=0,q=0,h=0;function k(){if(o()){r=0}var u=s;var v=i>0?(Math.random()*i):0;if(v>0){u=Math.round(s*v)}if(m&&q<m){q++;h+=u}else{r+=u;if(h){r+=h}p.update(r);q=0;h=0}}function o(){var u=l&&l.getTime()<new Date().getTime();if(!l||u){l=new Date();l.setHours(24);l.setMinutes(0);l.setSeconds(0);l.setMilliseconds(0)}return u}if(t&&t.variation!==d){i=t.variation}if(t&&t.wait!==d){m=t.wait}if(f){if(!Browser.ie||Browser.version>=8){r=parseInt(f.getAttribute("data-start"),10);g=parseInt(f.getAttribute("data-interval"),10);if(g>0&&g<j){s=j/g}n=f.getAttribute("data-separator");p=new c.Odometer({el:f,value:r,duration:j,format:"("+n+"ddd)",theme:""});p.render();k();setInterval(k,j)}}}}(document,window,ta));var amdResetOldDefine=window.define;var amdResetOldRequire=window.require;window.define=window.require=undefined;
/*
odometer 0.4.6
Copyright (c) 2013 HubSpot, Inc.
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
*/
(function(){var an,am,al,ak,aj,ai,ah,ag,af,ae,ad,ac,ab,aa,Z,Y,W,U,S,Q,O,M,K,J,I,H,X,V,T,R,P,N,L=[].slice;W='<span class="odometer-value"></span>',aa='<span class="odometer-ribbon"><span class="odometer-ribbon-inner">'+W+"</span></span>",ak='<span class="odometer-digit"><span class="odometer-digit-spacer">8</span><span class="odometer-digit-inner">'+aa+"</span></span>",ah='<span class="odometer-formatting-mark"></span>',al="(,ddd).dd",ag=/^\(?([^)]*)\)?(?:(.)(d+))?$/,af=30,ai=2000,an=20,ae=2,aj=0.5,ad=1000/af,am=1000/an,Z="transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",I=document.createElement("div").style,Y=null!=I.transition||null!=I.webkitTransition||null!=I.mozTransition||null!=I.oTransition,K=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,ac=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,S=function(d){var c;return c=document.createElement("div"),c.innerHTML=d,c.children[0]},M=function(d,c){return d.className=d.className.replace(new RegExp("(^| )"+c.split(" ").join("|")+"( |$)","gi")," ")},U=function(d,c){return M(d,c),d.className+=" "+c},H=function(e,d){var f;return null!=document.createEvent?(f=document.createEvent("HTMLEvents"),f.initEvent(d,!0,!0),e.dispatchEvent(f)):void 0},O=function(){var d,c;return null!=(d=null!=(c=window.performance)?"function"==typeof c.now?c.now():void 0:void 0)?d:+new Date},J=function(d,c){return null==c&&(c=0),c?(d*=Math.pow(10,c),d+=0.5,d=Math.floor(d),d/=Math.pow(10,c)):Math.round(d)},X=function(b){return 0>b?Math.ceil(b):Math.floor(b)},Q=function(b){return b-J(b)},T=!1,(V=function(){var g,f,j,i,h;if(!T&&null!=window.jQuery){for(T=!0,i=["html","text"],h=[],f=0,j=i.length;j>f;f++){g=i[f],h.push(function(d){var c;return c=window.jQuery.fn[d],window.jQuery.fn[d]=function(b){var e;return null==b||null==(null!=(e=this[0])?e.odometer:void 0)?c.apply(this,arguments):this[0].odometer.update(b)}}(g))}return h}})(),setTimeout(V,0),ab=function(){function b(z){var y,x,w,v,u,t,s,r,k,j,f=this;if(this.options=z,this.el=this.options.el,null!=this.el.odometer){return this.el.odometer}this.el.odometer=this,r=b.options;for(x in r){v=r[x],null==this.options[x]&&(this.options[x]=v)}null==(u=this.options).duration&&(u.duration=ai),this.MAX_VALUES=this.options.duration/ad/ae|0,this.resetFormat(),this.value=this.cleanValue(null!=(k=this.options.value)?k:""),this.renderInside(),this.render();try{for(j=["innerHTML","innerText","textContent"],t=0,s=j.length;s>t;t++){w=j[t],null!=this.el[w]&&!function(c){return Object.defineProperty(f.el,c,{get:function(){var d;return"innerHTML"===c?f.inside.outerHTML:null!=(d=f.inside.innerText)?d:f.inside.textContent},set:function(d){return f.update(d)}})}(w)}}catch(a){y=a,this.watchForMutations()}}return b.prototype.renderInside=function(){return this.inside=document.createElement("div"),this.inside.className="odometer-inside",this.el.innerHTML="",this.el.appendChild(this.inside)},b.prototype.watchForMutations=function(){var e,d=this;if(null!=ac){try{return null==this.observer&&(this.observer=new ac(function(){var c;return c=d.el.innerText,d.renderInside(),d.render(d.value),d.update(c)})),this.watchMutations=!0,this.startWatchingMutations()}catch(f){e=f}}},b.prototype.startWatchingMutations=function(){return this.watchMutations?this.observer.observe(this.el,{childList:!0}):void 0},b.prototype.stopWatchingMutations=function(){var c;return null!=(c=this.observer)?c.disconnect():void 0},b.prototype.cleanValue=function(d){var c;return"string"==typeof d&&(d=d.replace(null!=(c=this.format.radix)?c:".","<radix>"),d=d.replace(/[.,]/g,""),d=d.replace("<radix>","."),d=parseFloat(d,10)||0),J(d,this.format.precision)},b.prototype.bindTransitionEnd=function(){var i,h,n,m,l,k,j=this;if(!this.transitionEndBound){for(this.transitionEndBound=!0,h=!1,l=Z.split(" "),k=[],n=0,m=l.length;m>n;n++){i=l[n],k.push(this.el.addEventListener(i,function(){return h?!0:(h=!0,setTimeout(function(){return j.render(),h=!1,H(j.el,"odometerdone")},0),!0)},!1))}return k}},b.prototype.resetFormat=function(){var h,c,p,o,n,m,l,k;if(h=null!=(l=this.options.format)?l:al,h||(h="d"),p=ag.exec(h),!p){throw new Error("Odometer: Unparsable digit format")}return k=p.slice(1,4),m=k[0],n=k[1],c=k[2],o=(null!=c?c.length:void 0)||0,this.format={repeating:m,radix:n,precision:o}},b.prototype.render=function(z){var y,x,w,v,u,t,s,r,q,p,o,n;for(null==z&&(z=this.value),this.stopWatchingMutations(),this.resetFormat(),this.inside.innerHTML="",t=this.options.theme,y=this.el.className.split(" "),u=[],r=0,p=y.length;p>r;r++){x=y[r],x.length&&((v=/^odometer-theme-(.+)$/.exec(x))?t=v[1]:/^odometer(-|$)/.test(x)||u.push(x))}for(u.push("odometer"),Y||u.push("odometer-no-transitions"),u.push(t?"odometer-theme-"+t:"odometer-auto-theme"),this.el.className=u.join(" "),this.ribbons={},this.digits=[],s=!this.format.precision||!Q(z)||!1,n=z.toString().split("").reverse(),q=0,o=n.length;o>q;q++){w=n[q],"."===w&&(s=!0),this.addDigit(w,s)}return this.startWatchingMutations()},b.prototype.update=function(e){var d,f=this;return e=this.cleanValue(e),(d=e-this.value)?(M(this.el,"odometer-animating-up odometer-animating-down odometer-animating"),d>0?U(this.el,"odometer-animating-up"):U(this.el,"odometer-animating-down"),this.stopWatchingMutations(),this.animate(e),this.startWatchingMutations(),setTimeout(function(){return f.el.offsetHeight,U(f.el,"odometer-animating")},0),this.value=e):void 0},b.prototype.renderDigit=function(){return S(ak)},b.prototype.insertDigit=function(d,c){return null!=c?this.inside.insertBefore(d,c):this.inside.children.length?this.inside.insertBefore(d,this.inside.children[0]):this.inside.appendChild(d)},b.prototype.addSpacer=function(f,e,h){var g;return g=S(ah),g.innerHTML=f,h&&U(g,h),this.insertDigit(g,e)},b.prototype.addDigit=function(h,g){var l,k,j,i;if(null==g&&(g=!0),"-"===h){return this.addSpacer(h,null,"odometer-negation-mark")}if("."===h){return this.addSpacer(null!=(i=this.format.radix)?i:".",null,"odometer-radix-mark")}if(g){for(j=!1;;){if(!this.format.repeating.length){if(j){throw new Error("Bad odometer format without digits")}this.resetFormat(),j=!0}if(l=this.format.repeating[this.format.repeating.length-1],this.format.repeating=this.format.repeating.substring(0,this.format.repeating.length-1),"d"===l){break}this.addSpacer(l)}}return k=this.renderDigit(),k.querySelector(".odometer-value").innerHTML=h,this.digits.push(k),this.insertDigit(k)},b.prototype.animate=function(c){return Y&&"count"!==this.options.animation?this.animateSlide(c):this.animateCount(c)},b.prototype.animateCount=function(i){var o,n,m,l,k,j=this;if(n=+i-this.value){return l=m=O(),o=this.value,(k=function(){var d,c,a;return O()-l>j.options.duration?(j.value=i,j.render(),void H(j.el,"odometerdone")):(d=O()-m,d>am&&(m=O(),a=d/j.options.duration,c=n*a,o+=c,j.render(Math.round(o))),null!=K?K(k):setTimeout(k,am))})()}},b.prototype.getDigitCount=function(){var h,g,l,k,j,i;for(k=1<=arguments.length?L.call(arguments,0):[],h=j=0,i=k.length;i>j;h=++j){l=k[h],k[h]=Math.abs(l)}return g=Math.max.apply(Math,k),Math.ceil(Math.log(g+1)/Math.log(10))},b.prototype.getFractionalDigitCount=function(){var i,h,n,m,l,k,j;for(l=1<=arguments.length?L.call(arguments,0):[],h=/^\-?\d*\.(\d*?)0*$/,i=k=0,j=l.length;j>k;i=++k){m=l[i],l[i]=m.toString(),n=h.exec(l[i]),l[i]=null==n?0:n[1].length}return Math.max.apply(Math,l)},b.prototype.resetDigits=function(){return this.digits=[],this.ribbons=[],this.inside.innerHTML="",this.resetFormat()},b.prototype.animateSlide=function(aL){var aK,aJ,aI,aH,aG,aF,aE,aD,aC,aB,aA,az,ay,ax,aw,at,aq,ao,G,F,A,r,e,av,au,ar,ap;if(at=this.value,aD=this.getFractionalDigitCount(at,aL),aD&&(aL*=Math.pow(10,aD),at*=Math.pow(10,aD)),aI=aL-at){for(this.bindTransitionEnd(),aH=this.getDigitCount(at,aL),aG=[],aK=0,aA=G=0;aH>=0?aH>G:G>aH;aA=aH>=0?++G:--G){if(aq=X(at/Math.pow(10,aH-aA-1)),aE=X(aL/Math.pow(10,aH-aA-1)),aF=aE-aq,Math.abs(aF)>this.MAX_VALUES){for(aB=[],az=aF/(this.MAX_VALUES+this.MAX_VALUES*aK*aj),aJ=aq;aF>0&&aE>aJ||0>aF&&aJ>aE;){aB.push(Math.round(aJ)),aJ+=az}aB[aB.length-1]!==aE&&aB.push(aE),aK++}else{aB=function(){ap=[];for(var c=aq;aE>=aq?aE>=c:c>=aE;aE>=aq?c++:c--){ap.push(c)}return ap}.apply(this)}for(aA=F=0,r=aB.length;r>F;aA=++F){aC=aB[aA],aB[aA]=Math.abs(aC%10)}aG.push(aB)}for(this.resetDigits(),ar=aG.reverse(),aA=A=0,e=ar.length;e>A;aA=++A){for(aB=ar[aA],this.digits[aA]||this.addDigit(" ",aA>=aD),null==(ao=this.ribbons)[aA]&&(ao[aA]=this.digits[aA].querySelector(".odometer-ribbon-inner")),this.ribbons[aA].innerHTML="",0>aI&&(aB=aB.reverse()),ay=au=0,av=aB.length;av>au;ay=++au){aC=aB[ay],aw=document.createElement("div"),aw.className="odometer-value",aw.innerHTML=aC,this.ribbons[aA].appendChild(aw),ay===aB.length-1&&U(aw,"odometer-last-value"),0===ay&&U(aw,"odometer-first-value")}}return 0>aq&&this.addDigit("-"),ax=this.inside.querySelector(".odometer-radix-mark"),null!=ax&&ax.parent.removeChild(ax),aD?this.addSpacer(this.format.radix,this.digits[aD-1],"odometer-radix-mark"):void 0}},b}(),ab.options=null!=(P=window.odometerOptions)?P:{},setTimeout(function(){var g,f,j,i,h;if(window.odometerOptions){i=window.odometerOptions,h=[];for(g in i){f=i[g],h.push(null!=(j=ab.options)[g]?(j=ab.options)[g]:j[g]=f)}return h}},0),ab.init=function(){var h,g,l,k,j,i;if(null!=document.querySelectorAll){for(g=document.querySelectorAll(ab.options.selector||".odometer"),i=[],l=0,k=g.length;k>l;l++){h=g[l],i.push(h.odometer=new ab({el:h,value:null!=(j=h.innerText)?j:h.textContent}))}return i}},null!=(null!=(N=document.documentElement)?N.doScroll:void 0)&&null!=document.createEventObject?(R=document.onreadystatechange,document.onreadystatechange=function(){return"complete"===document.readyState&&ab.options.auto!==!1&&ab.init(),null!=R?R.apply(this,arguments):void 0}):document.addEventListener("DOMContentLoaded",function(){return ab.options.auto!==!1?ab.init():void 0},!1),"function"==typeof define&&define.amd?define(["jquery"],function(){return ab}):typeof exports===!1?module.exports=ab:window.Odometer=ab}).call(this);window.define=amdResetOldDefine;window.require=amdResetOldRequire;amdResetOldDefine=amdResetOldRequire=undefined;
(function(){if(typeof ta.pages=="undefined"){ta.pages={}}if(typeof ta.pages.home=="undefined"){ta.pages.home={}}daodao=daodao||{};daodao.home=daodao.home||{};daodao.home.createTypeAhead=function(m,g,h,k,n,l){m&&m.stop();g.removePropertyEvent("focus","daodao.home.createTypeAhead");var e=b(k);if(l){d(e)}var j={hotel:"h",eat:"e",attr:"A",dest:"g"};var f={minChars:3,offsetY:-1,defaultTextClass:"focusClear",syncro:null,search:function(p){var o=ta.util.Deferred();new ta.util.ajax({url:"/TypeAheadJson",data:{action:h,startTime:ta.pages.home.ptptFirstInteractionStamp,uiOrigin:e,types:"geo"+(k?","+k:""),hglt:"true",global:"true",query:p,legacy_format:"true",_ignoreMinCount:"true"}}).always(function(q){if(q&&q.length){o.resolve(q)}else{o.reject(JS_location_not_found)}});return o.promise()},listTemplate:function(q){var r=['<div class="typeahead-choices">'];var o=ta.retrieve("x.gif")||"/img2/x.gif";var p={};q.results.push({coords:q.results[0].coords,index:1,name:g.retrieve("typeahead").query,rendered:"查找更多关于 <b>"+g.retrieve("typeahead").query+"</b> 的搜索结果",title:"搜索",type:"SEARCH",url:"/Search?where=nav&returnTo=__2F__&q="+g.retrieve("typeahead").query+"&geo=&ssrc="+j[k],value:q.results[0].value});Array.each(q.results,function(s){var t=[];t.push('<div class="typeahead-choice" ');if(s.type&&!p[s.type]){p[s.type]=true;t.push(">");var u=[];u.push("<div class='typeahead-title'>");u.push(s.title);u.push("<img class="+s.type.toLowerCase()+" src='"+o+"'>");u.push("</div>");t=u.concat(t)}else{t.push(">")}t.push(s.rendered);t.push("</div>");r=r.concat(t)});r.push("</div>");return r.join("")},itemTemplate:function(o){if("eat"===k&&o.address&&o.address.length){return o.name+'<div class="address">'+o.address+"</div>"}return o.name},assumeOnBlur:function(q){for(var p=0,o=q.results.length;p<o;p++){if(q.options.resolveSelection(q.results[p]).toLowerCase().indexOf(q.query.toLowerCase())>=0){return p}}return 0},showOnFocus:(Browser.ie&&Browser.version<=8)?false:true,onUserFocus:function(o){d(k);if(Browser.ie6||Browser.ie7||Browser.ie8){a(o)}if(ta.retrieve("typeahead.isFromDDPYPTCityFlyout")){o.results=null;o.query=null;ta.store("typeahead.isFromDDPYPTCityFlyout",false)}},onSelect:function(o,r,s){var q=function(){if(m||window.event){new Event(m||window.event).stop()}var u=o.url;if("SEARCH"===o.type){u=o.url}else{if("hotel"===k){if(ta.has("useHotelsFilterState")){if("GEO"==o.type){var w="geo="+o.value;var v="&"+w;ta.pages.home.updateStateAndRedirect(v);return false}else{var u="/Hotel_Review-d"+o.value;var v="&clear=true";var t=ta.widgets.calendar.getCheckRatesData();if(t){v="&"+Object.toQueryString(t)}ta.widgets.calendar.updateSessionDates(u,v);return false}}else{u="/HACSearch?"+("GEO"===o.type?"geo":"detail")+"="+o.value}}else{if("eat"===k){if("GEO"===o.type){u="/Restaurants?geo="+o.value}}else{if("attr"===k){if("GEO"===o.type){u="/Attractions?geo="+o.value}}else{if("vr"===k){var t=ta.widgets.calendar.getCheckRatesData();if(t){u="/VRACSearch?"+("GEO"===o.type?"geo":"detail")+"="+o.value;u=u+"&"+Object.toQueryString(t)}}}}}}location.hash=s.query+";"+o.value;if("hotel"===k){setPID("35903")}else{if("attr"===k){setPID("35904")}else{if("eat"===k){setPID("35905")}else{if("geo"===k){setPID("35907")}}}}daodao.pageAction("Daodao_PTPT_Submit");window.location=u};if(daodao.home.isAutoSubmit){daodao.home.isAutoSubmit=false;q()}var p=s.results?s.results.length:0;ta.pages.home.logAndAct("select","PTPT-"+k,o.type,"PTPT",s.selectedIndex+1,p,o.value,null);g.store("redir",q)},shouldSubmit:function(){if(ta.id("PTPT_HAC_FORM")){return false}return true},onRestore:function(o){g.form.eliminate("redir")},onSync:function(q,p,o){g.removeClass("focusClear")},onRender:c,onError:c,resolveSelection:function(o){return o.name.stripTags()},onSelectNavigate:function(){if(this.results[this.selectedIndex].type=="SEARCH"){g.retrieve("redir")()}},validator:ta.pages.home.validate.partial(null,g.form)};f.autopopulateHighlighted=false;f.autoHighlightFirst=true;f.ignoreKeysWhenInvisible=true;f.nextField=function(p){var o=g.getParent("form").getElement(".date_picker");if((Browser.ie6||Browser.ie7||Browser.ie8)&&o){return o&&o.getParent()}else{if(o&&Date.parse(o.innerHTML)=="Invalid Date"&&ta.has("isDaoDaoHomePageUnforkCalendar")){return o&&o.getParent()}else{return p&&p.source}}};var i=new TypeAhead(g,api.extend(f,n));g.store("typeahead",i);return i};ta.pages.home.updateStateAndRedirect=function(e){new Request({url:"/FilterState",data:e,method:"post",onSuccess:function(f){ta.widgets.calendar.redirectToHotelOverview(f)},onFailure:function(f){ta.widgets.calendar.redirectToHotelOverview(null)}}).send()};ta.queueForLoad(function(){var j=location.hash.slice(1).split(";"),h=j&&j.shift(),g=j&&j.shift(),f=ta.id("hotelSearch"),i=f&&f.getElement("input.search-input"),e=ta.pages.home.searchSyncro||(ta.pages.home.searchSyncro=new Syncro());if(!(h&&g)){return}e.sync(null,{query:h,value:h,result:{value:g}});if(i){i.focus();i.blur()}});ta.pages.home.getInputField=function(e){return e.getElement("input[name='q']")};ta.pages.home.getUIOrignForForm=function(e){switch(e.id){case"attractionSearch":return"PTPT-attr";case"destinationSearch":return"PTPT-dest";case"hotelSearch":return"PTPT-hotel";case"restaurantSearch":return"PTPT-eat";default:return undefined}};ta.pages.home.trackFindEvent=function(f,l,j){var h=ta.pages.home.getInputField(f);var g=h&&h.retrieve("typeahead");if(g){var i=ta.pages.home.getUIOrignForForm(f);l=l||"";var k=g&&h.value.trim().length>0&&h.value!==h.defaultValue;if(!ta.retrieve("typeahead.revised.pypt.mechanics.feature")){if(k){if(g.options.minChars>h.value.length){l="not_enough_chars;"+l}else{if(g.selectedIndex<0){l="no_selection;"+l}}}else{l="blank;"+l}}else{if(k&&ta.retrieve("typeahead_pypt_allow_too_few_chars_search_feature")&&g.options.minChars>h.value.length){l="low_chars_search;"+l}}var e=ta.pages.home.getFindLastUserInteractionType();ta.pages.home.logAndAct("find",i,"","PTPT",0,0,"",j,e,l)}else{if(j){j()}}};ta.pages.home.getFindLastUserInteractionType=function(){var e=ta.retrieve("ta.pages.home.find.clicked")?"click":"enter";ta.remove("ta.pages.home.find.clicked");return e};ta.pages.home.validate=function(j,g){var i=g.getElement("input.search-input"),f=false,h=i.retrieve("typeahead"),e=i.retrieve("redir");if(!i.value.length||i.value===i.defaultValue){i.focus();if(h){h.renderError(JS_location_not_found);h.show()}}else{if(h&&!h.results){daodao.pageAction("Daodao_PTPT_Submit");g.submit()}else{if(Type.isFunction(e)){e()}else{f=true}}}ta.pages.home.trackFindEvent(g,null,null);if(!f&&(j||window.event)){new Event(j||window.event).stop()}return f};function c(f,e){if(f.query){var g=ta.retrieve("typeahead.results");if(!g){g={}}g[f.query]=true;ta.store("typeahead.results",g)}}ta.pages.home.logAndAct=function(f,e,p,k,o,m,h,l,j,n,i){var g={uiOrigin:e,global:true,type:p,query:i,value:h,eventType:f,source:k,startTime:ta.pages.home.ptptFirstInteractionStamp,action:"RECORD",selDepth:o,totalNum:m,userInteractionType:j,errors:n};(function(){new Request({method:"GET",url:"/TypeAheadJson",data:g,onSuccess:l,onFailure:l}).send()}).delay(10)};var d=function(f){if(!ta.pages.home.ptptFirstInteractionStamp){var e=new Date();ta.pages.home.ptptFirstInteractionStamp=e.getTime()+(e.getTimezoneOffset()*60*1000);ta.pages.home.logAndAct("start",f,"","PTPT",0,0,"",null)}};var b=function(e){if(e){return"PTPT-"+e}else{return"unknown"}};var a=function(e){if(e&&e.source){var f=e.source.value;e.source.value="";e.source.value=f}}})();
(function(d,f){var a=(function(){var t,j,p,g,l,k,q=0,m,s=!Browser.ie||Browser.version>=10;function i(){return j.getSize().x}function r(v){var w=0,x,u=i();switch(v){case"left":w=q-u;break;case"right":w=q+u;break;case"rebalance":if((q+u)<m){return false}w=q;break;default:throw"Invalid type for headerCarousel"}if(w<0){w=0}else{if(w>(m-u)){w=m-u}else{x=w%247;w=w-x}}return w}function h(v){var u=r(v);if(typeof u!="number"||u==q){return false}q=u;u*=-1;if(s){t.setStyle("left",u+"px");if(k){clearTimeout(k);k=0}k=setTimeout(function(){o();m_animateTimeout=setTimeout(function(){o();m_animateTimeout=setTimeout(function(){o();m_animateTimeout=setTimeout(function(){o();m_animateTimeout=0},50)},50)},50)},300)}else{l.start(null,u)}}function o(){var u=m-i(),w=q>0,v=q<u;if(s){p.setStyles({opacity:w?1:0,visibility:w?"":"hidden"});g.setStyles({opacity:v?1:0,visibility:v?"":"hidden"})}else{p.setStyle("display",(w?"":"none"));g.setStyle("display",(v?"":"none"))}}function n(){var w,u=i()>m;if(s){var v="left 300ms linear";t.setStyles({transition:v,"-webkit-transition":v,"-moz-transition":v});w={opacity:0,visibility:"hidden"};l=true}else{l=new Fx.Tween(t,{duration:300,property:"left",link:"cancel",transition:"bounce",unix:"px"});l.addEvent("complete",o);w={display:"none"}}p.addEvent("click",h.pass("left")).setStyles(w);g.addEvent("click",h.pass("right"));if(u){g.setStyles(w)}}return{init:function(){var u;t=$("headerCarousel");j=$("headerScrollLimiter");if(!t||!j){return false}p=$("headerLeftBtn");g=$("headerRightBtn");u=t.getElements(".carouselItem");m=247*u.length;t.setStyle("width",m);n()},rebalance:function(){if(!l){return}h("rebalance")}}})();var b=(function(){var l=null,g=null,j=1482,i=!!Browser.ie&&Browser.version==6;function k(){var m=d.getSize().x;if(m<990){g.setStyle("width",990)}else{if(m>j){g.setStyle("width",j)}else{g.setStyle("width","")}}}function h(){if(!l){l=setTimeout(function(){a.rebalance();if(i){k()}l=null},800)}}return{init:function(){g=$("headerScrollLimiter");if(i&&g.get("data-max")){j=g.get("data-max")}d.addEvent("resize",h);if(i){k()}}}})();var c=function(){$$(".carouselLazy").each(function(h,g){$(h).set("src",$(h).get("lazy-src")).erase("lazy-src")})};function e(){a.init();b.init();c()}if($("headerCarousel")&&$("headerScrollLimiter")){d.addEvent("domready",e)}ta.queueForLoad(function(){ta.run("ta.overlays.Factory.ddPYPTCityFlyout",{},"hotelSearch_loc_handler","hotelSearch_loc_handler_icon","hhotel search-input","hotel_search_bar_wrap");ta.run("ta.overlays.Factory.ddPYPTCityFlyout",{},"attractionSearch_loc_handler","attractionSearch_loc_handler_icon","attraction search-input","attraction_search_bar_wrap");ta.run("ta.overlays.Factory.ddPYPTCityFlyout",{},"restaurantSearch_loc_handler","restaurantSearch_loc_handler_icon","restaurant search-input","restaurant_search_bar_wrap");ta.run("ta.overlays.Factory.ddPYPTCityFlyout",{},"destinationSearch_loc_handler","destinationSearch_loc_handler_icon","destination search-input","destination_search_bar_wrap")},"PYPT_GEO_LIST_PopUp")})(window);
(function(g){var a,e,h=null;function b(){return(a.getWidth()-e)>0}function c(){clearTimeout(h);h=null;if(b()){if(!a.hasClass("greater-bg-width")){a.addClass("greater-bg-width")}}else{if(a.hasClass("greater-bg-width")){a.removeClass("greater-bg-width")}}}function d(){if(h==null){h=setTimeout(c,200)}}function f(){if(!Browser.ie||Browser.version>8){return false}a=$("headerScrollLimiter");if(!a){return false}e=Number.from(a.get("data-backdrop-width"));if(!e){return false}if(b()){c()}window.addEvent("resize",d)}window.addEvent("domready",f)})();
daodao.PYPTCityFlyoutOverlay=new Class({Extends:daodao.CityFlyoutOverlay,bindCityLink:function(){var a=this,c=a.options,b=c.geoIdElement,d=c.geoNameElement;if(!Type.isElement(b)||!Type.isElement(d)){return}this.overlayContainer.addEvent("click:relay(.overlay-cityflyout-tabcontent a)",function(g){g.stop();var e=$(this),f=e.get("geoid"),h=e.get("text");b.set("value",f);d.set("value",h);a.fireEvent("select",[f,h]);a.overlayObj.hide();daodao.pageAction(this)})},show:function(){this.parent.apply(this,arguments);this.fireEvent("show")}});daodao.PYPTGeoListPopUp=function(j,b,e,a){var f=false;var h=ta.id(b);var d=ta.id(j);if(d){var i={hotelSearch_loc_handler:"PYPT-hotel",attractionSearch_loc_handler:"PYPT-attr",restaurantSearch_loc_handler:"PYPT-eat",destinationSearch_loc_handler:"PYPT-dest",restaurants_lander_loc_handler:"Restaurants_lander",hotels_lander_loc_handler:"Hotels_lander",attractions_lander_loc_handler:"Attractions_lander",destinations_lander_loc_handler:"Destinations_lander"};trackingContinentPrefix=function(k){if(!i[k]){return"noValid"}else{return i[k]}};var g=[trackingContinentPrefix(j)+"_click_domestic",trackingContinentPrefix(j)+"_click_hkmctw",trackingContinentPrefix(j)+"_click_asia",trackingContinentPrefix(j)+"_click_america",trackingContinentPrefix(j)+"_click_europe",trackingContinentPrefix(j)+"_click_oceania"];var c=new daodao.PYPTCityFlyoutOverlay(a,{type:"PYPT_CITY_FLY_OUT",alignElement:ta.id(j),geoIdElement:ta.id(j+"_geo-city"),geoNameElement:ta.id(j),trackingContinent:g,PYPTGeoListPopupType:i[j],onShow:function(){var k=this.options.geoNameElement;if(Type.isElement(k)&&!k.retrieve("typeahead")){k.focus()}},onSelect:function(k,p){var l=this.options,n=l.geoNameElement,m=null,o=null;if(Type.isElement(n)&&(m=n.retrieve("typeahead"))){m.sync({query:p,result:{value:k}})}if(l.PYPTGeoListPopupType){daodao.pageAction(l.PYPTGeoListPopupType+"_geoId_"+k);if(!ta.has("date.picker.pageInDate")&&(o=$$("#hotelSearch .date_picker")[0])){o.getParent().focus()}}}});d.onkeyup=function(){c.hide();ta.id(j+"_geo-city").className=e+"_";d.setAttribute("name","q");$$(".typeahead-container").show()};ta.id(a).onclick=function(){if(!f&&d.value!==""){c.hide()}else{c.show()}f=false};if(h){h.onclick=function(){f=true;daodao.pageAction("PYPT_click_listicon")}}}};
(function(a,d,c){function b(){var f=document.getElement("#recentReviewersBar .text.withOdometer");if(f){var e=f.getElement("em");if(e){e.setAttribute("data-start",f.getAttribute("data-start"));e.setAttribute("data-interval",f.getAttribute("data-interval"));e.setAttribute("data-separator",f.getAttribute("data-separator"));e.setAttribute("class","odometer");e.setAttribute("id","odometer");ta.commerce&&ta.commerce.odometer&&ta.commerce.odometer("odometer",{wait:3})}}}})(window,daodao);
(function(b,f){var a=b.ta;var e=b.daodao;function d(){var g=a.select("#popularDestinations .regionTabs > li");var i=a.select("#popularDestinations .regionContent > li");var h={};if(g.length==0||i.length==0){throw new Error("Retrieving tab or content elements failed")}i.each(function(k){var j=k.get("data-id");h[j]=k});g.addEvent("click:relay(a)",function(j){new Event(j).stop()});g.addEvent("click",function(){var l=this.get("data-id");var k=this.get("data-name");var j=h[l];if(!j){return}g.removeClass("active");i.removeClass("active");this.addClass("active");j.addClass("active");c(l,j);e.actionRecord(null,null,"homepage_tab_"+k)})}function c(h,g){if(g.retrieve("isContentPending")||g.retrieve("hasContentLoaded")){return}new Request({method:"get",url:"/DaoDaoHomePopCitiesAjax",data:{tabIndex:h},onRequest:function(){g.store("isContentPending",true)},onSuccess:function(i){g.innerHTML=i;g.store("hasContentLoaded",true)},onComplete:function(){g.store("isContentPending",false)}}).send()}a.queueForReady(d)})(window);
var dd=dd||{};dd.branding=dd.branding||{};dd.branding=(function(g){var e=NaN,d=0,h=false,b=null,a=null,l="590px",j=0,f=false,i=null,k=null;var c={init:function(){g.addEvent("scroll",c.scrollEvents);c.initHeroVideo()},bindEvent:function(){$$(".bottom-bar").addEvents({"mouseenter:relay(.bottom-bar-button)":function(){c.switchSlideTab(this)},"mouseleave:relay(.bottom-bar-button)":function(){c.slideLoopPlay()},"touchend:relay(.bottom-bar-button)":function(m){m.preventDefault();c.slideLoopPlay(this)}});$$(".intro-new-wrap #Js-close-button").addEvent("click",function(){c.closeTopLayer()})},showTopLayer:function(){if(!b&&!f){f=true;new Request({url:"/apages/home_rebranding_intro.html",onSuccess:function(m){b=new Element("div#brandIntro");b.set("html",m);$(document.body).grab(b,"top");b.set("tween",{duration:300,link:"cancel",transition:"bounce:out"});c.scrollToTop();c.bindEvent();c.slideLoopPlay();b.tween("height",0,l)}}).send()}else{c.scrollToTop();if(f){return}f=true;c.slideLoopPlay();b.tween("height",l)}daodao.actionRecord(null,null,"branding_first_open")},closeTopLayer:function(){if(!b){return}f=false;k.removeClass("focus");k=null;c.slidePause();b.tween("height",0);daodao.actionRecord(null,null,"branding_first_close")},slidePause:function(){clearTimeout(i);i=null},slideLoopPlay:function(m){if(!k){k=$$(".bottom-bar-button")[0]}else{if(!!m){k=m}}c.switchSlideTab(k);i=setTimeout(function(){k=k.nextElementSibling;c.slideLoopPlay()},4000)},rightTipsAnimate:function(){var m=$$(".phone-tips");m.removeClass("phone-tips-move");setTimeout(function(){m.addClass("phone-tips-move")},60)},switchSlideTab:function(n){c.slidePause();if(!n||n.hasClass("focus")){return false}k=n;var m=k.getAttribute("data-index");k.addClass("focus").getSiblings().removeClass("focus");$$(".phone-bg img").addClass("hidden");$$(".new-intro-img-"+m).removeClass("hidden");$$(".phone-tips").removeClass("phone-tips-bg"+j).addClass("phone-tips-bg"+m);j=m;c.rightTipsAnimate()},initHeroVideo:function(){a=$("mtyvideo2");try{a.addEventListener("play",function(){daodao.actionRecord(null,null,"homepage_hero_play")});a.preload="auto";a.play.delay(150,a)}catch(m){}},scrollEvents:function(){clearTimeout(e);e=g.setTimeout(function(){c.hideOnScroll();c.playOnScrollBack()},50)},hideOnScroll:function(){if(Type.isElement(b)&&b.getHeight()>0&&g.getScrollTop()>590){f=false;k.removeClass("focus");k=null;c.slidePause();c.scrollToTop();b.setStyle("height",0)}},playOnScrollBack:function(){if(!Type.isElement(a)||!Type.isFunction(a.play)){return}var m=g.getScrollTop();if(a.ended&&h){if(Browser.ie){a.load()}else{a.currentTime=0}a.pause()}if(m>600){a.pause();h=true}else{if((a.ended||a.paused)&&h&&m<d){a.play()}h=false}d=m},scrollToTop:function(){g.setTimeout(function(){g.scrollTo(0,0)},0)}};return{showTopLayer:c.showTopLayer.bind(c),closeTopLayer:c.closeTopLayer.bind(c),init:c.init.bind(c)}})($(window));$(document).addEvent("domready",function(){dd.branding.init()});
window.Modernizr=function(Z,Y,X){function F(b){Q.cssText=b}function E(d,c){return F(prefixes.join(d+";")+(c||""))}function D(d,c){return typeof d===c}function C(d,c){return !!~(""+d).indexOf(c)}function B(g,c,j){for(var i in g){var h=c[g[i]];if(h!==X){return j===!1?g[i]:D(h,"function")?h.bind(j||c):h}}return !1}var W="2.8.3",V={},U=!0,T=Y.documentElement,S="modernizr",R=Y.createElement(S),Q=R.style,P,O={}.toString,N={},M={},L={},K=[],J=K.slice,I,H={}.hasOwnProperty,G;!D(H,"undefined")&&!D(H.call,"undefined")?G=function(d,c){return H.call(d,c)}:G=function(d,c){return c in d&&D(d.constructor.prototype[c],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(a){var h=this;if(typeof h!="function"){throw new TypeError}var g=J.call(arguments,1),f=function(){if(this instanceof f){var b=function(){};b.prototype=h.prototype;var d=new b,c=h.apply(d,g.concat(J.call(arguments)));return Object(c)===c?c:d}return h.apply(a,g.concat(J.call(arguments)))};return f}),N.video=function(){var b=Y.createElement("video"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),f.h264=b.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),f.webm=b.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}}catch(e){}return f};for(var A in N){G(N,A)&&(I=A.toLowerCase(),V[I]=N[A](),K.push((V[I]?"":"no-")+I))}return V.addTest=function(e,c){if(typeof e=="object"){for(var f in e){G(e,f)&&V.addTest(f,e[f])}}else{e=e.toLowerCase();if(V[e]!==X){return V}c=typeof c=="function"?c():c,typeof U!="undefined"&&U&&(T.className+=" "+(c?"":"no-")+e),V[e]=c}return V},F(""),R=P=null,function(al,ak){function aa(f,e){var h=f.createElement("p"),g=f.getElementsByTagName("head")[0]||f.documentElement;return h.innerHTML="x<style>"+e+"</style>",g.insertBefore(h.lastChild,g.firstChild)}function z(){var b=t.elements;return typeof b=="string"?b.split(" "):b}function y(d){var c=ac[d[ae]];return c||(c={},ad++,d[ae]=ad,ac[ad]=c),c}function x(b,h,f){h||(h=ak);if(ab){return h.createElement(b)}f||(f=y(h));var e;return f.cache[b]?e=f.cache[b].cloneNode():ag.test(b)?e=(f.cache[b]=f.createElem(b)).cloneNode():e=f.createElem(b),e.canHaveChildren&&!ah.test(b)&&!e.tagUrn?f.frag.appendChild(e):e}function w(b,l){b||(b=ak);if(ab){return b.createDocumentFragment()}l=l||y(b);var k=l.frag.cloneNode(),j=0,i=z(),h=i.length;for(;j<h;j++){k.createElement(i[j])}return k}function v(d,c){c.cache||(c.cache={},c.createElem=d.createElement,c.createFrag=d.createDocumentFragment,c.frag=c.createFrag()),d.createElement=function(a){return t.shivMethods?x(a,d,c):c.createElem(a)},d.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+z().join().replace(/[\w\-]+/g,function(b){return c.createElem(b),c.frag.createElement(b),'c("'+b+'")'})+");return n}")(t,c.frag)}function u(b){b||(b=ak);var d=y(b);return t.shivCSS&&!af&&!d.hasCSS&&(d.hasCSS=!!aa(b,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),ab||v(b,d),b}var aj="3.7.0",ai=al.html5||{},ah=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,ag=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,af,ae="_html5shiv",ad=0,ac={},ab;(function(){try{var b=ak.createElement("a");b.innerHTML="<xyz></xyz>",af="hidden" in b,ab=b.childNodes.length==1||function(){ak.createElement("a");var c=ak.createDocumentFragment();return typeof c.cloneNode=="undefined"||typeof c.createDocumentFragment=="undefined"||typeof c.createElement=="undefined"}()}catch(d){af=!0,ab=!0}})();var t={elements:ai.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:aj,shivCSS:ai.shivCSS!==!1,supportsUnknownElements:ab,shivMethods:ai.shivMethods!==!1,type:"default",shivDocument:u,createElement:x,createDocumentFragment:w};al.html5=t,u(ak)}(this,Y),V._version=W,T.className=T.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(U?" js "+K.join(" "):""),V}(this,this.document),function(ad,ac,ab){function aa(b){return"[object Function]"==P.call(b)}function Z(b){return"string"==typeof b}function Y(){}function X(b){return !b||"loaded"==b||"complete"==b||"uninitialized"==b}function W(){var b=O.shift();M=1,b?b.t?R(function(){("c"==b.t?L.injectCss:L.injectJs)(b.s,0,b.a,b.x,b.e,1)},0):(b(),W()):M=0}function V(w,v,t,s,q,p,n){function m(a){if(!g&&X(h.readyState)&&(x.r=g=1,!M&&W(),h.onload=h.onreadystatechange=null,a)){"img"!=w&&R(function(){I.removeChild(h)},50);for(var c in D[v]){D[v].hasOwnProperty(c)&&D[v][c].onload()}}}var n=n||L.errorTimeout,h=ac.createElement(w),g=0,b=0,x={t:t,s:v,e:q,a:p,x:n};1===D[v]&&(b=1,D[v]=[]),"object"==w?h.data=v:(h.src=v,h.type=w),h.width=h.height="0",h.onerror=h.onload=h.onreadystatechange=function(){m.call(this,b)},O.splice(s,0,x),"img"!=w&&(b||2===D[v]?(I.insertBefore(h,J?null:Q),R(m,n)):D[v].push(h))}function U(g,e,j,i,h){return M=0,e=e||"j",Z(g)?V("c"==e?G:H,g,e,this.i++,j,i,h):(O.splice(this.i++,0,g),1==O.length&&W()),this}function T(){var b=L;return b.loader={load:U,i:0},b}var S=ac.documentElement,R=ad.setTimeout,Q=ac.getElementsByTagName("script")[0],P={}.toString,O=[],M=0,K="MozAppearance" in S.style,J=K&&!!ac.createRange().compareNode,I=J?S:Q.parentNode,S=ad.opera&&"[object Opera]"==P.call(ad.opera),S=!!ac.attachEvent&&!S,H=K?"object":S?"script":"img",G=S?"script":H,F=Array.isArray||function(b){return"[object Array]"==P.call(b)},E=[],D={},C={timeout:function(d,c){return c.length&&(d.timeout=c[0]),d}},N,L;L=function(e){function c(i){var i=i.split("!"),h=E.length,q=i.pop(),p=i.length,q={url:q,origUrl:q,prefixes:i},o,l,j;for(l=0;l<p;l++){j=i[l].split("="),(o=C[j.shift()])&&(q=o(q,j))}for(l=0;l<h;l++){q=E[l](q)}return q}function n(b,s,r,q,p){var o=c(b),l=o.autoCallback;o.url.split(".").pop().split("?").shift(),o.bypass||(s&&(s=aa(s)?s:s[b]||s[q]||s[b.split("/").pop().split("?")[0]]),o.instead?o.instead(b,s,r,q,p):(D[o.url]?o.noexec=!0:D[o.url]=1,r.load(o.url,o.forceCSS||!o.forceJS&&"css"==o.url.split(".").pop().split("?").shift()?"c":ab,o.noexec,o.attrs,o.timeout),(aa(s)||aa(l))&&r.load(function(){T(),s&&s(o.origUrl,p,q),l&&l(o.origUrl,p,q),D[o.url]=2})))}function m(w,v){function u(b,h){if(b){if(Z(b)){h||(r=function(){var i=[].slice.call(arguments);q.apply(this,i),p()}),n(b,r,v,0,t)}else{if(Object(b)===b){for(g in o=function(){var a=0,i;for(i in b){b.hasOwnProperty(i)&&a++}return a}(),b){b.hasOwnProperty(g)&&(!h&&!--o&&(aa(r)?r=function(){var i=[].slice.call(arguments);q.apply(this,i),p()}:r[g]=function(i){return function(){var a=[].slice.call(arguments);i&&i.apply(this,a),p()}}(q[g])),n(b[g],r,v,g,t))}}}}else{!h&&p()}}var t=!!w.test,s=w.load||w.both,r=w.callback||Y,q=r,p=w.complete||Y,o,g;u(t?w.yep:w.nope,!!s),s&&u(s)}var k,f,d=this.yepnope.loader;if(Z(e)){n(e,0,d,0)}else{if(F(e)){for(k=0;k<e.length;k++){f=e[k],Z(f)?n(f,0,d,0):F(f)?L(f):Object(f)===f&&m(f,d)}}else{Object(e)===e&&m(e,d)}}},L.addPrefix=function(d,c){C[d]=c},L.addFilter=function(b){E.push(b)},L.errorTimeout=10000,null==ac.readyState&&ac.addEventListener&&(ac.readyState="loading",ac.addEventListener("DOMContentLoaded",N=function(){ac.removeEventListener("DOMContentLoaded",N,0),ac.readyState="complete"},0)),ad.yepnope=T(),ad.yepnope.executeStack=W,ad.yepnope.injectJs=function(r,q,p,n,m,h){var g=ac.createElement("script"),f,b,n=n||L.errorTimeout;g.src=r;for(b in p){g.setAttribute(b,p[b])}q=h?W:q||Y,g.onreadystatechange=g.onload=function(){!f&&X(g.readyState)&&(f=1,q(),g.onload=g.onreadystatechange=null)},R(function(){f||(f=1,q(1))},n),m?g.onload():Q.parentNode.insertBefore(g,Q)},ad.yepnope.injectCss=function(b,n,m,l,k,h){var l=ac.createElement("link"),f,n=h?W:n||Y;l.href=b,l.rel="stylesheet",l.type="text/css";for(f in m){l.setAttribute(f,m[f])}k||(Q.parentNode.insertBefore(l,Q),R(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};
(function(){var a={validateUrlReg:/^(?:https?|\/).+/,appendQuery:function(d,c,f){if(!a.validateUrl(d)){return d}var e=[],g=d.split("#"),d=g[0].trim();e.push(d);e.push(d.indexOf("?")>-1?"&":"?");e.push(c);e.push("=");e.push(f);if(g.length>1){e.push("#");e.push(g[1].trim())}return e.join("")},validateUrl:function(c){return a.validateUrlReg.test(c)}};var b={init:function(){b.trackPID("PAGE");b.trackClick("PAGE");b.trackHover("PAGE")},trackPID:function(c){var e=$(c)||$(document),d=/^(?:https?|\/).+/;e.addEvent("click:relay(a[data-pid])",function(){if(this.retrieve("PID-initialized")){return}var f=Number(this.get("data-pid")),g=this.get("href");if(f>0){this.set("href",a.appendQuery(g,"pid",f))}this.store("PID-initialized",true)})},trackClick:function(c){var d=$(c)||$(document);d.addEvent("click:relay([data-action-click])",function(){b.actionRecord($(this).get("data-action-click"))})},trackHover:function(c){var d=$(c)||$(document);d.addEvent("mouseenter:relay([data-action-hover])",function(){b.actionRecord($(this).get("data-action-hover"))})},actionRecord:function(c){new Request({url:"/ActionRecord",method:"get",data:{action:c}}).send()}};$(document).addEvent("domready",function(){b.init()})})();
