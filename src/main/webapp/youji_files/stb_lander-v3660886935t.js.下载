daodao=daodao||{};(function(a,c,d){var b=new Class({Implements:[Options,Events],options:{leftBtn:null,rightBtn:null,container:null,tabs:null,selectedTab:null,mark:null,followMouse:false,wrapWidth:0,goAnotherPage:false,proLoadPhotoNumber:50,photoSizePerRequest:50},Binds:["loadImage","_doWhileScroll","tabSelect","markingTab","markingSelected","leftBtnClick","rightBtnClick"],initialize:function(e){this.setOptions(e);if(typeOf(this.options.container)=="null"&&typeOf(this.options.tabs)=="null"&&this.options.tabs.length<=0){return}this.smoothAnimation=!Browser.ie||Browser.version>=10;if(typeOf(this.options.selectedTab)=="null"){this.options.selectedTab=this.options.tabs[0]}if(!this.options.goAnotherPage){this.options.tabs.addEvent("click",this.tabSelect)}if(this.options.followMouse){this.options.tabs.addEvents({mouseover:this.markingTab,mouseout:this.markingSelected})}if(typeOf(this.options.leftBtn)=="element"&&typeOf(this.options.rightBtn)=="element"){this.options.leftBtn.addEvent("click",this.leftBtnClick);this.options.rightBtn.addEvent("click",this.rightBtnClick)}this.positions={};this.haveMarkIcon=typeOf(this.options.mark)!=null;this.bindAnimation();this.selectTabFn(this.options.selectedTab);this.bIsScrollLocked=false;this.currentPhotoIndex=this.options.proLoadPhotoNumber;this.geoId=$$("input[name=geo]")[0].get("value");this.tripSize=$$("div[id=stb_list] div.img-wrap").length;this.init()},init:function(){this._attachActions()},_attachActions:function(){c.addEvent("scroll",this._doWhileScroll)},_doWhileScroll:function(){if(!this.bIsScrollLocked&&c.getScrollTop()>3600){this.loadImage()}},loadImage:function(){var f=this.currentPhotoIndex;var e=this.options.photoSizePerRequest;new Request.JSON({url:"/DaoDaoTourismBlogAjax",data:{action:"posts",offset:f,size:e,geo:this.geoId},method:"get",onSuccess:function(g){var h=g.images;h.each(function(n,k){var l=$$("div[blogid="+n.tripid+"]");var m=new Element("a",{href:"/TourismBlog-t"+n.tripid+".html?p=37085",target:"_blank"});var j=new Element("img",{src:n.src,"class":"",style:"width: 100%; height: auto; margin-top: -26px;"});m.adopt(j);var i=l.getElement("a");i.dispose();l.adopt(m)})}}).send();this.currentPhotoIndex+=e;this.currentPhotoIndex=Math.min(this.tripSize,this.currentPhotoIndex);if(this.currentPhotoIndex==this.tripSize){this.bIsScrollLocked=true;c.removeEvent("scroll",this._doWhileScroll)}else{this.bIsScrollLocked=false;c.fireEvent("scroll")}},markingTab:function(g){if(!this.haveMarkIcon){return}var f=g.target,e=this.getOffset(f);this.sliderMarkIcon(e)},markingSelected:function(f){if(!this.haveMarkIcon){return}var e=this.getOffset(this.options.selectedTab);this.sliderMarkIcon(e)},tabSelect:function(f){f.stop();var e=f.target;this.selectTabFn(e)},selectTabFn:function(h){var g,f,e;if(!h){return}g=h.get("data-id");if(!g){return}this.geoId=g;this.bIsScrollLocked=false;this.currentPhotoIndex=this.options.proLoadPhotoNumber;this.tripSize=$$("div[id=stb_list] div.img-wrap").length;this.init();f=this.getOffset(h);e=this.getSliderStatus(f);this.sliderInner(e.lv);if(this.haveMarkIcon){this.sliderMarkIcon(f)}this.setBtnDisplayStatus(e);this.options.selectedTab=h;this.fireEvent("tabOnSelect")},sliderInner:function(e){if(this.smoothAnimation){this.options.container.setStyle("left",e*-1)}else{this.options.container.tween("left",e*-1)}},sliderMarkIcon:function(e){if(this.smoothAnimation){this.options.mark.setStyles({left:e.left,width:e.width})}else{this.options.mark.morph({left:e.left,width:e.width})}},setBtnDisplayStatus:function(e){if(e.lbs){this.options.leftBtn.show()}else{this.options.leftBtn.hide()}if(e.rbs){this.options.rightBtn.show()}else{this.options.rightBtn.hide()}},leftBtnClick:function(){var f=this.getInnerLeft()-100,e;f=(f>15)?f:0;e=f==0?false:true;this.moveInner(f,e,true)},rightBtnClick:function(){var f=this.getInnerLeft()+100,g=this.options.container.getSize().x-this.options.wrapWidth,e;f=(f<(g-15))?f:g;e=f==g?false:true;this.moveInner(f,true,e)},getSelected:function(){return this.options.selectedTab},getInnerLeft:function(){return Math.abs(parseInt(this.options.container.getStyle("left")))},moveInner:function(f,e,g){this.sliderInner(f);this.setBtnDisplayStatus({lbs:e,rbs:g})},getOffset:function(f){var e=f.get("data-id");if(typeOf(this.positions[e])=="null"){this.positions[e]={left:f.getPosition(this.options.container).x,width:f.getSize().x}}return this.positions[e]},bindAnimation:function(){if(this.smoothAnimation){var e="left 300ms linear",f="left 300ms linear, width 300ms linear";this.options.container.setStyles({transition:e,"-webkit-transition":e,"-moz-transition":e});if(this.options.mark){this.options.mark.setStyles({transition:f,"-webkit-transition":f,"-moz-transition":f})}}else{this.options.container.set("tween",{duration:300,link:"cancel",transition:"linear"});if(this.options.mark){this.options.mark.set("morph",{duration:300,link:"cancel",transition:"linear"})}}},getSliderStatus:function(g){var m=this.options.wrapWidth,i=parseInt(m/2),l=this.options.container.getSize().x,f=0,j=parseInt(g.left+g.width/2),k=l-j,e=false,h=false;if(l<(m+15)){return{lv:0,lbs:false,rbs:false}}if(j<=i){f=0;h=true}else{if(k<=i){f=l-m;e=true}else{f=j-i;e=true;h=true}}return{lv:f,lbs:e,rbs:h}}});a.tripTabsSlider=b})(daodao,window);
(function(){var d=(function(){var h=$("stb_nav"),q=h.getElement(".stb-tabs"),f=$("stb_list"),l={},n=false,m,k;function g(r){var s=r.getElements(".lazy-load");if(s.length<=0){return false}s.each(function(v,t){var u=v.getParent(".img-wrap");(function(z,x){var w=z.getSize();var y=w.x/w.y;var A=x.get("lazy-src");Asset.image(A,{onLoad:function(E){if(E&&E.width&&E.height){var B=E.width/E.height;x.erase("lazy-src").removeClass("lazy-load").set("src",E.src);if(B>y){var D=(w.x-B*w.y)/2;x.setStyles({height:"100%",width:"auto","margin-left":D})}else{var C=(w.y-w.x/B)/2;x.setStyles({width:"100%",height:"auto","margin-top":C})}}delete w;delete y;delete A;delete z;delete x}})})(u,v)})}function o(r){var s=Elements.from(r)[0];f.getElements(".stb-item").hide();s.inject(f);g(s);try{l[this.options.data.geo]=s}catch(t){}}function j(r){if(!m){m=new ta.overlays.CenteredOverlay({showCloseButton:false,style:"requestLoading",content:'<img src="/ddimg/home/icon_stb_loading.gif"><span class="loading-bg"></span>'})}m.show();new Request({url:"/CountryTripAjax",method:"get",data:{geo:r},onRequest:function(){n=true},onSuccess:o,onComplete:function(){n=false;m.hide()}}).send()}function p(r){if(l[r]){f.getElements("ul").hide();l[r].show()}else{j(r)}}function i(){var r=this;if(r.options&&r.options.selectedTab){var s=r.options.selectedTab.get("data-id");if(!s){return}p(s)}}return{init:function(){var t=q.getElements("a");var r=q.getElement(".icon");if(!q||!t||t.length==0){return false}g(f);var s=q.getElement(".selected a");var v=t[(t.length-1)];var u=v.getPosition(q)["x"]+v.getSize()["x"];q.setStyle("width",u+15);k=new daodao.tripTabsSlider({leftBtn:$("left_btn"),rightBtn:$("right_btn"),container:q,tabs:t,mark:r,wrapWidth:930,selectedTab:s,goAnotherPage:true}).addEvent("tabOnSelect",i)},goFn:function(s){var r=s.get("data-forKey");if(r=="664891"){r="294217"}var s=$$("#stb_nav a[data-id="+r+"]")[0];if(typeof s=="undefined"||typeof s.href=="undefined"||s.href==""){return false}window.location.href=s.href}}})();function c(){var g=ta.retrieve("homeBackdropHighRes");var f=Asset.image(g,{id:"backdrop",onLoad:a});$("backdrop").setProperty("src",f.getProperty("src"))}function a(){new Fx.Tween($("backdrop_blur"),{duration:2000,property:"opacity"}).start(1,0)}function b(){var f=$(this);var g=new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,offsetLeft:338,allowFlip:false,style:"overlay-allGeo"},f);g.addEvent("onShow",function(){this.source.addClass("all-geo-hover")});g.addEvent("onHide",function(){this.source.removeClass("all-geo-hover")});g.fireEvent("onShow");$$(".overlay-allGeo dd").addEvent("click",function(){daodao.actionRecord("","","TourismBlogLanding_SwitchC_MC");g.hide();d.goFn(this)});f.removeEvent("mouseenter",b)}function e(){c();$("all_geo").addEvent("mouseenter",b);d.init()}$(document).addEvent("domready",e)})();
ta.widgets.calendar.showAllPriceButtons=function(a){var b=document.getElements(".showPriceButton");if(b){a?b.addClass("showPriceButtonShow").removeClass("showPriceButtonHide"):b.addClass("showPriceButtonHide").removeClass("showPriceButtonShow")}};ta.widgets.calendar.dateToString=function(a){if(!a||!a.getDate){return""}return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()};(function(){var b=ta.overlays.CalendarOverlay;var a="typeO ocal";if(ta.retrieve("daodao_noPop_single_cr_button")){a=a+" no_cpu"}ta.overlays.CalendarOverlay=new Class({Extends:b,options:{style:a,category:"calendar"},recordDates:function(){var c=$$(".checkIn");if(c&&c[0]){ta.store("latest_checkIn",c[0].value)}var f=$$(".chk-in .day");if(f&&f[0]){ta.store("latest_checkIn_day",f[0].value)}var e=$$(".chk-in .month");if(e&&e[0]){ta.store("latest_checkIn_month",e[0].value)}var d=$$(".checkOut");if(d&&d[0]){ta.store("latest_checkOut",d[0].value)}var f=$$(".chk-out .day");if(f&&f[0]){ta.store("latest_checkOut_day",f[0].value)}var e=$$(".chk-out .month");if(e&&e[0]){ta.store("latest_checkOut_month",e[0].value)}},select:function(o,h){this.parent(o,h);this.recordDates();var q=this;if(ta.retrieve("isDaoDaoCRRedesign")){try{this.dateSelected=true;var p=this.theOtherCal;if(p.dateSelected){this.dateSelected=false;p.dateSelected=false;var n=this.input.hasClass("noMeta");if(ta.retrieve("doQueryCRData")==true&&!n){if(!ta.has("isDaoDaoHotelsMiniMeta")){var m=$$(".crrAvailability");dd.commerce.checkrates.clearCheckRatesData();if(m!=null){m.each(function(z){z.innerHTML="";z.removeClass("available");z.removeClass("partiallyAvailable");z.removeClass("maybeAvailable")})}}["hac_result_debug","hac_result_debug_lightbox"].each(function(A){var z=ta.id(A);if(z!=null){z.innerHTML=""}});var y=parseInt(this.dayField.value.replace(/^0/,""));var l=this.monthField.value.split(/\//);if(l.length!=2){return}var f=parseInt(l[1]);var d=parseInt(l[0].replace(/^0/,""));var x=parseInt(p.dayField.value.replace(/^0/,""));var k=p.monthField.value.split(/\//);if(k.length!=2){return}var e=parseInt(k[1]);var c=parseInt(k[0].replace(/^0/,""));if(ta.retrieve("showDateUpdateSpinOverlay")==true){ta.has("overlays.current")&&ta.store("overlays.previous",ta.retrieve("overlays.current"));var w=ta.overlays.Factory.getFilterWaitOverlay();w.container.setStyle("zIndex",10000);if(ta.has("overlays.previous")){w.addEvent("hide",function(){if(ta.retrieve("overlays.current")!==this){return}ta.store("overlays.current",ta.retrieve("overlays.previous"));ta.remove("overlays.previous");lightbox.deactivate()})}w.show();var j=ta.id("CHECK_RATES_CONT").getCoordinates();var i=w.container.getCoordinates();w.container.setStyles({left:j.left+(j.width-i.width)/2,top:j.top+(j.height-i.height)/2})}var u=$(this.source).getParent(".crForm").getProperty("data-locId")||0;var t=new Date();t.setYear(f);t.setMonth(d-1);t.setDate(y);var s=new Date();s.setYear(e);s.setMonth(c-1);s.setDate(x);var v=t;var r=s;if(t>s){v=s;r=t}dd.commerce.checkrates.requestMetaOnDateChange(u,v,r,this.qcArea)}}else{p.show(h)}}catch(g){ta.util.error.record(g,"calendar select for DaoDao CR Redesign")}}}})})();ta.commerce.checkrates={getPropIdFromCRElement:function(b){if(b){var a=null;if(a=b.className.match(/id_(\d+)/)){return a[1]}}return null},checkRatesMiniMeta:function(e,c,b,d,a){var f=new ta.commerce.CheckRatesData({type:d,evnt:e},ta.commerce.checkrates.getPropIdFromCRElement(c),b,false);if((ta.retrieve("checkrates.meta_ui_post_click_prices")||a)&&f.validate()){ta.commerce.meta.miniMetaAjax(null,f,1000)}},checkRatesCreateGeoCrAutoBroadenLb:function(c,b,a){ta.commerce.meta.checkRatesCreateGeoCrAutoBroadenLb(c,b,a)},logMetaUITestInfo:function(){if(ta.has("metaUITestInfo")){try{var b=ta.retrieve("metaUITestInfo");if(b.test&&b.placement&&b.type&&b.value){ta.trackEventOnPage(b.test,b.placement,b.type,b.value,false)}}catch(a){ta.util.error.record(a,"error logging meta test info")}ta.remove("metaUITestInfo")}},logMapSponsoredProviderClick:function(c){var b=ta.find(".overlay .skv3");if(b&&b.hasAttribute("data-sponsor")&&c&&pageServlet){var a=b.get("data-sponsor");var d=b.get("data-sponsor-provider");if(c==d){var e=(pageServlet=="LocalMapsRedesign")?"LocalMap":(pageServlet=="HACSearch"||pageServlet=="Hotels")?"HACMap":"FloatingMap";if(ta.id("cbx-"+a)){e="FloatingMap"}ta.trackEventOnPage(e,"sponsor_cr_sent",a)}}},logLowestPriceTestInfo:function(b,c){var d=b.getParent("div#PROVIDER_BLOCK")||b.getParent("div#PROVIDER_BLOCK_INLINE");if(d){var m=(d.id=="PROVIDER_BLOCK_INLINE")?true:false;var h=(m)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";var f=(m)?"Meta_LP_CTA_Click_Inline":"Meta_LP_CTA_Click";if(ta.has(h)){var k=ta.retrieve(h);if(k.hasOwnProperty("idx")&&k.hasOwnProperty("provider")){try{var j=ta.commerce.checkrates.scrapeMetaProviders(d);var a=null;for(var g=0;g<j.length;g++){if(c==j[g]){a=g}}if(a){ta.trackEventOnPage(f,k.idx,a,0,false)}}catch(l){ta.util.error.record(l,"error logging lowest price click info")}}}}},scrapeMetaProviders:function(h){var d=[];d[0]=-1;try{if(h){var b=h.getElements(".jsPrvdr");for(var a=0;a<b.length;a++){var c=b[a].onclick;if(c){var g=(c+"").match(/openMetaProvider.*'(\d+)'\)/)[1];if(g){d.push(g)}}}}}catch(f){ta.util.error.record(f,"error scraping meta providers")}return d},logBlueChevronLowestPriceTestInfo:function(c,d){var f=c.getParent("#HotelDateSearch");if(f){var b="bcMetaLowestPriceCTA";var g="BlueChevron_LP_CTA_Click";if(ta.has(b)){var l=ta.retrieve(b);if(l.hasOwnProperty("idx")&&l.hasOwnProperty("provider")){try{var j=ta.commerce.checkrates.scrapeBlueChevronProviders(f);var a=null;for(var h=0;h<j.length;h++){if(d==j[h]){a=h}}if(a){ta.trackEventOnPage(g,l.idx,a,0,false)}}catch(k){ta.util.error.record(k,"error logging blue chevron lowest price click info")}}}}},scrapeBlueChevronProviders:function(h){var f=[];f[0]=-1;try{if(h){var c=h.getElements(".offer");for(var b=0;b<c.length;b++){var d=c[b].onclick+"";var a=d.match(/openMetaProvider.*'(\d+)'\)/);if(a){provider=a[1];if(provider){f.push(provider)}}}}}catch(g){ta.util.error.record(g,"error scraping blue chevron providers")}return f},changePID:function(a){var b=ta.id("hacPid");if(b){b.value=a}},trackMetaClick:function(d,a,c){var b="CheckRates";var e=1;ta.trackPhysicalCommerce(b,a,e,c);ta.trackAttemptedCommerce(b,a,d,e)},removeProviderCheckboxClick:function(){var b=document.getElements("#META_UI_AVAIL_SECTIONS #META_HAC_ROOM_LIST .chk");var a=document.getElements("#META_UI_AVAIL_SECTIONS #META_HAC_ROOM_LIST .checkbox_ui");b.each(function(c){ta.remove(c.id)});a.each(function(c){ta.remove(c.name)})},showMetaCheckRates:function(){var b=ta.retrieve("metaCheckBoxCheckRates");var a=ta.retrieve("meta.isCheapVacationServlet");return ta.retrieve("metaCheckRatesFeatureEnabled")&&!a&&!b},hideLoading:function(c){var a=document.id(c);if(a){var b=a.getElement(".loading");b.set("styles",{display:"none"})}},showLoading:function(d){var a=document.id(d);if(a){var c=a.getElement(".loading");var b=a.getElement(".grn_chevronRgt");c.set("styles",{display:"block"});b.set("styles",{display:"none"})}},showArrow:function(d){var a=document.id(d);if(a){var c=a.getElement(".loading");var b=a.getElement(".grn_chevronRgt");c.set("styles",{display:"none"});b.set("styles",{display:"block"})}},getDelaySecs:function(){var a=ta.id("CHECK_MORE_SITES_LB");if(a&&a.hasClass("dont_animate")){return 0}return 2000},showRemainingCheckMore:function(){var b=this.checkMoreData;var f=document.id("UNCHECKED_PROVIDERS");var a=document.id("ALSO_VIEWED_LB");var c=ta.id("VR_CROSS_SELL");var d=this.getDelaySecs();b.uncheckedProviders=f;b.alsoViewed=a;b.VR=c;if(f){this.showUncheckedProviders.delay(d,this)}else{if(a){this.showAlsoViewed.delay(d,this)}else{if(c){this.showVR.delay(d,this)}}}try{this.loadPackages(false)}catch(g){ta.util.error.record(g,"hotel packages - loadPackages")}},loadPackages:function(b){if(this.shouldSendPackagesRequest()){var f=$$(".packages");this.checkMoreData.packages=f;var h=ta.id("PACKAGES_HOTEL_ID");var k=ta.id("PACKAGES_HOTEL_NAME");var o=ta.id("PACKAGES_CHECK_IN_DATE");var d=ta.id("PACKAGES_CHECK_OUT_DATE");var i=ta.id("PACKAGES_ADULTS");var m=ta.id("PACKAGES_GEO");if(h&&k&&o&&d&&i&&m){var j=h.get("value");var n=k.get("value");var c=o.get("value");var l=d.get("value");var g=i.get("value");var e=m.get("value");var a=[];$$("#ALSO_VIEWED_LIST a").each(function(p){var q=/-d([0-9]+)-/.exec(p.href);if(q&&q[1]&&q[1]!=""){a.push(q[1])}});this.fireCallCountEvent(1);setTimeout(function(){new Request({url:"/ExpediaPackagesAjax",onSuccess:function(p){try{ta.commerce.checkrates.handlePackages(p,0)}catch(q){ta.util.error.record(q,"hotel packages - handlePackages")}},onFailure:function(p){ta.util.error.record(p.responseText,"hotel packages - call to /ExpediaPackagesAjax")},data:{hotelId:j,hotelName:n,checkInDate:c,checkOutDate:l,adults:g,geo:e,alsoViewedIds:a.join(","),isAlsoViewed:b},evalScripts:true,method:"get"}).send()},500)}}},shouldSendPackagesRequest:function(){var a=$$(".packages").length>0;return a},hasPackagesReturned:function(){return this.hasPackagesResults()||this.hasPackagesNoResults()},hasPackagesResults:function(){return $$("#QUICK_CHECK_LB_PACKAGES .checking_sites").length>0},hasPackagesNoResults:function(){return ta.id("PACKAGES_NO_RESULTS")!=null},isPackagesShowing:function(){var a=ta.id("QUICK_CHECK_LB_PACKAGES");return a&&a.hasClass("show_section")},hasVRCrossSell:function(){return ta.id("VR_CROSS_SELL")!=null},transitionToPackages:function(){this.showPackages.delay(this.getDelaySecs(),this,true)},fireCallCountEvent:function(a){ta.trackEventOnPage("checkRates","packages","callCount",a,true)},handlePackages:function(a,d){this.checkMoreData.packages.set("html",a);var b=ta.id("PACKAGES_REQUERY_KEY");if(b){var c=b.get("value");if(d<20){this.fireCallCountEvent(d+2);setTimeout(function(){new Request({url:c,onSuccess:function(f){try{ta.commerce.checkrates.handlePackages(f,d+1)}catch(g){ta.util.error.record(g,"hotel packages - handlePackages")}},onFailure:function(e){ta.util.error.record(e.responseText,"hotel packages - requery to /ExpediaPackagesAjax")},evalScripts:true,method:"get"}).send()},1000)}}else{if(!ta.id("CHECK_MORE_SITES_LB")){setTimeout(function(){if(!ta.id("AVLB_HERO_PHOTOS")&&$$("#ALSO_VIEWED_PACKAGES .checking_sites")&&$("ALSO_VIEWED_AD")&&$("ALSO_VIEWED_AD").getSize().x>0){$$("#ALSO_VIEWED_PACKAGES .checking_sites").addClass("withAd")}var f=ta.id("ALSO_VIEWED_PACKAGES");if(f&&!ta.commerce.checkrates.hasPackagesNoResults()){f.show()}else{var e=ta.id("VR_CONTAINER");if(e){e.show()}}},2000)}}},showPackagesLoop:function(a){try{if(this.hasPackagesNoResults()){if(this.hasVRCrossSell()){this.showVR()}return}var b=ta.id("QUICK_CHECK_LB_PACKAGES");if(b&&b.hasClass("show_section")){return}if(this.hasPackagesReturned()&&!this.hasPackagesNoResults()){this.showPackages(false)}else{if(a==0){return}else{this.showPackagesLoop.delay(1000,this,a--)}}}catch(c){ta.util.error.record(c,"hotel packages - showPackagesLoop")}},showPackages:function(b){try{var c=$$(".packages")[0];var a=$$(".packages .checking_sites")[0].getSize().y;c.addClass("show_section");c.removeClass("hide_section");var f=new Fx.Tween(c,{duration:"long",property:"height"});f.start(0,a);if(b){f.addEvent("complete",this.transitionToAlsoViewed.bind(this))}}catch(d){ta.util.error.record(d,"hotel packages - showPackages");if(b){this.showAlsoViewed()}}},packagesClick:function(){try{var t="ExpediaPackageMeta2";var a=ta.id("hiddenReferrer");var h=ta.id("hiddenOrigin");var j=ta.id("hiddenDestination");var c=ta.id("hiddenPercentageSaved");var g=ta.id("hiddenGeo");var f=a.get("value");var u=h.get("value");var q=j.get("value");var v=g.get("value");var o=parseFloat(c.get("value"));var s=$$(".packages .savings");var k=s&&s.length>0?true:false;var p="Expedia";var i=ta.id("hiddenSource");if(i){p=i.get("value")}var l=ta.id("CHECK_MORE_SITES_LB")!=null;var b="";var m="";if(l&&k){b="QC_AlsoViewed_Packages1a";m="16221"}else{if(l){b="QC_AlsoViewed_Packages1b";m="16222"}else{if(k){b="QC_AlsoViewed_Packages2a";m="16269"}else{b="QC_AlsoViewed_Packages2b";m="16270"}}}if(p=="Orbitz"){b+="ORB"}var d="";if(o<7.5){d=1}else{if(o<10){d=2}else{if(o<12.5){d=3}else{if(o<15){d=4}else{d=5}}}}var n=window.open("about:blank","packages","width=800,height=600,scrollbars=1");ta.trackAttemptedCommerce("packages",b,t,d);new Request.JSONP({url:"/CheapFlightsCommerce",callbackKey:"jsonp",data:{AirProvider:t,from:f,area:b,slot:d,cnt:"1",Orig:u,Dest:q,geo:v,pid:m},onSuccess:function(w){try{var y=ta.id("hiddenDetailsUrl");if(y){var x=y.get("value");if(typeof(w)!="undefined"&&w!=null){if(typeof(w.icmcid)!="undefined"&&w.icmcid){x+="&icmcid="+w.icmcid}if(typeof(w.icmdtl)!="undefined"&&w.icmdtl){x+="&icmdtl="+w.icmdtl}}n.location=x}}catch(z){ta.util.error.record(z,"hotel packages - commerceClickCallback")}},method:"get"}).send()}catch(r){ta.util.error.record(r,"hotel packages - packagesClick")}return false},avafState:0,avafTimer:null,avafMoreExpandedSize:0,avafOut:function(d){try{if(ta.commerce.checkrates.avafState!=1){return}if(ta.commerce.checkrates.avafTimer==null){return}if(!d){d=window.event}if(!d){return}var a=(d.relatedTarget)?d.relatedTarget:d.toElement;var c=ta.id("ALSO_VIEWED_LIST");while(a&&a!=c&&a.nodeName!="BODY"){a=a.parentNode}if(a==c){return}clearTimeout(ta.commerce.checkrates.avafTimer);ta.commerce.checkrates.avafTimer=null;ta.commerce.checkrates.avafState=0}catch(b){ta.util.error.record(b,"also viewed - avafOut")}},avafExpand:function(b){try{ta.trk("AVAF_HOVER_EXPAND",false,b);ta.commerce.checkrates.avafState=2;var a=ta.id("expand_av_on_hover");if(!a){return}a.removeClass("hidden");a.addClass("expanding");var e=a.getSize().y;a.removeClass("expanding");a.addClass("show");var d=new Fx.Tween(a,{duration:"long",property:"height"});d.start(0,e)}catch(c){ta.util.error.record(c,"also viewed - avafExpand")}},avafMore:function(a,c){try{ta.trk("AVAF_EXPAND_"+(c?"MORE":"LESS"),false,(a)?(a.target||a.srcElement):null);if(c){var b=ta.id("hideableMore");if(!b){return}b.addClass("hidden");b=ta.id("expand_av_on_more");if(!b){return}b.removeClass("hidden");if(ta.commerce.checkrates.avafMoreExpandedSize==0){b.addClass("expanding");ta.commerce.checkrates.avafMoreExpandedSize=b.getSize().y;b.removeClass("expanding")}b.addClass("show");new Fx.Tween(b,{duration:"long",property:"height"}).start(0,ta.commerce.checkrates.avafMoreExpandedSize)}else{var b=ta.id("expand_av_on_more");if(!b){return}new Fx.Tween(b,{duration:"long",property:"height"}).start(b.getSize().y,0).chain(function(){b.removeClass("show");b.addClass("hidden");var e=ta.id("hideableMore");if(!e){return}e.removeClass("hidden")})}}catch(d){ta.util.error.record(d,"also viewed - avafMore")}},animatedShowHide:function(c,h,b){try{var f=ta.id(h);if(!f||!c){return}else{if(b==1){c.addClass("hidden")}var g=0;var a=0;if(f.hasClass("hidden")){f.removeClass("hidden");f.addClass("expanding");a=f.getSize().y;f.removeClass("expanding");f.addClass("show")}else{if(f.hasClass("show")){g=f.getSize().y;a=0}}new Fx.Tween(f,{property:"height",duration:"500"}).start(g,a).chain(function(){if(f.getSize().y==0){f.removeClass("show");f.addClass("hidden");f.setStyle("height","auto")}})}}catch(d){ta.util.error.record(d,"animatedShowHide")}},metaLbProviderHover:function(c,d,b){var a=ta.id("metaFlyout_"+d);if(!a){return}if(b){a.removeClass("hidden")}else{a.addClass("hidden")}},metaLbShowChecker:function(b,c){var a=ta.id("checker_"+c);if(!a){return}a.removeClass("hidden")},metaLbAltDates:function(i,b,g,d,j,a,c){var e,m,f;try{e=ta.util.date.create(i,b-1,g);m=ta.util.date.create(d,j-1,a);ta.widgets.calendar.setPageInDate(e);ta.widgets.calendar.setPageOutDate(m);var l=["inMonth="+b+"%20"+i,"inDay="+g,"outMonth="+j+"%20"+d,"outDay="+a];var k="http://"+document.domain+"/UpdateSessionDatesAjax?"+l.join("&");new Request({url:k,evalScripts:true,onSuccess:function(p){try{ta.widgets.calendar.syncAllDatePickers();ta.widgets.calendar.launchInlineMeta();var n=ta.retrieve("metaLeaveBehindOverlay");if(n){n.fireEvent("onClose",n);n.hide()}if(c){window.setTimeout(function(){window.location=c},800)}}catch(o){ta.util.error.record(o,"MetaLbV2 updates failed.")}}}).send()}catch(h){ta.util.error.record(h,"error constructing meta request with alternate dates")}},removeScooter:function(a){var c=ta.retrieve("scooterObj");if(c){c.removeScooter(c)}var b=ta.id(a);if(!b){return}b.parentNode.removeChild(b)},removeScooterPersistent:function(){try{ta.commerce.checkrates.removeScooter();Cookie.writeSession("SCL",1)}catch(a){}},showUncheckedProviders:function(){var d=this.checkMoreData.uncheckedProviders;var b=this.checkMoreData.alsoViewed;var c=ta.retrieve("vrCrossSellNew");if(d){var a=d.getSize().y;d.addClass("show_section");d.removeClass("hide_section");var e=new Fx.Tween(d,{duration:"long",property:"height"});e.start(0,a);if(this.hasPackagesResults()){e.addEvent("complete",this.transitionToPackages.bind(this))}else{if(b&&!c){e.addEvent("complete",this.transitionToAlsoViewed.bind(this))}else{e.addEvent("complete",this.transitionToVR.bind(this))}}}},actionRecord:function(a){new Request({url:"/ActionRecord?action="+a}).send()},transitionToAlsoViewed:function(){this.showAlsoViewed.delay(this.getDelaySecs(),this)},showAlsoViewed:function(){var a=this.checkMoreData.alsoViewed;var c=ta.retrieve("vrCrossSellNew");if(a){var b=a.getSize().y;a.addClass("show_section");a.removeClass("hide_section");var f=new Fx.Tween(a,{duration:"long",property:"height"});f.start(0,b);try{if(!this.isPackagesShowing()){if(this.shouldSendPackagesRequest()){f.addEvent("complete",this.showPackagesLoop.bind(this,10))}else{if(!c){f.addEvent("complete",this.transitionToVR.bind(this))}}}}catch(d){ta.util.error.record(d,"hotel packages - shouldSendPackagesRequest")}}},transitionToVR:function(){if(this.checkMoreData.VR){if(screen.height>=768){this.showVR.delay(2000,this)}else{this.actionRecord("VR_CROSS_SELL_SMALL_SCREEN")}}},showVR:function(){var b=this.checkMoreData.VR;var a=this.checkMoreData.alsoViewed;var d=ta.retrieve("vrCrossSellNew");if(b){var c=b.getSize().y;b.addClass("show_section");b.removeClass("hide_section");var e=new Fx.Tween(b,{duration:"long",property:"height"});e.start(0,c);ta.overlays.Factory.recordVRCrossSell();if(a&&d){e.addEvent("complete",this.transitionToAlsoViewed.bind(this))}}},removePCR:function(){var a=ta.retrieve("pcr.overlay");if(a){a.hide()}},daodaoPopTPW:function(n,g,t,r){var l=new ta.commerce.CheckRatesData({type:r,evnt:n},ta.commerce.checkrates.getPropIdFromCRElement(g),t,true);if(!l.validate()){return false}var m=l.getVendorSet().getVendors();var c=0;for(var o=0;o<m.length;o++){var j=m[o];if(j.isChecked()&&j.isAvailable()){c=o;j.opened=true;break}}var s=m[c];var p="daodaoTPW";var d=ta.retrieve("daodaoTPW");var k="/DaoDaoTabbedProviderWindow?first="+s.name+"&locId="+t+"&"+l.getUserData();try{if(d!=null){try{d.windowObject=window.open(k,p,"left=0,top=0,width="+screen.width+",height="+screen.height);d.windowObject.focus()}catch(q){ta.util.error.record(q,"daodao pop tpw one - reuse popup");return false}}else{var h=ta.popups.PopUtil.getHoldingWindowSet();var a=screen.width;if(h.length>0){d=h[h.length-1].repurpose(k,a)}else{var f=1;try{if(window.chrome){f=0}}catch(q){}var b={customWidth:a,customHeight:screen.height,name:p,url:k,scrollbars:f,left:0,top:0};d=ta.popups.PopUtil.createCheckRatesWindow(b)}}}catch(q){ta.util.error.record(q,"pop tpw - general");return false}if(d&&d.windowObject){ta.store("daodaoTPW",d);return d}return false},updateInlineFormElementRadio:function(d){var a=d.getElement("input[type=radio]");if(a){var e=a.id.substring(a.id.length-4);if(this.crSyncExtensions.contains(e)){var b=a.id.substring(0,a.id.length-4);var c=ta.id(b);if(c){c.checked=a.checked;var f=$$("#CHECK_RATES_CONT_SYNC form")[0];if(f){var g=f.getElement("#"+b+"_icr");g.checked=c.checked}}}else{var b=a.id;var c=ta.id(b);this.crSyncExtensions.each(function(i){var h=b+i;h=ta.id(h);if(h){h.checked=c.checked}})}}},daodaoPopOne:function(e,b,f,d){var g=new ta.commerce.CheckRatesData({evnt:b},f,d);if(!g.validate()||e<0){return false}var h=g.getVendorSet().getVendors();var c=h[e].name;h[e].name="";ta.commerce.checkrates.popOne(h[e],g,f);h[e].name=c;var a=ta.retrieve("disable_cr_href");if(a){return false}},popOne:function(a,c,b){try{if(a.hasWindow()){try{var d=a.window;d.windowObject=window.open(a.getUrl(c,b),d.name,d.winArgs);d.windowObject.focus()}catch(h){ta.util.error.record(h,"pop one - reuse popup");return false}}else{var i=a.name;var g=false;if(i=="hotels.com"){g=975}var f=ta.popups.PopUtil.getHoldingWindowSet();if(f.length>0){a.window=f[f.length-1].repurpose(a.getUrl(c,b),g)}else{var k=1;try{if(window.chrome){k=0}}catch(h){}var j={name:i,url:a.getUrl(c,b)};j.customWidth=g;j.scrollbars=k;a.window=ta.popups.PopUtil.createCheckRatesWindow(j)}}}catch(h){ta.util.error.record(h,"pop one - general");return false}if(a.window&&a.window.windowObject){a.opened=true;return a.window}return false},openProviderWindowUrl:function(i,e,b,g){var h=ta.asInt("commerce.provWinNum");h++;ta.store("commerce.provWinNum",h);var a=ta.retrieve("commerce.previousTpwNumbers");var d=a+"_"+h;if(!a){d=h}var f="TAProviderWindow_"+d;i=i+"&otpwn="+d;var j=window.open(i,f,this.getProviderWinArgs(d));j.focus();ta.store("commerce.TPWindow",j);var c=(function(){try{if(j.closed){clearTimeout(c)}else{var l=j.location.href;window.status=l}}catch(k){clearTimeout(c);new Request({url:"/ActionRecord?action=fbProvWin|id_"+e+"|ctrId_"+b+"|cv_"+g}).send()}}).periodical(1500);return j},addCustomUrlParams:function(c,b){var f=new RegExp("(&|\\?)area=[^&]*");c=c.replace(f,"$1area="+b);if(crPageServlet){var a=new RegExp("(&|\\?)from=[^&]*");c=c.replace(a,"$1from=HotelDateSearch_"+crPageServlet)}var d=c;try{c=ta.commerce.meta.tracking.updateUrlWithTiming(c,b)}catch(g){ta.util.error.record(g,"problem updating winUrl with timing in CheckRates.addCustomParams");c=d}return c},showProviders:function(){if(this.validateDates()){var a=$$("div.geoProviderHidden");if(a){a.removeClass("geoProviderHidden");a.addClass("geoProvider")}var c=ta.id("HotelDateSearch")||ta.id("HotelDateSearch_icr");if(c){var b=c.getElement("span.error_msg_geo");if(b){b.hide()}}}},validateDates:function(){var b=ta.id("checkIn_"+this.geoId)||ta.id("checkIn_"+this.geoId+"_icr");var e=ta.id("checkOut_"+this.geoId)||ta.id("checkOut_"+this.geoId+"_icr");if(!b||!e||!b.value||!e.value){return false}var d=this.parseDate(b.value);var c=this.parseDate(e.value);var a=this.dateErrorCheck(d);var f=this.dateErrorCheck(c);if(a&&f){return true}else{return false}},parseDate:function(b){var d=false;if(DATE_FORMAT&&b){var c=b.match(DATE_FORMAT.pattern);if(c){var e=parseInt(c[DATE_FORMAT.date].replace(/^0/,""));var a=parseInt(c[DATE_FORMAT.month].replace(/^0/,""));var f=parseInt(c[DATE_FORMAT.year].replace(/^0/,""));if(e>0&&e<32&&a>0&&a<13){if(f<100){f+=2000}d=ta.util.date.create(f,a-1,e)}}}return d},dateErrorCheck:function(c){if(!c||isNaN(c)){return false}var b=new Date();ta.util.date.normalize(b);var a=ta.util.date.create(b.getFullYear(),b.getMonth(),b.getDate()+330);if(c.getTime()<b.getTime()){return false}if(a.getTime()<c.getTime()){return false}return true},updateHiddenDateFields:function(e,b){var d=this.parseDate(b.value);var a=this.dateErrorCheck(d);if(a&&typeof(a)=="string"){if(a.replace(/^\s+|\s+$/g,"").length>0){alert(a)}return}var c=ta.id(b).overlay;if(c&&c.calendar){c.calendar.select(null,d)}},crSyncExtensions:["_pop","_icr","_pto","_per","_amo","_cro","_met","_imt","_pal","_inm"],_showSuppressedProviders:function(a){if(ta.retrieve("checkrates.datesChanged")){return}try{var b=ta.id(a);b.getElements(".unavailable").each(function(d){d.removeClass("unavailable");if(d.hasClass("js_ua_checked")){d.getElements("input").set("checked",true)}ta.commerce.checkrates.updateCRFormElement(d)});ta.store("checkrates.datesChanged",true)}catch(c){ta.util.error.record(c,"_showSuppressedProviders")}},findInlineCRLocationId:function(){var e=null;var f=ta.id("HotelDateSearch");if(f){var a=f.getElements("input[type=text]");for(var d=a.length;d--;){var b=a[d];var c=b.id.match(/_(\d+)/);if(c.length){e=c[1];break}}}return e},updateCRCalendar:function(c){if(c.form){ta.commerce.checkrates._showSuppressedProviders(c.form)}try{var b=c.before;var a=b.dayField;if(a&&/qcInDay_(\d+)/.test(a.id)){ta.commerce.checkrates.checkCRLimits(RegExp.$1)}}catch(d){ta.util.error.record(d,"update cal crLimits check")}ta.commerce.checkrates.updateCRFormElement(this);if(ta.id("META_UI_INLINE")){ta.commerce.checkrates.updateCRForm("_imt")}},checkCRLimits:function(g){try{if(!g){return}var d=new Date();var o=document.getElement('input[id*="qcInDay_'+g+'"]').value;var p=document.getElement('input[id*="qcInMonth_'+g+'"]').value;p=p.split("/");d.setDate(o);d.setMonth(p[0]-1);d.setFullYear(p[1]);var n=ta.retrieve("checkrates.vendors."+g);for(var h=0;h<n.length;h++){var m=n[h];if(m.hasDateLimits()){var c='input[id*="'+m.options.checkboxID+'"]';var f=document.getElement(c);if(f){var l=true;var b;var a=m.options.minDaysOut;if(a>0){b=new Date();b.setDate(b.getDate()+a);l=(d>=b)}var k=m.options.maxDaysOut;if(k>0&&l){b=new Date();b.setDate(b.getDate()+k);l=(d<=b)}if(f.getParent("li")){f.getParent("li").style.display=(l?"block":"none")}}}}}catch(j){ta.util.error.record(j,"check crLimits")}},updateCRFormElement:function(d){try{d=ta.id(d);var m=d.get("tag").toLowerCase();if(m=="li"){d=d.getElement("input[type=checkbox]")}var f=d.id.split("_")[0];var h=this.findInlineCRLocationId();var l=f+"_"+h;var c=d.id;var a=c.substring(c.length-4);var p=[l,l+"_icr",l+"_per",l+"_imt"];if(this.crSyncExtensions.contains(a)){for(var g=p.length;g--;){var l=p[g];if(l!=c){var o=ta.id(l);if(o){if(m=="li"&&a!="_pop"){o.checked=d.checked;var n=d.getParent("li");if(n&&!n.hasClass("unavailable")){var b=o.getParent("li");if(b){b.removeClass("unavailable")}}}else{if(m=="select"){o.selectedIndex=d.selectedIndex}else{if(m=="input"){var k=l.substring(l.length-4);if(!this.crSyncExtensions.contains(k)){k=""}this.updateCRFormElement_In(h,d,a,k)}}}}}}}}catch(j){ta.util.error.record(j,"updateCRFormElement")}},updateCRForm:function(a){try{if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers();return}var q=ta.id("HotelDateSearch"+a);var p=ta.id("HotelDateSearch");var f=["select","input[type=checkbox]","input[type=hidden]","input[type=text]"];if(q&&p){for(var l=f.length;l--;){var c=f[l];var s=p.getElements(c);var d=q.getElements(c);for(var h=d.length;h--;){var r=d[h];var o=r.id.split("_")[0];for(var g=s.length;g--;){var n=s[g];if(n.id.contains(o)){if(c=="input[type=checkbox]"){var t=n.getParent("li");if(t&&!t.hasClass("unavailable")){var b=r.getParent("li");if(b){b.removeClass("unavailable")}}}if(c=="select"){r.selectedIndex=n.selectedIndex}else{if(c=="input[type=checkbox]"&&a!="_pop"){r.checked=n.checked}else{if(!r.id.contains("hacPid")){r.value=n.value}}}}}}}}}catch(m){ta.util.error.record(m,"updateCRForm")}},updateCRFormElement_In:function(k,r,m,o){try{var l=r.id.match(/_(\d+)/)[1];var c=ta.id("checkIn_"+k+o);var b=ta.id("checkOut_"+k+o);var n=ta.id("checkIn_"+l+m);var i=ta.id("checkOut_"+l+m);var f=ta.id("qcInDay_"+k+o);var p=ta.id("qcOutDay_"+k+o);var g=ta.id("qcInDay_"+l+m);var d=ta.id("qcOutDay_"+l+m);var h=ta.id("qcInMonth_"+k+o);var s=ta.id("qcOutMonth_"+k+o);var j=ta.id("qcInMonth_"+l+m);var a=ta.id("qcOutMonth_"+l+m);if(c&&n&&b&&i&&f&&g&&p&&d&&h&&j&&s&&a){c.value=n.value;b.value=i.value;f.value=g.value;p.value=d.value;h.value=j.value;s.value=a.value}}catch(q){ta.util.error.record(q,"updateCRFormElement_In")}},availCheck:function(b){var a=ta.id("availability")&&ta.id("availability").value=="1";var d=ta.id(b).getElement(".overlaySrc");if(a&&d){var c=d.innerHTML;d.innerHTML=c.replace(/cid=(\w+_)?&amp;/,"")}},positionCheckRates:function(){try{var m=window.getScroll();var r=false;try{r=window.location.href}catch(l){}if(r){var j=ta.retrieve("pcr.initialUrl");if(!j){j=r;ta.store("pcr.initialUrl",j)}if(j!=r){ta.store("pcr.initialYPos",m.y);ta.store("pcr.initialUrl",r)}}var i=true;var a=ta.retrieve("pcr.initialYPos");if(a&&a>0){i=(Math.abs(a-m.y)>=100)}if(ta.retrieve("pcr.scrollPoint")<=0){var b=ta.id("CHECK_RATE");var o=document.getElement(".postShowMetaCR");var q=ta.id("BIG_ORANGE_CTA");var h=0;if(b){h=b.getPosition().y}if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&o){h=Math.max(h,o.getPosition().y)}if(q){h=Math.max(h,q.getPosition().y)}ta.store("pcr.scrollPoint",h)}var d=m.y>=ta.retrieve("pcr.scrollPoint")&&i;var f=$$(".overlayBG");if(d&&!ta.retrieve("pcr.overlay").visible&&!ta.has("pcr.keepHidden")&&!f.length&&!ta.has("pcr.disabled")){ta.store("pcr.initialYPos",-1);if(typeof(persistentCRCss)!="undefined"&&!ta.retrieve("ta.persCrCssAsset")){ta.store("ta.persCrCssAsset",Asset.css(persistentCRCss))}ta.retrieve("pcr.overlay").show();if(ta.id("PERSISTENT_HAC")){ta.servlet.HACSearch.updateHACFormCal(0,"_per");ta.servlet.HACSearch.updateHACFormAdults(0,"_per")}else{ta.commerce.checkrates.updateCRForm("_per")}if(!ta.id("PERSISTENT_CHECK_RATES_WRAP").hasClass("pcrStatic")){var g=ta.retrieve("pcr.overlay").container;g.setStyle("margin-top",-125);var c=new Fx.Tween(g,{duration:"300",transition:"bounce:out"});if(ta.has("checkrates.urgency_msg_placement_pcr")&&!ta.has("checkrates.urgencyMsgPCRShowing")){c.start("margin-top",-125,0).chain(function(){ta.commerce.checkrates.toggleUrgencyMessage.delay(1000,this,"_pcr")})}else{c.start("margin-top",-125,0)}}var n=ta.id("PERSISTENT_CHECK_RATES_WRAP").getElement(".miniMeta");var k=ta.id("PERSISTENT_CHECK_RATES_WRAP").getParent();if(!k.getElement(".drop_gradient")){var p=new Element("div.drop_gradient");p.inject(k,"bottom")}if(!ta.retrieve("pcr.firstShow")){ta.trackEventOnPage("PersistentCheckRates","shown","",1,true);ta.store("pcr.firstShow",true);ta.commerce.meta.updateProvAreaFromLightBox(ta.retrieve("page.location"))}}else{if(!d&&ta.retrieve("pcr.overlay").visible){ta.retrieve("pcr.overlay").hide();if(ta.retrieve("wechat_overlay")){ta.retrieve("wechat_overlay").hide()}ta.widgets.calendar.closeCalendarWidgets()}}}catch(l){window.removeEvent("scroll",ta.commerce.checkrates.positionCheckRates);ta.util.error.record(l,"pcr - positionCheckRates");return false}},_updateSecondaryFormElement_CB:function(){var a=ta.id("CHECK_RATES_CONT");if(a){var b=a.getElements("input.chk");b.each(function(f,d){var e=ta.id(f.id+"_pop");var c=ta.id(f.id+"_per");if(e){e.checked=f.checked}if(c){c.checked=f.checked}})}},openMetaProvider:function(d,e,k,p,g){e=ta.id(e);if(!e||!d){return}if(d.target.src){var q=d.target.src;if(q.contains("expandActive")){var m="ta.commerce.checkrates.isExpanded."+k+"."+p;ta.store(m,true);e.addClass("partnerExpanded").removeClass("partnerCollapsed");return}else{if(q.contains("contract")){var m="ta.commerce.checkrates.isExpanded."+k+"."+p;ta.store(m,false);e.addClass("partnerCollapsed").removeClass("partnerExpanded");return}}}if(p){var h=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+k);var l=false;if(h){l=h.getVendorSet()}else{h=new ta.commerce.CheckRatesData({type:"checkRates",evnt:d},ta.commerce.checkrates.getPropIdFromCRElement(e),k,true);l=h.getVendorSet()}if(h){h.actualTrigger=e}if(l){var o=l.getVendors();if(ta.retrieve("assisted_booking_desktop_entry")&&e.hasClass("bookableOffer")){a=ta.commerce.checkrates.getBookingUrl(k,p,g);if((ta.has("commerce_clicks_in_new_tab.isEnabled")&&typeof(a)!="undefined"&&a)||o.length<1){ta.commerce.checkrates.openMetaProviderNewTab(a)}else{var c=o[0];ta.commerce.checkrates.openMetaProviderWindow(c,h,a)}if(ta.browser.isIE10Metro()){var n=ta.remove("ta.meta.navArea");if(n=="QC_Meta_Book_Inline"){f="QC_Meta_Metro_Inline"}else{f="QC_Meta_Metro_Lightbox"}}else{f=ta.remove("ta.meta.navArea")||"QC_Meta_Lightbox"}ta.commerce.checkrates.logMetaUITestInfo();ta.commerce.checkrates.logLowestPriceTestInfo(e,p);if(f=="QC_Meta_Lightbox"){ta.commerce.checkrates.logMapSponsoredProviderClick(p)}ta.commerce.checkrates.logBlueChevronLowestPriceTestInfo(e,p);ta.commerce.checkrates.addClickOutPixels(k,true);return}for(var j=0;j<o.length;j++){var b=o[j];if(p==b.getContentID()){ta.commerce.checkrates._addTagManToDOM(b);var a=b.getUrl(h,e);var f;if(ta.browser.isIE10Metro()){var n=ta.remove("ta.meta.navArea");if(n=="QC_Meta_Book_Inline"){f="QC_Meta_Metro_Inline"}else{f="QC_Meta_Metro_Lightbox"}}else{f=ta.remove("ta.meta.navArea")||"QC_Meta_Lightbox"}a=ta.commerce.checkrates.addCustomUrlParams(a,f);if(g){a=a+"&m="+g}if(ta.has("commerce_clicks_in_new_tab.isEnabled")&&typeof(a)!="undefined"&&a){ta.commerce.checkrates.openMetaProviderNewTab(a)}else{ta.commerce.checkrates.openMetaProviderWindow(b,h,a)}ta.commerce.checkrates.trackMetaClick(o[j].name,f,k);ta.commerce.checkrates.logMetaUITestInfo();ta.commerce.checkrates.logLowestPriceTestInfo(e,p);if(f=="QC_Meta_Lightbox"){ta.commerce.checkrates.logMapSponsoredProviderClick(p)}ta.commerce.checkrates.logBlueChevronLowestPriceTestInfo(e,p);ta.commerce.checkrates.addClickOutPixels(k,true);return}}}}},openMetaProviderNewTab:function(a){window.open(a,"_blank")},openMetaProviderWindow:function(a,d,b){try{var i=a.name;var j=ta.popups.PopUtil.getProviderWindowDims(i,true);var g=ta.popups.PopUtil.getHoldingWindowSet();if(g.length>0&&d.useHoldingWin){g[g.length-1].repurpose(a.getUrl(d,elmt),j.customWidth,j.customHeight);if(d.skipHoldingWin){d.useHoldingWin=false}if(ta.has("checkrates.add_holding_windows")){if(a.window.type==ta.popups.PopUtil.windowType.CHECK_RATE){var f=ta.popups.PopUtil.getHoldingWindowSet().length;var c=window.cookieDomain;if(c){if(f>0){Cookie.write("CommercePopunder","HW"+f,{domain:c,duration:0})}else{Cookie.dispose("CommercePopunder",{domain:c})}}}}}else{var l=1;try{if(window.chrome){l=0}}catch(h){}var k={customWidth:j.customWidth,customHeight:j.customHeight,widthOffset:j.widthOffset,heightOffset:j.heightOffset,name:i,url:b,scrollbars:l};ta.popups.PopUtil.createCheckRatesWindow(k);if(window.IS_DEBUG){ta.store("ta.lastCommerceClickUrl",b)}}}catch(h){}},openMetaHacOverlay:function(d,a){if(ta.has("metaDatePickerEnabled")&&!ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.setErrorStyling(a);return}var c=d.getVendorSet().getCheckedContentID();var b=d.getVendorSet().getCheckedVendor();ta.store("ta.commerce.MetaHacOverlay.crData."+d.vendorSetId,d);ta.run("ta.overlays.Factory.metaCheckRatesOverlay",{},d,c,b,a)},multiDatePickerUserData:function(){var d=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();var c=ta.widgets.calendar.getPageAdultsCount();if(!d||!(d instanceof Date)||!b||!(b instanceof Date)){return}var a=[];a.push("inMonth=");a.push(d.getMonth()+1);a.push("%20");a.push(d.getFullYear());a.push("&inDay=");a.push(d.getDate());a.push("&outMonth=");a.push(b.getMonth()+1);a.push("%20");a.push(b.getFullYear());a.push("&outDay=");a.push(b.getDate());a.push("&adults=");a.push(c);return a.join("")},_parseDatePickerDate:function(c){if(c&&c.split&&c.split(" ").length>1){var a=c.split(" ");var b=new Date();b.setFullYear(a[0]);b.setMonth(a[1]);b.setDate(a[2]);return b}},buildMiniMetaHacUrl:function(c,b,l,f,h,i,k,j,d,g,e,a){return ta.commerce.checkrates.buildVarMetaHacUrl("MiniMetaCRAjax",c,b,l,f,h,i,k,j,d,g,e,a)},buildMetaHacUrl:function(c,b,j,e,f,g,i,h,d){var a=ta.commerce.checkrates.buildVarMetaHacUrl("MetaCheckRatesAjax",c,b,j,e,f,g,i,h,d);if(c&&ta.maps&&ta.maps.mapsponsor){if(typeof c.mapsponsor=="undefined"){c.mapsponsor=ta.maps.mapsponsor.getSponsorForLocation(c.vendorSetId)}if(c.mapsponsor){a+="&mapSponsorship="+c.mapsponsor}}return a},buildVarMetaHacUrl:function(m,x,r,q,u,l,G,n,s,o,j,k,a){var c=false;if(ta.browser.isIE10Metro()){if(G=="QC_Meta_Book_Inline"){c="QC_Meta_Metro_Inline"}else{c="QC_Meta_Metro_Lightbox"}}else{if(!G){if(ta.has("ta.meta.navArea")){c=ta.retrieve("ta.meta.navArea")}else{c="QC_Meta_Lightbox"}}else{c=G}}var p="";if(ta.has("metaDatePickerEnabled")){p=ta.commerce.checkrates.multiDatePickerUserData()}if(!p){p=x.getUserData();if(!p&&ta.retrieve("parentCheckRatesData")){var f=ta.retrieve("parentCheckRatesData");p=f.getUserData()}if(!ta.has("metaDatePickerEnabled")){if(!n){n=ta.commerce.checkrates.getTravelDataFromDOM()}if(n&&n.sInMonthYear&&n.sOutMonthYear&&n.inDay&&n.outDay&&n.adults){var b=n.sInMonthYear,H=n.sOutMonthYear,h=n.inDay,d=n.outDay,A=n.adults;var z=[];z.push("inMonth=");z.push(b[0]);z.push("%20");z.push(b[1]);z.push("&inDay=");z.push(h);z.push("&outMonth=");z.push(H[0]);z.push("%20");z.push(H[1]);z.push("&outDay=");z.push(d);z.push("&adults=");z.push(A);p=z.join("")}}}if(!p&&x){return"/"+m+"?detail="+x.vendorSetId}else{if(!p&&!x){return +"/"+m+"?detail="}}var w="";if(l){w="&metaVersion="+l}var C="";if(ta.has("meta.baseLocationId")){C="&baseLocId="+ta.retrieve("meta.baseLocationId")}var t="";if(ta.retrieve("checkrates.hr_bc_see_all_click")){t="&seeAllClick=true"}var g="/"+m+"?detail="+x.vendorSetId+"&"+p+"&area="+c+"&checkedContentID="+r+"&checkedContentNames="+q+w+C+t;var y=g;try{g=ta.commerce.meta.tracking.updateUrlWithTiming(g,c)}catch(F){ta.util.error.record(F,"problem updating url with timing in CheckRates.buildVarMetaHacUrl");g=y}if(ta.commerce.meta.tracking.hasAnySuppressedAreas()){var D=ta.commerce.meta.tracking.getSuppressedAreasAsString();if(D){g+="&suppressImpressionsOnComplete="+D}}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){y=g;try{g=ta.commerce.checkrates.checkSuppressCommerceImpressions(g,k);if(!g){g=y}}catch(F){ta.util.error.record(F,"problem updating url with isFirstPageLoad in CheckRates.buildVarMetaHacUrl");g=y}}if(u){g+="&finalRequest=true"}if(s){g+="&numTries="+s}if(j){g+="&loadingTimeoutPassed="+j}if(a){g+="&isDateChangedRequest="+a}if(o){var v=o[0];if(v){g+="&premiumContentId="+v;for(var B=1;B<o.length;B++){v=o[B];g+=","+v}}}var E="ta.commerce.MetaHacOverlay.currency";if(ta.has(E)){g+="&currency="+ta.retrieve(E);ta.remove(E)}return g},checkSuppressCommerceImpressions:function(a,c){if(!a||!c){return}suppressKey=c+"_suppressCommerceImpressionState";var b=ta.commerce.meta.polling.getPollingAttemptForRequest(c);if(b){if(b===1){if(ta.retrieve("meta.isFromDatesChange")){ta.remove("meta.isFromDatesChange");ta.store(suppressKey,true);a+="&isFirstPageLoad=false";return a}}else{if(ta.retrieve(suppressKey)){a+="&isFirstPageLoad=false";return a}}}return a},getTravelDataFromDOM:function(){var m={};if(!ta.widgets.calendar){return null}var b=ta.widgets.calendar.getPageInDate();var g=ta.widgets.calendar.getPageOutDate();var a=ta.widgets.calendar.hasPageDates();if(a&&b&&b.getMonth&&g&&g.getMonth){var h=ta.widgets.calendar.getPageAdultsCount();var d=new Array();d.push(b.getMonth()+1);d.push(b.getFullYear());var l=new Array();l.push(g.getMonth()+1);l.push(g.getFullYear());m.sInMonthYear=d;m.sOutMonthYear=l;m.inDay=b.getDate();m.outDay=g.getDate();m.adults=h}else{var f=ta.id("META_HAC_DATE_SELECTOR");if(!f){f=ta.id("META_HAC_DATE_SELECTOR_met")}if(!f){return null}var i=f.getElement(".chk-in .month"),c=f.getElement(".chk-in .day"),e=f.getElement(".chk-out .month"),k=f.getElement(".chk-out .day"),j=f.getElement(".adults select");if(!i||!c||!e||!k||!j){return null}m.sInMonthYear=i.value.split(/\//);m.sOutMonthYear=e.value.split(/\//);m.inDay=escape(c.value);m.outDay=escape(k.value);m.adults=j.selectedIndex+1}return m},buildMetaHacUrl_allProviders:function(f,p,i,l,z){var c=false;if(ta.browser.isIE10Metro()){if(z=="QC_Meta_Book_Inline"){c="QC_Meta_Metro_Inline"}else{c="QC_Meta_Metro_Lightbox"}}else{c=z||"QC_Meta_Lightbox"}var r="";if(i){r="&metaVersion="+i}var m="";if(ta.has("metaDatePickerEnabled")){m=ta.commerce.checkrates.multiDatePickerUserData()}else{if(!l){var u=ta.id("META_HAC_DATE_SELECTOR_met");if(!u){return}var q=u.getElement(".chk-in .month"),g=u.getElement(".chk-in .day"),x=u.getElement(".chk-out .month"),k=u.getElement(".chk-out .day"),b=u.getElement(".adults select");if(!q||!g||!x||!k||!b){return}var a=q.value.split(/\//),B=x.value.split(/\//),n=ta.util.date.create(a[1],a[0]-1,g.value),A=ta.util.date.create(B[1],B[0]-1,k.value);var t=[];t.push("inMonth=");t.push(a[0]);t.push("%20");t.push(a[1]);t.push("&inDay=");t.push(escape(g.value));t.push("&outMonth=");t.push(B[0]);t.push("%20");t.push(B[1]);t.push("&outDay=");t.push(escape(k.value));t.push("&adults=");t.push(b.selectedIndex+1);m=t.join("")}}var j="false";if(l&&!ta.has("metaDatePickerEnabled")){j="true"}var v="";if(ta.has("meta.baseLocationId")){v="&baseLocId="+ta.retrieve("meta.baseLocationId")}var o="";if(ta.retrieve("checkrates.hr_bc_see_all_click")){o="&seeAllClick=true"}var h="/MetaCheckRatesAjax?detail="+f+"&"+m+"&area="+c+r+"&returnAllOffers=true&useSessionDates="+j+v+o;var s=h;try{h=ta.commerce.meta.tracking.updateUrlWithTiming(h,c)}catch(y){ta.util.error.record(y,"problem updating url with timing in CheckRates.buildMetaHacUrl_allProviders");h=s}if(ta.commerce.meta.tracking.hasAnySuppressedAreas()){var w=ta.commerce.meta.tracking.getSuppressedAreasAsString();if(w){h+="&suppressImpressionsOnComplete="+w}}if(p){h+="&finalRequest=true"}if(ta.maps&&ta.maps.mapsponsor){var d=ta.maps.mapsponsor.getSponsorForLocation(f);if(d){h+="&mapSponsorship="+d}}return h},metaHacRequest:function(x,s,r,A,H,u,k){ta.commerce.meta.clearStoredMiniData();var h="metaHacRequest_curCancelKey";var d=13;var m=ta.retrieve("meta.travelData");var z=false;if(A==null){m=ta.commerce.checkrates.getTravelDataFromDOM();ta.store("meta.travelData",m);A=new Date().getTime();if(ta.commerce.meta&&x&&x.vendorSetId){if(H){ta.commerce.meta.loadBestPriceXsell(x.vendorSetId,"REC_CONT_INLINE",{isInline:true})}else{ta.commerce.meta.loadBestPriceXsell(x.vendorSetId,"REC_CONT",{isInline:false})}}var p=false;if(H){if(ta.has("metaCheckRatesUpdateDivInline")){p=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}}else{if(ta.has("metaCheckRatesUpdateDiv")){p=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}}if(p&&p.removeClass){p.removeClass("hidden")}if(ta.has("metaUI.hrTestComHvy")){var v=ta.id("COMHVY");if(v){v.removeClass("noDates");v.addClass("hasDates")}var F=ta.id("OPEN_CAL_PRNT");if(F){F.empty()}}if(ta.has("metaUI.hrTestComHvy")){if(ta.has("metaUI.hiddenAV")){var a=ta.retrieve("metaUI.hiddenAV");if(a&&a.removeClass){a.removeClass("hidden")}ta.remove("metaUI.hiddenAV")}}}var i="metaHacRequest_"+A+"_cancel";if(ta.has(h)){var E=ta.retrieve(h);if(E!=i){ta.store(E,true);ta.commerce.meta.polling.removePollingInfoForRequest(E)}}if(H){var g=document.getElement(".meta_rates_content .postShowMetaCR");var q=document.getElement(".meta_rates_content .postShowMetaCRLB");var b=document.getElement(".meta_rates_content .postShowMetaCRLBPCR");var G=ta.id("PROVIDER_BLOCK_INLINE");ta.commerce.meta.updateProvArea(g,q,b,G);if(ta.retrieve("stateopt_modal_test")&&ta.retrieve("worst_hack_ever")){var n=document.getElement(".stateoptModalLink");if(n&&n.click){n.click();ta.store("worst_hack_ever",false);ta.store("stateoptModal.GA_auto",true)}}}if(!ta.has(i)){ta.store(i,false);ta.store(h,i)}if(ta.retrieve(i)==true){return}var C=ta.retrieve("metaCheckRatesOverlay");if(!x||(!C&&!H)){return}var y=false;if(C){y=C.inner}if(ta.has("metaCheckRatesUpdateDiv")){y=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(H&&ta.has("metaCheckRatesUpdateDivInline")){y=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}if(!y){return}try{y.innerHTML=ta.commerce.checkrates._setCollapseExpand(x,y.innerHTML);if(ta.retrieve("metaChangeDateClicked")){ta.commerce.checkrates.removeProviderCheckboxClick();ta.remove("metaChangeDateClicked")}if(ta.retrieve("metaAvailSectionsCheckboxEnabled")){ta.commerce.checkrates.restoreProviderCheckboxClick()}var B;if(ta.commerce.meta.polling.isRequestBeingPolled(i)){B=ta.commerce.meta.polling.getPollingAttemptForRequest(i);if(!B||B>d){ta.commerce.meta.polling.removePollingInfoForRequest(i);return}}else{B=1;ta.commerce.meta.polling.setPollingAttemptForRequest(i,B)}if(!y.innerHTML.contains("hacComplete")){var c=false;if(H){c="QC_Meta_Inline"}if(!u){u=1}if(ta.isMetaHotelMBP2013()&&typeof(ta.commerce.meta)!="undefined"){ta.commerce.meta.hideMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}var w="";if(ta.widgets.calendar.getPageInDate()&&ta.widgets.calendar.getPageOutDate()){w=ta.commerce.checkrates.buildMetaHacUrl(x,s,r,true,k,c,m,u)}setTimeout(function(){new Request({url:w,onSuccess:function(e,I){if(ta.retrieve(i)==true){return}if(ta.retrieve("metaCheckRatesOverlay")||ta.retrieve("metaCheckRatesUpdateDivInline")){e=ta.commerce.checkrates._setCollapseExpand(x,e);y.innerHTML=e;if(ta.retrieve("checkrates.meta_ui_sk_box")){ta.commerce.meta.restoreProviderHover()}}if(ta.retrieve("metaChangeDateClicked")){ta.commerce.checkrates.removeProviderCheckboxClick();ta.remove("metaChangeDateClicked")}if(ta.retrieve("metaAvailSectionsCheckboxEnabled")){ta.commerce.checkrates.restoreProviderCheckboxClick()}if((ta.commerce.checkrates.getMetaPricesCount(H)>0||B>9)&&ta.commerce.meta.hacIsBlockingXSell(H)){if(H){ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}ta.commerce.checkrates.updateMetaProviders(x);ta.store("ta.commerce.checkrates.hacAttempt",B+1);if(ta.retrieve("meta.dropdownMiniMeta")){ta.commerce.checkrates.updateDropdownFlyout(e)}if(ta.has("meta.isHackathonBC")){if(ta.has("meta.bc.isMetaUIStateOptNoAvail")||ta.has("isMetaUIStateOptNoAvailXsellRhs")){ta.commerce.meta.updateStateOptHRNoAvailUI(e)}}ta.commerce.meta.polling.incrementPollingAttemptForRequest(i);ta.commerce.checkrates.metaHacRequest(x,s,r,A,H,u+1,k)},evalScripts:true}).send()},ta.commerce.meta.polling.getPollingWaitTimeForRequest(i))}else{try{ta.commerce.meta.polling.removePollingInfoForRequest(i);if(H){ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}if(C){ta.commerce.meta.storeMiniData(C.inner)}var o=ta.commerce.checkrates._getAvailCount(y);var j;var t="complete";if(H){if(ta.id("COMHVY")){j="Mini-Meta";if(ta.find(".NotShowing .postClickPrice")){t+="_may_be_available"}else{if(ta.find("#HotelDateSearch .price .minCost")){if(ta.find(".strikeHigh")){t+="_available_lp_chevron"}else{t+="_available"}}else{t+="_unavailable"}}}else{j="Metainline"}}else{j="meta_lightbox"}if(y.innerHTML.contains("doneNoAvailability")){ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_EMPTY",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount());if((ta.id("MAYBE_BUTTONS_INLINE")&&H)||(ta.id("MAYBE_BUTTONS")&&!H)&&j!="Mini-Meta"){t+="|may_be_availabile"}else{if(j!="Mini-Meta"){t+="|unavailable"}}}else{ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_PRESENT",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount())}ta.trackEventOnPage(j,t,o.toString());ta.commerce.meta.showLowestPriceCTA(H);if(ta.isMetaHotelMBP2013()&&typeof(ta.commerce.meta)!="undefined"){if(y.innerHTML.contains("hacMiniOfferUnavailable")){ta.commerce.meta.loadMiniMetaCrossSell(ta.retrieve("meta.baseLocationId"),"MINI_META_CROSS_SELL",false,false);ta.commerce.meta.showMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}else{ta.commerce.meta.hideMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}}if(ta.has("tests.bookingcom")&&ta.tests&&ta.tests.bookingcom){ta.tests.bookingcom.chkLightbox()}var l=ta.find(".overlay .skv3");if(l&&l.hasAttribute("data-sponsor")){var f=l.getAttribute("data-sponsor");ta.maps.ads.injectMetaLightBoxAd(f)}}catch(D){ta.util.error.record(D,"ta.commerce.meta.metaHacRequest - failure in complete results block")}}}catch(D){ta.util.error.record(D,"meta HAC - ajax requests")}},getMetaPricesCount:function(a){var c=0,e;var b=ta.retrieve("metaCheckRatesOverlay");var d=false;if(b){d=b.inner}if(ta.has("metaCheckRatesUpdateDiv")){d=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(a&&ta.has("metaCheckRatesUpdateDivInline")){d=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}if(!d){return}if(ta.retrieve("meta_ui_lightbox_chevron.enabled")){e=d.getChildren("#HR_HACKATHON_CONTENT .roomPrice")}else{e=d.getChildren(".metaProvider .roomPrice")}if(e){c=e.length}return c},_getAvailCount:function(c){var d;var e;var a=0;var b=0;c=ta.id(c);if(ta.retrieve("meta_ui_lightbox_chevron.enabled")){e=c.getChildren("#HR_HACKATHON_CONTENT .roomPrice");d=c.getChildren("#HR_HACKATHON_CONTENT .textLinks .offer .price")}else{e=c.getChildren(".metaProvider");d=c.getChildren(".remainingProviders .available")}if(e){a=e.length}if(d){b=d.length}return a+b},miniMetaReportLateAvailability:function(){var c=document.getElement("#CHECK_RATES_CONT div.hacMiniComplete");var a=document.getElement("#CHECK_RATES_CONT div.hacMiniCompleteTimeOut");if(c||a){return}var b=document.getElement("div.bc_flags");if(b){b.addClass("hacMiniCompleteTimeOut")}ta.commerce.checkrates.cancelMiniMetaCurrentQuery();ta.commerce.checkrates.gaHacCompleteAndStillLoading()},miniMetaAppearLoaded:function(f,e,c,b,a){var d=document.getElement("#CHECK_RATES_CONT div.hacMiniComplete");if(d){return}ta.commerce.checkrates.cancelMiniMetaCurrentQuery();ta.commerce.checkrates.gaHacCompleteOrTimedOut(b,true);ta.commerce.checkrates.removePremiumsIfLoading();ta.commerce.checkrates.loadingTextLinksToVisitSite();ta.commerce.checkrates.miniMetaHacRequest(f,e,c,new Date().getTime(),a+1,true)},loadingTextLinksToVisitSite:function(){var d=document.getElements("#CHECK_RATES_CONT span.textLink");var g=[];var j=[];var a=[];var b=[];var f=0;if(!d){return}for(var e=0;e<d.length;e++){var k=d[e];if(e<3){g.push(k)}var n=k.getElement(".textLinkLoading");var m=k.getElement(".sprite-visitSite");if(k.getElement(".price")){j.push(k)}else{if(n||m){if(n&&m){n.hide();m.show()}a.push(k)}else{b.push(k)}}if(k.hasClass("remaining")){f++}if(e>2){k.dispose()}}var o=d.length-f;var p=[];var h=true;var l=document.getElement("#CHECK_RATES_CONT div.textLinks");var c;if(l){c=l.getElement(".wrap")}if(!c){return}p.push.apply(p,j);p.push.apply(p,a);p.push.apply(p,b);for(e=0;e<p.length;e++){k=p[e];if(e<3){if(h&&k.get("data-contentid")==g[e].get("data-contentid")){k=d[e]}else{h=false;g[e].dispose()}}var q=e%2==0;if(q){k.addClass("odd")}else{k.removeClass("odd")}if(o<1){k.addClass("remaining")}else{k.removeClass("remaining")}o--;if(!h||e>2){k.inject(c,"bottom")}}},removePremiumsIfLoading:function(){var b=document.getElements("#CHECK_RATES_CONT div.premium");for(var a=0;a<b.length;a++){var c=b[a];if(c.getElement(".loading")){c.dispose()}}},cancelMiniMetaCurrentQuery:function(){var a="miniMetaHacRequest_curCancelKey";if(ta.has(a)){var b=ta.retrieve(a);ta.store(b,true);ta.commerce.meta.polling.removePollingInfoForRequest(b)}},updateInterrupter:function(b){var d=0;for(var c=0;c<b.length;c++){if(b[c].hasClass("interrupterContent")){d=b[c];break}}if(d){var a=document.getElement("#MINI_META_IN_REVIEWS");if(a){if(a.getElement(".interrupterContent")){a.getElement(".interrupterContent").destroy()}d.inject(a);ta.widgets.calendar.syncAllDatePickers();if(ta.has("ta.mmir.newDates")&&d.hasClass("loading")){if(ta.has("hac.progress.timer")){ta.remove("hac.progress.timer").stopTimer()}if(document.getElement(".interrupterProgressBar")){ta.store("hac.progress.timer",new ta.hac.RequestTimer({showProgressBar:true,triggerLoadingState:false,triggerListingsLoadState:false,trackProgress:false,progBarContainerSelector:".interrupterProgressBar",forceResults:false}))}ta.remove("ta.mmir.newDates")}else{if(ta.has("hac.progress.timer")&&!d.hasClass("loading")){ta.retrieve("hac.progress.timer").closeProgressBar()}}}}},miniMetaHacRequest:function(r,p,o,s,q,b){if(!q){q=0}if(!b){b=false}var e="miniMetaHacRequest_curCancelKey";var d=13;var h=ta.retrieve("meta.travelData");if(s==null){h=ta.commerce.checkrates.getTravelDataFromDOM();ta.store("meta.travelData",h);ta.store("ta.commerce.checkrates.hacAttempt",0);s=new Date().getTime()}var f="miniMetaHacRequest_"+s+"_cancel";if(ta.retrieve(f)==true){return}if(ta.has(e)){var v=ta.retrieve(e);if(v!=f){ta.store(v,true);ta.commerce.meta.polling.removePollingInfoForRequest(v)}}if(!ta.has(f)){ta.store(f,false);ta.store(e,f)}var u;if(ta.commerce.meta.polling.isRequestBeingPolled(f)){var u=ta.commerce.meta.polling.getPollingAttemptForRequest(f);if(!u||u>d){ta.commerce.meta.polling.removePollingInfoForRequest(f);return}}else{u=1;ta.commerce.meta.polling.setPollingAttemptForRequest(f,u)}var k=[];if(b){var w=$$("#CHECK_RATES_CONT div.premium");for(var t=0;t<w.length;t++){var c=w[t].get("data-contentid");k.push(parseInt(c))}}var j="miniMetaHacRequest_longTimeoutKey";var m="miniMetaHacRequest_appearLoadedTimeoutKey";if(q<1){if(ta.retrieve("hotels.datesChanged")&&ta.has("hac_timezone_awareness")){ta.servlet.HACSearch.clearDateFieldHighlighting();ta.remove("hac.dateBumped");var g=document.getElement("#HAC_DATES_MOVED_FORWARD.date_warn_bubble");if(g){g.addClass("hidden")}var n=document.getElement(".legend.metaDatesChosen.hidden");if(n){n.removeClass("hidden")}}var l;if(ta.has(j)){l=ta.retrieve(j);clearTimeout(Number.from(l))}if(ta.has(m)){l=ta.retrieve(m);clearTimeout(Number.from(l))}l=setTimeout(function(){ta.commerce.checkrates.miniMetaReportLateAvailability()},ta.commerce.minimeta.ajax.MINI_META_STOP_LOADING_TIMEOUT);ta.store(j,Number.from(l))}if(ta.isMetaHotelMBP2013()&&typeof(ta.commerce.meta)!="undefined"){ta.commerce.meta.hideMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.store("meta_guests_field_v2.CTAActivated",false)}var a=ta.retrieve("hotels.datesChanged");new Request({url:ta.commerce.checkrates.buildMiniMetaHacUrl(r,p,o,true,null,"QC_Meta_Mini",h,q,k,b,f,a),onSuccess:function(J,i){if(ta.retrieve(f)==true){return}if(ta.has("one_month_cal_layout")){var y=document.getElement(".inline_calendar");if(y&&!y.hasClass("hidden")){return}}var G=new Element("div",{html:J});var U=J.contains("hacMiniComplete");var O=document.getElement(".similarCarousel");var L=Elements.from(J);if(!O||q<1){ta.commerce.meta.updateProvArea(L.filter(".postShowMetaCR")[0],L.filter(".postShowMetaCRLB")[0],L.filter(".postShowMetaCRLBPCR")[0],L.filter("#PROVIDER_BLOCK_INLINE")[0]);ta.commerce.minimetapersist&&ta.commerce.minimetapersist.update(L.filter("#MINI_META_DATA")[0]);if(ta.has("ta.mini_meta_in_reviews")){ta.commerce.checkrates.updateInterrupter(L)}}if(ta.retrieve("meta.dropdownMiniMeta")){if(!document.getElement(".dropdownMiniMeta")){var C=document.getElement(".postShowMetaCR");if(C){ta.commerce.checkrates.injectDropdownMiniMeta(J,C)}}ta.commerce.checkrates.updateDropdownFlyout(J)}if(ta.has("meta.isHackathonBC")&&!b){if(ta.has("meta.bc.isMetaUIStateOptNoAvail")||ta.has("isMetaUIStateOptNoAvailXsell")){ta.commerce.meta.updateStateOptHRNoAvailUI(J)}}if(ta.has("meta.isHackathonBC")&&ta.has("meta.horizontal_xsell_enabled")){ta.commerce.meta.horizontalXSell.updateHorizontalXSell(G,r.vendorSetId)}if(ta.has("meta.isHackathonBC")&&L&&L.length>0){var N=ta.id("META_COMMERCE_BUTTON");var H=L[0];if(N&&H){var S=H.getElement(".price");var R=H.getElement(".offer")?H.getElement(".offer").get("data-contentid"):null;var V=H.getElement(".offer")?H.getElement(".offer").get("data-provider"):null;if(V){var D=H.getElement(".providerLogo");var F=D&&D.getElement("img")?D.getElement("img").get("alt"):null;if(V.contains("Com")&&!F.contains("Com")){V=F}}if(V&&S&&R){var W=document.getElement(".noRequest");if(W){W.removeClass("noRequest")}var Q=N.get("onclick");var M="Meta_Thumbnail";var E=Q.indexOf("this")+7;var B=Q.lastIndexOf(",")-1;var P=Q.substring(E,B);N.removeEvents("click");N.addEvent("click",function(Y){ta.commerce.meta.updateNavArea(M);ta.call("ta.commerce.checkrates.openMetaProvider",Y,this,P,R)});var K=".price";N.getElement(K).innerHTML=S.innerHTML;var x=".provider";N.getElement(x).innerHTML=V}else{var A=document.getElement(".metaClickOnHero");if(A){A.addClass("noRequest")}}}}if(!U&&ta.has("meta.isHackathonBC")&&J.contains("firstRequest")){l=setTimeout(function(){ta.commerce.checkrates.miniMetaAppearLoaded(r,p,o,s,q)},ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT);ta.store(m,Number.from(l))}if(!U){if(ta.has("meta.isHackathonBC")&&J.contains("anyOfferCompletedSuccessfully")){ta.commerce.meta.updateHeaderMsg(".metaDatesChosen",ta.retrieve("meta.bc.bestPricesForYourStay"))}ta.commerce.meta.polling.incrementPollingAttemptForRequest(f);setTimeout(function(){ta.commerce.checkrates.miniMetaHacRequest(r,p,o,s,q+1,b)},ta.commerce.meta.polling.getPollingWaitTimeForRequest(f))}else{if(ta.isMetaHotelMBP2013()&&typeof(ta.commerce.meta)!="undefined"){ta.commerce.meta.polling.removePollingInfoForRequest(f);if(J.contains("hacMiniOfferUnavailable")){ta.commerce.meta.showMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}else{ta.commerce.meta.hideMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}}else{if(ta.has("meta.isHackathonBC")){var z="meta.bc.bestPricesForYourStay";if(J.contains("allNotAvailable")){z="meta.bc.pricesTravelSitesNotAvailDates"}ta.commerce.meta.updateHeaderMsg(".metaDatesChosen",ta.retrieve(z));ta.commerce.meta.polling.removePollingInfoForRequest(f);ta.commerce.meta.displayBlueChevronLowestPriceCTA();if(ta.has("tests.bookingcom")&&ta.tests&&ta.tests.bookingcom){ta.tests.bookingcom.chkHR(true)}if(!b){ta.commerce.checkrates.gaHacCompleteOrTimedOut(s,false)}if(ta.has("meta.bc.isMetaUIStateOptNoAvail")||ta.has("isMetaUIStateOptNoAvailXsell")){ta.commerce.meta.updateStateOptHRNoAvailUI(J)}var T=document.getElement(".similarCarousel");if(b&&T){ta.commerce.checkrates.gaHacCompletedAfterTimeOut(J)}setTimeout(function(){ta.commerce.checkrates.gaHacCompleteAndStillLoading()},1000)}}}if(U&&ta.retrieve("meta_urgency_messaging.enabled")){var I=ta.id("META_URGENCY_MESSAGE");if(I&&I.hasClass("hidden")){var X=35;I.setStyles({height:0,opacity:0});I.removeClass("hidden");new Fx.Tween(I).start("height",0,X).chain(function(){I.setStyle("height","auto");this.start("opacity",0,1)})}}if(U&&ta.retrieve("hotels_to_seo_hotels_redirect")&&a&&!b){ta.commerce.meta.seoRedirectIfAllUnavail&&ta.commerce.meta.seoRedirectIfAllUnavail(J);if(ta.retrieve("seo_hr_maybe_available_redirect")){ta.commerce.meta.seoRedirectIfMayAvail&&ta.commerce.meta.seoRedirectIfMayAvail(J)}}},evalScripts:true}).send()},gaHacCompleteAndStillLoading:function(){var a=ta.commerce.checkrates.getNumOffersStillLoading();if(a>0){ta.trackEventOnPage("HAC","HACError","LoadingAfterHACComplete",a,true)}},gaHacCompleteOrTimedOut:function(g,j){var c=0;var h="unknown";if(j){c=ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT;var i=ta.commerce.checkrates.getNumOffersStillLoading();var b=document.getElements("#CHECK_RATES_CONT div.premium");var d=document.getElements("#CHECK_RATES_CONT span.textLink");var f=0;if(b){f+=b.length}if(d){f+=d.length}var a=f-i;if(f>0){var e=Math.round((a/f)*10)*10;if(e%10==0&&e>-1&&e<101){h=""+e+"percent"}}}else{c=new Date().getTime()-g;h="100percent"}ta.trackEventOnPage("HAC","HACComplete",h,c,true)},getNumOffersStillLoading:function(){var c=document.getElements("#CHECK_RATES_CONT span.textLinkLoading");var b=document.getElements("#CHECK_RATES_CONT div.loading");var a=0;if(c){a+=c.length}if(b){a+=b.length}return a},gaHacCompletedAfterTimeOut:function(e){var d=Elements.from(e)[0];if(!d){return}var c=d.getElementsByClassName("price");var b=d.getElementsByClassName("priceBlock");var a=0;if(c){a+=c.length}if(b){a+=b.length}ta.trackEventOnPage("HAC","StateCarouselDisplayed","",a,true)},injectDropdownMiniMeta:function(c,a){responseXML=new Element("div",{html:c});var b=responseXML.getElement(".dropdownMiniMeta");if(b){b.inject(a)}},updateDropdownFlyout:function(c){var a=document.getElement(".rgba_flyout.dropdownMiniMeta");if(a){responseXML=new Element("div",{html:c});var b=responseXML.getElement(".dropdownMiniMeta");if(b){var d=a.getElement(".inner");d.innerHTML="";b.set("class","dropdownMiniMeta");d.adopt(b)}ta.commerce.checkrates.setDropdownHoverState()}},setDropdownHoverState:function(){if(ta.retrieve("dropdownMiniMeta.hover")){ta.commerce.meta.hoverTopOffer()}else{if(ta.retrieve("dropdownMiniMeta.blur")){ta.commerce.meta.blurTopOffer()}}},updateMetaProviders:function(e){var m=e.getVendorSet();var o=m.getVendors();var f=ta.id("META_UI_AVAIL_SECTIONS");for(var g=0;g<o.length;g++){var h=o[g].getContentID();var d=o[g].vendorName;var k=o[g].options.image;var l=ta.id("partner_"+h);if(l&&d){var c="";if(!f&&e.options.type!="meta_inline_checkrates"){if(k){var b="82";c='<div class="partnerImage"><img src="'+CDNHOST+"/img2/"+k+'" alt="'+d+'" width="'+b+'"></div>'}else{c='<div class="partnerName">'+d+"</div>"}}l.innerHTML=c+l.innerHTML.replace(/@@partnerName@@/g,d)}}var p=document.getElement("#CHECK_RATES_CONT ul.provider");var n=document.getElement("#META_HAC_DATE_SELECTOR .providerContainer");if(!n){n=document.getElement("#META_HAC_DATE_SELECTOR_met .providerContainer")}if(p&&p.length>0&&n&&n.length>0){n[0].innerHTML=p[0].outerHTML}var j=document.getElement("#META_UI_AVAIL_SECTIONS .meta_title_div");if(j){var a=document.getElement("#META_UI_AVAIL_SECTIONS .meta_title_replace");j.innerHTML=a.innerHTML}},showMetaDateSelector:function(){var b=ta.id("META_HAC_DATE_SELECTOR"),a=ta.id("META_HAC_ROOM_LIST");if(!b){b=ta.id("META_HAC_DATE_SELECTOR_met")}if(b){if(this.metaTimeout){clearTimeout(this.metaTimeout)}this.checkAllProviders();b.show();if(a){a.hide()}ta.store("ta.commerce.checkrates.hide_room_types",true)}},selectCheckboxForProvider:function(c){if(!c){return}var b=document.getElementById(c);var a=b&&b.getNext(".checkbox_ui");if(b){b.checked=!b.checked;ta.commerce.checkrates.storeProviderCheckboxClick(c)}if(a){a.toggleClass("checked");if(a.hasClass("checked")){a.setProperty("src",CDNHOST+"/img2/ui/checkbox_org_checked.gif")}else{a.setProperty("src",CDNHOST+"/img2/ui/checkbox_org_unchecked.gif")}}},storeProviderCheckboxClick:function(b){var a=document.getElementById(b);ta.store(b,a)},restoreProviderCheckboxClick:function(){var b=document.getElements("#META_UI_AVAIL_SECTIONS #META_HAC_ROOM_LIST .chk");var a=document.getElements("#META_UI_AVAIL_SECTIONS #META_HAC_ROOM_LIST .checkbox_ui");b.each(function(d){var c=ta.retrieve(d.id);if(c){d.checked=c.checked}});a.each(function(d){var c=ta.retrieve(d.name);if(c){if(c.checked){d.addClass("checked");d.setProperty("src",CDNHOST+"/img2/ui/checkbox_org_checked.gif")}else{d.removeClass("checked");d.setProperty("src",CDNHOST+"/img2/ui/checkbox_org_unchecked.gif")}}})},checkAllProviders:function(){var a=document.getElements('.provider input[type="checkbox"]');ta.commerce.checkrates.selectAllCheckBoxes(a)},selectAllCheckBoxes:function(a){a.each(function(b){b.checked=true;ta.commerce.checkrates.storeProviderCheckboxClick(b.id)})},_setCollapseExpand:function(b,h){var l=b.getVendorSet().getVendors();var f=0;for(var e=0;e<l.length;e++){var k=l[e];var d=k.propertyId;var a=k.getContentID();var j="ta.commerce.checkrates.isExpanded."+d+"."+a;var c=ta.retrieve(j);if(d&&a){var g="collapseExpand_"+d+"_"+a;if(c){h=h.replace(g,"partnerExpanded")}else{h=h.replace(g,"partnerCollapsed")}}}return h},changeMetaDates:function(c,b){var a=ta.id("META_HAC_DATE_SELECTOR_met");if(a){a.setStyle("display","block");b.destroy()}if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}},partnerHoverOn:function(c,b){var a=b;while(a&&!a.hasClass("partner")){a=a.parent}if(a){a.addClass("partnerHvr")}},partnerHoverOff:function(c,b){var a=b;while(a&&!a.hasClass("partner")){a=a.parent}if(a){a.removeClass("partnerHvr")}},toggleUrgencyMessage:function(m){try{if(!m){m=""}var c=ta.id("URGENCY_MESSAGE"+m);if(!c){return}var d=false;var l=false;var i=false;var j=false;var a="";var f="";var b=false;if(c.hasClass("slide_in")){var n=document.getElement("#HotelDateSearch .provider");b=document.getElement("#BODYCON .col.balance");if(n&&b){var h=n.getCoordinates();var k=b.getCoordinates();c.style.top=(h.top-k.top)+"px";c.style.left=(k.width+7)+"px";b.style.position="relative";j=h.left-k.left+70}a="slide_in";b.addClass("hide_x_overflow")}else{if(c.hasClass("middle")){var n=document.getElement("#HotelDateSearch .provider");if(n){var h=n.getCoordinates();var b=ta.id("PAGE");c.style.top=h.top+"px";c.style.left=(h.left+70)+"px"}a="middle"}else{if(m=="_pcr"){var n=document.getElement("#PERSISTENT_CHECK_RATES .fl");if(n){var b=document.getElement("#PERSISTENT_CHECK_RATES");var h=n.getCoordinates(b);c.style.top=h.top+"px";c.style.left=(h.right+10)+"px"}a="pcr"}else{if(c.hasClass("top_right")){var b=document.getElement("#HEAD .masthead");a="top_right"}else{if(c.hasClass("bottom_right")){a="bottom_right"}}}}}if(b){b.grab(c.dispose())}if(c.hasClass("anim_left")){l="left";i=c.style.left;d=new Fx.Tween(c,{transition:"quad:out",duration:"1500"});f="left"}else{if(c.hasClass("anim_height")){l="height";i=0;j=c.getSize().y;d=new Fx.Tween(c,{transition:"quad:out",duration:"500"});c.style.height="0px";f="height"}else{if(c.hasClass("anim_opacity")){l="opacity";i=0;j=1;d=new Fx.Tween(c,{transition:"bounce:out",duration:"250"});c.addClass("opacity_0");f="opacity"}}}c.removeClass("hide_section");if(ta.has("checkrates.urgency_msg_once")){d.start(l,i,j);if(m=="_pcr"){ta.store("checkrates.urgencyMsgPCRShowing",true)}else{d.chain(function(){this.start.delay(6000,this,[l,j,i])});if(c.hasClass("slide_in")){d.chain(function(){c.addClass("hide_section");if(b.hasClass("hide_x_overflow")){b.removeClass("hide_x_overflow")}})}}}else{d.start(l,i,j).chain(function(){this.start.delay(6000,this,[l,j,i])},function(){this.start.delay(4000,this,[l,j,i])},function(){this.start.delay(6000,this,[l,j,i])})}ta.trackEventOnPage("UrgencyMessage",f,a,1,true)}catch(g){ta.util.error.record(g,"urgency messaging")}},_addTagManToDOM:function(b){if(b.options.trackClick){var c=b.options.trackClick;c=c.replace("http:",window.location.protocol);var a=new Element("img",{src:c,height:1,width:1,styles:{position:"absolute",bottom:0,left:0}});document.body.appendChild(a)}},addClickOutPixels:function(d,b){try{if(ta.has("remarketing.clickoutpixels")&&ta.has("remarketing.clickouturl")){var a=ta.retrieve("remarketing.clickouturl");if(a){if(b){a+="&isMetaCheckRates=true"}a=a.replace("replaceTxt",d)}ta.store("ads.monikerClickOutUrl",a);ta.common.ads.loadClickOutMonikers()}}catch(c){ta.util.error.record(c,"click out monikers failure (meta="+b+")")}},addMetaHacRoomInfoToOffer:function(d,c,b){if(!b||!c||!d){return}var a=ta.retrieve("ta.commerce.hacRoomInfo."+c)||new ta.commerce.HACRoomInfo(c);a.setRoomDetailKey(d,b);ta.store("ta.commerce.hacRoomInfo."+c,a)},startScooter:function(){try{if(typeof ta!="undefined"&&ta.p13n&&ta.p13n.Scooter){var a=ta.retrieve("scooterObj");if(a&&a!="undefined"){a.removeScooter(a);ta.remove("scooterObj")}var a=new ta.p13n.Scooter();if(a){if(ta.retrieve("checkrates.hotel_flyout_micro_meta")&&a.getScooterContent){a.getScooterContent(a)}else{if(a.getScooterContentNonAjax){a.getScooterContentNonAjax(a)}}ta.store("scooterObj",a);ta.trackEventOnPage("scooter","Displayed",null,0,true)}}}catch(b){ta.util.error.record(b,"startScooter failed")}},getBookingUrl:function(c,d,a){var b="/HotelBookingRoomSelectionHtml?";if(c){b=b+"detail="+c+"&"}if(d){b=b+"src_0="+d+"&"}if(a){b=b+"m="+a+"&"}b=b+"adults=2";return b},getTravelDataForURL:function(){try{var d=[];var i=ta.retrieve("meta.travelData");i=ta.commerce.checkrates.getTravelDataFromDOM();if(i&&i.sInMonthYear&&i.sOutMonthYear&&i.inDay&&i.outDay&&i.adults){var g=i.sInMonthYear,c=i.sOutMonthYear,b=i.inDay,a=i.outDay,f=i.adults;d.push("inMonth=");d.push(g[0]);d.push("%20");d.push(g[1]);d.push("&inDay=");d.push(b);d.push("&outMonth=");d.push(c[0]);d.push("%20");d.push(c[1]);d.push("&outDay=");d.push(a);d.push("&adults=");d.push(f)}return d.join("")}catch(h){ta.util.error.record(h,"getTravelDataForURL")}}};ta.queueForLoad(function(){var c=false;try{c=window.location.href}catch(b){}if(c){var a=ta.retrieve("pcr.initialUrl");if(!a){a=c;ta.store("pcr.initialUrl",a)}}if(ta.commerce.checkrates.showMetaCheckRates()){ta.commerce.checkrates.checkAllProviders()}},"pcr.inititalUrl and metro check all providers");
ta.commerce.HACRoomInfo=new Class({initialize:function(a){this.locId=a;this.offers={}},getRoomDetailKey:function(a){a=""+a;return(a in this.offers)?this.offers[a]["roomDetailKey"]:null},setRoomDetailKey:function(b,a){b=""+b;if(!(b in this.offers)){this.offers[b]={}}this.offers[b]["roomDetailKey"]=a}});
ta.commerce.Vendor=new Class({Implements:Options,options:{checkboxID:false,additionalOffer:false,defaultChecked:false,minDaysOut:0,maxDaysOut:0},initialize:function(c,d,e,a,b){this.setOptions(c);this.name=d;this.url=e;this.window=null;this.slot=null;this.opened=false;this.vendorName=a;this.propertyId=b;this.isFlight=false},isChecked:function(){if(ta.retrieve("isMetaCheckboxCheckRates")){return this.isCheckedWithExtension("_met")}else{return this.isCheckedWithExtension()}},isCheckedWithExtension:function(d){if(this.options.checkboxID){if(d){a=ta.id(this.options.checkboxID+d);if(a){return a.checked}}var a=ta.id(this.options.checkboxID);if(!a){a=ta.id(this.options.checkboxID+"_pop")}if(!a){a=ta.id(this.options.checkboxID+"_icr")}if(!a){a=ta.id(this.options.checkboxID+"_per")}if(!a){a=ta.id(this.options.checkboxID+"_met")}if(!a){a=ta.id(this.options.checkboxID+"_amo")}if(a){try{var b=ta.id(a).getParent("li");if(b&&b.style.display=="none"){return false}}catch(c){ta.util.error.record(c,"cr checkbox hidden check")}return a.checked}}return this.options.defaultChecked&&(this.options.available||ta.retrieve("checkrates.datesChanged"))},isAvailable:function(){if(!this.isOpened()){return true}return false},isOpened:function(){try{if(!this.opened||!this.hasWindow()){return(ta.has("checkrates.cr_provider_on_mousedown")&&ta.retrieve("checkrates.cr_mousedown_provider")==this.name)}}catch(a){}return true},isDefaultChecked:function(){return this.options.defaultChecked},isHidden:function(){var a=ta.id(this.options.checkboxID);if(!a){a=ta.id(this.options.checkboxID+"_pop")}if(!a){a=ta.id(this.options.checkboxID+"_icr")}if(a){try{var b=ta.id(a).getParent("li");if(b){if(b.style.display=="none"){return true}else{if(this.options.hide){if(b.style.display=="block"){return false}else{return true}}}}}catch(c){ta.util.error.record(c,"checkbox hide check")}}return false},hasWindow:function(){if(!this.window||!this.window.windowObject||!("closed" in this.window.windowObject)||this.window.windowObject.closed){return false}return true},addRoomDetailKeyParameters:function(a){var b=a;if(this.getLowestPriceRoomDetailKey()){b+="&rdex="+this.getLowestPriceRoomDetailKey()}return b},getUrl:function(d,a){var i=this.url;if(this.isFlight){i+="&"+d.getFlightData()}else{if(ta.has("metaDatePickerEnabled")&&ta.widgets&&ta.widgets.calendar&&ta.widgets.calendar.hasPageDates()){i+="&"+ta.commerce.checkrates.multiDatePickerUserData();if(d.type=="geocheckrates"){i=ta.commerce.checkrates.addCustomUrlParams(i,"QC_Inline_Geo")}}else{if(d.type!="checkdeals"){var e=d.getUserData();if(!e){e=ta.retrieve("checkrates.avUserData")}i+="&"+e;var h="QC_Inline";var c=a;if(c){var g=false;if(g=c.className.match(/custom_area_(\w+)/)){h=g[1]}}i=ta.commerce.checkrates.addCustomUrlParams(i,h)}else{if(ta.has("photo.viewer.isPhotoLBClick")){i=ta.commerce.checkrates.addCustomUrlParams(i,"QC_Inline")}}}}var c=d.actualTrigger||a;var b=c&&(c.hasClass("msk")?c:c.getParent(".msk"));if(b){var f=b.className.match(/msk[^\s]+/);if(f&&f.length>0){i+="&msk="+f[0].substr(3)}}if(ta.has("metaCacheKey")){i+="&"+ta.retrieve("metaCacheKey")}i=this.addRoomDetailKeyParameters(i);return i},errorString:function(){var a=[];if(this.name){a.push("&name_");a.push(this.name)}if(this.slot){a.push("&slot_full")}if(this.propertyId){a.push("&propId_");a.push(this.propertyId)}var b=a.join("");if(b&&b[0]){return b.slice(1)}return"noInfo"},hasDateLimits:function(){return this.options.minDaysOut>0||this.options.maxDaysOut>0},getContentID:function(){if(this.url){return ta.util.URL.getParameter(this.url,"src")}return false},getLowestPriceRoomDetailKey:function(){var b=this.propertyId;var c=this.getContentID();var a=ta.retrieve("ta.commerce.hacRoomInfo."+b);return a?a.getRoomDetailKey(c):null}});
ta.commerce.VendorSet=new Class({Implements:Options,options:{vendorSet:false},initialize:function(b,a){this.setOptions(b);this.vendorSetId=a;if(this.options.vendorSet){this.vendors=this.options.vendorSet}this.vendorsUnchecked=[];this.vendorsDefaultUnchecked=[]},getVendors:function(){if((!this.vendors)||ta.has("checkrates.sponsored_vendors.loc."+this.vendorSetId)){this.vendors=ta.retrieve("checkrates.vendors."+this.vendorSetId)}return this.vendors},getVendorsUnchecked:function(){var c=ta.retrieve("checkrates.vendors."+this.vendorSetId);for(var a=0;a<c.length;a++){var b=c[a];if(!b.isChecked()&&!b.isHidden()){this.vendorsUnchecked.push(b)}}return this.vendorsUnchecked},getAllVendorIds:function(){var b=[];var c=this.getVendors();for(var a=0;a<c.length;a++){var d=c[a];b.push(d.getContentID());b.push("__")}if(b.length>0){b.pop()}return b.join("")},getVendorsDefaultUnchecked:function(){try{var d=ta.retrieve("checkrates.vendors."+this.vendorSetId);for(var a=0;a<d.length;a++){var c=d[a];if(!c.isChecked()&&!c.isHidden()&&!c.isDefaultChecked()){this.vendorsDefaultUnchecked.push(c)}}return this.vendorsDefaultUnchecked}catch(b){ta.util.error.record(b,"vendorSet - default unchecked")}},setVendorSetDefaultChecked:function(c){var b=this.getVendors();for(var a=0;a<b.length;a++){b[a].options.defaultChecked=c}},getCheckedInfo:function(p){var q=0;var o=0;var b=0;var c=[];var g=[];var k=[];var r=[];var d=[];var a=[];var s=[];try{var n=this.getVendors();for(var f=0;f<n.length;f++){var m=n[f];d.push(m.name);d.push("__");if(m.isChecked()){q++;c.push(m.name);c.push("__");g.push(m.vendorName);g.push("__");s.push(m.getContentID());s.push("__")}else{a.push(m.name);a.push("__")}if(m.window&&m.window.closed){m.window=null}else{if(m.isOpened()){o++;k.push(m.name);k.push("__")}}}var l=ta.retrieve("checkrates.vendors."+this.vendorSetId);for(var f=0;f<l.length;f++){var h=l[f];if(h.isHidden()){b++;r.push(h.name);r.push("__")}}if(c.length>0){c.pop()}if(g.length>0){g.pop()}if(k.length>0){k.pop()}if(r.length>0){r.pop()}if(d.length>0){d.pop()}if(a.length>0){a.pop()}if(s.length>0){s.pop()}if(p=="unavail_set"){return{vendorsAvailable:d.join(""),vendorsOpened:k.join("")}}else{if(p=="unchecked"){return{vendorsUnchecked:a.join("")}}else{if(p=="count"){return q}else{if(p=="tpw_string"){return c.join("")}else{if(p=="tpv_string"){return g.join("")}else{if(p=="open_count"){return o}else{if(p=="check_more"){return{vendorsChecked:c.join(""),vendorsOpened:k.join(""),vendorsHidden:r.join("")}}else{if(p=="now_checking"){return{vendorsChecked:c.join("")}}else{if(p=="checked_content_id"){return s.join("")}}}}}}}}}}catch(j){}return{checked:q,tpw_string:c.join(""),tpv_string:g.join(""),open:o,tpw_open_string:k.join("")}},getCheckedCount:function(){return this.getCheckedInfo("count")},getCheckedString:function(){return this.getCheckedInfo("tpw_string")},getCheckedVendor:function(){return this.getCheckedInfo("tpv_string")},getCheckedContentID:function(){return this.getCheckedInfo("checked_content_id")},oneChecked:function(){var a=this.getCheckedCount();if(a==0){alert(js_0001);return false}return true},getOpenCount:function(){return this.getCheckedInfo("open_count")},storeCheckBoxValues:function(){var a={};this.getVendors().each(function(b){a[b.name]=b.isChecked()});ta.store("checkBoxSet_"+this.vendorSetId,a)},errorString:function(){var a=[];var b=this.getVendors();if(!b||b.length<1){return"empty.vendor.set"}a.push("VSet::");b.each(function(d,c){a.push("V");a.push(c);a.push(":");a.push(d.errorString())});return a.join("")}});
ta.commerce.CheckRatesData=new Class({Implements:Options,options:{type:"checkRates",evnt:false},initialize:function(c,b,d,a){this.setOptions(c);this.type=this.options.type;this.vendorSetId=d;this.isCheckMore=a;this.maxAllowedWin=0;this.maxHoldingWin=2;this.useHoldingWin=false;this.cap=3;this.lbDelay=1000;this.providerOnMouseDown=false;this.skipHoldingWin=false;if(ta.has("checkrates.cr_provider_on_mousedown")&&c&&c.evnt&&c.evnt.type=="mousedown"){this.providerOnMouseDown=true}if(Browser.chrome){ta.popups.PopUtil.useShiftClick();if(!ta.has("checkrates.use_chrome_provider_on_shift_click")){if(Browser.version==22){this.maxAllowedWin=2}else{if(Browser.version>22){this.maxAllowedWin=1}}if(ta.has("checkrates.cr_provider_on_mousedown")){this.maxAllowedWin+=1}}}else{if(Browser.ie){this.maxAllowedWin=1}}this.propId=b;if(!this.propId){this.propId=this.vendorSetId}if(this.vendorSetId){this.vendorSet=new ta.commerce.VendorSet({},this.vendorSetId)}},showInfo:function(a){if(this.infoField){this.infoField.addClass("errorSpan");this.infoField.setContent(a).show()}},hideInfo:function(){if(this.infoField){this.infoField.hide();this.infoField.removeClass("errorSpan")}},showErrors:function(f,b){var a=[];if(!ta.retrieve("ta.commerce.CheckRatesData.cssAsset")){ta.store("ta.commerce.CheckRatesData.cssAsset",Asset.css(CDNHOST+"/css2/common/validation_error.css"))}if(b!=null&&b instanceof Array&&b.constructor==Array){a=b}else{a.push(b)}for(var e=0;e<a.length;e++){var d=a[e];if(d){d.addClass("errorInput");var c=ta.id("lbl_"+d.id);if(c){c.addClass("errorLabel")}}}this.showInfo(f)},clearErrors:function(a,c){var b=ta.id("lbl_"+a.id);var d=ta.id("lbl_"+c.id);if(a){a.removeClass("errorInput")}if(c){c.removeClass("errorInput")}if(b){b.removeClass("errorLabel")}if(d){d.removeClass("errorLabel")}},validate:function(){if(!this.propId||!this.vendorSetId||!this.getVendorSet()){try{var a="NoVendSet";if(this.getVendorSet()){a=this.getVendorSet().errorString()}ta.util.error.record(null,"cr data validate",new Event(this.options.evnt),{propId:this.propId,vendorSetId:this.vendorSetId,vendorSet:a})}catch(b){}return false}if(!this.getVendorSet().oneChecked()||!this.validateDates()){return false}return true},getVendorSet:function(){if(this.reorderedVendorSet){return this.reorderedVendorSet}return this.vendorSet},getAvailVendorSet:function(){if(!this.availVendorSet){this.setAvailVendorSet()}return this.availVendorSet},getOriginalVendorSet:function(){return this.vendorSet},validateDates:function(){var c=ta.id("checkIn_"+this.vendorSetId);var d=ta.id("checkOut_"+this.vendorSetId);var a=false;checkInElemPer=ta.id("checkIn_"+this.vendorSetId+"_per");if(checkInElemPer){c=checkInElemPer;d=ta.id("checkOut_"+this.vendorSetId+"_per")}checkInElemPto=ta.id("checkIn_"+this.vendorSetId+"_pto");if(checkInElemPto){c=checkInElemPto;d=ta.id("checkOut_"+this.vendorSetId+"_pto")}checkInElemPto=ta.id("checkIn_"+this.vendorSetId+"_pal");if(checkInElemPto){c=checkInElemPto;d=ta.id("checkOut_"+this.vendorSetId+"_pal")}checkInElemMeta=ta.id("checkIn_"+this.vendorSetId+"_met");if(checkInElemMeta){c=checkInElemMeta;d=ta.id("checkOut_"+this.vendorSetId+"_met")}var b=ta.id("checkIn_"+this.vendorSetId+"_inm");if(b){c=b;d=ta.id("checkOut_"+this.vendorSetId+"_inm")}if(ta.has("checkrates.date_picker_on_classic")&&!ta.widgets.calendar.datesExist()){this.errorMsg=this.dateErrorCheck(this.inDate);this.showErrors(this.errorMsg,null);return false}else{if(!this.formElem||!c||!d||!c.value||!d.value){if(!c){c=ta.id("checkIn_"+this.vendorSetId+"_pop");d=ta.id("checkOut_"+this.vendorSetId+"_pop")}if(!this.formElem||!c||!d||!c.value||!d.value){return true}}}this.inDate=this.parseDate(c.value);this.outDate=this.parseDate(d.value);this.clearErrors(c,d);this.errorMsg=this.dateErrorCheck(this.inDate);if(this.errorMsg){this.showErrors(this.errorMsg,c);a=true}this.errorMsg=this.dateErrorCheck(this.outDate);if(this.errorMsg){this.showErrors(this.errorMsg,d);a=true}if(this.inDate&&this.outDate&&(this.outDate.getTime()<=this.inDate.getTime())){this.errorMsg=js_0003;this.showErrors(this.errorMsg,[d,c]);a=true}if(a){new Request({url:"/ActionRecord?action=DaodaoInlineCRClick"}).send();var e=ta.retrieve("daodao.checkrate.error.nodate");if(e!=null){}}return !a},parseDate:function(b){var d=false;if(DATE_FORMAT&&b){var c=b.match(DATE_FORMAT.pattern);if(c){var e=parseInt(c[DATE_FORMAT.date].replace(/^0/,""));var a=parseInt(c[DATE_FORMAT.month].replace(/^0/,""));var f=parseInt(c[DATE_FORMAT.year].replace(/^0/,""));if(e>0&&e<32&&a>0&&a<13){if(f<100){f+=2000}d=ta.util.date.create(f,a-1,e)}}}return d},dateErrorCheck:function(c){if(!c||isNaN(c)){if(js_invalid_dates_text_new2){return js_invalid_dates_text_new2}return" "}var b=new Date();ta.util.date.normalize(b);var a=ta.util.date.create(b.getFullYear(),b.getMonth(),b.getDate()+330);if(c.getTime()<b.getTime()){if(js_0002){return js_0002}return" "}if(a.getTime()<c.getTime()){if(js_0004){return js_0004}return" "}return false},getMetaUserData:function(f){var b=ta.widgets.calendar.getCheckRatesData();if(b){return b}var a=ta.retrieve("avail.data."+f);if(a){ta.store("avail.data."+f,a);return a.getState(true)}var d=ta.id("date_picker_"+f);if(!d){d=ta.id("date_picker_"+f+"._met")}if(d){a=new ta.commerce.AvailDataWidget(false,f);if(instanceOf(a.calendar,ta.widgets.SingleDateCalendar)){a.calendar.inDate=a.calendar.getPageInDate();a.calendar.outDate=a.calendar.getPageOutDate()}return a.getState(true)}var e=ta.retrieve("avail.data.objects");if(e){var c=e[0];if(c&&c.getState){return c.getState(true)}}return null},getUserData:function(){if(!this.userData){var c=this.vendorSetId;var d=[];if(ta.has("metaDatePickerEnabled")){var a=this.getMetaUserData(c);if(!a){return""}d.push(Object.toQueryString(a));var o=ta.retrieve("checkrates.originAirport");if(o&&o.length==3){d.push("&Orig=");d.push(o)}}else{var m=ta.id("qcInMonth_"+c);if(!m){c=this.vendorSetId+"_pop";m=ta.id("qcInMonth_"+c)}if(!m){return""}var h=ta.id("qcOutMonth_"+c);var f=ta.id("qcInDay_"+c);var p=ta.id("qcOutDay_"+c);var n=ta.id("qcAdults_"+c);var i=m.value.split(/\//);var e=h.value.split(/\//);var j=ta.util.date.create(i[1],i[0]-1,f.value);var g=ta.util.date.create(e[1],e[0]-1,p.value);var b=new Date();ta.util.date.normalize(b);if(j.getTime()<b.getTime()||g.getTime()<b.getTime()){alert(js_0002);return""}var l=ta.util.date.create(b.getFullYear(),b.getMonth(),b.getDate()+330);if(j.getTime()>l.getTime()||g.getTime()>l.getTime()){alert(js_0004);return""}d.push("inMonth=");d.push(i[0]);d.push("%20");d.push(i[1]);d.push("&inDay=");d.push(escape(f.value));d.push("&outMonth=");d.push(e[0]);d.push("%20");d.push(e[1]);d.push("&outDay=");d.push(escape(p.value));d.push("&adults=");d.push(n.selectedIndex+1);var o=ta.retrieve("checkrates.originAirport");if(o&&o.length==3){d.push("&Orig=");d.push(o)}}var k=ta.id("hacPid"+c);if(k==null){k=ta.id("hacPid")}if(k&&k.value){d.push("&pid=");d.push(k.value)}this.userData=d.join("")}return this.userData},getFlightData:function(){var a=this.vendorSetId;var h=ta.id("qcInMonth_"+a);if(!h){a=this.vendorSetId+"_pop";h=ta.id("qcInMonth_"+a)}if(!h){return false}var e=ta.id("qcOutMonth_"+a);var c=ta.id("qcInDay_"+a);var i=ta.id("qcOutDay_"+a);var f=h.value.split(/\//);var d=e.value.split(/\//);var b=[];b.push("date0=");b.push(f[1]);b.push(f[0]);b.push(escape(c.value));b.push("&date1=");b.push(d[1]);b.push(d[0]);b.push(escape(i.value));var g=ta.id("qcFlightOfferPid");if(g&&g.value){b.push("&pid=");b.push(g.value)}return b.join("")},getCROpenCount:function(b){var a=0;b.each(function(d){var c=d.window;if(d&&d.bOpened&&c&&c.windowObject&&!c.windowObject.closed){a++}});return a},fixPopOrder:function(r){var c=this.getCheckedVendors();var n=ta.popups.PopUtil.getHoldingWindowSet();var l=this.getVendorSet().getOpenCount();var b=n.length+l;var g=this.getVendorSet().getCheckedCount();if((b+1)<g){var a=false;try{a=window.chrome}catch(m){}var i=2;var q=a?true:ta.popups.PopUtil.tryHoldingWindows(this.propId,i);if(ta.has("checkrates.chrome_dates_entry_holding")&&Browser.chrome&&!ta.has("checkrates.use_chrome_provider_on_shift_click")){r=Math.min(r,(n.length+this.maxAllowedWin))}if(q&&r<c.length){var h=c.splice(0,r).reverse();c=h.concat(c)}else{if(q){c=c.reverse()}else{var o=n.length+1;if(ta.has("checkrates.add_holding_windows")){o=Math.min(o,r)}var p=[];for(var f=0;f<o;f++){p.push(c.shift())}for(var d=0;d<p.length;d++){c.unshift(p[d])}}}}else{c=c.reverse()}this.reorderedVendorSet=new ta.commerce.VendorSet({vendorSet:c},this.vendorSetId)},getCheckedVendors:function(){try{var a=this.getVendorSet().getVendors().slice();var b=[];a.map(function(e,d){if(e.isChecked()){b.push(e)}});return b}catch(c){ta.util.error.record(c,"getCheckedVendors")}},setAvailVendorSet:function(){try{var b=[];var h=this.getVendorSet().getVendors();var c=ta.retrieve("availability_check");if(c){for(var a=0;a<h.length;a++){var f=h[a];var g=c.unavailableProviders;if(!g||!g[f.name]){b.push(f)}}this.availVendorSet=new ta.commerce.VendorSet({vendorSet:b},this.vendorSetId)}}catch(d){ta.util.error.record(d,"availability check - crData set vendor set")}}});
